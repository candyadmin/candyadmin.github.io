<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>es常用命令 | 点到为止</title><meta name="keywords" content="学习笔记"><meta name="author" content="candy"><meta name="copyright" content="candy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="es常用命令"><meta name="application-name" content="es常用命令"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="es常用命令"><meta property="og:url" content="https://candyadmin.github.io/elasticsearch/es%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/index.html"><meta property="og:site_name" content="点到为止"><meta property="og:description" content="以下是 Elasticsearch (ES) 常用命令的总结和笔记： 1. 查看索引相关信息 查看指定索引的映射信息 1GET kibana_sample_data_ecommerce  查看指定索引的文档总数 1GET kibana_sample_data_ecommerce&amp;#x2F;_count  查看"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="candy"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="以下是 Elasticsearch (ES) 常用命令的总结和笔记： 1. 查看索引相关信息 查看指定索引的映射信息 1GET kibana_sample_data_ecommerce  查看指定索引的文档总数 1GET kibana_sample_data_ecommerce&amp;#x2F;_count  查看"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://candyadmin.github.io/elasticsearch/es%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: candy","link":"链接: ","source":"来源: 点到为止","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '点到为止',
  title: 'es常用命令',
  postAI: '',
  pageFillDescription: '1. 查看索引相关信息, 2. 查看索引状态与信息, 3. 查看节点信息, 4. 查看集群健康状况, 5. 查看集群状态, 6. 查看集群设置, 7. 查看分片信息, 1. 创建文档, 2. 根据 ID 获取文档, 3. 更新文档, 4. 删除文档, 5. 批量操作 (Bulk API), 6. 多文档获取 (MGET), 7. 多查询操作 (MSEARCH), 8. 清除测试数据, 1. 分析 Mastering Elasticsearch, 2. 分析 Elasticsearch Server, 3. 分析 Elasticsearch Essentials, 结果, 1. Standard Analyzer, 2. Simple Analyzer, 3. Stop Analyzer, 4. Whitespace Analyzer, 5. Keyword Analyzer, 6. Pattern Analyzer, 7. English Analyzer, 8. ICU Analyzer for Chinese Text, 9. Standard Analyzer for Chinese Text, 10. ICU Analyzer for Another Chinese Sentence, 总结, 1. 基本查询, 2. 带 Profile 的查询, 3. 泛查询对所有字段进行查询, 4. 指定字段查询, 5. 查找美丽心灵, 6. 泛查询, 7. Phrase 查询（短语查询）, 8. 分组查询（使用括号）, 9. 布尔操作符查询, 10. 范围查询, 11. 通配符查询, 12. 模糊查询 amp 近似度匹配, 总结, 1. 忽略不存在的索引（ignore_unavailable=true）, 2. 分页查询, 3. 日期排序, 4. 源过滤, 5. 脚本字段, 6. match 查询, 7. match 查询并使用 AND 操作符, 8. match_phrase 查询（短语匹配）, 9. match_phrase 查询并使用 slop, 总结, 1. 向索引添加文档, 2. query_string 查询：查询名称中包含 Ruan 和 Yiming 的文档, 3. query_string 查询：多个字段和复杂查询, 4. simple_query_string 查询（默认操作符为 OR）, 5. simple_query_string 查询（默认操作符为 AND）, 6. query_string 查询：查询电影标题包含 Beautiful 和 Mind, 7. query_string 查询：多个字段查询, 8. simple_query_string 查询：使用 + 进行短语匹配, 总结, 映射和字段定义, 动态映射（Dynamic Mapping）, 操作演示, 总结, 1. index false 设置, 2. null_value 设置, 3. copy_to 设置, 4. 数组类型处理, 总结常见的 Mapping 参数, 1. 自定义 Analyzer 和 Char Filter, 自定义 Tokenizer 和 Char Filter 示例, Path Hierarchy Tokenizer, 2. Char Filter 替换符号, 3. Char Filter 替换表情符号, 4. 使用 Stop 和 Snowball 过滤器, 5. 正则表达式替换, 总结：, 1. Index Templates (索引模板), 创建默认模板, 为特定模式创建模板, 查看模板, 删除模板, 2. Dynamic Templates (动态模板), 自动映射数字字符串和日期字符串, 定义动态模板映射规则, 结合路径匹配, 搜索字段, 总结：, 1. 基本的聚合分析：按目的地分桶统计, 2. 增加更多统计：平均、最大、最小价格, 3. 聚合价格与天气信息：统计与多重聚合, 常见的聚合类型：, 相关阅读：以下是常用命令的总结和笔记查看索引相关信息查看指定索引的映射信息查看指定索引的文档总数查看前条文档查看索引状态与信息查看索引信息查看状态为绿的索引按文档个数排序查看索引查看具体的索引字段健康主分片复制分片文档数等查看每个索引使用的内存量查看节点信息查看所有节点信息查看特定节点信息查看节点信息并显示特定字段查看集群健康状况查看集群健康状况查看集群健康状况并按分片级别显示查看特定索引的集群健康状况查看特定索引的集群健康状况并按分片级别显示查看集群状态查看集群状态查看集群设置查看集群设置查看集群设置包括默认设置查看分片信息查看集群的所有分片信息查看特定的分片信息包括状态主分片副本分片等创建文档自动生成创建文档指定创建文档如果已存在则报错指定创建文档如果已存在则报错根据获取文档获取指定的文档更新文档更新指定的文档先删除再写入在原文档上增加字段删除文档根据删除文档批量操作执行批量操作第一次执行批量操作第二次执行批量操作多文档获取获取多个文档中指定索引使用参数指定返回的字段多查询操作执行多个查询清除测试数据删除索引清除数据倒排索引入门的它用于分析文本查看在特定分析器下文本是如何被分词和处理的下面是每个请求的说明分析分析器使用默认的分析器文本预期效果分析器会将这段文本分割成单词通常会根据空格和标点符号进行分词分析分析器同样使用分析器文本预期效果分析器会分割文本为单词可能会得到类似于的分词结果分析分析器继续使用分析器文本预期效果分析器会将文本分割成结果每个请求的结果将显示由分析器生成的分词结果通常分析器会去除大部分标点符号并将文本转换为小写分词的具体结果如下以下是使用不同的分析器对文本进行分词分析的示例标准分析器会根据空格标点符号等进行分词并将所有文本转换为小写分词结果简单分析器按非字母字符切分符号会被过滤文本会转换为小写分词结果停用词分析器会将文本转换为小写并过滤掉常见的停用词如分词结果空格分析器会按空格切分文本并且不会转换为小写分词结果关键字分析器不进行分词直接返回原始文本分词结果模式分析器使用正则表达式进行分词默认使用非字母字符作为分隔符分词结果英语分析器针对英语语言进行分词去除停用词等分词结果使用来处理中文文本适用于多语言环境中的分词他说的确实在理分词结果他说的确实在理使用标准分析器处理中文文本通常处理中文时可能不会像中文专用分析器那样精确他说的确实在理分词结果他说的确实在理处理另一个中文句子这个苹果不大好吃这个苹果不大好吃分词结果这个苹果不大好吃总结每种分析器具有不同的分词行为根据空格和标点符号分词并小写化过滤非字母字符并小写化去除停用词并小写化仅按空格分词不进行大小写转换不进行分词返回整个文本使用正则表达式分词默认分割为英语文本设计的分析器去除停用词适合多语言的分词特别适用于中文等非拉丁字母语言这些分析器可以根据不同的语言和需求来优化索引和搜索以下是您提供的一些查询示例涵盖了基本查询带有分析的查询布尔查询范围查询通配符查询模糊查询等操作下面是每种查询的详细解释和用法基本查询查询索引中标题为的电影并根据字段降序排序返回前条结果查询内容为指定查询字段为按字段降序排序分页返回前条数据查询超时限制为秒带的查询启用可以帮助分析查询性能查看查询的每个阶段的时间启用查询性能分析泛查询对所有字段进行查询使用字段进行泛查询查询所有字段查询所有字段中包含的数据指定字段查询查询字段中包含的记录并按照字段降序排序指定查询字段为查询内容为查找美丽心灵查询字段包含的记录泛查询查询字段包含的记录查询短语查询查询字段精确匹配使用引号表示精确短语匹配要求字段内容必须完全匹配短语分组查询使用括号查询字段中包含的记录使用括号可以进行分组查询类似逻辑上的括号优先级布尔操作符查询查询查询字段同时包含和的记录查询查询字段包含但不包含的记录查询查询字段包含或的记录范围查询查询字段包含且在到年之间的记录指定字段的范围查询通配符查询查询字段以开头的所有记录使用通配符查询以开头的字符串模糊查询近似度匹配模糊匹配查询字段中的词语允许有个字符的错误近似度匹配查询字段中的短语允许个字符的误差总结这些查询展示了如何使用提供的强大查询能力来根据不同的需求筛选和搜索数据常见的查询类型包括基本查询用于查找单一词汇布尔查询组合多个查询条件范围查询查找特定范围内的记录通配符查询模糊匹配短语查询精确匹配整个短语同时参数可以帮助分析查询性能优化查询响应与简介以下是您提供的查询操作包括分页日期排序源过滤脚本字段以及不同的查询类型如这些操作展示了如何在中进行更精细的查询和数据处理忽略不存在的索引在查询时如果访问的索引不存在使用可以避免报错在访问不存在的索引时忽略错误分页查询查询索引并分页返回数据从第条开始返回条记录和分页跳过前条返回接下来的条日期排序按字段降序排序按照字段降序排序源过滤只返回文档中的字段不返回其他字段指定只返回字段的数据脚本字段使用脚本字段计算新的字段例如拼接和使用脚本创建新的字段将字段与字符串拼接查询查询索引中字段包含的记录进行标准的全文匹配查询查询并使用操作符查询包含且两个词都必须出现的记录使用操作符两个词必须同时出现在字段中查询短语匹配查询字段精确匹配作为一个短语精确匹配整个短语必须按照指定的顺序查询并使用查询字段中的短语并允许个词语的偏移即词语可以有一定的顺序变化允许最多个词语的顺序偏移例如也可以匹配总结这些查询展示了中常用的查询类型分页查询使用和来实现分页日期排序使用来对结果进行排序源过滤通过限制返回的字段脚本字段使用脚本来计算新字段布尔操作符通过来定义查询的逻辑短语匹配和偏移通过和来进行更灵活的查询这些查询可以帮助你在中实现复杂的搜索需求查询以下是您提供的查询操作涉及到和查询的使用以及如何通过不同的字段和操作符执行复杂查询这里的查询包括布尔操作符字段匹配以及指定默认操作符等向索引添加文档首先向索引添加两个用户文档查询查询名称中包含和的文档使用查询指定默认字段为查询条件为用于执行复杂的查询可以使用逻辑操作符如查询多个字段和复杂查询查询名称或简介字段包含或的文档可以指定多个字段进行查询包含布尔操作符如查询默认操作符为执行一个简单查询默认操作符为查询字段中包含或的文档适用于较简单的查询避免了复杂的查询语法查询默认操作符为查询字段中包含且的文档使用作为默认操作符设置默认操作符或在此示例中用于要求和必须同时出现在字段中查询查询电影标题包含和执行查询查询电影标题中包含和的文档执行复杂查询可以使用布尔操作符如查询多个字段查询查询电影的或字段包含的文档指定多个字段进行查询这里同时查询和字段查询使用进行短语匹配查询电影标题中包含和的文档使用确保两个词都出现在查询中操作符用于强制要求某个词出现在查询结果中总结这些查询展示了如何在中使用不同类型的查询查询用于执行复杂的查询可以包含多个字段布尔操作符以及通配符等查询比更简单适用于不需要复杂语法的查询并且支持默认操作符的配置字段查询可以针对多个字段同时查询指定多个字段使用参数布尔操作符如控制查询的逻辑这些查询方式非常适合处理复杂的检索需求和常见字段类型您的示例展示了如何在中管理映射以及如何处理动态字段和映射更新以下是总结和解释映射和字段定义映射在中类似于关系数据库中的表结构定义主要用于定义字段的名称指定文档中的字段名定义字段的类型比如文本关键字日期等定义倒排索引相关配置比如是否需要索引字段以及字段的配置动态映射动态映射允许根据新文档自动推断字段的类型可以通过属性来配置动态行为默认允许新字段自动被索引和映射禁止自动创建新字段但已存在字段可以继续使用禁止任何新的字段如果文档包含未定义的字段将导致错误操作演示写入文档并查看映射向索引中添加一个文档查看映射动态映射推断字段类型新字段等被自动推断并加入映射新增字段默认动态如果动态映射为默认可以动态添加新的字段修改动态设置为修改设置为禁止自动推断新字段在此示例中将不会被索引或搜索因为动态映射已设置为修改为模式如果将设置为任何新的字段都会导致错误此时写入新字段会导致错误返回错误码删除索引删除索引总结动态映射允许自动推断并添加新的字段方便快速处理未知数据配置控制是否允许自动映射新字段默认允许动态字段禁止自动映射新字段禁止所有未知字段如果有未定义字段则会报错更改映射映射一旦建立后不能直接修改字段类型要修改字段配置或添加新字段需要使用操作这些操作有助于管理索引和字段的生命周期确保数据能够根据业务需求灵活适应您的示例展示了中显式设置映射的一些常见操作和参数以下是各个设置项的详细介绍和使用案例设置通过设置字段的可以阻止某些字段被索引这样可以避免该字段参与倒排索引也不会进行搜索示例禁止索引该字段搜索时不会命中字段在上面的示例中字段被设置为因此无法用于搜索查询设置通过设置可以在文档中存储值并用指定的替代值替换这对于查询时需要处理数据特别有用示例值替代为实际值是没有字段搜索时会匹配到值字段此设置可以确保查询时用代替存储的值设置可以将多个字段的内容复制到另一个字段方便进行联合查询或索引示例将复制到字段将复制到字段联合查询字段这里和字段的内容会被复制到字段从而使得查询变得更加方便数组类型处理支持数组字段数组中的每个元素会被视为一个单独的值这对于多值字段非常有用示例字段为单一值字段为数组在此示例中字段既可以是单个值也可以是数组会将每个数组元素视为独立的值进行索引总结常见的参数字段的数据类型如等控制是否索引该字段表示不索引默认为控制值的替代值可以设置为任何替代值如将多个字段的内容复制到一个目标字段中便于联合查询控制动态映射表示允许自动推断新字段表示禁止新字段自动映射则表示严格模式下不允许任何新字段通过这些映射设置可以更好地控制数据如何存储和索引以及如何在查询时处理和优化字段您的示例展示了中关于多字段特性以及自定义分析器的配置以下是对各个分析器和相关配置的详细解释自定义和提供了灵活的机制来配置分词器和字符过滤器这些配置用于在索引和搜索过程中控制文本的处理方式自定义和示例将整个文本当作一个单独的进行处理用于从文本中去除标签使用关键词分词器使用字符过滤器输入带有标签的文本输出将会是此配置移除了文本中的标签只保留了纯文本用于处理文件路径等层级结构的数据将路径按分隔符如切割使用路径层级分词器输出会将路径按切分替换符号字符过滤器可以用于替换文本中的特定符号或字符例如使用类型的可以替换文本中的字符如将替换为使用标准分词器使用字符映射过滤器此配置将文本中的替换为输出将是替换表情符号你还可以使用字符过滤器将表情符号替换为特定的文本如将替换为替换为输出替换表情符号为使用和过滤器使用过滤器来删除常见的停用词使用过滤器进行词干提取如将转换为使用空格分词器使用停用词和词干提取输出正则表达式替换通过字符过滤器您可以根据正则表达式来替换文本中的特定部分此配置将替换为一个空字符串结果为总结负责将输入文本切割成词条如处理文本中的字符替换去除特殊符号或标签等如用于文本处理如去除停用词或词干提取这些工具的组合允许您灵活地处理和分析文本数据并针对特定的业务需求优化索引和搜索行为在中和是两种强大的工具用于控制如何定义和管理索引的映射和设置以下是这两者的详细解释和示例索引模板是一种配置模板用于为匹配特定模式的索引自动配置设置映射和其他配置当创建一个新索引时如果该索引匹配模板中的配置模板中的设置映射和其他配置就会自动应用到新索引上创建默认模板下面是创建一个默认模板的示例匹配所有索引这会为所有索引设置一个模板其中包含分片数量为副本数量为为特定模式创建模板另一个例子是为开头的索引创建模板匹配所有以开头的索引禁止自动检测日期字段自动检测数字字段查看模板你可以查看已定义的模板查看所有模板删除模板删除模板的命令如下动态模板用于在创建索引时自动匹配字段类型和名称根据这些动态模板来生成字段的映射规则可以根据字段的类型例如字符串数字和字段名称例如以某些字符开头的字段来定义映射自动映射数字字符串和日期字符串例如数字字符串会被映射为类型日期字符串会被映射为日期类型字符串数字字符串日期在这个例子中会被映射成类型而会被映射成类型定义动态模板映射规则使用可以根据字段类型和名称定义映射例如以下动态模板将以开头的字符串字段映射为类型其他字符串字段映射为类型匹配所有字符串类型字段名称以开头匹配所有字符串类型在这个示例中字段会被映射为类型而其他字符串类型的字段则会被映射为类型结合路径匹配动态模板不仅可以基于字段名称还可以基于字段的路径例如以下模板会将路径下的所有字段映射为类型并将这些字段复制到字段中匹配下的所有字段排除字段将值复制到字段然后插入以下数据在这个例子中和字段将被映射为类型并且它们的内容会被复制到字段中搜索字段可以通过字段来搜索总结是为匹配特定索引模式的所有索引自动配置设置和映射的模板用于根据字段类型和字段名称自动映射索引字段你可以根据字段类型如或字段路径如来定义映射规则这些配置使得索引的创建和管理更加灵活可以根据实际数据自动推断和调整映射从而提高了的可用性和效率提供了强大的聚合功能用于对数据进行汇总和分析聚合是搜索的一个核心功能允许你通过多种方式对数据进行分组统计求最大最小值计算平均值等操作以下是一些常见的聚合分析操作和示例基本的聚合分析按目的地分桶统计在这个示例中我们按航班的目的地进行分桶统计查看每个目的地的航班数量不返回实际的文档数据只返回聚合结果按目的地国家分桶在这个聚合查询中聚合用于对字段的值进行分桶返回每个目的地国家的航班数量增加更多统计平均最大最小价格你可以在分桶内部添加更多聚合来获取其他统计信息如每个目的地的平均票价最高票价和最低票价计算平均票价计算最高票价计算最低票价在这个查询中我们为每个目的地添加了三个聚合和分别计算每个目的地的平均票价最大票价和最小票价聚合价格与天气信息统计与多重聚合如果你还想结合天气信息如字段与航班价格统计一起进行聚合可以使用嵌套聚合计算票价的多项统计信息按天气类型分桶只返回前个天气类型在这个示例中我们不仅计算了每个目的地的票价统计信息如平均票价最大票价等还将天气信息作为另一个聚合显示每个目的地的天气类型并限制返回的天气类型数量为个常见的聚合类型聚合将文档按某个字段的值进行分桶常用于统计词频或其他分类数据聚合计算某个数值字段的平均值聚合计算某个数值字段的总和聚合返回某个数值字段的最小值聚合返回某个数值字段的最大值聚合返回字段的统计信息包括最小值最大值平均值总和和文档数量聚合按日期进行分桶适用于时间序列数据聚合按数值区间进行分桶常用于数值数据的统计相关阅读聚合文档详细介绍了各种聚合的使用方式和示例聚合功能非常强大能帮助你从海量数据中提取有价值的信息适用于各种数据分析场景',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-02-27 17:25:21',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">点到为止</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://candyadmin.github.io/49172c7d-e632-47b4-9bc4-f792ae82b980.jpeg" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://candyadmin.github.io/49172c7d-e632-47b4-9bc4-f792ae82b980.jpeg"/></a><div class="post-qr-code-desc">微信</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/JNI/" style="font-size: 1.05rem;">JNI<sup>1</sup></a><a href="/tags/chrome/" style="font-size: 1.05rem;">chrome<sup>2</sup></a><a href="/tags/docker/" style="font-size: 1.05rem;">docker<sup>1</sup></a><a href="/tags/docker%E9%83%A8%E7%BD%B2/" style="font-size: 1.05rem;">docker部署<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>1</sup></a><a href="/tags/grafana-prometheus-springboot/" style="font-size: 1.05rem;">grafana,prometheus,springboot<sup>1</sup></a><a href="/tags/k8s/" style="font-size: 1.05rem;">k8s<sup>1</sup></a><a href="/tags/lua%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 1.05rem;">lua表达式<sup>1</sup></a><a href="/tags/nginx/" style="font-size: 1.05rem;">nginx<sup>2</sup></a><a href="/tags/openvpn/" style="font-size: 1.05rem;">openvpn<sup>2</sup></a><a href="/tags/%E4%BA%8B%E5%8A%A1/" style="font-size: 1.05rem;">事务<sup>1</sup></a><a href="/tags/%E4%BA%A4%E6%98%93%E7%AD%96%E7%95%A5/" style="font-size: 1.05rem;">交易策略<sup>1</sup></a><a href="/tags/%E5%82%B2%E4%BA%BA%E7%9A%84%E5%86%99%E6%B3%95/" style="font-size: 1.05rem;">傲人的写法<sup>1</sup></a><a href="/tags/%E5%91%BD%E4%BB%A4/" style="font-size: 1.05rem;">命令<sup>1</sup></a><a href="/tags/%E5%A4%87%E4%BB%BD/" style="font-size: 1.05rem;">备份<sup>2</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 1.05rem;">学习笔记<sup>2</sup></a><a href="/tags/%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/" style="font-size: 1.05rem;">实时数据同步<sup>1</sup></a><a href="/tags/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" style="font-size: 1.05rem;">常用命令<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 1.05rem;">并发<sup>1</sup></a><a href="/tags/%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF/" style="font-size: 1.05rem;">开机自启<sup>1</sup></a><a href="/tags/%E6%89%93%E5%8D%B0%E5%BC%82%E5%B8%B8%E6%97%A5%E5%BF%97/" style="font-size: 1.05rem;">打印异常日志<sup>1</sup></a><a href="/tags/%E6%89%A9%E5%AE%B9%E7%A3%81%E7%9B%98/" style="font-size: 1.05rem;">扩容磁盘<sup>2</sup></a><a href="/tags/%E6%8A%A5%E8%AD%A6/" style="font-size: 1.05rem;">报警<sup>1</sup></a><a href="/tags/%E6%9F%A5%E6%89%BE%E8%BF%9B%E7%A8%8B/" style="font-size: 1.05rem;">查找进程<sup>1</sup></a><a href="/tags/%E6%BC%8F%E6%B4%9E/" style="font-size: 1.05rem;">漏洞<sup>1</sup></a><a href="/tags/%E7%8A%B6%E6%80%81%E6%9C%BA/" style="font-size: 1.05rem;">状态机<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%AB%99%E8%B5%84%E6%BA%90/" style="font-size: 1.05rem;">网站资源<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>1</sup></a><a href="/tags/%E7%BF%BB%E5%A2%99/" style="font-size: 1.05rem;">翻墙<sup>1</sup></a><a href="/tags/%E8%87%AA%E5%AD%A6%E5%85%AC%E5%BC%8F/" style="font-size: 1.05rem;">自学公式<sup>1</sup></a><a href="/tags/%E8%A1%A8%E8%AE%BE%E8%AE%A1/" style="font-size: 1.05rem;">表设计<sup>1</sup></a><a href="/tags/%E8%B4%A6%E6%88%B7%E8%B5%84%E9%87%91/" style="font-size: 1.05rem;">账户资金<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/12/"><span class="card-archive-list-date">十二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/11/"><span class="card-archive-list-date">十一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">十月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/elasticsearch/" itemprop="url">elasticsearch</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>学习笔记</span></a></span></div></div><h1 class="post-title" itemprop="name headline">es常用命令</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-02-27T07:00:37.000Z" title="发表于 2025-02-27 15:00:37">2025-02-27</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-02-27T09:25:21.655Z" title="更新于 2025-02-27 17:25:21">2025-02-27</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为长沙"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>长沙</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://candyadmin.github.io/elasticsearch/es%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"><header><a class="post-meta-categories" href="/categories/elasticsearch/" itemprop="url">elasticsearch</a><a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" tabindex="-1" itemprop="url">学习笔记</a><h1 id="CrawlerTitle" itemprop="name headline">es常用命令</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">candy</span><time itemprop="dateCreated datePublished" datetime="2025-02-27T07:00:37.000Z" title="发表于 2025-02-27 15:00:37">2025-02-27</time><time itemprop="dateCreated datePublished" datetime="2025-02-27T09:25:21.655Z" title="更新于 2025-02-27 17:25:21">2025-02-27</time></header><p>以下是 Elasticsearch (ES) 常用命令的总结和笔记：</p>
<h3 id="1-查看索引相关信息"><a href="#1-查看索引相关信息" class="headerlink" title="1. 查看索引相关信息"></a>1. 查看索引相关信息</h3><ul>
<li><p><strong>查看指定索引的映射信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看指定索引的文档总数</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce/_count</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看前10条文档</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-查看索引状态与信息"><a href="#2-查看索引状态与信息" class="headerlink" title="2. 查看索引状态与信息"></a>2. 查看索引状态与信息</h3><ul>
<li><p><strong>查看索引信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/indices/kibana*?v&amp;s=index</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看状态为绿的索引</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/indices?v&amp;health=green</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>按文档个数排序查看索引</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/indices?v&amp;s=docs.count:desc</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看具体的索引字段（健康、主分片、复制分片、文档数等）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/indices/kibana*?pri&amp;v&amp;h=health,index,pri,rep,docs.count,mt</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看每个索引使用的内存量</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/indices?v&amp;h=i,tm&amp;s=tm:desc</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-查看节点信息"><a href="#3-查看节点信息" class="headerlink" title="3. 查看节点信息"></a>3. 查看节点信息</h3><ul>
<li><p><strong>查看所有节点信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cat/nodes?v</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看特定节点信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_nodes/es7_01,es7_02</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看节点信息并显示特定字段</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/nodes?v&amp;h=<span class="built_in">id</span>,ip,port,v,m</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-查看集群健康状况"><a href="#4-查看集群健康状况" class="headerlink" title="4. 查看集群健康状况"></a>4. 查看集群健康状况</h3><ul>
<li><p><strong>查看集群健康状况</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cluster/health</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看集群健康状况，并按分片级别显示</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _cluster/health?level=shards</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看特定索引的集群健康状况</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cluster/health/kibana_sample_data_ecommerce,kibana_sample_data_flights</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看特定索引的集群健康状况，并按分片级别显示</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cluster/health/kibana_sample_data_flights?level=shards</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="5-查看集群状态"><a href="#5-查看集群状态" class="headerlink" title="5. 查看集群状态"></a>5. 查看集群状态</h3><ul>
<li><strong>查看集群状态</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cluster/state</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="6-查看集群设置"><a href="#6-查看集群设置" class="headerlink" title="6. 查看集群设置"></a>6. 查看集群设置</h3><ul>
<li><p><strong>查看集群设置</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cluster/settings</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看集群设置，包括默认设置</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cluster/settings?include_defaults=<span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="7-查看分片信息"><a href="#7-查看分片信息" class="headerlink" title="7. 查看分片信息"></a>7. 查看分片信息</h3><ul>
<li><p><strong>查看集群的所有分片信息</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/shards</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>查看特定的分片信息（包括状态、主分片&#x2F;副本分片等）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/shards?h=index,shard,prirep,state,unassigned.reason</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="1-创建文档"><a href="#1-创建文档" class="headerlink" title="1. 创建文档"></a>1. 创建文档</h3><ul>
<li><p><strong>自动生成 <code>_id</code> 创建文档</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST <span class="built_in">users</span>/_doc</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;user&quot;</span> : <span class="string">&quot;Mike&quot;</span>,</span><br><span class="line">  <span class="string">&quot;post_date&quot;</span> : <span class="string">&quot;2019-04-15T14:12:12&quot;</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span> : <span class="string">&quot;trying out Kibana&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>指定 ID 创建文档（如果 ID 已存在则报错）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT <span class="built_in">users</span>/_doc/1?op_type=create</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;user&quot;</span> : <span class="string">&quot;Jack&quot;</span>,</span><br><span class="line">  <span class="string">&quot;post_date&quot;</span> : <span class="string">&quot;2019-05-15T14:12:12&quot;</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span> : <span class="string">&quot;trying out Elasticsearch&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>指定 ID 创建文档（如果 ID 已存在则报错）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT <span class="built_in">users</span>/_create/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;user&quot;</span> : <span class="string">&quot;Jack&quot;</span>,</span><br><span class="line">  <span class="string">&quot;post_date&quot;</span> : <span class="string">&quot;2019-05-15T14:12:12&quot;</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span> : <span class="string">&quot;trying out Elasticsearch&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-根据-ID-获取文档"><a href="#2-根据-ID-获取文档" class="headerlink" title="2. 根据 ID 获取文档"></a>2. 根据 ID 获取文档</h3><ul>
<li><strong>获取指定 ID 的文档</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET <span class="built_in">users</span>/_doc/1</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-更新文档"><a href="#3-更新文档" class="headerlink" title="3. 更新文档"></a>3. 更新文档</h3><ul>
<li><p><strong>更新指定 ID 的文档（先删除再写入）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT <span class="built_in">users</span>/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;user&quot;</span> : <span class="string">&quot;Mike&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在原文档上增加字段</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST <span class="built_in">users</span>/_update/1/</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;doc&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;post_date&quot;</span> : <span class="string">&quot;2019-05-15T14:12:12&quot;</span>,</span><br><span class="line">    <span class="string">&quot;message&quot;</span> : <span class="string">&quot;trying out Elasticsearch&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-删除文档"><a href="#4-删除文档" class="headerlink" title="4. 删除文档"></a>4. 删除文档</h3><ul>
<li><strong>根据 ID 删除文档</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE <span class="built_in">users</span>/_doc/1</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="5-批量操作-Bulk-API"><a href="#5-批量操作-Bulk-API" class="headerlink" title="5. 批量操作 (Bulk API)"></a>5. 批量操作 (Bulk API)</h3><ul>
<li><strong>执行批量操作</strong><br>第一次执行批量操作：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST _bulk</span><br><span class="line">&#123; <span class="string">&quot;index&quot;</span> : &#123; <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span> &#125; &#125;</span><br><span class="line">&#123; <span class="string">&quot;field1&quot;</span> : <span class="string">&quot;value1&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;delete&quot;</span> : &#123; <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;2&quot;</span> &#125; &#125;</span><br><span class="line">&#123; <span class="string">&quot;create&quot;</span> : &#123; <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test2&quot;</span>, <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;3&quot;</span> &#125; &#125;</span><br><span class="line">&#123; <span class="string">&quot;field1&quot;</span> : <span class="string">&quot;value3&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;update&quot;</span> : &#123;<span class="string">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>, <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test&quot;</span>&#125; &#125;</span><br><span class="line">&#123; <span class="string">&quot;doc&quot;</span> : &#123;<span class="string">&quot;field2&quot;</span> : <span class="string">&quot;value2&quot;</span>&#125; &#125;</span><br></pre></td></tr></table></figure>

第二次执行批量操作：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST _bulk</span><br><span class="line">&#123; <span class="string">&quot;index&quot;</span> : &#123; <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span> &#125; &#125;</span><br><span class="line">&#123; <span class="string">&quot;field1&quot;</span> : <span class="string">&quot;value1&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;delete&quot;</span> : &#123; <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;2&quot;</span> &#125; &#125;</span><br><span class="line">&#123; <span class="string">&quot;create&quot;</span> : &#123; <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test2&quot;</span>, <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;3&quot;</span> &#125; &#125;</span><br><span class="line">&#123; <span class="string">&quot;field1&quot;</span> : <span class="string">&quot;value3&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;update&quot;</span> : &#123;<span class="string">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>, <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test&quot;</span>&#125; &#125;</span><br><span class="line">&#123; <span class="string">&quot;doc&quot;</span> : &#123;<span class="string">&quot;field2&quot;</span> : <span class="string">&quot;value2&quot;</span>&#125; &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="6-多文档获取-MGET"><a href="#6-多文档获取-MGET" class="headerlink" title="6. 多文档获取 (MGET)"></a>6. 多文档获取 (MGET)</h3><ul>
<li><p><strong>获取多个文档</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /_mget</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;docs&quot;</span> : [</span><br><span class="line">    &#123; <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;2&quot;</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>URI中指定索引</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /test/_mget</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;docs&quot;</span> : [</span><br><span class="line">    &#123; <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;2&quot;</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>使用 <code>_source</code> 参数指定返回的字段</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /_mget</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;docs&quot;</span> : [</span><br><span class="line">    &#123; <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>, <span class="string">&quot;_source&quot;</span> : <span class="literal">false</span> &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;2&quot;</span>, <span class="string">&quot;_source&quot;</span> : [<span class="string">&quot;field3&quot;</span>, <span class="string">&quot;field4&quot;</span>] &#125;,</span><br><span class="line">    &#123; <span class="string">&quot;_index&quot;</span> : <span class="string">&quot;test&quot;</span>, <span class="string">&quot;_id&quot;</span> : <span class="string">&quot;3&quot;</span>, <span class="string">&quot;_source&quot;</span> : &#123; <span class="string">&quot;include&quot;</span>: [<span class="string">&quot;user&quot;</span>], <span class="string">&quot;exclude&quot;</span>: [<span class="string">&quot;user.location&quot;</span>] &#125; &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="7-多查询操作-MSEARCH"><a href="#7-多查询操作-MSEARCH" class="headerlink" title="7. 多查询操作 (MSEARCH)"></a>7. 多查询操作 (MSEARCH)</h3><ul>
<li><strong>执行多个查询</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST kibana_sample_data_ecommerce/_msearch</span><br><span class="line">&#123;&#125;</span><br><span class="line">&#123;<span class="string">&quot;query&quot;</span> : &#123;<span class="string">&quot;match_all&quot;</span> : &#123;&#125;&#125;,<span class="string">&quot;size&quot;</span>:1&#125;</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span> : <span class="string">&quot;kibana_sample_data_flights&quot;</span>&#125;</span><br><span class="line">&#123;<span class="string">&quot;query&quot;</span> : &#123;<span class="string">&quot;match_all&quot;</span> : &#123;&#125;&#125;,<span class="string">&quot;size&quot;</span>:2&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="8-清除测试数据"><a href="#8-清除测试数据" class="headerlink" title="8. 清除测试数据"></a>8. 清除测试数据</h3><ul>
<li><strong>删除索引（清除数据）</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DELETE <span class="built_in">users</span></span><br><span class="line">DELETE <span class="built_in">test</span></span><br><span class="line">DELETE test2</span><br></pre></td></tr></table></figure></li>
</ul>
<p>[3.4-倒排索引入门]</p>
<p>Elasticsearch 的 <code>_analyze</code> API，它用于分析文本，查看在特定分析器下，文本是如何被分词和处理的。下面是每个请求的说明：</p>
<h3 id="1-分析-“Mastering-Elasticsearch”"><a href="#1-分析-“Mastering-Elasticsearch”" class="headerlink" title="1. 分析 “Mastering Elasticsearch”"></a>1. <strong>分析 “Mastering Elasticsearch”</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;standard&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;Mastering Elasticsearch&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>分析器</strong>：使用默认的 <code>standard</code> 分析器。</li>
<li><strong>文本</strong>：<code>&quot;Mastering Elasticsearch&quot;</code>。</li>
<li><strong>预期效果</strong>：<code>standard</code> 分析器会将这段文本分割成单词，通常会根据空格和标点符号进行分词。</li>
</ul>
<h3 id="2-分析-“Elasticsearch-Server”"><a href="#2-分析-“Elasticsearch-Server”" class="headerlink" title="2. 分析 “Elasticsearch Server”"></a>2. <strong>分析 “Elasticsearch Server”</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;standard&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;Elasticsearch Server&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>分析器</strong>：同样使用 <code>standard</code> 分析器。</li>
<li><strong>文本</strong>：<code>&quot;Elasticsearch Server&quot;</code>。</li>
<li><strong>预期效果</strong>：分析器会分割文本为单词，可能会得到类似于 <code>[&quot;elasticsearch&quot;, &quot;server&quot;]</code> 的分词结果。</li>
</ul>
<h3 id="3-分析-“Elasticsearch-Essentials”"><a href="#3-分析-“Elasticsearch-Essentials”" class="headerlink" title="3. 分析 “Elasticsearch Essentials”"></a>3. <strong>分析 “Elasticsearch Essentials”</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;standard&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;Elasticsearch Essentials&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>分析器</strong>：继续使用 <code>standard</code> 分析器。</li>
<li><strong>文本</strong>：<code>&quot;Elasticsearch Essentials&quot;</code>。</li>
<li><strong>预期效果</strong>：分析器会将文本分割成 <code>[&quot;elasticsearch&quot;, &quot;essentials&quot;]</code>。</li>
</ul>
<h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><p>每个请求的结果将显示由 <code>standard</code> 分析器生成的分词结果。通常，<code>standard</code> 分析器会去除大部分标点符号并将文本转换为小写。分词的具体结果如下：</p>
<ul>
<li><code>&quot;Mastering Elasticsearch&quot;</code> -&gt; <code>[&quot;mastering&quot;, &quot;elasticsearch&quot;]</code></li>
<li><code>&quot;Elasticsearch Server&quot;</code> -&gt; <code>[&quot;elasticsearch&quot;, &quot;server&quot;]</code></li>
<li><code>&quot;Elasticsearch Essentials&quot;</code> -&gt; <code>[&quot;elasticsearch&quot;, &quot;essentials&quot;]</code></li>
</ul>
<p>以下是使用不同的分析器（Analyzer）对文本进行分词分析的示例：</p>
<h3 id="1-Standard-Analyzer"><a href="#1-Standard-Analyzer" class="headerlink" title="1. Standard Analyzer"></a>1. <strong>Standard Analyzer</strong></h3><p>标准分析器会根据空格、标点符号等进行分词，并将所有文本转换为小写。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;standard&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tokens&quot;</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 0,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 1,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;NUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;running&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 2,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 9,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;quick&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 10,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 15,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;brown&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 16,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 21,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;foxes&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 22,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 27,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;leap&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 28,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 32,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;over&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 33,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 37,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 6</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;lazy&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 38,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 42,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 7</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;dogs&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 43,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 47,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;in&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 48,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 50,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;the&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 51,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 54,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 10</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;summer&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 55,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 61,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 11</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;token&quot;</span> : <span class="string">&quot;evening&quot;</span>,</span><br><span class="line">      <span class="string">&quot;start_offset&quot;</span> : 62,</span><br><span class="line">      <span class="string">&quot;end_offset&quot;</span> : 69,</span><br><span class="line">      <span class="string">&quot;type&quot;</span> : <span class="string">&quot;&lt;ALPHANUM&gt;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span> : 12</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>分词结果</strong>：<code>[&quot;2&quot;, &quot;running&quot;, &quot;quick&quot;, &quot;brown&quot;, &quot;foxes&quot;, &quot;leap&quot;, &quot;over&quot;, &quot;lazy&quot;, &quot;dogs&quot;, &quot;in&quot;, &quot;the&quot;, &quot;summer&quot;, &quot;evening&quot;]</code></li>
</ul>
<h3 id="2-Simple-Analyzer"><a href="#2-Simple-Analyzer" class="headerlink" title="2. Simple Analyzer"></a>2. <strong>Simple Analyzer</strong></h3><p>简单分析器按非字母字符切分，符号会被过滤，文本会转换为小写。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;simple&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>分词结果</strong>：<code>[&quot;2&quot;, &quot;running&quot;, &quot;quick&quot;, &quot;brown&quot;, &quot;foxes&quot;, &quot;leap&quot;, &quot;over&quot;, &quot;lazy&quot;, &quot;dogs&quot;, &quot;in&quot;, &quot;the&quot;, &quot;summer&quot;, &quot;evening&quot;]</code></li>
</ul>
<h3 id="3-Stop-Analyzer"><a href="#3-Stop-Analyzer" class="headerlink" title="3. Stop Analyzer"></a>3. <strong>Stop Analyzer</strong></h3><p>停用词分析器会将文本转换为小写，并过滤掉常见的停用词（如 “the”, “a”, “is”）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;stop&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>分词结果</strong>：<code>[&quot;2&quot;, &quot;running&quot;, &quot;quick&quot;, &quot;brown&quot;, &quot;foxes&quot;, &quot;leap&quot;, &quot;lazy&quot;, &quot;dogs&quot;, &quot;summer&quot;, &quot;evening&quot;]</code></li>
</ul>
<h3 id="4-Whitespace-Analyzer"><a href="#4-Whitespace-Analyzer" class="headerlink" title="4. Whitespace Analyzer"></a>4. <strong>Whitespace Analyzer</strong></h3><p>空格分析器会按空格切分文本，并且不会转换为小写。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;whitespace&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>分词结果</strong>：<code>[&quot;2&quot;, &quot;running&quot;, &quot;Quick&quot;, &quot;brown-foxes&quot;, &quot;leap&quot;, &quot;over&quot;, &quot;lazy&quot;, &quot;dogs&quot;, &quot;in&quot;, &quot;the&quot;, &quot;summer&quot;, &quot;evening.&quot;]</code></li>
</ul>
<h3 id="5-Keyword-Analyzer"><a href="#5-Keyword-Analyzer" class="headerlink" title="5. Keyword Analyzer"></a>5. <strong>Keyword Analyzer</strong></h3><p>关键字分析器不进行分词，直接返回原始文本。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>分词结果</strong>：<code>[&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;]</code></li>
</ul>
<h3 id="6-Pattern-Analyzer"><a href="#6-Pattern-Analyzer" class="headerlink" title="6. Pattern Analyzer"></a>6. <strong>Pattern Analyzer</strong></h3><p>模式分析器使用正则表达式进行分词，默认使用 <code>\W+</code>（非字母字符）作为分隔符。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;pattern&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>分词结果</strong>：<code>[&quot;2&quot;, &quot;running&quot;, &quot;Quick&quot;, &quot;brown&quot;, &quot;foxes&quot;, &quot;leap&quot;, &quot;over&quot;, &quot;lazy&quot;, &quot;dogs&quot;, &quot;in&quot;, &quot;the&quot;, &quot;summer&quot;, &quot;evening&quot;]</code></li>
</ul>
<h3 id="7-English-Analyzer"><a href="#7-English-Analyzer" class="headerlink" title="7. English Analyzer"></a>7. <strong>English Analyzer</strong></h3><p>英语分析器针对英语语言进行分词，去除停用词等。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;english&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>分词结果</strong>：<code>[&quot;2&quot;, &quot;running&quot;, &quot;quick&quot;, &quot;brown&quot;, &quot;foxes&quot;, &quot;leap&quot;, &quot;lazy&quot;, &quot;dogs&quot;, &quot;summer&quot;, &quot;evening&quot;]</code></li>
</ul>
<h3 id="8-ICU-Analyzer-for-Chinese-Text"><a href="#8-ICU-Analyzer-for-Chinese-Text" class="headerlink" title="8. ICU Analyzer for Chinese Text"></a>8. <strong>ICU Analyzer for Chinese Text</strong></h3><p>使用 <code>icu_analyzer</code> 来处理中文文本，适用于多语言环境中的分词。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;icu_analyzer&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;他说的确实在理&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>分词结果</strong>：<code>[&quot;他说&quot;, &quot;的&quot;, &quot;确实&quot;, &quot;在理&quot;]</code></li>
</ul>
<h3 id="9-Standard-Analyzer-for-Chinese-Text"><a href="#9-Standard-Analyzer-for-Chinese-Text" class="headerlink" title="9. Standard Analyzer for Chinese Text"></a>9. <strong>Standard Analyzer for Chinese Text</strong></h3><p>使用标准分析器处理中文文本，通常处理中文时可能不会像中文专用分析器那样精确。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;standard&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;他说的确实在理&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>分词结果</strong>：<code>[&quot;他说&quot;, &quot;的&quot;, &quot;确实&quot;, &quot;在理&quot;]</code></li>
</ul>
<h3 id="10-ICU-Analyzer-for-Another-Chinese-Sentence"><a href="#10-ICU-Analyzer-for-Another-Chinese-Sentence" class="headerlink" title="10. ICU Analyzer for Another Chinese Sentence"></a>10. <strong>ICU Analyzer for Another Chinese Sentence</strong></h3><p>处理另一个中文句子 <code>&quot;这个苹果不大好吃&quot;</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;icu_analyzer&quot;</span>,</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;这个苹果不大好吃&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>分词结果</strong>：<code>[&quot;这个&quot;, &quot;苹果&quot;, &quot;不大&quot;, &quot;好吃&quot;]</code></li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>每种分析器具有不同的分词行为：</p>
<ul>
<li><strong>Standard</strong>：根据空格和标点符号分词并小写化。</li>
<li><strong>Simple</strong>：过滤非字母字符并小写化。</li>
<li><strong>Stop</strong>：去除停用词并小写化。</li>
<li><strong>Whitespace</strong>：仅按空格分词，不进行大小写转换。</li>
<li><strong>Keyword</strong>：不进行分词，返回整个文本。</li>
<li><strong>Pattern</strong>：使用正则表达式分词，默认 <code>\W+</code> 分割。</li>
<li><strong>English</strong>：为英语文本设计的分析器，去除停用词。</li>
<li><strong>ICU Analyzer</strong>：适合多语言的分词，特别适用于中文等非拉丁字母语言。</li>
</ul>
<p>这些分析器可以根据不同的语言和需求来优化索引和搜索。</p>
<p>以下是您提供的一些 Elasticsearch 查询示例，涵盖了基本查询、带有分析的查询、布尔查询、范围查询、通配符查询、模糊查询等操作。下面是每种查询的详细解释和用法：</p>
<h3 id="1-基本查询"><a href="#1-基本查询" class="headerlink" title="1. 基本查询"></a>1. <strong>基本查询</strong></h3><p>查询 <code>movies</code> 索引中标题为 <code>2012</code> 的电影，并根据 <code>year</code> 字段降序排序，返回前 10 条结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search?q=2012&amp;<span class="built_in">df</span>=title&amp;<span class="built_in">sort</span>=year:desc&amp;from=0&amp;size=10&amp;<span class="built_in">timeout</span>=1s</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>q=2012</code>**：查询内容为 <code>2012</code>。</li>
<li>**<code>df=title</code>**：指定查询字段为 <code>title</code>。</li>
<li>**<code>sort=year:desc</code>**：按 <code>year</code> 字段降序排序。</li>
<li>**<code>from=0&amp;size=10</code>**：分页，返回前 10 条数据。</li>
<li>**<code>timeout=1s</code>**：查询超时限制为 1 秒。</li>
</ul>
<h3 id="2-带-Profile-的查询"><a href="#2-带-Profile-的查询" class="headerlink" title="2. 带 Profile 的查询"></a>2. <strong>带 Profile 的查询</strong></h3><p>启用 <code>profile</code> 可以帮助分析查询性能，查看查询的每个阶段的时间。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search?q=2012&amp;<span class="built_in">df</span>=title</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>&quot;profile&quot;: &quot;true&quot;</code>**：启用查询性能分析。</li>
</ul>
<h3 id="3-泛查询，对所有字段进行查询"><a href="#3-泛查询，对所有字段进行查询" class="headerlink" title="3. 泛查询，对所有字段进行查询"></a>3. <strong>泛查询，对所有字段进行查询</strong></h3><p>使用 <code>_all</code> 字段进行泛查询，查询所有字段。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search?q=2012</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>q=2012</code>**：查询所有字段中包含 <code>2012</code> 的数据。</li>
</ul>
<h3 id="4-指定字段查询"><a href="#4-指定字段查询" class="headerlink" title="4. 指定字段查询"></a>4. <strong>指定字段查询</strong></h3><p>查询 <code>title</code> 字段中包含 <code>2012</code> 的记录，并按照 <code>year</code> 字段降序排序：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search?q=title:2012&amp;<span class="built_in">sort</span>=year:desc&amp;from=0&amp;size=10&amp;<span class="built_in">timeout</span>=1s</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>q=title:2012</code>**：指定查询字段为 <code>title</code>，查询内容为 <code>2012</code>。</li>
</ul>
<h3 id="5-查找美丽心灵"><a href="#5-查找美丽心灵" class="headerlink" title="5. 查找美丽心灵"></a>5. <strong>查找美丽心灵</strong></h3><p>查询 <code>title</code> 字段包含 <code>&quot;Beautiful Mind&quot;</code> 的记录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search?q=title:Beautiful Mind</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-泛查询"><a href="#6-泛查询" class="headerlink" title="6. 泛查询"></a>6. <strong>泛查询</strong></h3><p>查询 <code>title</code> 字段包含 <code>2012</code> 的记录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search?q=title:2012</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-Phrase-查询（短语查询）"><a href="#7-Phrase-查询（短语查询）" class="headerlink" title="7. Phrase 查询（短语查询）"></a>7. <strong>Phrase 查询（短语查询）</strong></h3><p>查询 <code>title</code> 字段精确匹配 <code>&quot;Beautiful Mind&quot;</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search?q=title:<span class="string">&quot;Beautiful Mind&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用引号表示精确短语匹配，要求字段内容必须完全匹配短语 <code>&quot;Beautiful Mind&quot;</code>。</li>
</ul>
<h3 id="8-分组查询（使用括号）"><a href="#8-分组查询（使用括号）" class="headerlink" title="8. 分组查询（使用括号）"></a>8. <strong>分组查询（使用括号）</strong></h3><p>查询 <code>title</code> 字段中包含 <code>Beautiful Mind</code> 的记录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search?q=title:(Beautiful Mind)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用括号可以进行分组查询，类似逻辑上的括号优先级。</li>
</ul>
<h3 id="9-布尔操作符查询"><a href="#9-布尔操作符查询" class="headerlink" title="9. 布尔操作符查询"></a>9. <strong>布尔操作符查询</strong></h3><ul>
<li><strong>AND 查询：</strong><br>查询 <code>title</code> 字段同时包含 <code>Beautiful</code> 和 <code>Mind</code> 的记录：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search?q=title:(Beautiful AND Mind)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>NOT 查询：</strong><br>查询 <code>title</code> 字段包含 <code>Beautiful</code> 但不包含 <code>Mind</code> 的记录：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search?q=title:(Beautiful NOT Mind)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>OR 查询：</strong><br>查询 <code>title</code> 字段包含 <code>Beautiful</code> 或 <code>Mind</code> 的记录：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search?q=title:(Beautiful %2BMind)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="10-范围查询"><a href="#10-范围查询" class="headerlink" title="10. 范围查询"></a>10. <strong>范围查询</strong></h3><p>查询 <code>title</code> 字段包含 <code>beautiful</code> 且 <code>year</code> 在 2002 到 2018 年之间的记录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search?q=title:beautiful AND year:[2002 TO 2018%7D</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>year:[2002 TO 2018]</code>**：指定 <code>year</code> 字段的范围查询。</li>
</ul>
<h3 id="11-通配符查询"><a href="#11-通配符查询" class="headerlink" title="11. 通配符查询"></a>11. <strong>通配符查询</strong></h3><p>查询 <code>title</code> 字段以 <code>b</code> 开头的所有记录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search?q=title:b*</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>b*</code>**：使用通配符查询以 <code>b</code> 开头的字符串。</li>
</ul>
<h3 id="12-模糊查询-近似度匹配"><a href="#12-模糊查询-近似度匹配" class="headerlink" title="12. 模糊查询 &amp; 近似度匹配"></a>12. <strong>模糊查询 &amp; 近似度匹配</strong></h3><ul>
<li><strong>模糊匹配</strong>：查询 <code>title</code> 字段中的词语 <code>beautifl</code>，允许有 1 个字符的错误：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search?q=title:beautifl~1</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>近似度匹配</strong>：查询 <code>title</code> 字段中的短语 <code>&quot;Lord Rings&quot;</code>，允许 2 个字符的误差：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search?q=title:<span class="string">&quot;Lord Rings&quot;</span>~2</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;profile&quot;</span>:<span class="string">&quot;true&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>这些查询展示了如何使用 Elasticsearch 提供的强大查询能力来根据不同的需求筛选和搜索数据。常见的查询类型包括：</p>
<ul>
<li><strong>基本查询</strong>：用于查找单一词汇。</li>
<li><strong>布尔查询</strong>：组合多个查询条件。</li>
<li><strong>范围查询</strong>：查找特定范围内的记录。</li>
<li><strong>通配符查询</strong>：模糊匹配。</li>
<li><strong>短语查询</strong>：精确匹配整个短语。</li>
</ul>
<p>同时，<code>profile</code> 参数可以帮助分析查询性能，优化查询响应。</p>
<p>3.8-RequestBody与QueryDSL简介</p>
<p>以下是您提供的 Elasticsearch 查询操作，包括分页、日期排序、源过滤、脚本字段、以及不同的查询类型（如 <code>match</code>、<code>match_phrase</code>）。这些操作展示了如何在 Elasticsearch 中进行更精细的查询和数据处理。</p>
<h3 id="1-忽略不存在的索引（ignore-unavailable-true）"><a href="#1-忽略不存在的索引（ignore-unavailable-true）" class="headerlink" title="1. 忽略不存在的索引（ignore_unavailable=true）"></a>1. <strong>忽略不存在的索引（<code>ignore_unavailable=true</code>）</strong></h3><p>在查询时，如果访问的索引不存在，使用 <code>ignore_unavailable=true</code> 可以避免报错：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /movies,404_idx/_search?ignore_unavailable=<span class="literal">true</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;profile&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>ignore_unavailable=true</code>**：在访问不存在的索引时，忽略错误。</li>
</ul>
<h3 id="2-分页查询"><a href="#2-分页查询" class="headerlink" title="2. 分页查询"></a>2. <strong>分页查询</strong></h3><p>查询 <code>kibana_sample_data_ecommerce</code> 索引并分页返回数据（从第 10 条开始，返回 20 条记录）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST /kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;from&quot;</span>: 10,</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 20,</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>from=10</code></strong> 和 **<code>size=20</code>**：分页，跳过前 10 条，返回接下来的 20 条。</li>
</ul>
<h3 id="3-日期排序"><a href="#3-日期排序" class="headerlink" title="3. 日期排序"></a>3. <strong>日期排序</strong></h3><p>按 <code>order_date</code> 字段降序排序：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;sort&quot;</span>: [&#123;<span class="string">&quot;order_date&quot;</span>: <span class="string">&quot;desc&quot;</span>&#125;],</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>sort</code>**：按照 <code>order_date</code> 字段降序排序。</li>
</ul>
<h3 id="4-源过滤"><a href="#4-源过滤" class="headerlink" title="4. 源过滤"></a>4. <strong>源过滤</strong></h3><p>只返回文档中的 <code>order_date</code> 字段，不返回其他字段：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;_source&quot;</span>: [<span class="string">&quot;order_date&quot;</span>],</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>_source</code>**：指定只返回 <code>order_date</code> 字段的数据。</li>
</ul>
<h3 id="5-脚本字段"><a href="#5-脚本字段" class="headerlink" title="5. 脚本字段"></a>5. <strong>脚本字段</strong></h3><p>使用脚本字段计算新的字段（例如，拼接 <code>order_date</code> 和 <code>&quot;hello&quot;</code>）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_ecommerce/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;script_fields&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;new_field&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;lang&quot;</span>: <span class="string">&quot;painless&quot;</span>,</span><br><span class="line">        <span class="string">&quot;source&quot;</span>: <span class="string">&quot;doc[&#x27;order_date&#x27;].value+&#x27;hello&#x27;&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>script_fields</code>**：使用 <code>painless</code> 脚本创建新的字段 <code>new_field</code>，将 <code>order_date</code> 字段与字符串 <code>&quot;hello&quot;</code> 拼接。</li>
</ul>
<h3 id="6-match-查询"><a href="#6-match-查询" class="headerlink" title="6. match 查询"></a>6. <strong><code>match</code> 查询</strong></h3><p>查询 <code>movies</code> 索引中 <code>title</code> 字段包含 <code>&quot;last christmas&quot;</code> 的记录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST movies/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;title&quot;</span>: <span class="string">&quot;last christmas&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>match</code>**：进行标准的全文匹配查询。</li>
</ul>
<h3 id="7-match-查询并使用-AND-操作符"><a href="#7-match-查询并使用-AND-操作符" class="headerlink" title="7. match 查询并使用 AND 操作符"></a>7. <strong><code>match</code> 查询并使用 AND 操作符</strong></h3><p>查询 <code>title</code> 包含 <code>&quot;last christmas&quot;</code> 且两个词都必须出现的记录（使用 AND 操作符）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST movies/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;title&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: <span class="string">&quot;last christmas&quot;</span>,</span><br><span class="line">        <span class="string">&quot;operator&quot;</span>: <span class="string">&quot;and&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>operator: &quot;and&quot;</code>**：两个词必须同时出现在字段中。</li>
</ul>
<h3 id="8-match-phrase-查询（短语匹配）"><a href="#8-match-phrase-查询（短语匹配）" class="headerlink" title="8. match_phrase 查询（短语匹配）"></a>8. <strong><code>match_phrase</code> 查询（短语匹配）</strong></h3><p>查询 <code>title</code> 字段精确匹配 <code>&quot;one love&quot;</code> 作为一个短语：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST movies/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_phrase&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;title&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: <span class="string">&quot;one love&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>match_phrase</code>**：精确匹配整个短语，必须按照指定的顺序。</li>
</ul>
<h3 id="9-match-phrase-查询并使用-slop"><a href="#9-match-phrase-查询并使用-slop" class="headerlink" title="9. match_phrase 查询并使用 slop"></a>9. <strong><code>match_phrase</code> 查询并使用 <code>slop</code></strong></h3><p>查询 <code>title</code> 字段中的短语 <code>&quot;one love&quot;</code>，并允许 1 个词语的偏移（即词语可以有一定的顺序变化）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST movies/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_phrase&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;title&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: <span class="string">&quot;one love&quot;</span>,</span><br><span class="line">        <span class="string">&quot;slop&quot;</span>: 1</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>slop: 1</code>**：允许最多 1 个词语的顺序偏移（例如，<code>love one</code> 也可以匹配）。</li>
</ul>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><p>这些查询展示了 Elasticsearch 中常用的查询类型：</p>
<ul>
<li><strong>分页查询</strong>：使用 <code>from</code> 和 <code>size</code> 来实现分页。</li>
<li><strong>日期排序</strong>：使用 <code>sort</code> 来对结果进行排序。</li>
<li><strong>源过滤</strong>：通过 <code>_source</code> 限制返回的字段。</li>
<li><strong>脚本字段</strong>：使用 <code>painless</code> 脚本来计算新字段。</li>
<li><strong>布尔操作符</strong>：通过 <code>operator</code> 来定义 <code>match</code> 查询的逻辑。</li>
<li><strong>短语匹配和偏移</strong>：通过 <code>match_phrase</code> 和 <code>slop</code> 来进行更灵活的查询。</li>
</ul>
<p>这些查询可以帮助你在 Elasticsearch 中实现复杂的搜索需求。</p>
<p>[3.9-QueryString&amp;SimpleQueryString查询]</p>
<p>以下是您提供的 Elasticsearch 查询操作，涉及到 <code>query_string</code> 和 <code>simple_query_string</code> 查询的使用，以及如何通过不同的字段和操作符执行复杂查询。这里的查询包括布尔操作符、字段匹配、以及指定默认操作符等。</p>
<h3 id="1-向索引添加文档"><a href="#1-向索引添加文档" class="headerlink" title="1. 向索引添加文档"></a>1. <strong>向索引添加文档</strong></h3><p>首先，向 <code>users</code> 索引添加两个用户文档：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUT /users/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Ruan Yiming&quot;</span>,</span><br><span class="line">  <span class="string">&quot;about&quot;</span>: <span class="string">&quot;java, golang, node, swift, elasticsearch&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT /users/_doc/2</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Li Yiming&quot;</span>,</span><br><span class="line">  <span class="string">&quot;about&quot;</span>: <span class="string">&quot;Hadoop&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-query-string-查询：查询名称中包含-“Ruan”-和-“Yiming”-的文档"><a href="#2-query-string-查询：查询名称中包含-“Ruan”-和-“Yiming”-的文档" class="headerlink" title="2. query_string 查询：查询名称中包含 “Ruan” 和 “Yiming” 的文档"></a>2. <strong><code>query_string</code> 查询：查询名称中包含 “Ruan” 和 “Yiming” 的文档</strong></h3><p>使用 <code>query_string</code> 查询，指定默认字段为 <code>name</code>，查询条件为 <code>&quot;Ruan AND Yiming&quot;</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST <span class="built_in">users</span>/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;query_string&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;default_field&quot;</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: <span class="string">&quot;Ruan AND Yiming&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>query_string</code>**：用于执行复杂的查询，可以使用逻辑操作符（如 AND、OR）。</li>
</ul>
<h3 id="3-query-string-查询：多个字段和复杂查询"><a href="#3-query-string-查询：多个字段和复杂查询" class="headerlink" title="3. query_string 查询：多个字段和复杂查询"></a>3. <strong><code>query_string</code> 查询：多个字段和复杂查询</strong></h3><p>查询名称或简介字段包含 <code>&quot;Ruan AND Yiming&quot;</code> 或 <code>&quot;Java AND Elasticsearch&quot;</code> 的文档：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST <span class="built_in">users</span>/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;query_string&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;fields&quot;</span>: [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;about&quot;</span>],</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: <span class="string">&quot;(Ruan AND Yiming) OR (Java AND Elasticsearch)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>fields</code>**：可以指定多个字段进行查询。</li>
<li>**<code>query</code>**：包含布尔操作符（如 AND、OR）。</li>
</ul>
<h3 id="4-simple-query-string-查询（默认操作符为-OR）"><a href="#4-simple-query-string-查询（默认操作符为-OR）" class="headerlink" title="4. simple_query_string 查询（默认操作符为 OR）"></a>4. <strong><code>simple_query_string</code> 查询（默认操作符为 OR）</strong></h3><p>执行一个简单查询，默认操作符为 <code>OR</code>，查询 <code>name</code> 字段中包含 <code>&quot;Ruan&quot;</code> 或 <code>&quot;Yiming&quot;</code> 的文档：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST <span class="built_in">users</span>/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;simple_query_string&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: <span class="string">&quot;Ruan AND Yiming&quot;</span>,</span><br><span class="line">      <span class="string">&quot;fields&quot;</span>: [<span class="string">&quot;name&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>simple_query_string</code>**：适用于较简单的查询，避免了复杂的查询语法。</li>
</ul>
<h3 id="5-simple-query-string-查询（默认操作符为-AND）"><a href="#5-simple-query-string-查询（默认操作符为-AND）" class="headerlink" title="5. simple_query_string 查询（默认操作符为 AND）"></a>5. <strong><code>simple_query_string</code> 查询（默认操作符为 AND）</strong></h3><p>查询 <code>name</code> 字段中包含 <code>&quot;Ruan&quot;</code> 且 <code>&quot;Yiming&quot;</code> 的文档，使用 <code>AND</code> 作为默认操作符：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST <span class="built_in">users</span>/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;simple_query_string&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: <span class="string">&quot;Ruan Yiming&quot;</span>,</span><br><span class="line">      <span class="string">&quot;fields&quot;</span>: [<span class="string">&quot;name&quot;</span>],</span><br><span class="line">      <span class="string">&quot;default_operator&quot;</span>: <span class="string">&quot;AND&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>default_operator</code>**：设置默认操作符（<code>AND</code> 或 <code>OR</code>）。在此示例中，<code>AND</code> 用于要求 <code>&quot;Ruan&quot;</code> 和 <code>&quot;Yiming&quot;</code> 必须同时出现在 <code>name</code> 字段中。</li>
</ul>
<h3 id="6-query-string-查询：查询电影标题包含-“Beautiful”-和-“Mind”"><a href="#6-query-string-查询：查询电影标题包含-“Beautiful”-和-“Mind”" class="headerlink" title="6. query_string 查询：查询电影标题包含 “Beautiful” 和 “Mind”"></a>6. <strong><code>query_string</code> 查询：查询电影标题包含 “Beautiful” 和 “Mind”</strong></h3><p>执行 <code>query_string</code> 查询，查询电影标题中包含 <code>&quot;Beautiful&quot;</code> 和 <code>&quot;Mind&quot;</code> 的文档：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;profile&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;query_string&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;default_field&quot;</span>: <span class="string">&quot;title&quot;</span>,</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: <span class="string">&quot;Beautiful AND Mind&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>query_string</code>**：执行复杂查询，可以使用布尔操作符（如 <code>AND</code>）。</li>
</ul>
<h3 id="7-query-string-查询：多个字段查询"><a href="#7-query-string-查询：多个字段查询" class="headerlink" title="7. query_string 查询：多个字段查询"></a>7. <strong><code>query_string</code> 查询：多个字段查询</strong></h3><p>查询电影的 <code>title</code> 或 <code>year</code> 字段包含 <code>&quot;2012&quot;</code> 的文档：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;profile&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;query_string&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;fields&quot;</span>: [<span class="string">&quot;title&quot;</span>, <span class="string">&quot;year&quot;</span>],</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: <span class="string">&quot;2012&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>**<code>fields</code>**：指定多个字段进行查询，这里同时查询 <code>title</code> 和 <code>year</code> 字段。</li>
</ul>
<h3 id="8-simple-query-string-查询：使用-进行短语匹配"><a href="#8-simple-query-string-查询：使用-进行短语匹配" class="headerlink" title="8. simple_query_string 查询：使用 + 进行短语匹配"></a>8. <strong><code>simple_query_string</code> 查询：使用 <code>+</code> 进行短语匹配</strong></h3><p>查询电影标题中包含 <code>&quot;Beautiful&quot;</code> 和 <code>&quot;mind&quot;</code> 的文档，使用 <code>+</code> 确保两个词都出现在查询中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /movies/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;profile&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;simple_query_string&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;query&quot;</span>: <span class="string">&quot;Beautiful +mind&quot;</span>,</span><br><span class="line">      <span class="string">&quot;fields&quot;</span>: [<span class="string">&quot;title&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>+</code> 操作符</strong>：用于强制要求某个词出现在查询结果中。</li>
</ul>
<hr>
<h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><p>这些查询展示了如何在 Elasticsearch 中使用不同类型的查询：</p>
<ul>
<li><strong><code>query_string</code></strong> 查询：用于执行复杂的查询，可以包含多个字段、布尔操作符（AND、OR、NOT）以及通配符等。</li>
<li><strong><code>simple_query_string</code></strong> 查询：比 <code>query_string</code> 更简单，适用于不需要复杂语法的查询，并且支持默认操作符的配置。</li>
<li><strong>字段查询</strong>：可以针对多个字段同时查询，指定多个字段使用 <code>fields</code> 参数。</li>
<li><strong>布尔操作符</strong>：如 <code>AND</code>、<code>OR</code>、<code>NOT</code>，控制查询的逻辑。</li>
</ul>
<p>这些查询方式非常适合处理复杂的检索需求。</p>
<p>[3.10-DynamicMapping和常见字段类型]</p>
<p>您的示例展示了如何在 Elasticsearch 中管理映射（Mapping）以及如何处理动态字段和映射更新。以下是总结和解释：</p>
<h3 id="映射和字段定义"><a href="#映射和字段定义" class="headerlink" title="映射和字段定义"></a><strong>映射和字段定义</strong></h3><p>映射在 Elasticsearch 中类似于关系数据库中的表结构定义，主要用于：</p>
<ul>
<li><strong>定义字段的名称</strong>：指定文档中的字段名。</li>
<li><strong>定义字段的类型</strong>：比如文本（<code>text</code>）、关键字（<code>keyword</code>）、日期（<code>date</code>）等。</li>
<li><strong>定义倒排索引相关配置</strong>：比如是否需要索引字段，以及字段的 <code>Analyzer</code> 配置。</li>
</ul>
<h3 id="动态映射（Dynamic-Mapping）"><a href="#动态映射（Dynamic-Mapping）" class="headerlink" title="动态映射（Dynamic Mapping）"></a><strong>动态映射（Dynamic Mapping）</strong></h3><p>动态映射允许 Elasticsearch 根据新文档自动推断字段的类型。可以通过 <code>dynamic</code> 属性来配置动态行为：</p>
<ul>
<li>**<code>true</code>**（默认）：允许新字段自动被索引和映射。</li>
<li>**<code>false</code>**：禁止自动创建新字段，但已存在字段可以继续使用。</li>
<li>**<code>strict</code>**：禁止任何新的字段。如果文档包含未定义的字段，将导致错误。</li>
</ul>
<h3 id="操作演示"><a href="#操作演示" class="headerlink" title="操作演示"></a><strong>操作演示</strong></h3><ol>
<li><p><strong>写入文档并查看映射</strong></p>
<ul>
<li>向 <code>mapping_test</code> 索引中添加一个文档，查看映射：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT mapping_test/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;firstName&quot;</span>: <span class="string">&quot;Chan&quot;</span>,</span><br><span class="line">  <span class="string">&quot;lastName&quot;</span>: <span class="string">&quot;Jackie&quot;</span>,</span><br><span class="line">  <span class="string">&quot;loginDate&quot;</span>: <span class="string">&quot;2018-07-24T10:29:48.103Z&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET mapping_test/_mapping</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>动态映射：推断字段类型</strong></p>
<ul>
<li>新字段 <code>uid</code>, <code>isVip</code>, <code>age</code> 等被自动推断并加入映射：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT mapping_test/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;uid&quot;</span>: <span class="string">&quot;123&quot;</span>,</span><br><span class="line">  <span class="string">&quot;isVip&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">&quot;isAdmin&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">  <span class="string">&quot;age&quot;</span>: 19,</span><br><span class="line">  <span class="string">&quot;height&quot;</span>: 180</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET mapping_test/_mapping</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>新增字段（默认动态）</strong></p>
<ul>
<li>如果动态映射为 <code>true</code>（默认），可以动态添加新的字段：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PUT dynamic_mapping_test/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;newField&quot;</span>: <span class="string">&quot;someValue&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST dynamic_mapping_test/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;newField&quot;</span>: <span class="string">&quot;someValue&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>修改动态设置为 <code>false</code></strong></p>
<ul>
<li>修改 <code>dynamic</code> 设置为 <code>false</code>，禁止自动推断新字段：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">PUT dynamic_mapping_test/_mapping</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;dynamic&quot;</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT dynamic_mapping_test/_doc/10</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;anotherField&quot;</span>: <span class="string">&quot;someValue&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST dynamic_mapping_test/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;anotherField&quot;</span>: <span class="string">&quot;someValue&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>在此示例中，<code>anotherField</code> 将不会被索引或搜索，因为动态映射已设置为 <code>false</code>。</p>
</li>
<li><p><strong>修改为 <code>strict</code> 模式</strong></p>
<ul>
<li>如果将 <code>dynamic</code> 设置为 <code>strict</code>，任何新的字段都会导致错误：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT dynamic_mapping_test/_mapping</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;dynamic&quot;</span>: <span class="string">&quot;strict&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT dynamic_mapping_test/_doc/12</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;lastField&quot;</span>: <span class="string">&quot;value&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
此时，写入新字段 <code>lastField</code> 会导致错误，HTTP 返回 <code>400</code> 错误码。</li>
</ul>
</li>
<li><p><strong>删除索引</strong></p>
<ul>
<li>删除索引：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE dynamic_mapping_test</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h3 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a><strong>总结</strong></h3><ul>
<li><strong>动态映射（Dynamic Mapping）</strong>：允许 Elasticsearch 自动推断并添加新的字段，方便快速处理未知数据。</li>
<li><strong><code>dynamic</code> 配置</strong>：控制是否允许 Elasticsearch 自动映射新字段：<ul>
<li><code>true</code>：默认允许动态字段；</li>
<li><code>false</code>：禁止自动映射新字段；</li>
<li><code>strict</code>：禁止所有未知字段，如果有未定义字段则会报错。</li>
</ul>
</li>
<li><strong>更改映射</strong>：映射一旦建立后不能直接修改字段类型，要修改字段配置或添加新字段需要使用 <code>reindex</code> 操作。</li>
</ul>
<p>这些操作有助于管理索引和字段的生命周期，确保数据能够根据业务需求灵活适应。</p>
<p>您的示例展示了 Elasticsearch 中显式设置映射（Mapping）的一些常见操作和参数。以下是各个设置项的详细介绍和使用案例。</p>
<h3 id="1-index-false-设置"><a href="#1-index-false-设置" class="headerlink" title="1. index: false 设置"></a><strong>1. <code>index: false</code> 设置</strong></h3><p>通过设置字段的 <code>index: false</code>，可以阻止某些字段被索引。这样可以避免该字段参与倒排索引，也不会进行搜索。</p>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">DELETE <span class="built_in">users</span></span><br><span class="line">PUT <span class="built_in">users</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;firstName&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;lastName&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;mobile&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">          <span class="string">&quot;index&quot;</span>: <span class="literal">false</span>  <span class="comment"># 禁止索引该字段</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT <span class="built_in">users</span>/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;firstName&quot;</span>: <span class="string">&quot;Ruan&quot;</span>,</span><br><span class="line">  <span class="string">&quot;lastName&quot;</span>: <span class="string">&quot;Yiming&quot;</span>,</span><br><span class="line">  <span class="string">&quot;mobile&quot;</span>: <span class="string">&quot;12345678&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST /users/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;mobile&quot;</span>: <span class="string">&quot;12345678&quot;</span>  <span class="comment"># 搜索时不会命中mobile字段</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上面的示例中，<code>mobile</code> 字段被设置为 <code>index: false</code>，因此无法用于搜索查询。</p>
<h3 id="2-null-value-设置"><a href="#2-null-value-设置" class="headerlink" title="2. null_value 设置"></a><strong>2. <code>null_value</code> 设置</strong></h3><p>通过设置 <code>null_value</code>，可以在文档中存储 <code>null</code> 值，并用指定的替代值替换 <code>null</code>。这对于查询时需要处理 <code>null</code> 数据特别有用。</p>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">DELETE <span class="built_in">users</span></span><br><span class="line">PUT <span class="built_in">users</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="string">&quot;properties&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;firstName&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;lastName&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;mobile&quot;</span> : &#123;</span><br><span class="line">          <span class="string">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">          <span class="string">&quot;null_value&quot;</span>: <span class="string">&quot;NULL&quot;</span>  <span class="comment"># null值替代为&quot;NULL&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT <span class="built_in">users</span>/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;firstName&quot;</span>: <span class="string">&quot;Ruan&quot;</span>,</span><br><span class="line">  <span class="string">&quot;lastName&quot;</span>: <span class="string">&quot;Yiming&quot;</span>,</span><br><span class="line">  <span class="string">&quot;mobile&quot;</span>: null  <span class="comment"># 实际值是null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT <span class="built_in">users</span>/_doc/2</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;firstName&quot;</span>: <span class="string">&quot;Ruan2&quot;</span>,</span><br><span class="line">  <span class="string">&quot;lastName&quot;</span>: <span class="string">&quot;Yiming2&quot;</span>  <span class="comment"># 没有mobile字段</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET <span class="built_in">users</span>/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;mobile&quot;</span>: <span class="string">&quot;NULL&quot;</span>  <span class="comment"># 搜索时会匹配到null值字段</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此设置可以确保查询时用 <code>NULL</code> 代替存储的 <code>null</code> 值。</p>
<h3 id="3-copy-to-设置"><a href="#3-copy-to-设置" class="headerlink" title="3. copy_to 设置"></a><strong>3. <code>copy_to</code> 设置</strong></h3><p><code>copy_to</code> 可以将多个字段的内容复制到另一个字段，方便进行联合查询或索引。</p>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">DELETE <span class="built_in">users</span></span><br><span class="line">PUT <span class="built_in">users</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;firstName&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;copy_to&quot;</span>: <span class="string">&quot;fullName&quot;</span>  <span class="comment"># 将firstName复制到fullName字段</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;lastName&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">        <span class="string">&quot;copy_to&quot;</span>: <span class="string">&quot;fullName&quot;</span>  <span class="comment"># 将lastName复制到fullName字段</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT <span class="built_in">users</span>/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;firstName&quot;</span>: <span class="string">&quot;Ruan&quot;</span>,</span><br><span class="line">  <span class="string">&quot;lastName&quot;</span>: <span class="string">&quot;Yiming&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET <span class="built_in">users</span>/_search?q=fullName:(Ruan Yiming)</span><br><span class="line"></span><br><span class="line">POST <span class="built_in">users</span>/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;fullName&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;query&quot;</span>: <span class="string">&quot;Ruan Yiming&quot;</span>,</span><br><span class="line">        <span class="string">&quot;operator&quot;</span>: <span class="string">&quot;and&quot;</span>  <span class="comment"># 联合查询fullName字段</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里，<code>firstName</code> 和 <code>lastName</code> 字段的内容会被复制到 <code>fullName</code> 字段，从而使得查询变得更加方便。</p>
<h3 id="4-数组类型处理"><a href="#4-数组类型处理" class="headerlink" title="4. 数组类型处理"></a><strong>4. 数组类型处理</strong></h3><p>Elasticsearch 支持数组字段。数组中的每个元素会被视为一个单独的值，这对于多值字段非常有用。</p>
<p><strong>示例</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PUT <span class="built_in">users</span>/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;onebird&quot;</span>,</span><br><span class="line">  <span class="string">&quot;interests&quot;</span>: <span class="string">&quot;reading&quot;</span>  <span class="comment"># 字段为单一值</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT <span class="built_in">users</span>/_doc/2</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;twobirds&quot;</span>,</span><br><span class="line">  <span class="string">&quot;interests&quot;</span>: [<span class="string">&quot;reading&quot;</span>, <span class="string">&quot;music&quot;</span>]  <span class="comment"># 字段为数组</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST <span class="built_in">users</span>/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;match_all&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET <span class="built_in">users</span>/_mapping</span><br></pre></td></tr></table></figure>
<p>在此示例中，<code>interests</code> 字段既可以是单个值也可以是数组，Elasticsearch 会将每个数组元素视为独立的值进行索引。</p>
<hr>
<h3 id="总结常见的-Mapping-参数"><a href="#总结常见的-Mapping-参数" class="headerlink" title="总结常见的 Mapping 参数"></a><strong>总结常见的 Mapping 参数</strong></h3><ul>
<li><strong><code>type</code></strong>: 字段的数据类型，如 <code>text</code>, <code>keyword</code>, <code>date</code> 等。</li>
<li><strong><code>index</code></strong>: 控制是否索引该字段，<code>false</code> 表示不索引，默认为 <code>true</code>。</li>
<li><strong><code>null_value</code></strong>: 控制 <code>null</code> 值的替代值。可以设置为任何替代值，如 <code>&quot;NULL&quot;</code>。</li>
<li><strong><code>copy_to</code></strong>: 将多个字段的内容复制到一个目标字段中，便于联合查询。</li>
<li><strong><code>dynamic</code></strong>: 控制动态映射，<code>true</code> 表示允许自动推断新字段，<code>false</code> 表示禁止新字段自动映射，<code>strict</code> 则表示严格模式下不允许任何新字段。</li>
</ul>
<p>通过这些映射设置，可以更好地控制数据如何存储和索引，以及如何在查询时处理和优化字段。</p>
<p>您的示例展示了 Elasticsearch 中关于多字段特性以及自定义分析器（Analyzer）的配置。以下是对各个分析器和相关配置的详细解释。</p>
<h3 id="1-自定义-Analyzer-和-Char-Filter"><a href="#1-自定义-Analyzer-和-Char-Filter" class="headerlink" title="1. 自定义 Analyzer 和 Char Filter"></a><strong>1. 自定义 Analyzer 和 Char Filter</strong></h3><p>Elasticsearch 提供了灵活的机制来配置分词器（Tokenizer）和字符过滤器（Char Filter）。这些配置用于在索引和搜索过程中控制文本的处理方式。</p>
<h4 id="自定义-Tokenizer-和-Char-Filter-示例"><a href="#自定义-Tokenizer-和-Char-Filter-示例" class="headerlink" title="自定义 Tokenizer 和 Char Filter 示例"></a><strong>自定义 Tokenizer 和 Char Filter 示例</strong></h4><ul>
<li><strong>Keyword Tokenizer</strong>: <code>keyword</code> tokenizer 将整个文本当作一个单独的 token 进行处理。</li>
<li><strong>HTML Strip Char Filter</strong>: <code>html_strip</code> char filter 用于从文本中去除 HTML 标签。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tokenizer&quot;</span>: <span class="string">&quot;keyword&quot;</span>,  <span class="comment"># 使用关键词分词器</span></span><br><span class="line">  <span class="string">&quot;char_filter&quot;</span>: [<span class="string">&quot;html_strip&quot;</span>],  <span class="comment"># 使用html_strip字符过滤器</span></span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;&lt;b&gt;hello world&lt;/b&gt;&quot;</span>  <span class="comment"># 输入带有HTML标签的文本</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出将会是：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;hello world&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>此配置移除了文本中的 <code>&lt;b&gt;&lt;/b&gt;</code> HTML 标签，只保留了纯文本 “hello world”。</p>
<h4 id="Path-Hierarchy-Tokenizer"><a href="#Path-Hierarchy-Tokenizer" class="headerlink" title="Path Hierarchy Tokenizer"></a><strong>Path Hierarchy Tokenizer</strong></h4><p><code>path_hierarchy</code> tokenizer 用于处理文件路径等层级结构的数据，将路径按分隔符（如 <code>/</code>）切割。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tokenizer&quot;</span>: <span class="string">&quot;path_hierarchy&quot;</span>,  <span class="comment"># 使用路径层级分词器</span></span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;/user/ymruan/a/b/c/d/e&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出会将路径按 <code>/</code> 切分：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/user/ymruan/a/b/c/d/e&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">21</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/user/ymruan/a/b/c/d&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-Char-Filter-替换符号"><a href="#2-Char-Filter-替换符号" class="headerlink" title="2. Char Filter 替换符号"></a><strong>2. Char Filter 替换符号</strong></h3><p>字符过滤器可以用于替换文本中的特定符号或字符。例如，使用 <code>mapping</code> 类型的 <code>char_filter</code>，可以替换文本中的字符（如将 <code>-</code> 替换为 <code>_</code>）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tokenizer&quot;</span>: <span class="string">&quot;standard&quot;</span>,  <span class="comment"># 使用标准分词器</span></span><br><span class="line">  <span class="string">&quot;char_filter&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;mapping&quot;</span>,  <span class="comment"># 使用字符映射过滤器</span></span><br><span class="line">      <span class="string">&quot;mappings&quot;</span>: [<span class="string">&quot;- =&gt; _&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;123-456, I-test! test-990 650-555-1234&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此配置将文本中的 <code>-</code> 替换为 <code>_</code>，输出将是：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;123_456&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-Char-Filter-替换表情符号"><a href="#3-Char-Filter-替换表情符号" class="headerlink" title="3. Char Filter 替换表情符号"></a><strong>3. Char Filter 替换表情符号</strong></h3><p>你还可以使用字符过滤器将表情符号替换为特定的文本（如将 <code>:)</code> 替换为 <code>happy</code>，<code>:(</code> 替换为 <code>sad</code>）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tokenizer&quot;</span>: <span class="string">&quot;standard&quot;</span>,</span><br><span class="line">  <span class="string">&quot;char_filter&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;mapping&quot;</span>,</span><br><span class="line">      <span class="string">&quot;mappings&quot;</span>: [<span class="string">&quot;:) =&gt; happy&quot;</span>, <span class="string">&quot;:( =&gt; sad&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: [<span class="string">&quot;I am felling :)&quot;</span>, <span class="string">&quot;Feeling :( today&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;I&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;am&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;felling&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;happy&quot;</span><span class="punctuation">,</span>  # 替换表情符号<span class="punctuation">:</span>) 为 happy</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-使用-Stop-和-Snowball-过滤器"><a href="#4-使用-Stop-和-Snowball-过滤器" class="headerlink" title="4. 使用 Stop 和 Snowball 过滤器"></a><strong>4. 使用 Stop 和 Snowball 过滤器</strong></h3><p>使用 <code>stop</code> 过滤器来删除常见的停用词，使用 <code>snowball</code> 过滤器进行词干提取（如将 “playing” 转换为 “play”）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tokenizer&quot;</span>: <span class="string">&quot;whitespace&quot;</span>,  <span class="comment"># 使用空格分词器</span></span><br><span class="line">  <span class="string">&quot;filter&quot;</span>: [<span class="string">&quot;stop&quot;</span>, <span class="string">&quot;snowball&quot;</span>],  <span class="comment"># 使用停用词和词干提取</span></span><br><span class="line">  <span class="string">&quot;text&quot;</span>: [<span class="string">&quot;The girls in China are playing this game!&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;girl&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;china&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">14</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-正则表达式替换"><a href="#5-正则表达式替换" class="headerlink" title="5. 正则表达式替换"></a><strong>5. 正则表达式替换</strong></h3><p>通过 <code>pattern_replace</code> 字符过滤器，您可以根据正则表达式来替换文本中的特定部分。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;tokenizer&quot;</span>: <span class="string">&quot;standard&quot;</span>,</span><br><span class="line">  <span class="string">&quot;char_filter&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;type&quot;</span>: <span class="string">&quot;pattern_replace&quot;</span>,</span><br><span class="line">      <span class="string">&quot;pattern&quot;</span>: <span class="string">&quot;http://(.*)&quot;</span>,</span><br><span class="line">      <span class="string">&quot;replacement&quot;</span>: <span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;text&quot;</span>: <span class="string">&quot;http://www.elastic.co&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此配置将 <code>http://</code> 替换为一个空字符串，结果为：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;tokens&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;www.elastic.co&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span><span class="punctuation">:</span> <span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;word&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;position&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a><strong>总结：</strong></h3><ul>
<li><strong>Tokenizer</strong>: 负责将输入文本切割成词条（token）。如 <code>keyword</code>, <code>standard</code>, <code>path_hierarchy</code>。</li>
<li><strong>Char Filter</strong>: 处理文本中的字符替换、去除特殊符号或HTML标签等，如 <code>html_strip</code>, <code>mapping</code>, <code>pattern_replace</code>。</li>
<li><strong>Filter</strong>: 用于文本处理，如去除停用词（<code>stop</code>）或词干提取（<code>snowball</code>）。</li>
</ul>
<p>这些工具的组合允许您灵活地处理和分析文本数据，并针对特定的业务需求优化索引和搜索行为。</p>
<p>在 Elasticsearch 中，<strong>Index Templates</strong> 和 <strong>Dynamic Templates</strong> 是两种强大的工具，用于控制如何定义和管理索引的映射和设置。以下是这两者的详细解释和示例。</p>
<h3 id="1-Index-Templates-索引模板"><a href="#1-Index-Templates-索引模板" class="headerlink" title="1. Index Templates (索引模板)"></a><strong>1. Index Templates (索引模板)</strong></h3><p><strong>Index Templates</strong> 是一种配置模板，用于为匹配特定模式的索引自动配置设置、映射和其他配置。当创建一个新索引时，如果该索引匹配模板中的 <code>index_patterns</code> 配置，模板中的设置、映射和其他配置就会自动应用到新索引上。</p>
<h4 id="创建默认模板"><a href="#创建默认模板" class="headerlink" title="创建默认模板"></a><strong>创建默认模板</strong></h4><p>下面是创建一个默认模板的示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT _template/template_default</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;index_patterns&quot;</span>: [<span class="string">&quot;*&quot;</span>],  <span class="comment"># 匹配所有索引</span></span><br><span class="line">  <span class="string">&quot;order&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: 1,</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;number_of_shards&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;number_of_replicas&quot;</span>: 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这会为所有索引设置一个模板，其中包含分片数量为1、副本数量为1。</p>
<h4 id="为特定模式创建模板"><a href="#为特定模式创建模板" class="headerlink" title="为特定模式创建模板"></a><strong>为特定模式创建模板</strong></h4><p>另一个例子是为 <code>test*</code> 开头的索引创建模板：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PUT /_template/template_test</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;index_patterns&quot;</span>: [<span class="string">&quot;test*&quot;</span>],  <span class="comment"># 匹配所有以test开头的索引</span></span><br><span class="line">  <span class="string">&quot;order&quot;</span>: 1,</span><br><span class="line">  <span class="string">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;number_of_shards&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;number_of_replicas&quot;</span>: 2</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;date_detection&quot;</span>: <span class="literal">false</span>,  <span class="comment"># 禁止自动检测日期字段</span></span><br><span class="line">    <span class="string">&quot;numeric_detection&quot;</span>: <span class="literal">true</span>  <span class="comment"># 自动检测数字字段</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="查看模板"><a href="#查看模板" class="headerlink" title="查看模板"></a><strong>查看模板</strong></h4><p>你可以查看已定义的模板：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /_template/template_default</span><br><span class="line">GET /_template/temp*  <span class="comment"># 查看所有模板</span></span><br></pre></td></tr></table></figure>

<h4 id="删除模板"><a href="#删除模板" class="headerlink" title="删除模板"></a><strong>删除模板</strong></h4><p>删除模板的命令如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE /_template/template_default</span><br><span class="line">DELETE /_template/template_test</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="2-Dynamic-Templates-动态模板"><a href="#2-Dynamic-Templates-动态模板" class="headerlink" title="2. Dynamic Templates (动态模板)"></a><strong>2. Dynamic Templates (动态模板)</strong></h3><p><strong>Dynamic Templates</strong> 用于在创建索引时自动匹配字段类型和名称，根据这些动态模板来生成字段的映射规则。可以根据字段的类型（例如字符串、数字）和字段名称（例如以某些字符开头的字段）来定义映射。</p>
<h4 id="自动映射数字字符串和日期字符串"><a href="#自动映射数字字符串和日期字符串" class="headerlink" title="自动映射数字字符串和日期字符串"></a><strong>自动映射数字字符串和日期字符串</strong></h4><p>例如，数字字符串会被映射为 <code>text</code> 类型，日期字符串会被映射为日期类型：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT ttemplate/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;someNumber&quot;</span>: <span class="string">&quot;1&quot;</span>,        <span class="comment"># 字符串数字</span></span><br><span class="line">  <span class="string">&quot;someDate&quot;</span>: <span class="string">&quot;2019/01/01&quot;</span>  <span class="comment"># 字符串日期</span></span><br><span class="line">&#125;</span><br><span class="line">GET ttemplate/_mapping</span><br></pre></td></tr></table></figure>
<p>在这个例子中，<code>someNumber</code> 会被映射成 <code>text</code> 类型，而 <code>someDate</code> 会被映射成 <code>date</code> 类型。</p>
<h4 id="定义动态模板映射规则"><a href="#定义动态模板映射规则" class="headerlink" title="定义动态模板映射规则"></a><strong>定义动态模板映射规则</strong></h4><p>使用 <code>dynamic_templates</code> 可以根据字段类型和名称定义映射。例如，以下动态模板将以 <code>is*</code> 开头的字符串字段映射为 <code>boolean</code> 类型，其他字符串字段映射为 <code>keyword</code> 类型：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">DELETE my_index</span><br><span class="line"></span><br><span class="line">PUT my_index</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dynamic_templates&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;strings_as_boolean&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;match_mapping_type&quot;</span>: <span class="string">&quot;string&quot;</span>,   <span class="comment"># 匹配所有字符串类型</span></span><br><span class="line">          <span class="string">&quot;match&quot;</span>: <span class="string">&quot;is*&quot;</span>,  <span class="comment"># 字段名称以is开头</span></span><br><span class="line">          <span class="string">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;boolean&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;strings_as_keywords&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;match_mapping_type&quot;</span>: <span class="string">&quot;string&quot;</span>,   <span class="comment"># 匹配所有字符串类型</span></span><br><span class="line">          <span class="string">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个示例中，<code>isVIP</code> 字段会被映射为 <code>boolean</code> 类型，而其他字符串类型的字段则会被映射为 <code>keyword</code> 类型。</p>
<h4 id="结合路径匹配"><a href="#结合路径匹配" class="headerlink" title="结合路径匹配"></a><strong>结合路径匹配</strong></h4><p>动态模板不仅可以基于字段名称，还可以基于字段的路径。例如，以下模板会将 <code>name.*</code> 路径下的所有字段映射为 <code>text</code> 类型，并将这些字段复制到 <code>full_name</code> 字段中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PUT my_index</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;dynamic_templates&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;full_name&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;path_match&quot;</span>: <span class="string">&quot;name.*&quot;</span>,  <span class="comment"># 匹配name下的所有字段</span></span><br><span class="line">          <span class="string">&quot;path_unmatch&quot;</span>: <span class="string">&quot;*.middle&quot;</span>,  <span class="comment"># 排除middle字段</span></span><br><span class="line">          <span class="string">&quot;mapping&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="string">&quot;copy_to&quot;</span>: <span class="string">&quot;full_name&quot;</span>  <span class="comment"># 将值复制到full_name字段</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，插入以下数据：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT my_index/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;first&quot;</span>: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">    <span class="string">&quot;middle&quot;</span>: <span class="string">&quot;Winston&quot;</span>,</span><br><span class="line">    <span class="string">&quot;last&quot;</span>: <span class="string">&quot;Lennon&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，<code>first</code> 和 <code>last</code> 字段将被映射为 <code>text</code> 类型，并且它们的内容会被复制到 <code>full_name</code> 字段中。</p>
<h4 id="搜索字段"><a href="#搜索字段" class="headerlink" title="搜索字段"></a><strong>搜索字段</strong></h4><p>可以通过 <code>full_name</code> 字段来搜索：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET my_index/_search?q=full_name:John</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="总结：-1"><a href="#总结：-1" class="headerlink" title="总结："></a><strong>总结：</strong></h3><ul>
<li><strong>Index Templates</strong> 是为匹配特定索引模式（<code>index_patterns</code>）的所有索引自动配置设置和映射的模板。</li>
<li><strong>Dynamic Templates</strong> 用于根据字段类型和字段名称自动映射索引字段。你可以根据字段类型（如 <code>string</code>）或字段路径（如 <code>name.*</code>）来定义映射规则。</li>
</ul>
<p>这些配置使得索引的创建和管理更加灵活，可以根据实际数据自动推断和调整映射，从而提高了 Elasticsearch 的可用性和效率。</p>
<p>Elasticsearch 提供了强大的 <strong>聚合</strong> 功能，用于对数据进行汇总和分析。聚合是 Elasticsearch 搜索的一个核心功能，允许你通过多种方式对数据进行分组、统计、求最大&#x2F;最小值、计算平均值等操作。以下是一些常见的聚合分析操作和示例：</p>
<h3 id="1-基本的聚合分析：按目的地分桶统计"><a href="#1-基本的聚合分析：按目的地分桶统计" class="headerlink" title="1. 基本的聚合分析：按目的地分桶统计"></a><strong>1. 基本的聚合分析：按目的地分桶统计</strong></h3><p>在这个示例中，我们按航班的目的地（<code>DestCountry</code>）进行分桶统计，查看每个目的地的航班数量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_flights/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,  <span class="comment"># 不返回实际的文档数据，只返回聚合结果</span></span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;flight_dest&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;DestCountry&quot;</span>  <span class="comment"># 按目的地国家分桶</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个聚合查询中，<code>terms</code> 聚合用于对 <code>DestCountry</code> 字段的值进行分桶，返回每个目的地国家的航班数量。</p>
<h3 id="2-增加更多统计：平均、最大、最小价格"><a href="#2-增加更多统计：平均、最大、最小价格" class="headerlink" title="2. 增加更多统计：平均、最大、最小价格"></a><strong>2. 增加更多统计：平均、最大、最小价格</strong></h3><p>你可以在分桶内部添加更多聚合来获取其他统计信息，如每个目的地的平均票价、最高票价和最低票价：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_flights/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;flight_dest&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;DestCountry&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;avg_price&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;avg&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;AvgTicketPrice&quot;</span>  <span class="comment"># 计算平均票价</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;max_price&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;max&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;AvgTicketPrice&quot;</span>  <span class="comment"># 计算最高票价</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;min_price&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;min&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;AvgTicketPrice&quot;</span>  <span class="comment"># 计算最低票价</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个查询中，我们为每个目的地添加了三个聚合：<code>avg_price</code>、<code>max_price</code> 和 <code>min_price</code>，分别计算每个目的地的平均票价、最大票价和最小票价。</p>
<h3 id="3-聚合价格与天气信息：统计与多重聚合"><a href="#3-聚合价格与天气信息：统计与多重聚合" class="headerlink" title="3. 聚合价格与天气信息：统计与多重聚合"></a><strong>3. 聚合价格与天气信息：统计与多重聚合</strong></h3><p>如果你还想结合天气信息（如 <code>DestWeather</code> 字段）与航班价格统计一起进行聚合，可以使用嵌套聚合：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">GET kibana_sample_data_flights/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;size&quot;</span>: 0,</span><br><span class="line">  <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;flight_dest&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;field&quot;</span>: <span class="string">&quot;DestCountry&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;aggs&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;stats_price&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;stats&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;AvgTicketPrice&quot;</span>  <span class="comment"># 计算票价的多项统计信息</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;weather&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&quot;terms&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;field&quot;</span>: <span class="string">&quot;DestWeather&quot;</span>,  <span class="comment"># 按天气类型分桶</span></span><br><span class="line">            <span class="string">&quot;size&quot;</span>: 5  <span class="comment"># 只返回前5个天气类型</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个示例中，我们不仅计算了每个目的地的票价统计信息（如平均票价、最大票价等），还将天气信息作为另一个 <code>terms</code> 聚合，显示每个目的地的天气类型，并限制返回的天气类型数量为 5 个。</p>
<hr>
<h3 id="常见的聚合类型："><a href="#常见的聚合类型：" class="headerlink" title="常见的聚合类型："></a><strong>常见的聚合类型：</strong></h3><ul>
<li><strong><code>terms</code> 聚合</strong>：将文档按某个字段的值进行分桶，常用于统计词频或其他分类数据。</li>
<li><strong><code>avg</code> 聚合</strong>：计算某个数值字段的平均值。</li>
<li><strong><code>sum</code> 聚合</strong>：计算某个数值字段的总和。</li>
<li><strong><code>min</code> 聚合</strong>：返回某个数值字段的最小值。</li>
<li><strong><code>max</code> 聚合</strong>：返回某个数值字段的最大值。</li>
<li><strong><code>stats</code> 聚合</strong>：返回字段的统计信息（包括：最小值、最大值、平均值、总和和文档数量）。</li>
<li><strong><code>date_histogram</code> 聚合</strong>：按日期进行分桶，适用于时间序列数据。</li>
<li><strong><code>histogram</code> 聚合</strong>：按数值区间进行分桶，常用于数值数据的统计。</li>
</ul>
<hr>
<h3 id="相关阅读："><a href="#相关阅读：" class="headerlink" title="相关阅读："></a><strong>相关阅读：</strong></h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.1/search-aggregations.html">Elasticsearch 聚合文档</a> 详细介绍了各种聚合的使用方式和示例。</li>
</ul>
<p>聚合功能非常强大，能帮助你从海量数据中提取有价值的信息，适用于各种数据分析场景。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">candy</div><div class="post-copyright__author_desc">欢迎来到点到为止.</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://candyadmin.github.io/elasticsearch/es%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://candyadmin.github.io/elasticsearch/es%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/')">es常用命令</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://candyadmin.github.io/49172c7d-e632-47b4-9bc4-f792ae82b980.jpeg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://candyadmin.github.io/49172c7d-e632-47b4-9bc4-f792ae82b980.jpeg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://candyadmin.github.io/elasticsearch/es%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=es常用命令&amp;url=https://candyadmin.github.io/elasticsearch/es%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://candyadmin.github.io" target="_blank">点到为止</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>学习笔记<span class="tagsPageCount">2</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/elasticsearch/logstach%E5%AE%89%E8%A3%85%E5%92%8C%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">logstach安装和导入数据</div></div></a></div><div class="next-post pull-right"><a href="/elasticsearch/es%E9%AB%98%E7%BA%A7%E5%91%BD%E4%BB%A4/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">es高级命令</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/elasticsearch/es%E9%AB%98%E7%BA%A7%E5%91%BD%E4%BB%A4/" title="es高级命令"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-27</div><div class="title">es高级命令</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="toc-number">1.</span> <span class="toc-text">1. 查看索引相关信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95%E7%8A%B6%E6%80%81%E4%B8%8E%E4%BF%A1%E6%81%AF"><span class="toc-number">2.</span> <span class="toc-text">2. 查看索引状态与信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%9F%A5%E7%9C%8B%E8%8A%82%E7%82%B9%E4%BF%A1%E6%81%AF"><span class="toc-number">3.</span> <span class="toc-text">3. 查看节点信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E5%81%A5%E5%BA%B7%E7%8A%B6%E5%86%B5"><span class="toc-number">4.</span> <span class="toc-text">4. 查看集群健康状况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81"><span class="toc-number">5.</span> <span class="toc-text">5. 查看集群状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E8%AE%BE%E7%BD%AE"><span class="toc-number">6.</span> <span class="toc-text">6. 查看集群设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%9F%A5%E7%9C%8B%E5%88%86%E7%89%87%E4%BF%A1%E6%81%AF"><span class="toc-number">7.</span> <span class="toc-text">7. 查看分片信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E6%96%87%E6%A1%A3"><span class="toc-number">8.</span> <span class="toc-text">1. 创建文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%A0%B9%E6%8D%AE-ID-%E8%8E%B7%E5%8F%96%E6%96%87%E6%A1%A3"><span class="toc-number">9.</span> <span class="toc-text">2. 根据 ID 获取文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3"><span class="toc-number">10.</span> <span class="toc-text">3. 更新文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">11.</span> <span class="toc-text">4. 删除文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C-Bulk-API"><span class="toc-number">12.</span> <span class="toc-text">5. 批量操作 (Bulk API)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%A4%9A%E6%96%87%E6%A1%A3%E8%8E%B7%E5%8F%96-MGET"><span class="toc-number">13.</span> <span class="toc-text">6. 多文档获取 (MGET)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%A4%9A%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C-MSEARCH"><span class="toc-number">14.</span> <span class="toc-text">7. 多查询操作 (MSEARCH)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E6%B8%85%E9%99%A4%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE"><span class="toc-number">15.</span> <span class="toc-text">8. 清除测试数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%86%E6%9E%90-%E2%80%9CMastering-Elasticsearch%E2%80%9D"><span class="toc-number">16.</span> <span class="toc-text">1. 分析 “Mastering Elasticsearch”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%86%E6%9E%90-%E2%80%9CElasticsearch-Server%E2%80%9D"><span class="toc-number">17.</span> <span class="toc-text">2. 分析 “Elasticsearch Server”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%86%E6%9E%90-%E2%80%9CElasticsearch-Essentials%E2%80%9D"><span class="toc-number">18.</span> <span class="toc-text">3. 分析 “Elasticsearch Essentials”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C"><span class="toc-number">19.</span> <span class="toc-text">结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Standard-Analyzer"><span class="toc-number">20.</span> <span class="toc-text">1. Standard Analyzer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Simple-Analyzer"><span class="toc-number">21.</span> <span class="toc-text">2. Simple Analyzer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Stop-Analyzer"><span class="toc-number">22.</span> <span class="toc-text">3. Stop Analyzer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Whitespace-Analyzer"><span class="toc-number">23.</span> <span class="toc-text">4. Whitespace Analyzer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Keyword-Analyzer"><span class="toc-number">24.</span> <span class="toc-text">5. Keyword Analyzer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-Pattern-Analyzer"><span class="toc-number">25.</span> <span class="toc-text">6. Pattern Analyzer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-English-Analyzer"><span class="toc-number">26.</span> <span class="toc-text">7. English Analyzer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-ICU-Analyzer-for-Chinese-Text"><span class="toc-number">27.</span> <span class="toc-text">8. ICU Analyzer for Chinese Text</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-Standard-Analyzer-for-Chinese-Text"><span class="toc-number">28.</span> <span class="toc-text">9. Standard Analyzer for Chinese Text</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-ICU-Analyzer-for-Another-Chinese-Sentence"><span class="toc-number">29.</span> <span class="toc-text">10. ICU Analyzer for Another Chinese Sentence</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">30.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2"><span class="toc-number">31.</span> <span class="toc-text">1. 基本查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%B8%A6-Profile-%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">32.</span> <span class="toc-text">2. 带 Profile 的查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B3%9B%E6%9F%A5%E8%AF%A2%EF%BC%8C%E5%AF%B9%E6%89%80%E6%9C%89%E5%AD%97%E6%AE%B5%E8%BF%9B%E8%A1%8C%E6%9F%A5%E8%AF%A2"><span class="toc-number">33.</span> <span class="toc-text">3. 泛查询，对所有字段进行查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">34.</span> <span class="toc-text">4. 指定字段查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%9F%A5%E6%89%BE%E7%BE%8E%E4%B8%BD%E5%BF%83%E7%81%B5"><span class="toc-number">35.</span> <span class="toc-text">5. 查找美丽心灵</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%B3%9B%E6%9F%A5%E8%AF%A2"><span class="toc-number">36.</span> <span class="toc-text">6. 泛查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-Phrase-%E6%9F%A5%E8%AF%A2%EF%BC%88%E7%9F%AD%E8%AF%AD%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="toc-number">37.</span> <span class="toc-text">7. Phrase 查询（短语查询）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2%EF%BC%88%E4%BD%BF%E7%94%A8%E6%8B%AC%E5%8F%B7%EF%BC%89"><span class="toc-number">38.</span> <span class="toc-text">8. 分组查询（使用括号）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E5%B8%83%E5%B0%94%E6%93%8D%E4%BD%9C%E7%AC%A6%E6%9F%A5%E8%AF%A2"><span class="toc-number">39.</span> <span class="toc-text">9. 布尔操作符查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="toc-number">40.</span> <span class="toc-text">10. 范围查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E9%80%9A%E9%85%8D%E7%AC%A6%E6%9F%A5%E8%AF%A2"><span class="toc-number">41.</span> <span class="toc-text">11. 通配符查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2-%E8%BF%91%E4%BC%BC%E5%BA%A6%E5%8C%B9%E9%85%8D"><span class="toc-number">42.</span> <span class="toc-text">12. 模糊查询 &amp; 近似度匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">43.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%BF%BD%E7%95%A5%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E7%B4%A2%E5%BC%95%EF%BC%88ignore-unavailable-true%EF%BC%89"><span class="toc-number">44.</span> <span class="toc-text">1. 忽略不存在的索引（ignore_unavailable&#x3D;true）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">45.</span> <span class="toc-text">2. 分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%97%A5%E6%9C%9F%E6%8E%92%E5%BA%8F"><span class="toc-number">46.</span> <span class="toc-text">3. 日期排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%BA%90%E8%BF%87%E6%BB%A4"><span class="toc-number">47.</span> <span class="toc-text">4. 源过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%84%9A%E6%9C%AC%E5%AD%97%E6%AE%B5"><span class="toc-number">48.</span> <span class="toc-text">5. 脚本字段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-match-%E6%9F%A5%E8%AF%A2"><span class="toc-number">49.</span> <span class="toc-text">6. match 查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-match-%E6%9F%A5%E8%AF%A2%E5%B9%B6%E4%BD%BF%E7%94%A8-AND-%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-number">50.</span> <span class="toc-text">7. match 查询并使用 AND 操作符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-match-phrase-%E6%9F%A5%E8%AF%A2%EF%BC%88%E7%9F%AD%E8%AF%AD%E5%8C%B9%E9%85%8D%EF%BC%89"><span class="toc-number">51.</span> <span class="toc-text">8. match_phrase 查询（短语匹配）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-match-phrase-%E6%9F%A5%E8%AF%A2%E5%B9%B6%E4%BD%BF%E7%94%A8-slop"><span class="toc-number">52.</span> <span class="toc-text">9. match_phrase 查询并使用 slop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-number">53.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%90%91%E7%B4%A2%E5%BC%95%E6%B7%BB%E5%8A%A0%E6%96%87%E6%A1%A3"><span class="toc-number">54.</span> <span class="toc-text">1. 向索引添加文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-query-string-%E6%9F%A5%E8%AF%A2%EF%BC%9A%E6%9F%A5%E8%AF%A2%E5%90%8D%E7%A7%B0%E4%B8%AD%E5%8C%85%E5%90%AB-%E2%80%9CRuan%E2%80%9D-%E5%92%8C-%E2%80%9CYiming%E2%80%9D-%E7%9A%84%E6%96%87%E6%A1%A3"><span class="toc-number">55.</span> <span class="toc-text">2. query_string 查询：查询名称中包含 “Ruan” 和 “Yiming” 的文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-query-string-%E6%9F%A5%E8%AF%A2%EF%BC%9A%E5%A4%9A%E4%B8%AA%E5%AD%97%E6%AE%B5%E5%92%8C%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2"><span class="toc-number">56.</span> <span class="toc-text">3. query_string 查询：多个字段和复杂查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-simple-query-string-%E6%9F%A5%E8%AF%A2%EF%BC%88%E9%BB%98%E8%AE%A4%E6%93%8D%E4%BD%9C%E7%AC%A6%E4%B8%BA-OR%EF%BC%89"><span class="toc-number">57.</span> <span class="toc-text">4. simple_query_string 查询（默认操作符为 OR）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-simple-query-string-%E6%9F%A5%E8%AF%A2%EF%BC%88%E9%BB%98%E8%AE%A4%E6%93%8D%E4%BD%9C%E7%AC%A6%E4%B8%BA-AND%EF%BC%89"><span class="toc-number">58.</span> <span class="toc-text">5. simple_query_string 查询（默认操作符为 AND）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-query-string-%E6%9F%A5%E8%AF%A2%EF%BC%9A%E6%9F%A5%E8%AF%A2%E7%94%B5%E5%BD%B1%E6%A0%87%E9%A2%98%E5%8C%85%E5%90%AB-%E2%80%9CBeautiful%E2%80%9D-%E5%92%8C-%E2%80%9CMind%E2%80%9D"><span class="toc-number">59.</span> <span class="toc-text">6. query_string 查询：查询电影标题包含 “Beautiful” 和 “Mind”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-query-string-%E6%9F%A5%E8%AF%A2%EF%BC%9A%E5%A4%9A%E4%B8%AA%E5%AD%97%E6%AE%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">60.</span> <span class="toc-text">7. query_string 查询：多个字段查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-simple-query-string-%E6%9F%A5%E8%AF%A2%EF%BC%9A%E4%BD%BF%E7%94%A8-%E8%BF%9B%E8%A1%8C%E7%9F%AD%E8%AF%AD%E5%8C%B9%E9%85%8D"><span class="toc-number">61.</span> <span class="toc-text">8. simple_query_string 查询：使用 + 进行短语匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-number">62.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E5%92%8C%E5%AD%97%E6%AE%B5%E5%AE%9A%E4%B9%89"><span class="toc-number">63.</span> <span class="toc-text">映射和字段定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%98%A0%E5%B0%84%EF%BC%88Dynamic-Mapping%EF%BC%89"><span class="toc-number">64.</span> <span class="toc-text">动态映射（Dynamic Mapping）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%BC%94%E7%A4%BA"><span class="toc-number">65.</span> <span class="toc-text">操作演示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-4"><span class="toc-number">66.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-index-false-%E8%AE%BE%E7%BD%AE"><span class="toc-number">67.</span> <span class="toc-text">1. index: false 设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-null-value-%E8%AE%BE%E7%BD%AE"><span class="toc-number">68.</span> <span class="toc-text">2. null_value 设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-copy-to-%E8%AE%BE%E7%BD%AE"><span class="toc-number">69.</span> <span class="toc-text">3. copy_to 设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86"><span class="toc-number">70.</span> <span class="toc-text">4. 数组类型处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E5%B8%B8%E8%A7%81%E7%9A%84-Mapping-%E5%8F%82%E6%95%B0"><span class="toc-number">71.</span> <span class="toc-text">总结常见的 Mapping 参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%87%AA%E5%AE%9A%E4%B9%89-Analyzer-%E5%92%8C-Char-Filter"><span class="toc-number">72.</span> <span class="toc-text">1. 自定义 Analyzer 和 Char Filter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-Tokenizer-%E5%92%8C-Char-Filter-%E7%A4%BA%E4%BE%8B"><span class="toc-number">72.1.</span> <span class="toc-text">自定义 Tokenizer 和 Char Filter 示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Path-Hierarchy-Tokenizer"><span class="toc-number">72.2.</span> <span class="toc-text">Path Hierarchy Tokenizer</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Char-Filter-%E6%9B%BF%E6%8D%A2%E7%AC%A6%E5%8F%B7"><span class="toc-number">73.</span> <span class="toc-text">2. Char Filter 替换符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Char-Filter-%E6%9B%BF%E6%8D%A2%E8%A1%A8%E6%83%85%E7%AC%A6%E5%8F%B7"><span class="toc-number">74.</span> <span class="toc-text">3. Char Filter 替换表情符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8-Stop-%E5%92%8C-Snowball-%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">75.</span> <span class="toc-text">4. 使用 Stop 和 Snowball 过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%9B%BF%E6%8D%A2"><span class="toc-number">76.</span> <span class="toc-text">5. 正则表达式替换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">77.</span> <span class="toc-text">总结：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Index-Templates-%E7%B4%A2%E5%BC%95%E6%A8%A1%E6%9D%BF"><span class="toc-number">78.</span> <span class="toc-text">1. Index Templates (索引模板)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%BB%98%E8%AE%A4%E6%A8%A1%E6%9D%BF"><span class="toc-number">78.1.</span> <span class="toc-text">创建默认模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E7%89%B9%E5%AE%9A%E6%A8%A1%E5%BC%8F%E5%88%9B%E5%BB%BA%E6%A8%A1%E6%9D%BF"><span class="toc-number">78.2.</span> <span class="toc-text">为特定模式创建模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%A8%A1%E6%9D%BF"><span class="toc-number">78.3.</span> <span class="toc-text">查看模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%A8%A1%E6%9D%BF"><span class="toc-number">78.4.</span> <span class="toc-text">删除模板</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Dynamic-Templates-%E5%8A%A8%E6%80%81%E6%A8%A1%E6%9D%BF"><span class="toc-number">79.</span> <span class="toc-text">2. Dynamic Templates (动态模板)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%98%A0%E5%B0%84%E6%95%B0%E5%AD%97%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C%E6%97%A5%E6%9C%9F%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">79.1.</span> <span class="toc-text">自动映射数字字符串和日期字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%8A%A8%E6%80%81%E6%A8%A1%E6%9D%BF%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99"><span class="toc-number">79.2.</span> <span class="toc-text">定义动态模板映射规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E5%90%88%E8%B7%AF%E5%BE%84%E5%8C%B9%E9%85%8D"><span class="toc-number">79.3.</span> <span class="toc-text">结合路径匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E5%AD%97%E6%AE%B5"><span class="toc-number">79.4.</span> <span class="toc-text">搜索字段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A-1"><span class="toc-number">80.</span> <span class="toc-text">总结：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E7%9A%84%E8%81%9A%E5%90%88%E5%88%86%E6%9E%90%EF%BC%9A%E6%8C%89%E7%9B%AE%E7%9A%84%E5%9C%B0%E5%88%86%E6%A1%B6%E7%BB%9F%E8%AE%A1"><span class="toc-number">81.</span> <span class="toc-text">1. 基本的聚合分析：按目的地分桶统计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%A2%9E%E5%8A%A0%E6%9B%B4%E5%A4%9A%E7%BB%9F%E8%AE%A1%EF%BC%9A%E5%B9%B3%E5%9D%87%E3%80%81%E6%9C%80%E5%A4%A7%E3%80%81%E6%9C%80%E5%B0%8F%E4%BB%B7%E6%A0%BC"><span class="toc-number">82.</span> <span class="toc-text">2. 增加更多统计：平均、最大、最小价格</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%81%9A%E5%90%88%E4%BB%B7%E6%A0%BC%E4%B8%8E%E5%A4%A9%E6%B0%94%E4%BF%A1%E6%81%AF%EF%BC%9A%E7%BB%9F%E8%AE%A1%E4%B8%8E%E5%A4%9A%E9%87%8D%E8%81%9A%E5%90%88"><span class="toc-number">83.</span> <span class="toc-text">3. 聚合价格与天气信息：统计与多重聚合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E8%81%9A%E5%90%88%E7%B1%BB%E5%9E%8B%EF%BC%9A"><span class="toc-number">84.</span> <span class="toc-text">常见的聚合类型：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E9%98%85%E8%AF%BB%EF%BC%9A"><span class="toc-number">85.</span> <span class="toc-text">相关阅读：</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/flink/%E5%BC%82%E6%9E%84%E7%B3%BB%E7%BB%9F%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E6%96%B9%E6%A1%88/" title="异构系统实时数据同步方案">异构系统实时数据同步方案</a><time datetime="2025-12-22T09:40:10.000Z" title="发表于 2025-12-22 17:40:10">2025-12-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/spring-boot/grafana-prometheus-springboot%E7%9B%91%E6%8E%A7%E5%B9%B3%E5%8F%B0/" title="grafana+prometheus+springboot监控平台">grafana+prometheus+springboot监控平台</a><time datetime="2025-12-03T03:10:13.000Z" title="发表于 2025-12-03 11:10:13">2025-12-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/java/java%E4%B8%AD%E5%82%B2%E4%BA%BA%E7%9A%84%E5%86%99%E6%B3%95/" title="java中傲人的写法">java中傲人的写法</a><time datetime="2025-11-29T09:21:06.000Z" title="发表于 2025-11-29 17:21:06">2025-11-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/mysql/%E9%80%9A%E8%BF%87excel%E6%96%87%E6%A1%A3%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90%E8%A1%A8%E8%AE%BE%E8%AE%A1/" title="通过excel文档快速生成表设计（excel转pdm）">通过excel文档快速生成表设计（excel转pdm）</a><time datetime="2025-11-27T01:35:57.000Z" title="发表于 2025-11-27 09:35:57">2025-11-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/linux/linux%E4%B8%8B%E4%BF%AE%E5%A4%8D%E7%BD%91%E5%8D%A1%E5%87%BA%E5%85%A5%E5%8F%A3%E7%AD%96%E7%95%A5/" title="linux下修复网卡出入口策略">linux下修复网卡出入口策略</a><time datetime="2025-10-17T09:51:59.000Z" title="发表于 2025-10-17 17:51:59">2025-10-17</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="candy" target="_blank">candy</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">42</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">32</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">15</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/JNI/" style="font-size: 0.88rem;">JNI<sup>1</sup></a><a href="/tags/chrome/" style="font-size: 0.88rem;">chrome<sup>2</sup></a><a href="/tags/docker/" style="font-size: 0.88rem;">docker<sup>1</sup></a><a href="/tags/docker%E9%83%A8%E7%BD%B2/" style="font-size: 0.88rem;">docker部署<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/grafana-prometheus-springboot/" style="font-size: 0.88rem;">grafana,prometheus,springboot<sup>1</sup></a><a href="/tags/k8s/" style="font-size: 0.88rem;">k8s<sup>1</sup></a><a href="/tags/lua%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 0.88rem;">lua表达式<sup>1</sup></a><a href="/tags/nginx/" style="font-size: 0.88rem;">nginx<sup>2</sup></a><a href="/tags/openvpn/" style="font-size: 0.88rem;">openvpn<sup>2</sup></a><a href="/tags/%E4%BA%8B%E5%8A%A1/" style="font-size: 0.88rem;">事务<sup>1</sup></a><a href="/tags/%E4%BA%A4%E6%98%93%E7%AD%96%E7%95%A5/" style="font-size: 0.88rem;">交易策略<sup>1</sup></a><a href="/tags/%E5%82%B2%E4%BA%BA%E7%9A%84%E5%86%99%E6%B3%95/" style="font-size: 0.88rem;">傲人的写法<sup>1</sup></a><a href="/tags/%E5%91%BD%E4%BB%A4/" style="font-size: 0.88rem;">命令<sup>1</sup></a><a href="/tags/%E5%A4%87%E4%BB%BD/" style="font-size: 0.88rem;">备份<sup>2</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 0.88rem;">学习笔记<sup>2</sup></a><a href="/tags/%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5/" style="font-size: 0.88rem;">实时数据同步<sup>1</sup></a><a href="/tags/%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" style="font-size: 0.88rem;">常用命令<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 0.88rem;">并发<sup>1</sup></a><a href="/tags/%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF/" style="font-size: 0.88rem;">开机自启<sup>1</sup></a><a href="/tags/%E6%89%93%E5%8D%B0%E5%BC%82%E5%B8%B8%E6%97%A5%E5%BF%97/" style="font-size: 0.88rem;">打印异常日志<sup>1</sup></a><a href="/tags/%E6%89%A9%E5%AE%B9%E7%A3%81%E7%9B%98/" style="font-size: 0.88rem;">扩容磁盘<sup>2</sup></a><a href="/tags/%E6%8A%A5%E8%AD%A6/" style="font-size: 0.88rem;">报警<sup>1</sup></a><a href="/tags/%E6%9F%A5%E6%89%BE%E8%BF%9B%E7%A8%8B/" style="font-size: 0.88rem;">查找进程<sup>1</sup></a><a href="/tags/%E6%BC%8F%E6%B4%9E/" style="font-size: 0.88rem;">漏洞<sup>1</sup></a><a href="/tags/%E7%8A%B6%E6%80%81%E6%9C%BA/" style="font-size: 0.88rem;">状态机<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%AB%99%E8%B5%84%E6%BA%90/" style="font-size: 0.88rem;">网站资源<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>1</sup></a><a href="/tags/%E7%BF%BB%E5%A2%99/" style="font-size: 0.88rem;">翻墙<sup>1</sup></a><a href="/tags/%E8%87%AA%E5%AD%A6%E5%85%AC%E5%BC%8F/" style="font-size: 0.88rem;">自学公式<sup>1</sup></a><a href="/tags/%E8%A1%A8%E8%AE%BE%E8%AE%A1/" style="font-size: 0.88rem;">表设计<sup>1</sup></a><a href="/tags/%E8%B4%A6%E6%88%B7%E8%B5%84%E9%87%91/" style="font-size: 0.88rem;">账户资金<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 candy 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>