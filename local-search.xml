<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>åŸºäºk8så®ç°ä¼˜é›…åœæœº</title>
    <link href="/docker/%E5%9F%BA%E4%BA%8Ek8s%E5%AE%9E%E7%8E%B0%E4%BC%98%E9%9B%85%E5%81%9C%E6%9C%BA/"/>
    <url>/docker/%E5%9F%BA%E4%BA%8Ek8s%E5%AE%9E%E7%8E%B0%E4%BC%98%E9%9B%85%E5%81%9C%E6%9C%BA/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ Kubernetes ä¸­ï¼Œ<strong>é»˜è®¤æƒ…å†µä¸‹ pod ä¼šåœ¨æ¥æ”¶åˆ° <code>SIGTERM</code> ä¿¡å·ï¼ˆä¾‹å¦‚å‡çº§ã€åˆ é™¤ç­‰åœºæ™¯ï¼‰åï¼Œç«‹å³ä» Service çš„è´Ÿè½½åˆ—è¡¨ä¸­æ‘˜é™¤ï¼ˆEndpoint ç§»é™¤ï¼‰</strong>ï¼Œç„¶åå†æ‰§è¡Œ <code>preStop</code> é’©å­ä»¥åŠè¿›å…¥ <code>terminationGracePeriodSeconds</code> ç­‰æ­¥éª¤ã€‚</p><p>ä½ è¯´çš„éœ€æ±‚æ˜¯ï¼š</p><blockquote><p><strong>åœ¨å‘ç‰ˆæ—¶ï¼ŒPod æ”¶åˆ°åœæ­¢ä¿¡å·åï¼Œä¸è¦ç«‹å³æ‘˜é™¤å®ƒçš„ IP å’Œç«¯å£ï¼ˆå³ä¸ç«‹å³ä»æœåŠ¡åˆ—è¡¨ä¸­å‰”é™¤ï¼‰ï¼Œè€Œæ˜¯ç­‰åˆ°ä½ ä¸»åŠ¨å®Œæˆä¸€äº›æ“ä½œï¼ˆå¦‚ä¼˜é›…åœæœºé€šçŸ¥ï¼‰åï¼Œå†æ‘˜é™¤ã€‚</strong></p></blockquote><p>è¿™ä¸ªéœ€æ±‚åœ¨ Kubernetes ä¸­å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å®ç°ï¼š</p><hr><h2 id="âœ…-å®ç°ç›®æ ‡ï¼šæ§åˆ¶-Pod-åœ¨-SIGTERM-æ—¶-å»¶è¿Ÿæ‘˜é™¤-IP-å’Œç«¯å£"><a href="#âœ…-å®ç°ç›®æ ‡ï¼šæ§åˆ¶-Pod-åœ¨-SIGTERM-æ—¶-å»¶è¿Ÿæ‘˜é™¤-IP-å’Œç«¯å£" class="headerlink" title="âœ… å®ç°ç›®æ ‡ï¼šæ§åˆ¶ Pod åœ¨ SIGTERM æ—¶ å»¶è¿Ÿæ‘˜é™¤ IP å’Œç«¯å£"></a>âœ… å®ç°ç›®æ ‡ï¼šæ§åˆ¶ Pod åœ¨ <code>SIGTERM</code> æ—¶ <strong>å»¶è¿Ÿæ‘˜é™¤ IP å’Œç«¯å£</strong></h2><hr><h2 id="ğŸ§©-æ–¹æ³•ä¸€ï¼šä½¿ç”¨-terminationGracePeriodSeconds-å»¶è¿Ÿæ‘˜é™¤é€»è¾‘"><a href="#ğŸ§©-æ–¹æ³•ä¸€ï¼šä½¿ç”¨-terminationGracePeriodSeconds-å»¶è¿Ÿæ‘˜é™¤é€»è¾‘" class="headerlink" title="ğŸ§© æ–¹æ³•ä¸€ï¼šä½¿ç”¨ terminationGracePeriodSeconds + å»¶è¿Ÿæ‘˜é™¤é€»è¾‘"></a>ğŸ§© æ–¹æ³•ä¸€ï¼šä½¿ç”¨ <code>terminationGracePeriodSeconds</code> + å»¶è¿Ÿæ‘˜é™¤é€»è¾‘</h2><p>Kubernetes çš„<strong>æ‘˜é™¤ Endpoint è¡Œä¸º</strong>æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>Pod ä¸€æ—¦è¿›å…¥ Terminating çŠ¶æ€ï¼Œ<strong>ä¼šç«‹å³ä» Service çš„ endpoints ä¸­ç§»é™¤</strong></li><li>å¹¶ä¸æ˜¯ç­‰ <code>preStop</code> æˆ– <code>terminationGracePeriodSeconds</code> å®Œæˆåæ‰ç§»é™¤</li></ul><p>å› æ­¤æƒ³â€œæš‚æ—¶ä¿ç•™ IP ä¸è¢«æ‘˜é™¤â€â€”â€”<strong>éœ€è¦è§„é¿ Pod ç›´æ¥è¿›å…¥ Terminating çŠ¶æ€</strong></p><h3 id="ğŸ§ -æ ¸å¿ƒæ–¹æ¡ˆï¼šæ§åˆ¶æµé‡çš„ç§»é™¤æ—¶æœºï¼Œè€Œä¸æ˜¯æ§åˆ¶-Pod-çš„ä¸‹çº¿æ—¶æœº"><a href="#ğŸ§ -æ ¸å¿ƒæ–¹æ¡ˆï¼šæ§åˆ¶æµé‡çš„ç§»é™¤æ—¶æœºï¼Œè€Œä¸æ˜¯æ§åˆ¶-Pod-çš„ä¸‹çº¿æ—¶æœº" class="headerlink" title="ğŸ§  æ ¸å¿ƒæ–¹æ¡ˆï¼šæ§åˆ¶æµé‡çš„ç§»é™¤æ—¶æœºï¼Œè€Œä¸æ˜¯æ§åˆ¶ Pod çš„ä¸‹çº¿æ—¶æœº"></a>ğŸ§  æ ¸å¿ƒæ–¹æ¡ˆï¼š<strong>æ§åˆ¶æµé‡çš„ç§»é™¤æ—¶æœºï¼Œè€Œä¸æ˜¯æ§åˆ¶ Pod çš„ä¸‹çº¿æ—¶æœº</strong></h3><hr><h2 id="âœ…-æ–¹æ³•äºŒï¼šä½¿ç”¨-Readiness-Probe-æ§åˆ¶æµé‡æ‘˜é™¤æ—¶æœºï¼ˆæ¨èï¼‰"><a href="#âœ…-æ–¹æ³•äºŒï¼šä½¿ç”¨-Readiness-Probe-æ§åˆ¶æµé‡æ‘˜é™¤æ—¶æœºï¼ˆæ¨èï¼‰" class="headerlink" title="âœ… æ–¹æ³•äºŒï¼šä½¿ç”¨ [Readiness Probe] æ§åˆ¶æµé‡æ‘˜é™¤æ—¶æœºï¼ˆæ¨èï¼‰"></a>âœ… æ–¹æ³•äºŒï¼šä½¿ç”¨ [<strong>Readiness Probe</strong>] æ§åˆ¶æµé‡æ‘˜é™¤æ—¶æœºï¼ˆæ¨èï¼‰</h2><h3 id="æ­¥éª¤å¦‚ä¸‹ï¼š"><a href="#æ­¥éª¤å¦‚ä¸‹ï¼š" class="headerlink" title="æ­¥éª¤å¦‚ä¸‹ï¼š"></a>æ­¥éª¤å¦‚ä¸‹ï¼š</h3><ol><li>Pod å¯åŠ¨æ—¶è®¾ç½® <code>readinessProbe</code>ï¼Œåªæœ‰æ¢é’ˆé€šè¿‡æ—¶æ‰å‚ä¸æœåŠ¡</li><li>åœæœºå‰ï¼Œåœ¨ <code>preStop</code> é˜¶æ®µ<strong>æ‰‹åŠ¨è®¾ç½®ä¸º NotReady</strong>ï¼ˆæµé‡ä¼šè¢«æ‘˜é™¤ï¼Œä½† Pod ä»åœ¨ï¼‰</li></ol><hr><h3 id="âœ…-å®ç°æ–¹å¼ï¼ˆæ¨èï¼‰"><a href="#âœ…-å®ç°æ–¹å¼ï¼ˆæ¨èï¼‰" class="headerlink" title="âœ… å®ç°æ–¹å¼ï¼ˆæ¨èï¼‰"></a>âœ… å®ç°æ–¹å¼ï¼ˆæ¨èï¼‰</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">livenessProbe:</span><br>  <span class="hljs-attr">httpGet:</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">/actuator/health</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>  <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">10</span><br>  <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span><br><br><span class="hljs-attr">readinessProbe:</span><br>  <span class="hljs-attr">httpGet:</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">/actuator/health/readiness</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>  <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">5</span><br>  <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><h3 id="âš™ï¸-preStop-é˜¶æ®µâ€œæ‰‹åŠ¨è®¾ç½®ä¸ºä¸å¥åº·â€"><a href="#âš™ï¸-preStop-é˜¶æ®µâ€œæ‰‹åŠ¨è®¾ç½®ä¸ºä¸å¥åº·â€" class="headerlink" title="âš™ï¸ preStop é˜¶æ®µâ€œæ‰‹åŠ¨è®¾ç½®ä¸ºä¸å¥åº·â€"></a>âš™ï¸ preStop é˜¶æ®µâ€œæ‰‹åŠ¨è®¾ç½®ä¸ºä¸å¥åº·â€</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">lifecycle:</span><br>  <span class="hljs-attr">preStop:</span><br>    <span class="hljs-attr">exec:</span><br>      <span class="hljs-attr">command:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">/bin/sh</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">-c</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-string">|</span><br><span class="hljs-string">          echo &quot;Notifying service to stop sending traffic&quot;</span><br><span class="hljs-string">          curl -X POST http://localhost:8080/shutdown-hook</span><br><span class="hljs-string">          sleep 30  # ç­‰å¾…æµé‡è½¬ç§» + ä¼˜é›…åœæœº</span><br></code></pre></td></tr></table></figure><p>åœ¨ Spring Boot ä¸­å¯ä»¥ç»“åˆ actuator ç®¡ç†å¥åº·çŠ¶æ€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShutdownController</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ApplicationAvailability availability;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ShutdownController</span><span class="hljs-params">(ApplicationAvailability availability)</span> &#123;<br>        <span class="hljs-built_in">this</span>.availability = availability;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/shutdown-hook&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shutdown</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// æ‰‹åŠ¨è®¾ç½®ä¸ºä¸å¯ç”¨ï¼ˆä¹Ÿå¯ä»¥åˆ‡æ¢ readiness probe çš„çŠ¶æ€ï¼‰</span><br>        <span class="hljs-comment">// è‹¥ä½¿ç”¨ spring-boot-actuator 2.3+ å¯åˆ‡æ¢ Readiness</span><br>        System.out.println(<span class="hljs-string">&quot;Application is preparing to shutdown...&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="â—-ä¸ºä»€ä¹ˆä¸èƒ½â€œé˜»æ­¢-IP-è¢«æ‘˜é™¤â€"><a href="#â—-ä¸ºä»€ä¹ˆä¸èƒ½â€œé˜»æ­¢-IP-è¢«æ‘˜é™¤â€" class="headerlink" title="â— ä¸ºä»€ä¹ˆä¸èƒ½â€œé˜»æ­¢ IP è¢«æ‘˜é™¤â€"></a>â— ä¸ºä»€ä¹ˆä¸èƒ½â€œé˜»æ­¢ IP è¢«æ‘˜é™¤â€</h2><p>K8s çš„ Endpoint Controller ä¸€æ—¦å‘ç° Pod æ˜¯ Terminating çŠ¶æ€ï¼ˆå³ä½¿ä½ è¿˜åœ¨ <code>preStop</code> å’Œ <code>terminationGracePeriodSeconds</code> é‡Œï¼‰ï¼Œå°±ä¼šä» Service ä¸­ç§»é™¤ Endpointï¼ˆä¹Ÿå°±æ˜¯ä» DNS æˆ–ç½‘å…³è´Ÿè½½ä¸­æ‘˜é™¤ IPï¼‰ã€‚</p><blockquote><p>æ‰€ä»¥ï¼Œè¦æƒ³â€œå‘ç‰ˆæ—¶ä¸ç«‹å³æ‘˜æ‰ IPâ€ï¼Œä½ è¦é¿å…ä¸€å¼€å§‹å°±è®© Pod è¿›å…¥ Terminatingï¼Œè€Œæ˜¯<strong>å…ˆæ ‡è®°ä¸º NotReady</strong>ï¼Œç­‰å¤„ç†å®Œæ¯•å†åˆ é™¤ Podã€‚</p></blockquote><hr><h2 id="âœ…-æ€»ç»“æ¨èé…ç½®"><a href="#âœ…-æ€»ç»“æ¨èé…ç½®" class="headerlink" title="âœ… æ€»ç»“æ¨èé…ç½®"></a>âœ… æ€»ç»“æ¨èé…ç½®</h2><table><thead><tr><th>é¡¹ç›®</th><th>æ¨èé…ç½®</th></tr></thead><tbody><tr><td><code>readinessProbe</code></td><td>ç”¨äºæ§åˆ¶æœåŠ¡æ˜¯å¦æ¥å—æµé‡</td></tr><tr><td><code>preStop</code> hook</td><td>ä¼˜é›…é€šçŸ¥å¾®æœåŠ¡å…³é—­ï¼Œå¹¶ sleep ç­‰å¾…</td></tr><tr><td><code>terminationGracePeriodSeconds</code></td><td>è®¾ç½®ä¸º â‰¥ <code>preStop</code> è„šæœ¬è€—æ—¶ï¼Œä¾‹å¦‚ 60s</td></tr><tr><td><code>Spring Boot readiness endpoint</code></td><td>å»ºè®®ä½¿ç”¨ actuator + readiness å®ç°æ¥å£å¥åº·çŠ¶æ€åŠ¨æ€åˆ‡æ¢</td></tr></tbody></table><hr><h3 id="ğŸ’¡-ç¤ºä¾‹å®Œæ•´é…ç½®ç‰‡æ®µ"><a href="#ğŸ’¡-ç¤ºä¾‹å®Œæ•´é…ç½®ç‰‡æ®µ" class="headerlink" title="ğŸ’¡ ç¤ºä¾‹å®Œæ•´é…ç½®ç‰‡æ®µ"></a>ğŸ’¡ ç¤ºä¾‹å®Œæ•´é…ç½®ç‰‡æ®µ</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spec:</span><br>  <span class="hljs-attr">containers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">trade</span><br>      <span class="hljs-attr">image:</span> <span class="hljs-string">trade:latest</span><br>      <span class="hljs-attr">lifecycle:</span><br>        <span class="hljs-attr">preStop:</span><br>          <span class="hljs-attr">exec:</span><br>            <span class="hljs-attr">command:</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">/bin/sh</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">-c</span><br>              <span class="hljs-bullet">-</span> <span class="hljs-string">|</span><br><span class="hljs-string">                curl -X POST http://localhost:8080/shutdown-hook</span><br><span class="hljs-string">                sleep 30</span><br><span class="hljs-string"></span>      <span class="hljs-attr">readinessProbe:</span><br>        <span class="hljs-attr">httpGet:</span><br>          <span class="hljs-attr">path:</span> <span class="hljs-string">/actuator/health/readiness</span><br>          <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br>        <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">5</span><br>        <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">5</span><br>  <span class="hljs-attr">terminationGracePeriodSeconds:</span> <span class="hljs-number">60</span><br></code></pre></td></tr></table></figure><hr><p>å¦‚ä½ æƒ³ç»“åˆ Spring Boot actuator åšåŠ¨æ€å¥åº·çŠ¶æ€åˆ‡æ¢ï¼ˆæ¯”å¦‚è°ƒç”¨ <code>/actuator/health/readiness</code> è¿”å› <code>DOWN</code> çŠ¶æ€ï¼‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>k8s</category>
      
    </categories>
    
    
    <tags>
      
      <tag>chrome</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysqlå¼‚å¸¸æ’æŸ¥sql</title>
    <link href="/mysql/mysql%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5sql/"/>
    <url>/mysql/mysql%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5sql/</url>
    
    <content type="html"><![CDATA[<p>###æŸ¥æ‰¾æŒç»­æ—¶é—´è¶…è¿‡ 60s çš„äº‹åŠ¡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> information_schema.innodb_trx <span class="hljs-keyword">where</span> TIME_TO_SEC(timediff(now(),trx_started))<span class="hljs-operator">&gt;</span><span class="hljs-number">60</span><br></code></pre></td></tr></table></figure><p>###æŒ‡å®šsqlçš„å¼•æ“</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> test(c <span class="hljs-type">int</span>) engine<span class="hljs-operator">=</span>InnoDB;<br></code></pre></td></tr></table></figure><p>###æŸ¥çœ‹ transaction-isolation çš„å€¼,ä¾‹å¦‚ï¼š READ-COMMITTED</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;transaction_isolation&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="alter-table-è¯­å¥é‡Œé¢è®¾å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœåœ¨è¿™ä¸ªæŒ‡å®šçš„ç­‰å¾…æ—¶é—´é‡Œé¢èƒ½å¤Ÿæ‹¿åˆ°-MDL-å†™é”æœ€å¥½ï¼Œæ‹¿ä¸åˆ°ä¹Ÿä¸è¦é˜»å¡åé¢çš„ä¸šåŠ¡è¯­å¥ï¼Œå…ˆæ”¾å¼ƒã€‚ä¹‹åå¼€å‘äººå‘˜æˆ–è€…-DBA-å†é€šè¿‡é‡è¯•å‘½ä»¤é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚"><a href="#alter-table-è¯­å¥é‡Œé¢è®¾å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœåœ¨è¿™ä¸ªæŒ‡å®šçš„ç­‰å¾…æ—¶é—´é‡Œé¢èƒ½å¤Ÿæ‹¿åˆ°-MDL-å†™é”æœ€å¥½ï¼Œæ‹¿ä¸åˆ°ä¹Ÿä¸è¦é˜»å¡åé¢çš„ä¸šåŠ¡è¯­å¥ï¼Œå…ˆæ”¾å¼ƒã€‚ä¹‹åå¼€å‘äººå‘˜æˆ–è€…-DBA-å†é€šè¿‡é‡è¯•å‘½ä»¤é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚" class="headerlink" title="alter table è¯­å¥é‡Œé¢è®¾å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœåœ¨è¿™ä¸ªæŒ‡å®šçš„ç­‰å¾…æ—¶é—´é‡Œé¢èƒ½å¤Ÿæ‹¿åˆ° MDL å†™é”æœ€å¥½ï¼Œæ‹¿ä¸åˆ°ä¹Ÿä¸è¦é˜»å¡åé¢çš„ä¸šåŠ¡è¯­å¥ï¼Œå…ˆæ”¾å¼ƒã€‚ä¹‹åå¼€å‘äººå‘˜æˆ–è€… DBA å†é€šè¿‡é‡è¯•å‘½ä»¤é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚"></a>alter table è¯­å¥é‡Œé¢è®¾å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœåœ¨è¿™ä¸ªæŒ‡å®šçš„ç­‰å¾…æ—¶é—´é‡Œé¢èƒ½å¤Ÿæ‹¿åˆ° MDL å†™é”æœ€å¥½ï¼Œæ‹¿ä¸åˆ°ä¹Ÿä¸è¦é˜»å¡åé¢çš„ä¸šåŠ¡è¯­å¥ï¼Œå…ˆæ”¾å¼ƒã€‚ä¹‹åå¼€å‘äººå‘˜æˆ–è€… DBA å†é€šè¿‡é‡è¯•å‘½ä»¤é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> t nowait <span class="hljs-keyword">add</span> <span class="hljs-keyword">column</span> c <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> t wait <span class="hljs-keyword">add</span> <span class="hljs-keyword">column</span> c <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>;<br><br></code></pre></td></tr></table></figure><h3 id="é˜²æ­¢å‡ºç°æ­»é”ï¼Œè®¾ç½®åŠ é”è¶…æ—¶æ—¶é—´"><a href="#é˜²æ­¢å‡ºç°æ­»é”ï¼Œè®¾ç½®åŠ é”è¶…æ—¶æ—¶é—´" class="headerlink" title="é˜²æ­¢å‡ºç°æ­»é”ï¼Œè®¾ç½®åŠ é”è¶…æ—¶æ—¶é—´"></a>é˜²æ­¢å‡ºç°æ­»é”ï¼Œè®¾ç½®åŠ é”è¶…æ—¶æ—¶é—´</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">GLOBAL</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;innodb_lock_wait_timeout&#x27;</span>;<br><span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> innodb_lock_wait_timeout<span class="hljs-operator">=</span><span class="hljs-number">120</span>;<br></code></pre></td></tr></table></figure><h3 id="å‘èµ·æ­»é”æ£€æµ‹ï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•°-innodb-deadlock-detect-è®¾ç½®ä¸º-onï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚"><a href="#å‘èµ·æ­»é”æ£€æµ‹ï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•°-innodb-deadlock-detect-è®¾ç½®ä¸º-onï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚" class="headerlink" title="å‘èµ·æ­»é”æ£€æµ‹ï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•° innodb_deadlock_detect è®¾ç½®ä¸º onï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚"></a>å‘èµ·æ­»é”æ£€æµ‹ï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚å°†å‚æ•° innodb_deadlock_detect è®¾ç½®ä¸º onï¼Œè¡¨ç¤ºå¼€å¯è¿™ä¸ªé€»è¾‘ã€‚</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">GLOBAL</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;innodb_deadlock_detect&#x27;</span>;<br><span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> innodb_deadlock_detect<span class="hljs-operator">=</span><span class="hljs-keyword">on</span>;<br></code></pre></td></tr></table></figure><h3 id="ç»Ÿè®¡ç´¢å¼•æƒ…å†µ"><a href="#ç»Ÿè®¡ç´¢å¼•æƒ…å†µ" class="headerlink" title="ç»Ÿè®¡ç´¢å¼•æƒ…å†µ"></a>ç»Ÿè®¡ç´¢å¼•æƒ…å†µ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> TABLE_NAME, INDEX_NAME, NON_UNIQUE, SEQ_IN_INDEX, COLUMN_NAME, INDEX_TYPE<br><span class="hljs-keyword">FROM</span> information_schema.STATISTICS<br><span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;mt5_bybit_demo&#x27;</span><br>  <span class="hljs-keyword">AND</span> TABLE_NAME <span class="hljs-keyword">IN</span> (<br>                     <span class="hljs-string">&#x27;mt5_orders&#x27;</span>,<br>                     <span class="hljs-string">&#x27;mt5_position&#x27;</span>,<br>                     <span class="hljs-string">&#x27;mt5_orders_history&#x27;</span>,<br>                     <span class="hljs-string">&#x27;mt5_deals&#x27;</span>,<br>                     <span class="hljs-string">&#x27;mt5_accounts&#x27;</span>,<br>                     <span class="hljs-string">&#x27;mt5_groups&#x27;</span>,<br>                     <span class="hljs-string">&#x27;mt5_users&#x27;</span><br>    )<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> TABLE_NAME, INDEX_NAME, SEQ_IN_INDEX;<br><br></code></pre></td></tr></table></figure><h3 id="æ™®é€šæ•°æ®åº“å¤‡ä»½å‘½ä»¤"><a href="#æ™®é€šæ•°æ®åº“å¤‡ä»½å‘½ä»¤" class="headerlink" title="æ™®é€šæ•°æ®åº“å¤‡ä»½å‘½ä»¤"></a>æ™®é€šæ•°æ®åº“å¤‡ä»½å‘½ä»¤</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysqldump <span class="hljs-operator">-</span>u root <span class="hljs-operator">-</span>p <span class="hljs-comment">--databases mt5_bybit_demo --result-file=/home/mysql_backup/mt5_bybit_demo.sql</span><br></code></pre></td></tr></table></figure><h3 id="åŸºäº-InnoDB-å­˜å‚¨å¼•æ“-MySQLåšä¸€è‡´æ€§å¤‡ä»½çš„ä¸€ç§å¯è¡Œæ–¹æ¡ˆ"><a href="#åŸºäº-InnoDB-å­˜å‚¨å¼•æ“-MySQLåšä¸€è‡´æ€§å¤‡ä»½çš„ä¸€ç§å¯è¡Œæ–¹æ¡ˆ" class="headerlink" title="åŸºäº InnoDB å­˜å‚¨å¼•æ“ + MySQLåšä¸€è‡´æ€§å¤‡ä»½çš„ä¸€ç§å¯è¡Œæ–¹æ¡ˆ"></a>åŸºäº InnoDB å­˜å‚¨å¼•æ“ + MySQLåšä¸€è‡´æ€§å¤‡ä»½çš„ä¸€ç§å¯è¡Œæ–¹æ¡ˆ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- Q1: è®¾ç½®å½“å‰ä¼šè¯çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸º RRï¼ˆå¯é‡å¤è¯»ï¼‰</span><br><span class="hljs-keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;<br><br><span class="hljs-comment">-- Q2: å¯åŠ¨äº‹åŠ¡ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªä¸€è‡´æ€§å¿«ç…§ï¼Œç¡®ä¿æ•´ä¸ªä¼šè¯è¯»åˆ°çš„æ•°æ®ä¸€è‡´</span><br><span class="hljs-keyword">START</span> TRANSACTION <span class="hljs-keyword">WITH</span> CONSISTENT SNAPSHOT;<br><br><span class="hljs-comment">-- Q3: è®¾ç½®ä¿å­˜ç‚¹ï¼ˆå¯é€‰ï¼Œä¸»è¦ç”¨äº rollbackï¼‰</span><br><span class="hljs-keyword">SAVEPOINT</span> sp;<br><br><span class="hljs-comment">-- Q4: è·å–è¡¨ç»“æ„</span><br><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t1`;<br><br><span class="hljs-comment">-- Q5: è·å–è¡¨æ•°æ®ï¼ˆåœ¨ä¸€è‡´æ€§è§†å›¾ä¸‹ï¼‰</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> `t1`;<br><br><span class="hljs-comment">-- Q6: å›æ»šåˆ°ä¿å­˜ç‚¹ï¼ˆç”¨äºæ¸…ç†çŠ¶æ€ï¼Œé€šå¸¸å¯é€‰ï¼‰</span><br><span class="hljs-keyword">ROLLBACK</span> <span class="hljs-keyword">TO</span> <span class="hljs-keyword">SAVEPOINT</span> sp;<br><br><span class="hljs-comment">-- æœ€åæäº¤äº‹åŠ¡æˆ–å›æ»šï¼ˆå¦‚æœåªæ˜¯è¯»å–ï¼Œå…¶å®å¯ä»¥ä¸ç”¨æäº¤ï¼‰</span><br><span class="hljs-keyword">ROLLBACK</span>;<br></code></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹åˆ·ç›˜é…ç½®-innodb-io-capacity"><a href="#æŸ¥çœ‹åˆ·ç›˜é…ç½®-innodb-io-capacity" class="headerlink" title="æŸ¥çœ‹åˆ·ç›˜é…ç½® innodb_io_capacity ,"></a>æŸ¥çœ‹åˆ·ç›˜é…ç½® innodb_io_capacity ,</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">GLOBAL</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;innodb_io_capacity&#x27;</span>;<br></code></pre></td></tr></table></figure><table><thead><tr><th>ç¡¬ç›˜ç±»å‹</th><th>ç±»å‹è¯´æ˜</th><th><code>innodb_io_capacity</code></th><th><code>innodb_io_capacity_max</code></th></tr></thead><tbody><tr><td>æœºæ¢°ç¡¬ç›˜ï¼ˆHDDï¼‰</td><td>7200 RPM æ™®é€šç¡¬ç›˜</td><td>100 ~ 200</td><td>200 ~ 400</td></tr><tr><td>SATA å›ºæ€ï¼ˆSSDï¼‰</td><td>2.5è‹±å¯¸ï¼ŒSATA æ¥å£</td><td>300 ~ 800</td><td>1000 ~ 2000</td></tr><tr><td>M.2 NVMe å›ºæ€ï¼ˆé«˜é€Ÿï¼‰</td><td>PCIe 3.0&#x2F;4.0 NVMeï¼ˆé«˜é€Ÿ SSDï¼‰</td><td>1000 ~ 2000</td><td>3000 ~ 10000</td></tr><tr><td>ä¼ä¸šçº§ SSDï¼ˆé«˜IOï¼‰</td><td>é«˜ç«¯ NVMe ä¼ä¸šç¡¬ç›˜&#x2F;RAIDé˜µåˆ—</td><td>2000 ~ 4000+</td><td>5000 ~ 20000+</td></tr></tbody></table><h1 id="MySQL-ä¸­-SELECT-ä¸-ALTER-TABLE-æ“ä½œå¯¹è¡¨é”å®šçš„å½±å“æ¯”è¾ƒ"><a href="#MySQL-ä¸­-SELECT-ä¸-ALTER-TABLE-æ“ä½œå¯¹è¡¨é”å®šçš„å½±å“æ¯”è¾ƒ" class="headerlink" title="MySQL ä¸­ SELECT ä¸ ALTER TABLE æ“ä½œå¯¹è¡¨é”å®šçš„å½±å“æ¯”è¾ƒ"></a>MySQL ä¸­ SELECT ä¸ ALTER TABLE æ“ä½œå¯¹è¡¨é”å®šçš„å½±å“æ¯”è¾ƒ</h1><h2 id="ä¸€ã€SELECT-æŸ¥è¯¢çš„è¡¨é”å®šè¡Œä¸º"><a href="#ä¸€ã€SELECT-æŸ¥è¯¢çš„è¡¨é”å®šè¡Œä¸º" class="headerlink" title="ä¸€ã€SELECT æŸ¥è¯¢çš„è¡¨é”å®šè¡Œä¸º"></a>ä¸€ã€SELECT æŸ¥è¯¢çš„è¡¨é”å®šè¡Œä¸º</h2><table><thead><tr><th>å­˜å‚¨å¼•æ“</th><th>é”å®šè¡Œä¸º</th></tr></thead><tbody><tr><td><strong>InnoDB</strong></td><td>é»˜è®¤ä½¿ç”¨ <strong>éé”å®šä¸€è‡´æ€§è¯»</strong>ï¼ˆMVCC å®ç°ï¼‰ï¼Œ<strong>ä¸é”è¡¨</strong>ã€‚</td></tr><tr><td><strong>MyISAM</strong></td><td>è·å–<strong>å…±äº«é”ï¼ˆè¯»é”ï¼‰</strong>ï¼Œä¸º<strong>è¡¨çº§é”</strong>ï¼Œä¼š<strong>é˜»å¡å†™æ“ä½œ</strong>ï¼Œä½†ä¸ä¼šé˜»å¡å…¶ä»–è¯»æ“ä½œã€‚</td></tr></tbody></table><h2 id="äºŒã€ALTER-TABLE-æ“ä½œçš„é”å®šè¡Œä¸º"><a href="#äºŒã€ALTER-TABLE-æ“ä½œçš„é”å®šè¡Œä¸º" class="headerlink" title="äºŒã€ALTER TABLE æ“ä½œçš„é”å®šè¡Œä¸º"></a>äºŒã€ALTER TABLE æ“ä½œçš„é”å®šè¡Œä¸º</h2><h3 id="1-InnoDB-å¼•æ“"><a href="#1-InnoDB-å¼•æ“" class="headerlink" title="1. InnoDB å¼•æ“"></a>1. InnoDB å¼•æ“</h3><table><thead><tr><th>MySQL ç‰ˆæœ¬</th><th>æ“ä½œç±»å‹</th><th>é”å®šè¡Œä¸º</th></tr></thead><tbody><tr><td>MySQL 5.6+</td><td>åœ¨çº¿ DDLï¼ˆå¦‚æ·»åŠ åˆ—ï¼‰</td><td>æ”¯æŒä½¿ç”¨ <code>ALGORITHM=INPLACE</code> å’Œ <code>LOCK=NONE</code>ï¼Œ<strong>ä¸é”è¡¨</strong></td></tr><tr><td>MySQL 5.6+</td><td>å¤åˆ¶æ•°æ®æ“ä½œï¼ˆå¦‚ä¿®æ”¹åˆ—ç±»å‹ï¼‰</td><td>ä½¿ç”¨ <code>ALGORITHM=COPY</code>ï¼Œ<strong>ä¼šé”è¡¨</strong></td></tr><tr><td>MySQL â‰¤ 5.5</td><td>æ‰€æœ‰ ALTER æ“ä½œ</td><td><strong>å¤§å¤šæ•°ä¼šé”è¡¨</strong>ï¼Œé˜»å¡è¯»å†™æ“ä½œ</td></tr></tbody></table><h3 id="2-MyISAM-å¼•æ“"><a href="#2-MyISAM-å¼•æ“" class="headerlink" title="2. MyISAM å¼•æ“"></a>2. MyISAM å¼•æ“</h3><ul><li>æ‰€æœ‰ ALTER TABLE æ“ä½œéƒ½ä¼š<strong>é”å®šæ•´ä¸ªè¡¨</strong>ï¼Œé˜»å¡æ‰€æœ‰è¯»å†™æ“ä½œç›´åˆ°å®Œæˆã€‚</li></ul><h2 id="ä¸‰ã€å‡å°‘é”å®šå½±å“çš„ç­–ç•¥"><a href="#ä¸‰ã€å‡å°‘é”å®šå½±å“çš„ç­–ç•¥" class="headerlink" title="ä¸‰ã€å‡å°‘é”å®šå½±å“çš„ç­–ç•¥"></a>ä¸‰ã€å‡å°‘é”å®šå½±å“çš„ç­–ç•¥</h2><ul><li>âœ… ä½¿ç”¨åœ¨çº¿ DDLï¼ˆMySQL 5.6+ï¼‰ï¼š<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> table_name <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> new_column <span class="hljs-type">INT</span>, ALGORITHM<span class="hljs-operator">=</span>INPLACE, LOCK<span class="hljs-operator">=</span><span class="hljs-keyword">NONE</span>;<br></code></pre></td></tr></table></figure></li><li>âœ… åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œ ALTER TABLEã€‚</li><li>âœ… ä½¿ç”¨å·¥å…· <strong>pt-online-schema-change</strong>ï¼ˆPercona Toolkitï¼‰å¯¹å¤§è¡¨ç»“æ„è¿›è¡Œæ— é”ä¿®æ”¹ã€‚</li><li>âœ… ä¸»ä»å¤åˆ¶æ¶æ„ä¸‹ï¼Œå…ˆåœ¨ä»åº“æ‰§è¡Œ ALTER TABLEï¼ŒéªŒè¯æ— è¯¯ååˆ‡ä¸»ã€‚</li></ul><h2 id="å››ã€ç¤ºä¾‹å¯¹æ¯”"><a href="#å››ã€ç¤ºä¾‹å¯¹æ¯”" class="headerlink" title="å››ã€ç¤ºä¾‹å¯¹æ¯”"></a>å››ã€ç¤ºä¾‹å¯¹æ¯”</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- åœ¨çº¿æ·»åŠ åˆ—ï¼ˆä¸é”è¡¨ï¼‰</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> phone <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>), ALGORITHM<span class="hljs-operator">=</span>INPLACE, LOCK<span class="hljs-operator">=</span><span class="hljs-keyword">NONE</span>;<br><span class="hljs-comment">-- ä¿®æ”¹åˆ—ç±»å‹ï¼ˆå¯èƒ½é”è¡¨ï¼‰</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users MODIFY <span class="hljs-keyword">COLUMN</span> phone <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">30</span>), ALGORITHM<span class="hljs-operator">=</span><span class="hljs-keyword">COPY</span>;<br></code></pre></td></tr></table></figure><h2 id="äº”ã€æ€»ç»“å¯¹æ¯”"><a href="#äº”ã€æ€»ç»“å¯¹æ¯”" class="headerlink" title="äº”ã€æ€»ç»“å¯¹æ¯”"></a>äº”ã€æ€»ç»“å¯¹æ¯”</h2><table><thead><tr><th>æ“ä½œç±»å‹</th><th>InnoDBï¼ˆé»˜è®¤ï¼‰</th><th>MyISAM</th></tr></thead><tbody><tr><td>SELECT</td><td>éé”å®šä¸€è‡´æ€§è¯»ï¼Œä¸é”è¡¨</td><td>è¡¨çº§å…±äº«é”ï¼Œé˜»å¡å†™æ“ä½œ</td></tr><tr><td>ALTER TABLE</td><td>æ”¯æŒåœ¨çº¿ DDLï¼Œéƒ¨åˆ†æ“ä½œä¸é”è¡¨</td><td>æ‰€æœ‰æ“ä½œé”è¡¨ï¼Œé˜»å¡è¯»å†™</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤‡ä»½</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaé€šè¿‡JNIè°ƒç”¨C/C++</title>
    <link href="/java/Java%E9%80%9A%E8%BF%87JNI%E8%B0%83%E7%94%A8C-C/"/>
    <url>/java/Java%E9%80%9A%E8%BF%87JNI%E8%B0%83%E7%94%A8C-C/</url>
    
    <content type="html"><![CDATA[<h4 id="1-JNI"><a href="#1-JNI" class="headerlink" title="1 JNI"></a>1 JNI</h4><p>JNIï¼Œå…¨å Java Native Interfaceï¼Œæ˜¯Javaæœ¬åœ°æ¥å£ï¼ŒJNIæ˜¯Javaè°ƒç”¨Native è¯­è¨€çš„ä¸€ç§ç‰¹æ€§ï¼Œé€šè¿‡JNIå¯ä»¥ä½¿å¾—Javaä¸C&#x2F;C++æœºå‹äº¤äº’ã€‚ç®€å•ç‚¹è¯´å°±æ˜¯JNIæ˜¯Javaä¸­è°ƒç”¨C&#x2F;C++çš„ç»Ÿç§°ã€‚</p><ul><li>Javaç¨‹åºä¸­çš„å‡½æ•°å¯ä»¥è°ƒç”¨Nativeè¯­è¨€å†™çš„å‡½æ•°ï¼ŒNativeä¸€èˆ¬æŒ‡çš„æ˜¯C&#x2F;C++ç¼–å†™çš„å‡½æ•°ã€‚</li><li>Nativeç¨‹åºä¸­çš„å‡½æ•°å¯ä»¥è°ƒç”¨Javaå±‚çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯åœ¨C&#x2F;C++ç¨‹åºä¸­å¯ä»¥è°ƒç”¨Javaçš„å‡½æ•°ã€‚</li></ul><h5 id="1-1-JNIä½¿ç”¨"><a href="#1-1-JNIä½¿ç”¨" class="headerlink" title="1.1 JNIä½¿ç”¨"></a>1.1 JNIä½¿ç”¨</h5><h6 id="1-1-1-å£°æ˜Nativeæ–¹æ³•"><a href="#1-1-1-å£°æ˜Nativeæ–¹æ³•" class="headerlink" title="1.1.1 å£°æ˜Nativeæ–¹æ³•"></a>1.1.1 å£°æ˜Nativeæ–¹æ³•</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> TestJNI;<br><span class="hljs-comment">// å¸¦åŒ…å</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JNICallCpp</span> &#123;<br><span class="hljs-comment">// å£°æ˜ä¸ºnativeï¼Œè¡¨æ˜æ˜¯æœ‰å¤–éƒ¨æ¥å®ç°çš„</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">HannoTower</span><span class="hljs-params">(<span class="hljs-type">int</span> topN, <span class="hljs-type">char</span> from, <span class="hljs-type">char</span> inter, <span class="hljs-type">char</span> to)</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">HellCpp</span><span class="hljs-params">()</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure><h6 id="1-1-2-ç¼–è¯‘ç”Ÿæˆå¤´æ–‡ä»¶"><a href="#1-1-2-ç¼–è¯‘ç”Ÿæˆå¤´æ–‡ä»¶" class="headerlink" title="1.1.2 ç¼–è¯‘ç”Ÿæˆå¤´æ–‡ä»¶"></a>1.1.2 ç¼–è¯‘ç”Ÿæˆå¤´æ–‡ä»¶</h6><ul><li>å¸¦åŒ…åç¼–è¯‘</li></ul><p>å¦‚æœ<code>.java</code>æ–‡ä»¶ä¸­å¸¦æœ‰åŒ…åï¼Œåˆ™ç¼–è¯‘æ—¶éœ€è¦åˆ‡æ¢åˆ°<code>åŒ…æ–‡ä»¶æ‰€åœ¨åŒçº§ç›®å½•</code>ï¼Œé€‚ç”¨å‘½ä»¤<code>javah åŒ…å.ç±»å</code>ã€‚å¦‚ï¼Œåœ¨E:\JavaProject\LearnJava\srcç›®å½•ä¸‹ï¼Œæ‰“å¼€cmdï¼Œè¾“å…¥<br>javah TestJNI.JNICallCppã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">E:<br>cd E:\JavaProject\LearnJava\src<br>javah TestJNI.JNICallCpp<br></code></pre></td></tr></table></figure><ul><li>ä¸å¸¦åŒ…åç¼–è¯‘</li></ul><p>å¦‚æœ<code>.java</code>æ–‡ä»¶ä¸­æ²¡æœ‰åŒ…åï¼Œåˆ™ç¼–è¯‘æ—¶éœ€è¦åˆ‡æ¢åˆ°<code>.javaæ–‡ä»¶æ‰€åœ¨åŒçº§ç›®å½•</code>ï¼Œé€‚ç”¨å‘½ä»¤<code>javah ç±»å</code>ã€‚å¦‚ï¼Œåœ¨E:\JavaProject\LearnJava\src\TestJNI\ç›®å½•ä¸‹ï¼Œæ‰“å¼€cmdï¼Œè¾“å…¥javah JNICallCppã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">E:<br>cd E:\JavaProject\LearnJava\src\TestJNI\<br>javah JNICallCpp<br></code></pre></td></tr></table></figure><h6 id="1-1-3-å®ç°Nativeæ–¹æ³•"><a href="#1-1-3-å®ç°Nativeæ–¹æ³•" class="headerlink" title="1.1.3 å®ç°Nativeæ–¹æ³•"></a>1.1.3 å®ç°Nativeæ–¹æ³•</h6><p>å°†ç¼–è¯‘ç”Ÿæˆçš„å¤´æ–‡ä»¶å¼•å…¥C++å·¥ç¨‹çš„å¤´æ–‡ä»¶ä¸­ï¼Œä»¥åŠ<code>jni.hã€jni_md.h</code>å¹¶åœ¨æ–°å»ºæºæ–‡ä»¶å®ç°å¤´æ–‡ä»¶ä¸­å®šä¹‰çš„JNIæ ¼å¼çš„çš„å‡½æ•°ï¼Œç”±äºJNIçš„æ•°æ®ç±»å‹ä¸C++æ•°æ®ç±»å‹å¹¶ä¸å®Œå…¨ç›¸åŒï¼Œå› æ­¤éœ€è¦è¿›è¡Œæ•°æ®ç±»å‹è½¬æ¢ï¼Œå®ç°å®šä¹‰çš„å‡½æ•°åï¼Œç¼–è¯‘ä¸º<code>dllã€so</code>æ ¼å¼åº“æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­å³åŒ…å«è¯¥æ¥å£ã€‚</p><ul><li><code>jni.h</code>ï¼šC:\Program Files\Java\jdk1.8.0_291\include\jni.h</li><li><code>jni_md.h</code>ï¼šC:\Program Files\Java\jdk1.8.0_291\include\win32\jni_md</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;jni.h&gt;</span></span><br><span class="hljs-comment">/* Header for class TestJNI_JNICallCpp */</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> _Included_TestJNI_JNICallCpp</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _Included_TestJNI_JNICallCpp</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> __cplusplus</span><br><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> &#123;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Class:     TestJNI_JNICallCpp</span><br><span class="hljs-comment"> * Method:    HannoTower</span><br><span class="hljs-comment"> * Signature: (ICCC)V</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function">JNIEXPORT <span class="hljs-type">void</span> JNICALL <span class="hljs-title">Java_TestJNI_JNICallCpp_HannoTower</span></span><br><span class="hljs-function">  <span class="hljs-params">(JNIEnv *, jobject, jint, jchar, jchar, jchar)</span></span>;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Class:     TestJNI_JNICallCpp</span><br><span class="hljs-comment"> * Method:    HellCpp</span><br><span class="hljs-comment"> * Signature: ()V</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function">JNIEXPORT <span class="hljs-type">void</span> JNICALL <span class="hljs-title">Java_TestJNI_JNICallCpp_HellCpp</span></span><br><span class="hljs-function">  <span class="hljs-params">(JNIEnv *, jobject)</span></span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> __cplusplus</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br></code></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;TestJNI_JNICallCpp.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-comment">//using namespace std;</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> __cplusplus</span><br><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> &#123;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br><span class="hljs-function">JNIEXPORT <span class="hljs-type">void</span> JNICALL <span class="hljs-title">Java_TestJNI_JNICallCpp_HannoTower</span></span><br><span class="hljs-function"><span class="hljs-params">(JNIEnv *jni_env, jobject jobj, jint layer, jchar from, jchar inter, jchar to)</span> </span>&#123;<br><span class="hljs-keyword">if</span> (layer == <span class="hljs-number">1</span>) &#123;<br><span class="hljs-comment">//ä»Javaä¼ è¿‡æ¥çš„å‚æ•°jcharä¸ºunsigned int 16,ä¸æ˜¯charç±»å‹ï¼Œéœ€è¦å¼ºè½¬</span><br>std::cout &lt;&lt; <span class="hljs-string">&quot;Disk 1 from &quot;</span> &lt;&lt; <span class="hljs-built_in">char</span>(from) &lt;&lt; <span class="hljs-string">&quot; to &quot;</span> &lt;&lt; <span class="hljs-built_in">char</span>(to) &lt;&lt; std::endl;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-built_in">Java_TestJNI_JNICallCpp_HannoTower</span>(jni_env, jobj, layer - <span class="hljs-number">1</span>, from, to, inter);<br>std::cout &lt;&lt; <span class="hljs-string">&quot;Disk &quot;</span> &lt;&lt; layer &lt;&lt; <span class="hljs-string">&quot; from &quot;</span> &lt;&lt; <span class="hljs-built_in">char</span>(from) &lt;&lt; <span class="hljs-string">&quot; to &quot;</span> &lt;&lt; <span class="hljs-built_in">char</span>(to) &lt;&lt; std::endl;<br><span class="hljs-built_in">Java_TestJNI_JNICallCpp_HannoTower</span>(jni_env, jobj, layer - <span class="hljs-number">1</span>, inter, from, to);<br>&#125;<br>&#125;<br><br><span class="hljs-function">JNIEXPORT <span class="hljs-type">void</span> JNICALL <span class="hljs-title">Java_TestJNI_JNICallCpp_HellCpp</span></span><br><span class="hljs-function"><span class="hljs-params">(JNIEnv *, jobject)</span> </span>&#123;<br>std::cout &lt;&lt; <span class="hljs-string">&quot;Call Invoke JNI Func Success&quot;</span> &lt;&lt; std::endl;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> __cplusplus</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure><h6 id="1-1-4-è°ƒç”¨C-C-å‡½æ•°"><a href="#1-1-4-è°ƒç”¨C-C-å‡½æ•°" class="headerlink" title="1.1.4 è°ƒç”¨C&#x2F;C++å‡½æ•°"></a>1.1.4 è°ƒç”¨C&#x2F;C++å‡½æ•°</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.nio.file.FileSystems;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CallJNIFunc</span> &#123;<br><span class="hljs-comment">//ä¸€èˆ¬åœ¨ç±»çš„é™æ€ï¼ˆstaticï¼‰ä»£ç å—ä¸­åŠ è½½åŠ¨æ€åº“æœ€åˆé€‚ï¼Œå› ä¸ºåœ¨åˆ›å»ºç±»çš„å®ä¾‹æ—¶ï¼Œç±»ä¼šè¢« ClassLoader å…ˆåŠ è½½åˆ°è™šæ‹Ÿæœºï¼Œ</span><br><span class="hljs-comment">//éšåç«‹é©¬è°ƒç”¨ç±»çš„ static é™æ€ä»£ç å—ã€‚è¿™æ—¶å†å»è°ƒç”¨ native æ–¹æ³•å°±ä¸‡æ— ä¸€å¤±äº†ã€‚åŠ è½½åŠ¨æ€åº“çš„ä¸¤ç§æ–¹å¼ï¼š</span><br><span class="hljs-comment">//System.loadLibrary(&quot;HelloWorld&quot;);  </span><br><span class="hljs-comment">//System.load(&quot;/Users/yangxin/Desktop/libHelloWorld.jnilib&quot;); </span><br><span class="hljs-comment">//Can&#x27;t load IA 32-bit .dll on a AMD 64-bit platformè§£å†³</span><br><span class="hljs-comment">//64ä½JVMä¸èƒ½è°ƒç”¨32ä½åŠ¨æ€åº“</span><br><span class="hljs-keyword">static</span> &#123;<br><span class="hljs-comment">//è·å–å½“å‰ç³»ç»Ÿåˆ†éš”ç¬¦è·¯å¾„</span><br><span class="hljs-type">String</span> <span class="hljs-variable">separator</span> <span class="hljs-operator">=</span> FileSystems.getDefault().getSeparator();<br><span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">&quot;user.dir&quot;</span>);<br>System.out.println(separator);<br><span class="hljs-keyword">if</span> (separator == <span class="hljs-string">&quot;\\&quot;</span>) &#123;<br>path += <span class="hljs-string">&quot;\\CLibs\\InvokeJNIFunc.dll&quot;</span>;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>path += <span class="hljs-string">&quot;/CLibs/InvokeJNIFunc.dll&quot;</span>;<br>&#125;<br>System.out.println(path);<br>System.load(path);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">// TODO Auto-generated method stub</span><br><span class="hljs-comment">// String path = System.getProperty(&quot;java.library.path&quot;);</span><br><br><span class="hljs-type">JNICallCpp</span> <span class="hljs-variable">jniCallCpp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JNICallCpp</span>();<br>jniCallCpp.HellCpp();<br>jniCallCpp.HannoTower(<span class="hljs-number">5</span>, <span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="1-2-JNIå¤´æ–‡ä»¶ä»‹ç»"><a href="#1-2-JNIå¤´æ–‡ä»¶ä»‹ç»" class="headerlink" title="1.2 JNIå¤´æ–‡ä»¶ä»‹ç»"></a>1.2 JNIå¤´æ–‡ä»¶ä»‹ç»</h5><h6 id="1-2-1-JNIEnv-ç±»å‹å’Œjobjectç±»å‹"><a href="#1-2-1-JNIEnv-ç±»å‹å’Œjobjectç±»å‹" class="headerlink" title="1.2.1 JNIEnv ç±»å‹å’Œjobjectç±»å‹"></a>1.2.1 JNIEnv ç±»å‹å’Œjobjectç±»å‹</h6><p>åœ¨ä¸Šé¢çš„<code>TestJNI_JNICallCpp.cpp</code>æ–‡ä»¶ä¸­ï¼Œ<code>Java_TestJNI_JNICallCpp_HannoTower</code>æ–¹æ³•ä¸­æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯<code>JNIEnv *env</code>,ä¸€ä¸ªæ˜¯<code>jobjet jobj</code>ã€‚ä¸‹é¢ç®€å•ä»‹ç»ä¸‹è¿™ä¸¤ä¸ªç±»å‹çš„ä½œç”¨ã€‚</p><h6 id="1-2-1-1-JNIEnv-ç±»å‹"><a href="#1-2-1-1-JNIEnv-ç±»å‹" class="headerlink" title="1.2.1.1 JNIEnv ç±»å‹"></a>1.2.1.1 JNIEnv ç±»å‹</h6><p><strong>JNIEnv</strong>ç±»å‹å®é™…ä¸Šä»£è¡¨äº†Javaç¯å¢ƒï¼Œé€šè¿‡JNIEnv*æŒ‡é’ˆå°±å¯ä»¥å¯¹<strong>Javaç«¯çš„ä»£ç </strong>è¿›è¡Œæ“ä½œã€‚æ¯”å¦‚å¯ä»¥ä½¿ç”¨JNIEnvæ¥åˆ›å»ºJavaç±»ä¸­çš„å¯¹è±¡ï¼Œè°ƒç”¨Javaå¯¹è±¡çš„æ–¹æ³•ï¼Œè·å–Javaå¯¹è±¡ä¸­çš„å±æ€§ç­‰ã€‚JNIEnvç±»ä¸­æœ‰å¾ˆå¤šå‡½æ•°å¯ä»¥ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><ul><li>NewObject: åˆ›å»ºJavaç±»ä¸­çš„å¯¹è±¡ã€‚</li><li>NewString: åˆ›å»ºJavaç±»ä¸­çš„Stringå¯¹è±¡ã€‚</li><li>NewArray: åˆ›å»ºç±»å‹ä¸ºTypeçš„æ•°ç»„å¯¹è±¡ã€‚</li><li>GetField: è·å–ç±»å‹ä¸ºTypeçš„å­—æ®µã€‚</li><li>SetField: è®¾ç½®ç±»å‹ä¸ºTypeçš„å­—æ®µçš„å€¼ã€‚</li><li>GetStaticField: è·å–ç±»å‹ä¸ºTypeçš„staticçš„å­—æ®µã€‚</li><li>SetStaticField: è®¾ç½®ç±»å‹ä¸ºTypeçš„staticçš„å­—æ®µçš„å€¼ã€‚</li><li>CallMethod: è°ƒç”¨è¿”å›ç±»å‹ä¸ºTypeçš„æ–¹æ³•ã€‚</li><li>CallStaticMethod: è°ƒç”¨è¿”å›å€¼ç±»å‹ä¸ºTypeçš„static æ–¹æ³•ã€‚</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// å¦‚ï¼Œè¦è°ƒç”¨Javaä¸­çš„Dateç±»çš„getTimeæ–¹æ³•</span><br><span class="hljs-comment">// FindClassæ–¹æ³•å‚æ•°nameæ˜¯æŸä¸ªç±»çš„å®Œæ•´è·¯å¾„</span><br>(JNIEnv *env, jobject instance)&#123;<br>jclass  class_date = env-&gt;<span class="hljs-built_in">FindClass</span>(<span class="hljs-string">&quot;java/util/Date&quot;</span>);<br><span class="hljs-comment">//æ³¨æ„è¿™é‡Œè·¯å¾„è¦æ¢æˆ/,ä¸ç„¶ä¼šæŠ¥illegal class name</span><br>jmethodID  a_method = env-&gt;<span class="hljs-built_in">GetMethodID</span>(class_date,<span class="hljs-string">&quot;&lt;init&gt;&quot;</span>,<span class="hljs-string">&quot;()V&quot;</span>);<br>jobject  a_date_obj = env-&gt;<span class="hljs-built_in">NewObject</span>(class_date,a_method);<br>jmethodID  date_get_time = env-&gt;<span class="hljs-built_in">GetMethodID</span>(class_date,<span class="hljs-string">&quot;getTime&quot;</span>,<span class="hljs-string">&quot;()J&quot;</span>);<br>jlong get_time = env-&gt;<span class="hljs-built_in">CallLongMethod</span>(a_date_obj,date_get_time);<br><span class="hljs-keyword">return</span> get_time; <br>&#125;<br></code></pre></td></tr></table></figure><h6 id="1-2-1-1-Jobject-ç±»å‹"><a href="#1-2-1-1-Jobject-ç±»å‹" class="headerlink" title="1.2.1.1 Jobject ç±»å‹"></a>1.2.1.1 Jobject ç±»å‹</h6><p><strong>Jobject</strong>å¯ä»¥çœ‹åšæ˜¯javaä¸­çš„ç±»å®ä¾‹çš„å¼•ç”¨ã€‚å½“ç„¶ï¼Œæƒ…å†µä¸åŒï¼Œæ„ä¹‰ä¹Ÿä¸ä¸€æ ·ã€‚å¦‚æœnativeæ–¹æ³•ä¸æ˜¯static, jobjet å°±ä»£è¡¨nativeæ–¹æ³•çš„ç±»å®ä¾‹ã€‚å¦‚æœnativeæ–¹æ³•æ˜¯static, jobjet å°±ä»£è¡¨nativeæ–¹æ³•çš„ç±»çš„class å¯¹è±¡å®ä¾‹(static æ–¹æ³•ä¸éœ€è¦ç±»å®ä¾‹çš„ï¼Œæ‰€ä»¥å°±ä»£è¡¨è¿™ä¸ªç±»çš„classå¯¹è±¡)ã€‚</p><ul><li>jclass GetObjectClass(jobject obj) æ ¹æ®ä¸€ä¸ªå¯¹è±¡ï¼Œè·å–è¯¥å¯¹è±¡çš„ç±»</li><li>jclass GetSuperClass(jclass obj) è·å–ä¸€ä¸ªä¼ å…¥çš„å¯¹è±¡è·å–ä»–çš„çˆ¶ç±»çš„jclass</li><li>GetMethodID: è·å–éé™æ€æ–¹æ³•çš„ID</li><li>GetStaticMethodID: è·å–é™æ€æ–¹æ³•çš„ID</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// æ ¹æ®jobjectçš„ç±»å‹ï¼Œåœ¨JNIä¸­å†™æ–¹æ³•çš„æ—¶å€™å¦‚æœæ˜¯éé™æ€çš„éƒ½ä¼šä¼ ä¸€ä¸ªjobjectçš„å¯¹è±¡</span><br><span class="hljs-comment">// å¯ä»¥æ ¹æ®ä¼ å…¥çš„æ¥è·å–å½“å‰å¯¹è±¡çš„ç±»</span><br><br>(JNIEnv *env, jobject instance) &#123;<br>jclass  a_class = env-&gt;<span class="hljs-built_in">GetObjectClass</span>(instance);<br>    <span class="hljs-comment">//è¿™é‡Œçš„a_classå°±æ˜¯é€šè¿‡instanceè·å–åˆ°çš„</span><br>â€¦â€¦<br>&#125;<br></code></pre></td></tr></table></figure><h6 id="1-2-1-1-C-è°ƒç”¨Javaæ–¹æ³•"><a href="#1-2-1-1-C-è°ƒç”¨Javaæ–¹æ³•" class="headerlink" title="1.2.1.1 C++è°ƒç”¨Javaæ–¹æ³•"></a>1.2.1.1 C++è°ƒç”¨Javaæ–¹æ³•</h6><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs C++">(JNIEnv *env, jclass type) &#123;<br>jmethodID  a_method = env-&gt;<span class="hljs-built_in">GetMethodID</span>(type,<span class="hljs-string">&quot;describe&quot;</span>,<span class="hljs-string">&quot;()Ljava/lang/String;&quot;</span>); <br>    <span class="hljs-comment">// é€šè¿‡GetMethodæ–¹æ³•è·å–æ–¹æ³•çš„methodId.</span><br>jobject jobj = env-&gt;<span class="hljs-built_in">AllocObject</span>(type);                                          <br>    <span class="hljs-comment">// å¯¹jclassè¿›è¡Œå®ä¾‹ï¼Œç›¸å½“äºjavaä¸­çš„new</span><br>jstring pring= (jstring)(env)-&gt;<span class="hljs-built_in">CallObjectMethod</span>(jobj,a_method);                <br>    <span class="hljs-comment">// ç±»è°ƒç”¨ç±»ä¸­çš„æ–¹æ³•</span><br><span class="hljs-type">char</span> *print=(<span class="hljs-type">char</span>*)(env)-&gt;<span class="hljs-built_in">GetStringUTFChars</span>(pring,<span class="hljs-number">0</span>);                           <br>    <span class="hljs-comment">// è½¬æ¢æ ¼å¼è¾“å‡ºã€‚</span><br><span class="hljs-keyword">return</span> env-&gt;<span class="hljs-built_in">NewStringUTF</span>(print);<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="1-3-JNIæ•°æ®ç±»å‹æ˜ å°„"><a href="#1-3-JNIæ•°æ®ç±»å‹æ˜ å°„" class="headerlink" title="1.3 JNIæ•°æ®ç±»å‹æ˜ å°„"></a>1.3 JNIæ•°æ®ç±»å‹æ˜ å°„</h5><ul><li>åŸºæœ¬çš„æ•°æ®ç±»å‹</li></ul><table><thead><tr><th>Javaç±»å‹</th><th>Nativeç±»å‹</th><th>åŸŸæè¿°ç¬¦</th></tr></thead><tbody><tr><td>boolean</td><td>jboolean</td><td>Z</td></tr><tr><td>byte</td><td>jbyte</td><td>B</td></tr><tr><td>char</td><td>jchar</td><td>C</td></tr><tr><td>short</td><td>jshort</td><td>S</td></tr><tr><td>int</td><td>jnit</td><td>I</td></tr><tr><td>long</td><td>jlong</td><td>J</td></tr><tr><td>float</td><td>jfloat</td><td>F</td></tr><tr><td>double</td><td>jdouble</td><td>D</td></tr><tr><td>void</td><td>void</td><td>V</td></tr></tbody></table><ul><li>æ•°ç»„å¼•ç”¨ç±»å‹</li></ul><p>å¦‚æœæ˜¯ä¸€ç»´æ•°ç»„åˆ™éµå¾ªä¸‹è¡¨ï¼Œå¦‚æœæ˜¯äºŒç»´æ•°ç»„æˆ–æ›´é«˜ç»´æ•°ç»„åˆ™å¯¹åº”çš„ Natvieç±»å‹ä¸º jobjectArrayï¼ŒåŸŸæè¿°ç¬¦ä¸­ä½¿ç”¨ â€˜[â€™ çš„ä¸ªæ•°è¡¨ç¤ºç»´æ•°ï¼š</p><table><thead><tr><th>Javaç±»å‹</th><th>Nativeç±»å‹</th><th>åŸŸæè¿°ç¬¦</th></tr></thead><tbody><tr><td>int[]</td><td>jintArray</td><td>[I</td></tr><tr><td>float[]</td><td>jfloatArray</td><td>[f</td></tr><tr><td>byte[]</td><td>jbyteArray</td><td>[B</td></tr><tr><td>char[]</td><td>jcharArray</td><td>[C</td></tr><tr><td>short[]</td><td>jshortArray</td><td>[S</td></tr><tr><td>double[]</td><td>jdoubleArray</td><td>[D</td></tr><tr><td>long[]</td><td>jlongArray</td><td>[F</td></tr><tr><td>boolean[]</td><td>jbooleanArray</td><td>[Z</td></tr></tbody></table><ul><li>å¯¹è±¡å¼•ç”¨ç±»å‹</li></ul><p>å¯¹äºå…¶å®ƒå¼•ç”¨ç±»å‹ï¼Œå³ java ä¸­çš„å¯¹è±¡ï¼Œå…¶æ˜ å°„è§„åˆ™ä¸ºï¼š</p><table><thead><tr><th>Javaç±»å‹</th><th>Nativeç±»å‹</th><th>åŸŸæè¿°ç¬¦</th></tr></thead><tbody><tr><td>ç±»åï¼ˆå¦‚ Surfaceï¼‰</td><td>é€šå¸¸æ˜¯ jobjectï¼Œä»…æœ‰ä¸€ç§ä¾‹å¤–ï¼Œå¦‚æœ java ç±»å‹æ˜¯ Stringï¼Œåˆ™å¯¹åº”çš„native ç±»å‹æ˜¯ jstring</td><td>ä»¥â€Lâ€å¼€å¤´ï¼Œä»¥â€;â€ç»“å°¾ä¸­é—´æ˜¯ç”¨â€&#x2F;â€ éš”å¼€çš„åŒ…åŠç±»åï¼ˆå¦‚ Landroid&#x2F;view&#x2F;Surface;ï¼‰å¦‚æœå†…éƒ¨ç±»åˆ™ä½¿ç”¨$è¿æ¥å†…éƒ¨ç±»ï¼›</td></tr></tbody></table><ul><li>å¯¹è±¡æ•°ç»„å¼•ç”¨ç±»å‹</li></ul><p>å¦‚æœæ˜¯ä¸€ç»´æ•°ç»„åˆ™éµå¾ªä¸‹è¡¨ï¼Œå¦‚æœæ˜¯äºŒç»´æ•°ç»„æˆ–æ›´é«˜ç»´æ•°ç»„åˆ™å¯¹åº”çš„ native ç±»å‹ä¸º jobjectArrayï¼ŒåŸŸæè¿°ç¬¦ä¸­ä½¿ç”¨ â€˜[â€™ çš„ä¸ªæ•°è¡¨ç¤ºç»´æ•°ï¼š</p><table><thead><tr><th>Javaç±»å‹</th><th>Nativeç±»å‹</th><th>åŸŸæè¿°ç¬¦</th></tr></thead><tbody><tr><td>ç±»åï¼ˆå¦‚ Surfaceï¼‰</td><td>é€šå¸¸æ˜¯ jobjectï¼Œä»…æœ‰ä¸€ç§ä¾‹å¤–ï¼Œå¦‚æœ java ç±»å‹æ˜¯ Stringï¼Œåˆ™å¯¹åº”çš„native ç±»å‹æ˜¯ jstring</td><td>åœ¨å¯¹è±¡å¼•ç”¨ç±»å‹çš„åŸŸæè¿°ç¬¦çš„åŸºç¡€ä¸Šåœ¨å·¦è¾¹æ·»åŠ â€™[â€˜å­—ç¬¦</td></tr></tbody></table><h5 id="1-4-å‚è€ƒæ–‡çŒ®"><a href="#1-4-å‚è€ƒæ–‡çŒ®" class="headerlink" title="1.4 å‚è€ƒæ–‡çŒ®"></a>1.4 å‚è€ƒæ–‡çŒ®</h5><ul><li>Javaæ–‡æ¡£ï¼š<a href="https://docs.oracle.com/javase/6/docs/technotes/guides/jni/spec/jniTOC.html">Contents (oracle.com)</a></li><li>JNIä½¿ç”¨å…¨é¢è®²è§£ï¼š<a href="https://zhuanlan.zhihu.com/p/97691316">Android JNIä½¿ç”¨å…¨é¢è®²è§£ - çŸ¥ä¹ (zhihu.com)</a></li></ul><h4 id="2-JNA"><a href="#2-JNA" class="headerlink" title="2  JNA"></a>2  JNA</h4><p>JNAï¼Œå…¨åJava Native Accessæ˜¯å»ºç«‹åœ¨JNIæŠ€æœ¯åŸºç¡€ä¹‹ä¸Šçš„ä¸€ä¸ªJavaç±»åº“ï¼Œå¯ä»¥æ–¹ä¾¿åœ°ä½¿ç”¨javaç›´æ¥è®¿é—®åŠ¨æ€é“¾æ¥åº“ä¸­çš„å‡½æ•°ã€‚ä¸éœ€è¦ä½¿ç”¨JNIé‡å†™åŠ¨æ€é“¾æ¥åº“æ–‡ä»¶ï¼Œè€Œæ˜¯æœ‰ç›´æ¥è°ƒç”¨çš„APIï¼Œå¤§å¤§ç®€åŒ–äº†å·¥ä½œé‡ã€‚JNAå°†è‡ªåŠ¨å®ç°Javaæ¥å£åˆ°native functionçš„æ˜ å°„ï¼Œä½†æ˜¯JNAä¸€èˆ¬åªé€‚ç”¨äºè¾ƒä¸ºç®€å•çš„C&#x2F;C++åº“ï¼Œå¦‚æœæ¥å£ã€æ•°æ®ç»“æ„å¤æ‚çš„è¯å°±ä¸æ¨èã€‚è€Œä¸”JNAä¹Ÿåªæä¾›äº†C&#x2F;C++å¯¹Javaçš„æ¥å£è½¬åŒ–ã€‚</p><p>JNAä½¿ç”¨ä¸€ä¸ªå°å‹çš„JNIåº“æ’æ¡©ç¨‹åºæ¥åŠ¨æ€è°ƒç”¨æœ¬åœ°ä»£ç ã€‚å¼€å‘è€…ä½¿ç”¨Javaæ¥å£æè¿°ç›®æ ‡æœ¬åœ°åº“çš„åŠŸèƒ½å’Œç»“æ„ï¼Œè¿™ä½¿å¾—å®ƒå¾ˆå®¹æ˜“åˆ©ç”¨æœ¬æœºå¹³å°çš„åŠŸèƒ½ï¼Œè€Œä¸ä¼šäº§ç”Ÿå¤šå¹³å°é…ç½®å’Œç”ŸæˆJNIä»£ç çš„é«˜å¼€é”€ã€‚è¿™æ ·çš„æ€§èƒ½ã€å‡†ç¡®æ€§å’Œæ˜“ç”¨æ€§æ˜¾ç„¶å—åˆ°å¾ˆå¤§çš„é‡è§†ã€‚</p><h5 id="2-1-JNAä½¿ç”¨"><a href="#2-1-JNAä½¿ç”¨" class="headerlink" title="2 .1 JNAä½¿ç”¨"></a>2 .1 JNAä½¿ç”¨</h5><h6 id="2-1-1-å¼•å…¥jaråŒ…"><a href="#2-1-1-å¼•å…¥jaråŒ…" class="headerlink" title="2.1.1 å¼•å…¥jaråŒ…"></a>2.1.1 å¼•å…¥jaråŒ…</h6><p>ä½¿ç”¨Mavené…ç½®æˆ–è€…ä»githubä¸‹è½½æœ€æ–°çš„<code>jna.jar</code>æ–‡ä»¶(<a href="https://github.com/java-native-access/jna/blob/master/www/GettingStarted.md">jna&#x2F;GettingStarted.md at master Â· java-native-access&#x2F;jna Â· GitHub</a>)ï¼Œå¹¶å°†<code>jna.jar</code>å¼•å…¥åˆ°å·¥ç¨‹æ–‡ä»¶ä¸­ã€‚</p><h6 id="2-1-2-å£°æ˜APIæ¥å£"><a href="#2-1-2-å£°æ˜APIæ¥å£" class="headerlink" title="2.1.2 å£°æ˜APIæ¥å£"></a>2.1.2 å£°æ˜APIæ¥å£</h6><ul><li><p>å®šä¹‰äº†ä¸€ä¸ªæ¥å£ï¼Œç»§æ‰¿è‡ªLibrary æˆ–StdCallLibraryï¼Œé»˜è®¤çš„æ˜¯ç»§æ‰¿Library ï¼Œ å¦‚æœåŠ¨æ€é“¾æ¥åº“é‡Œçš„å‡½æ•°æ˜¯ä»¥stdcallæ–¹å¼è¾“å‡ºçš„ï¼Œé‚£ä¹ˆå°±ç»§æ‰¿StdCallLibraryï¼Œæ¯”å¦‚ä¼—æ‰€å‘¨çŸ¥çš„kernel32åº“ã€‚</p></li><li><p>æ¥å£å†…éƒ¨éœ€è¦ä¸€ä¸ªå…¬å…±é™æ€å¸¸é‡ï¼šINSTANCEï¼Œé€šè¿‡è¿™ä¸ªå¸¸é‡ï¼Œå°±å¯ä»¥è·å¾—è¿™ä¸ªæ¥å£çš„å®ä¾‹ï¼Œä»è€Œä½¿ç”¨æ¥å£çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨å¤–éƒ¨dll&#x2F;soçš„å‡½æ•°ã€‚ è¯¥å¸¸é‡é€šè¿‡Native.loadLibrary()è¿™ä¸ªAPIå‡½æ•°è·å¾—ï¼Œè¯¥å‡½æ•°æœ‰2ä¸ªå‚æ•°ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åŠ¨æ€é“¾æ¥åº“dll&#x2F;soçš„åç§°ï¼Œä½†ä¸å¸¦.dllæˆ–.soè¿™æ ·çš„åç¼€ï¼Œè¿™ç¬¦åˆJNIçš„è§„èŒƒï¼Œå› ä¸ºå¸¦äº†åç¼€åå°±ä¸å¯ä»¥è·¨æ“ä½œç³»ç»Ÿå¹³å°äº†ã€‚æœç´¢åŠ¨æ€é“¾ æ¥åº“è·¯å¾„çš„é¡ºåºæ˜¯ï¼šå…ˆä»å½“å‰ç±»çš„å½“å‰æ–‡ä»¶å¤¹æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå†åœ¨å·¥ç¨‹å½“å‰æ–‡ä»¶å¤¹ä¸‹é¢æ‰¾win32&#x2F;win64æ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ°åæœç´¢å¯¹åº”çš„dllæ–‡ä»¶ï¼Œå¦‚æœæ‰¾ä¸åˆ°å†åˆ°WINDOWSä¸‹é¢å»æœç´¢ï¼Œå†æ‰¾ä¸åˆ°å°±ä¼šæŠ›å¼‚å¸¸äº†ã€‚æ¯”å¦‚ä¸Šä¾‹ä¸­printfå‡½æ•°åœ¨Windowså¹³å°ä¸‹æ‰€åœ¨çš„dllåº“åç§°æ˜¯msvcrtï¼Œè€Œåœ¨ å…¶å®ƒå¹³å°å¦‚Linuxä¸‹çš„soåº“åç§°æ˜¯cã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯æœ¬æ¥å£çš„Classç±»å‹ã€‚JNAé€šè¿‡è¿™ä¸ªClassç±»å‹ï¼Œæ ¹æ®æŒ‡å®šçš„.dll&#x2F;.soæ–‡ä»¶ï¼ŒåŠ¨æ€åˆ›å»ºæ¥å£çš„å®ä¾‹ã€‚è¯¥å®ä¾‹ç”±JNAé€šè¿‡åå°„è‡ªåŠ¨ç”Ÿæˆã€‚ ç„¶ååœ¨MainActivityä¸­è°ƒç”¨sayHelloæ–¹æ³•ã€‚</li></ul></li><li><p>æ¥å£ä¸­åªéœ€è¦å®šä¹‰ä½ è¦ç”¨åˆ°çš„å‡½æ•°æˆ–è€…å…¬å…±å˜é‡ï¼Œä¸éœ€è¦çš„å¯ä»¥ä¸å®šä¹‰ï¼Œæ³¨æ„å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹ï¼Œåº”è¯¥å’Œé“¾æ¥åº“ä¸­çš„å‡½æ•°ç±»å‹ä¿æŒä¸€è‡´ã€‚</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// This is the standard, stable way of mapping, which supports extensive</span><br><span class="hljs-comment">// customization and mapping of Java to native types</span><br><span class="hljs-comment">// å£°æ˜æ¥å£ï¼Œç»§æ‰¿Libraryï¼Œç”¨äºåŠ è½½åº“æ–‡ä»¶</span><br><br><span class="hljs-comment">//ç»§æ‰¿Libraryï¼Œç”¨äºåŠ è½½åº“æ–‡ä»¶</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CLibrary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Library</span> &#123;<br><span class="hljs-type">String</span> <span class="hljs-variable">dllName</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;/Clibs/CompileDLL.dll&quot;</span>;<br><span class="hljs-meta">@SuppressWarnings(&quot;deprecation&quot;)</span><br><span class="hljs-comment">// åŠ è½½åŠ¨æ€é“¾æ¥åº“</span><br><span class="hljs-comment">// ç›´æ¥å†™åŠ¨æ€åº“åç§°ï¼ŒåŠ¨æ€åº“éœ€è¦åˆ°ä¸ºsourceæˆ–è€…ä»£ç æ·»åŠ åŠ¨æ€åº“è·¯å¾„ä¸ºsource</span><br><span class="hljs-comment">// CLibrary instance = (CLibrary) Native.loadLibrary(dllName, CLibrary.class);</span><br><br><span class="hljs-type">CLibrary</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> (CLibrary) Native.loadLibrary(dllName, CLibrary.class);<br><br><span class="hljs-comment">// é“¾æ¥åŠ¨æ€åº“ä¸­çš„æ–¹æ³•</span><br><span class="hljs-type">double</span> <span class="hljs-title function_">seekArea</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h6 id="2-1-3-è°ƒç”¨C-C-å‡½æ•°"><a href="#2-1-3-è°ƒç”¨C-C-å‡½æ•°" class="headerlink" title="2.1.3 è°ƒç”¨C&#x2F;C++å‡½æ•°"></a>2.1.3 è°ƒç”¨C&#x2F;C++å‡½æ•°</h6><p>å®šä¹‰å¥½æ¥å£åï¼Œå°±å¯ä»¥ä½¿ç”¨æ¥å£ä¸­çš„å‡½æ•°å³ç›¸åº”dll&#x2F;soä¸­çš„å‡½æ•°äº†ã€‚é€šè¿‡æ¥å£ä¸­çš„å®ä¾‹è¿›è¡Œè°ƒç”¨ï¼Œéå¸¸ç®€å•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> TestJNA;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JNACallCpp</span> &#123;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-comment">// TODO Auto-generated method stub</span><br><br><span class="hljs-type">double</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> CLibrary.instance.seekArea(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>);<br>System.out.println(<span class="hljs-string">&quot;the area is:&quot;</span> + res);<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2-2-JNAæ•°æ®ç±»å‹æ˜ å°„"><a href="#2-2-JNAæ•°æ®ç±»å‹æ˜ å°„" class="headerlink" title="2.2  JNAæ•°æ®ç±»å‹æ˜ å°„"></a>2.2  JNAæ•°æ®ç±»å‹æ˜ å°„</h5><ul><li>åŸºæœ¬çš„æ•°æ®ç±»å‹</li></ul><table><thead><tr><th>Native Type</th><th>Size</th><th>Java Type</th><th>Common Windows Types</th></tr></thead><tbody><tr><td>char</td><td>8-bit integer</td><td>byte</td><td>BYTE, TCHAR</td></tr><tr><td>short</td><td>16-bit integer</td><td>short</td><td>WORD</td></tr><tr><td>wchar_t</td><td>16&#x2F;32-bit character</td><td>char</td><td>TCHAR</td></tr><tr><td>int</td><td>32-bit integer</td><td>int</td><td>DWORD</td></tr><tr><td>int</td><td>boolean value</td><td>boolean</td><td>BOOL</td></tr><tr><td>long</td><td>32&#x2F;64-bit integer</td><td>NativeLong</td><td>LONG</td></tr><tr><td>long long</td><td>64-bit integer</td><td>long</td><td>__int64</td></tr><tr><td>float</td><td>32-bit FP</td><td>float</td><td></td></tr><tr><td>double</td><td>64-bit FP</td><td>double</td><td></td></tr><tr><td>char*</td><td>C string</td><td>String</td><td>LPCSTR</td></tr><tr><td>void*</td><td>pointer</td><td>Pointer</td><td>LPVOID, HANDLE, LP<em>XXX</em></td></tr></tbody></table><ul><li>å¤æ‚çš„æ•°æ®ç±»å‹</li></ul><table><thead><tr><th><strong>Java ç±»å‹</strong></th><th><strong>C ç±»å‹</strong></th><th><strong>åŸç”Ÿè¡¨ç°</strong></th></tr></thead><tbody><tr><td>boolean</td><td>int</td><td>32ä½æ•´æ•°(å¯å®šåˆ¶)</td></tr><tr><td>byte</td><td>char</td><td>8ä½æ•´æ•°</td></tr><tr><td>char</td><td>wchar_t</td><td>å¹³å°ä¾èµ–</td></tr><tr><td>short</td><td>short</td><td>16ä½æ•´æ•°</td></tr><tr><td>int</td><td>int</td><td>32ä½æ•´æ•°</td></tr><tr><td>long</td><td>long long, __int64</td><td>64ä½æ•´æ•°</td></tr><tr><td>float</td><td>float</td><td>32ä½æµ®ç‚¹æ•°</td></tr><tr><td>double</td><td>double</td><td>64ä½æµ®ç‚¹æ•°</td></tr><tr><td>Buffer&#x2F;Pointer</td><td>pointer</td><td>å¹³å°ä¾èµ–(32æˆ–64ä½æŒ‡é’ˆ)</td></tr><tr><td><T>[] (åŸºæœ¬ç±»å‹çš„æ•°ç»„)</td><td>pointer&#x2F;array</td><td>32æˆ–64ä½æŒ‡é’ˆ(å‚æ•°&#x2F;è¿”å›å€¼)é‚»æ¥å†…å­˜(ç»“æ„ä½“æˆå‘˜)</td></tr><tr><td>String</td><td>char*</td><td>&#x2F;0ç»“æŸçš„æ•°ç»„ (native encoding or jna.encoding)</td></tr><tr><td>WString</td><td>wchar_t*</td><td>&#x2F;0ç»“æŸçš„æ•°ç»„(unicode)</td></tr><tr><td>String[]</td><td>char**</td><td>&#x2F;0ç»“æŸçš„æ•°ç»„çš„æ•°ç»„</td></tr><tr><td>WString[]</td><td>wchar_t**</td><td>&#x2F;0ç»“æŸçš„å®½å­—ç¬¦æ•°ç»„çš„æ•°ç»„</td></tr><tr><td>Structure</td><td>struct*&#x2F;struct</td><td>æŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆ(å‚æ•°æˆ–è¿”å›å€¼) (æˆ–è€…æ˜ç¡®æŒ‡å®šæ˜¯ç»“æ„ä½“æŒ‡é’ˆ)ç»“æ„ä½“(ç»“æ„ä½“çš„æˆå‘˜) (æˆ–è€…æ˜ç¡®æŒ‡å®šæ˜¯ç»“æ„ä½“)</td></tr><tr><td>Union</td><td>union</td><td>ç­‰åŒäºç»“æ„ä½“</td></tr><tr><td>Structure[]</td><td>struct[]</td><td>ç»“æ„ä½“çš„æ•°ç»„ï¼Œé‚»æ¥å†…å­˜</td></tr><tr><td>Callback</td><td><T> (*fp)()</td><td>Javaå‡½æ•°æŒ‡é’ˆæˆ–åŸç”Ÿå‡½æ•°æŒ‡é’ˆ</td></tr><tr><td>NativeMapped</td><td>varies</td><td>ä¾èµ–äºå®šä¹‰</td></tr><tr><td>NativeLong</td><td>long</td><td>å¹³å°ä¾èµ–(32æˆ–64ä½æ•´æ•°)</td></tr><tr><td>PointerType</td><td>pointer</td><td>å’ŒPointerç›¸åŒ</td></tr></tbody></table><ul><li>ç»“æ„ä½“æ•°æ®ç±»å‹</li></ul><p><strong>Structure å­ç±»ä¸­çš„å…¬å…±å­—æ®µçš„é¡ºåºï¼Œå¿…é¡»ä¸C è¯­è¨€ä¸­çš„ç»“æ„çš„é¡ºåºä¸€è‡´ã€‚å¦åˆ™ä¼šæŠ¥é”™ï¼</strong>å› ä¸ºï¼ŒJava è°ƒç”¨åŠ¨æ€é“¾æ¥åº“ä¸­çš„C å‡½æ•°ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€æ®µå†…å­˜ä½œä¸ºå‡½æ•°çš„å‚æ•°ä¼ é€’ç»™Cå‡½æ•°ã€‚åŠ¨æ€é“¾æ¥åº“ä»¥ä¸ºè¿™ä¸ªå‚æ•°å°±æ˜¯C è¯­è¨€ä¼ è¿‡æ¥çš„å‚æ•°ã€‚åŒæ—¶ï¼ŒC è¯­è¨€çš„ç»“æ„ä½“æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„è§„èŒƒï¼Œå®ƒå®šä¹‰äº†å†…å­˜çš„æ¬¡åºã€‚å› æ­¤ï¼ŒJNA ä¸­æ¨¡æ‹Ÿçš„ç»“æ„ä½“çš„å˜é‡é¡ºåºç»å¯¹ä¸èƒ½é”™ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// Cè¯­è¨€ç»“æ„ä½“</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">UserStruct</span>&#123;</span><br>    <span class="hljs-type">long</span> id;<br>    <span class="hljs-type">wchar_t</span>* name;<br>    <span class="hljs-type">int</span> age;<br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> MYLIBAPI extern <span class="hljs-string">&quot;C&quot;</span> __declspec( dllexport )</span><br>MYLIBAPI <span class="hljs-type">void</span> <span class="hljs-title function_">sayUser</span><span class="hljs-params">(UserStruct* pUserStruct)</span>;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Javaæ„é€ </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserStruct</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Structure</span>&#123;<br>    <span class="hljs-keyword">public</span> NativeLong id;<br>    <span class="hljs-keyword">public</span> WString name;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ByReference</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">UserStruct</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Structure</span>.ByReference &#123;&#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ByValue</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">UserStruct</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Structure</span>.ByValue &#123;&#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> List <span class="hljs-title function_">getFieldOrder</span><span class="hljs-params">()</span> &#123;<br><span class="hljs-keyword">return</span> Arrays.asList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] &#123; <span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>&#125;);<br>    &#125;<br><br>&#125;<br><span class="hljs-comment">// å®šä¹‰C++å‡½æ•°æ¥å£</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sayUser</span><span class="hljs-params">(UserStruct.ByReference struct)</span>;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Javaè°ƒç”¨</span><br>UserStruct userStruct=<span class="hljs-keyword">new</span> <span class="hljs-title class_">UserStruct</span> ();<br>userStruct.id=<span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeLong</span>(<span class="hljs-number">100</span>);<br>userStruct.age=<span class="hljs-number">30</span>;<br>userStruct.name=<span class="hljs-keyword">new</span> <span class="hljs-title class_">WString</span>(<span class="hljs-string">&quot;å¥¥å·´é©¬&quot;</span>);<br>TestDll1.INSTANCE.sayUser(userStruct);<br></code></pre></td></tr></table></figure><h5 id="2-3-å‚è€ƒæ–‡çŒ®"><a href="#2-3-å‚è€ƒæ–‡çŒ®" class="headerlink" title="2.3  å‚è€ƒæ–‡çŒ®"></a>2.3  å‚è€ƒæ–‡çŒ®</h5><ul><li><p>JNAå®˜æ–¹æ–‡æ¡£ï¼š<a href="http://java-native-access.github.io/jna/4.4.0/javadoc/">Overview (JNA API) (java-native-access.github.io)</a></p></li><li><p>Githubï¼š<a href="https://github.com/java-native-access/jna/blob/master/www/GettingStarted.md">jna&#x2F;GettingStarted.md at master Â· java-native-access&#x2F;jna Â· GitHub</a></p></li><li><p>JNAå®æˆ˜ç¬”è®°æ±‡æ€»ï¼š<a href="https://www.jianshu.com/p/164443701574">JNAå®æˆ˜ç¬”è®°æ±‡æ€»&lt;ä¸€&gt; ç®€å•è®¤è¯†JNA|æˆåŠŸè°ƒç”¨JNA - ç®€ä¹¦ (jianshu.com)</a></p></li><li><p>JNAä½¿ç”¨ç¤ºä¾‹ï¼š[Java JNA ï¼ˆä¸‰ï¼‰â€”â€” ç»“æ„ä½“ä½¿ç”¨åŠç®€å•ç¤ºä¾‹ - ç–¯ç‹‚çš„å°èåœå¤´ - åšå®¢å›­ (cnblogs.com)](</p></li></ul><h4 id="3-æ–‡ä»¶è¯´æ˜"><a href="#3-æ–‡ä»¶è¯´æ˜" class="headerlink" title="3 æ–‡ä»¶è¯´æ˜"></a>3 æ–‡ä»¶è¯´æ˜</h4><table><thead><tr><th>åç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>CLibs</td><td>ç¼–è¯‘å¥½çš„DLLæ–‡ä»¶ï¼Œ<code>CompileDLL.dllã€InvokeJNIFunc.dll</code></td></tr><tr><td>CompileDLL</td><td>JNAè°ƒç”¨<code>CompileDLL.dl</code>lçš„C++æºæ–‡ä»¶</td></tr><tr><td>InvokeJNIFunc</td><td>JNIè°ƒç”¨<code>InvokeJNIFunc.dll</code>çš„C++æºæ–‡ä»¶</td></tr><tr><td>Jar</td><td>jnaçš„jaråŒ…</td></tr><tr><td>src</td><td>javaè°ƒç”¨æµ‹è¯•æºæ–‡ä»¶</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JNI</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>UNIXæ“ä½œç³»ç»Ÿé‡‡ç”¨iç»“ç‚¹ç®¡ç†æ–‡ä»¶çš„å­˜å‚¨ç©ºé—´</title>
    <link href="/linux/UNIX%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%87%87%E7%94%A8i%E7%BB%93%E7%82%B9%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6%E7%9A%84%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4/"/>
    <url>/linux/UNIX%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%87%87%E7%94%A8i%E7%BB%93%E7%82%B9%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6%E7%9A%84%E5%AD%98%E5%82%A8%E7%A9%BA%E9%97%B4/</url>
    
    <content type="html"><![CDATA[<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section">## UNIX i ç»“ç‚¹ç®¡ç†æ–‡ä»¶çš„æœ€å¤§æ–‡ä»¶é•¿åº¦è®¡ç®—</span><br><br><span class="hljs-section">### 1. ç»™å®šæ¡ä»¶</span><br><span class="hljs-bullet">-</span> <span class="hljs-strong">**ç£ç›˜å—å¤§å°**</span> = 2048 å­—èŠ‚<br><span class="hljs-bullet">-</span> <span class="hljs-strong">**æ¯ä¸ªåœ°å€å **</span> = 64 ä½ = <span class="hljs-strong">**8 å­—èŠ‚**</span><br><span class="hljs-bullet">-</span> <span class="hljs-strong">**i ç»“ç‚¹åœ°å€é¡¹**</span><br><span class="hljs-bullet">  -</span> <span class="hljs-strong">**10 ä¸ªç›´æ¥åœ°å€**</span><br><span class="hljs-bullet">  -</span> <span class="hljs-strong">**1 ä¸ªä¸€æ¬¡é—´æ¥åœ°å€**</span><br><span class="hljs-bullet">  -</span> <span class="hljs-strong">**1 ä¸ªäºŒæ¬¡é—´æ¥åœ°å€**</span><br><span class="hljs-bullet">  -</span> <span class="hljs-strong">**1 ä¸ªä¸‰æ¬¡é—´æ¥åœ°å€**</span><br><br><span class="hljs-section">### 2. è®¡ç®—ä¸åŒå¯»å€æ–¹å¼å¯ç®¡ç†çš„æ–‡ä»¶å¤§å°</span><br><br><span class="hljs-section">#### ï¼ˆ1ï¼‰ç›´æ¥åœ°å€éƒ¨åˆ†</span><br>æ¯ä¸ªç›´æ¥åœ°å€æŒ‡å‘ <span class="hljs-strong">**1 ä¸ªç£ç›˜å—**</span>ï¼Œå…±æœ‰ 10 ä¸ªç›´æ¥åœ°å€ï¼š<br></code></pre></td></tr></table></figure><p>10 Ã— 2048 &#x3D; 20480 å­—èŠ‚</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean"><br>#### ï¼ˆ<span class="hljs-number">2</span>ï¼‰ä¸€æ¬¡é—´æ¥åœ°å€<br>- <span class="hljs-number">1</span> ä¸ªåœ°å€é¡¹å¯ä»¥å­˜å‚¨çš„åœ°å€æ•°ï¼š<br></code></pre></td></tr></table></figure><p>2048 Ã· 8 &#x3D; 256<br>  <figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tap">-<span class="hljs-number"> 256 </span>ä¸ªç£ç›˜å—ï¼Œæ¯ä¸ª<span class="hljs-number"> 2048 </span>å­—èŠ‚ï¼š<br></code></pre></td></tr></table></figure><br>256 Ã— 2048 &#x3D; 524288 å­—èŠ‚ &#x3D; 512 KB<br>  <figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean"><br>#### ï¼ˆ<span class="hljs-number">3</span>ï¼‰äºŒæ¬¡é—´æ¥åœ°å€<br>- <span class="hljs-number">1</span> ä¸ªåœ°å€é¡¹å­˜ <span class="hljs-number">256</span> ä¸ªåœ°å€ï¼Œæ¯ä¸ªåœ°å€æŒ‡å‘ä¸€ä¸ªé—´æ¥å—ï¼Œæ¯ä¸ªé—´æ¥å—åˆæŒ‡å‘ <span class="hljs-number">256</span> ä¸ªæ•°æ®å—ï¼š<br></code></pre></td></tr></table></figure><br>256 Ã— 256 &#x3D; 65536 ä¸ªæ•°æ®å—<br>  <figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tap">-<span class="hljs-number"> 65536 </span>ä¸ªæ•°æ®å—ï¼Œæ¯ä¸ª<span class="hljs-number"> 2048 </span>å­—èŠ‚ï¼š<br></code></pre></td></tr></table></figure><br>65536 Ã— 2048 &#x3D; 134217728 å­—èŠ‚ &#x3D; 128 MB<br>  <figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tap"><br><span class="hljs-comment">#### ï¼ˆ4ï¼‰ä¸‰æ¬¡é—´æ¥åœ°å€</span><br>-<span class="hljs-number"> 1 </span>ä¸ªåœ°å€é¡¹å­˜<span class="hljs-number"> 256 </span>ä¸ªåœ°å€ï¼Œæ¯ä¸ªåœ°å€æŒ‡å‘ä¸€ä¸ªé—´æ¥å—ï¼Œæ¯ä¸ªé—´æ¥å—å†æŒ‡å‘<span class="hljs-number"> 256 </span>ä¸ªäºŒæ¬¡é—´æ¥å—ï¼Œæ¯ä¸ªäºŒæ¬¡é—´æ¥å—åˆæŒ‡å‘<span class="hljs-number"> 256 </span>ä¸ªæ•°æ®å—ï¼š<br></code></pre></td></tr></table></figure><br>256 Ã— 256 Ã— 256 &#x3D; 16777216 ä¸ªæ•°æ®å—<br>  <figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tap">-<span class="hljs-number"> 16777216 </span>ä¸ªæ•°æ®å—ï¼Œæ¯ä¸ª<span class="hljs-number"> 2048 </span>å­—èŠ‚ï¼š<br></code></pre></td></tr></table></figure><br>16777216 Ã— 2048 &#x3D; 34359738368 å­—èŠ‚ &#x3D; 32 GB<br>  <figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs clean"><br>### <span class="hljs-number">3.</span> æ€»æ–‡ä»¶å¤§å°<br></code></pre></td></tr></table></figure><br>ç›´æ¥åœ°å€éƒ¨åˆ† + ä¸€æ¬¡é—´æ¥åœ°å€ + äºŒæ¬¡é—´æ¥åœ°å€ + ä¸‰æ¬¡é—´æ¥åœ°å€<br>20480 + 524288 + 134217728 + 34359738368 &#x3D; 34494963764 å­—èŠ‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs"><br></code></pre></td></tr></table></figure><p>&#x3D; 32.125 GB</p><h3 id="4-ç»“è®º"><a href="#4-ç»“è®º" class="headerlink" title="4. ç»“è®º"></a>4. ç»“è®º</h3><p>è¯¥ UNIX ç³»ç»Ÿèƒ½ç®¡ç†çš„ <strong>å•ä¸ªæ–‡ä»¶æœ€å¤§é•¿åº¦</strong> ä¸º <strong>çº¦ 32.13 GB</strong>ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>sentence example</title>
    <link href="/english/sentence-example/"/>
    <url>/english/sentence-example/</url>
    
    <content type="html"><![CDATA[<h3 id="it-take-sb-sometime-to-do-sth"><a href="#it-take-sb-sometime-to-do-sth" class="headerlink" title="it take sb. sometime to do sth."></a>it take sb. sometime to do sth.</h3><p>It took me three years to draw  the beautiful horses.<br>ç”»è¿™äº›æ¼‚äº®çš„é©¬èŠ±äº†æˆ‘ä¸‰å¹´çš„æ—¶é—´ã€‚</p><h3 id="it-take-sb-sometime-to-do-sth-1"><a href="#it-take-sb-sometime-to-do-sth-1" class="headerlink" title="it take sb. sometime to do sth."></a>it take sb. sometime to do sth.</h3><p>Charles Smith, <code>who</code> was my former teacher, retired last year.<br>æŸ¥å°”æ–¯Â·å²å¯†æ–¯ï¼Œæˆ‘ä»¥å‰çš„è€å¸ˆï¼Œå»å¹´é€€ä¼‘äº†ã€‚<br>æ­¤å¥ä¸ºéé™å®šæ€§å®šè¯­ä»å¥ã€‚thatä¸èƒ½å¼•å¯¼éé™å®šæ€§å®šè¯­ä»å¥ï¼Œå¯ä»¥ç”¨whichå’Œwhoå¼•å¯¼ã€‚è¿™å¥è¯ä¸­whoæŒ‡ä»£å…ˆè¡Œè¯Charles Smithã€‚å¥æ„ä¸ºï¼šæŸ¥ç†â€¢å²å¯†æ–¯å»å¹´é€€ä¼‘äº†ï¼Œä»–æ›¾ç»æ˜¯æˆ‘çš„è€å¸ˆã€‚</p>]]></content>
    
    
    <categories>
      
      <category>english</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¸¸ç”¨ä¾‹å¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å‘é‡ä¸åæ ‡è½´çš„å¤¹è§’ä½™å¼¦å€¼</title>
    <link href="/%E6%95%B0%E5%AD%A6/%E5%90%91%E9%87%8F%E4%B8%8E%E5%9D%90%E6%A0%87%E8%BD%B4%E7%9A%84%E5%A4%B9%E8%A7%92%E4%BD%99%E5%BC%A6%E5%80%BC/"/>
    <url>/%E6%95%B0%E5%AD%A6/%E5%90%91%E9%87%8F%E4%B8%8E%E5%9D%90%E6%A0%87%E8%BD%B4%E7%9A%84%E5%A4%B9%E8%A7%92%E4%BD%99%E5%BC%A6%E5%80%BC/</url>
    
    <content type="html"><![CDATA[<p>æ±‚å‘é‡ $\mathbf{a} &#x3D; (a_1, a_2, a_3) $ ä¸åæ ‡è½´çš„å¤¹è§’ä½™å¼¦å€¼æ—¶ï¼Œé¦–å…ˆå¯ä»¥åˆ©ç”¨å‘é‡çš„å®šä¹‰å’Œå¤¹è§’ä½™å¼¦çš„å…¬å¼ã€‚</p><h3 id="1-å‘é‡ä¸åæ ‡è½´çš„å¤¹è§’ä½™å¼¦å€¼"><a href="#1-å‘é‡ä¸åæ ‡è½´çš„å¤¹è§’ä½™å¼¦å€¼" class="headerlink" title="1. å‘é‡ä¸åæ ‡è½´çš„å¤¹è§’ä½™å¼¦å€¼"></a>1. å‘é‡ä¸åæ ‡è½´çš„å¤¹è§’ä½™å¼¦å€¼</h3><p>å¯¹äºå‘é‡  $ \mathbf{a} &#x3D; (a_1, a_2, a_3)  $ï¼Œå®ƒä¸å„åæ ‡è½´çš„å¤¹è§’ä½™å¼¦å€¼åˆ†åˆ«ä¸ºï¼š</p><ul><li><p>ä¸ ( x )-è½´çš„å¤¹è§’ä½™å¼¦å€¼  $ \cos \alpha_x $ï¼š</p><p>$$ \cos \alpha_x &#x3D; \frac{a_1}{|\mathbf{a}|} $$</p></li><li><p>ä¸ ( y )-è½´çš„å¤¹è§’ä½™å¼¦å€¼  $\cos \alpha_y $ï¼š</p><p>$$ \cos \alpha_y &#x3D; \frac{a_2}{|\mathbf{a}|} $$</p></li><li><p>ä¸ ( z )-è½´çš„å¤¹è§’ä½™å¼¦å€¼  $\cos \alpha_z $ï¼š</p><p>$$ \cos \alpha_z &#x3D; \frac{a_3}{|\mathbf{a}|} $$</p></li></ul><h3 id="2-å‘é‡çš„æ¨¡ï¼ˆå¤§å°ï¼‰"><a href="#2-å‘é‡çš„æ¨¡ï¼ˆå¤§å°ï¼‰" class="headerlink" title="2. å‘é‡çš„æ¨¡ï¼ˆå¤§å°ï¼‰"></a>2. å‘é‡çš„æ¨¡ï¼ˆå¤§å°ï¼‰</h3><p>å‘é‡  $ \mathbf{a} &#x3D; (a_1, a_2, a_3)  $ çš„æ¨¡ä¸ºï¼š</p><p>$$ |\mathbf{a}| &#x3D; \sqrt{a_1^2 + a_2^2 + a_3^2} $$</p><h3 id="3-å¤¹è§’ä½™å¼¦å€¼çš„è§£é‡Š"><a href="#3-å¤¹è§’ä½™å¼¦å€¼çš„è§£é‡Š" class="headerlink" title="3. å¤¹è§’ä½™å¼¦å€¼çš„è§£é‡Š"></a>3. å¤¹è§’ä½™å¼¦å€¼çš„è§£é‡Š</h3><p>è¿™äº›ä½™å¼¦å€¼è¡¨ç¤ºäº†å‘é‡  $ \mathbf{a}  $ åœ¨å„åæ ‡è½´ä¸Šçš„åˆ†é‡æ¯”ä¾‹ã€‚ä¾‹å¦‚ $\cos \alpha_x $ è¡¨ç¤ºå‘é‡åœ¨ ( x )-è½´æ–¹å‘ä¸Šçš„åˆ†é‡å æ€»é•¿åº¦çš„æ¯”ä¾‹ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>dockerä¸­è¿è¡Œchromeå¹¶ä½¿ç”¨ä»£ç æ§åˆ¶</title>
    <link href="/docker/docker%E4%B8%AD%E8%BF%90%E8%A1%8Cchrome%E5%B9%B6%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%A0%81%E6%8E%A7%E5%88%B6/"/>
    <url>/docker/docker%E4%B8%AD%E8%BF%90%E8%A1%8Cchrome%E5%B9%B6%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%A0%81%E6%8E%A7%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<p>#ä½¿ç”¨dockerè¿è¡Œchrome</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -d -p 4444:4444 -p 5900:5900 --name selenium-chrome-debug selenium/standalone-chrome-debug<br>docker run -d -p 4444:4444 -p 5900:5900 \<br>  --name selenium-chrome-debug \<br>  -e TZ=&quot;US/Pacific&quot; \<br>  -v /dev/shm:/dev/shm \<br>  -v /opt/chrome/chrome-data:/home/seluser/.cache --privileged \<br>  selenium/standalone-chrome-debug<br><br><br></code></pre></td></tr></table></figure><p>#ä½¿ç”¨javaä»£ç æ§åˆ¶chrome</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> org.openqa.selenium.By;<br><span class="hljs-keyword">import</span> org.openqa.selenium.WebDriver;<br><span class="hljs-keyword">import</span> org.openqa.selenium.WebElement;<br><span class="hljs-keyword">import</span> org.openqa.selenium.chrome.ChromeOptions;<br><span class="hljs-keyword">import</span> org.openqa.selenium.remote.RemoteWebDriver;<br><span class="hljs-keyword">import</span> java.net.MalformedURLException;<br><span class="hljs-keyword">import</span> java.net.URL;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeleniumDockerTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ChromeOptions</span> <span class="hljs-variable">options</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChromeOptions</span>();<br>        options.addArguments(<span class="hljs-string">&quot;--disable-dev-shm-usage&quot;</span>);  <span class="hljs-comment">// è§£å†³ Chrome å´©æºƒé—®é¢˜</span><br>        options.addArguments(<span class="hljs-string">&quot;--no-sandbox&quot;</span>);  <span class="hljs-comment">// é¿å… Chrome åœ¨å®¹å™¨ä¸­å—é™åˆ¶</span><br><span class="hljs-comment">//        options.addArguments(&quot;--user-data-dir=/home/seluser&quot;);  // è®¾ç½® Chrome ç”¨æˆ·æ•°æ®ç›®å½•</span><br><br>        <span class="hljs-type">WebDriver</span> <span class="hljs-variable">driver</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            driver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteWebDriver</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(<span class="hljs-string">&quot;http://10.8.0.5:4444/wd/hub&quot;</span>), options);<br><br>            driver.get(<span class="hljs-string">&quot;https://www.jd.com&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;é¡µé¢æ ‡é¢˜: &quot;</span> + driver.getTitle());<br>            <span class="hljs-type">WebElement</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> driver.findElement(By.cssSelector(<span class="hljs-string">&quot;#J_cate &gt; ul&quot;</span>));<br>            System.out.println(<span class="hljs-string">&quot;é¡µé¢å†…å®¹: &quot;</span> + body.getText());<br>            System.in.read();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            System.out.println(<span class="hljs-string">&quot;é”™è¯¯: &quot;</span> + e.getMessage());<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span> (driver != <span class="hljs-literal">null</span>) &#123;<br>                driver.quit();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>chrome</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>äº¤æ˜“ç­–ç•¥æ€»ç»“</title>
    <link href="/%E4%BA%A4%E6%98%93/%E4%BA%A4%E6%98%93%E7%AD%96%E7%95%A5%E6%80%BB%E7%BB%93/"/>
    <url>/%E4%BA%A4%E6%98%93/%E4%BA%A4%E6%98%93%E7%AD%96%E7%95%A5%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h3 id="è¯¦ç»†è§£æäº¤æ˜“ç­–ç•¥"><a href="#è¯¦ç»†è§£æäº¤æ˜“ç­–ç•¥" class="headerlink" title="è¯¦ç»†è§£æäº¤æ˜“ç­–ç•¥"></a>è¯¦ç»†è§£æäº¤æ˜“ç­–ç•¥</h3><p>åœ¨é‡‘èå¸‚åœºäº¤æ˜“ä¸­ï¼Œåˆç†çš„ç­–ç•¥èƒ½å¸®åŠ©æŠ•èµ„è€…æ§åˆ¶é£é™©ã€æé«˜æ”¶ç›Šï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„äº¤æ˜“ç­–ç•¥ï¼Œé€‚ç”¨äºä¸åŒçš„å¸‚åœºæƒ…å†µå’Œäº¤æ˜“ç›®æ ‡ã€‚</p><hr><h3 id="1-çµæ´»çš„ä»“ä½æ­¢ç›ˆæ­¢æŸç®¡ç†"><a href="#1-çµæ´»çš„ä»“ä½æ­¢ç›ˆæ­¢æŸç®¡ç†" class="headerlink" title="1. çµæ´»çš„ä»“ä½æ­¢ç›ˆæ­¢æŸç®¡ç†"></a><strong>1. çµæ´»çš„ä»“ä½æ­¢ç›ˆæ­¢æŸç®¡ç†</strong></h3><p><strong>æ¦‚å¿µ</strong>ï¼šæ­¢ç›ˆæ­¢æŸæ˜¯æŠ•èµ„è€…åœ¨äº¤æ˜“æ—¶è®¾ç½®çš„é¢„å®šä»·æ ¼ç‚¹ï¼Œè¾¾åˆ°è¯¥ç‚¹æ—¶è‡ªåŠ¨å¹³ä»“ï¼Œä»¥é”å®šåˆ©æ¶¦æˆ–æ§åˆ¶äºæŸã€‚</p><p><strong>æ­¢ç›ˆæ­¢æŸçš„æ–¹å¼</strong>ï¼š</p><ul><li><strong>æ ¹æ®æ”¶ç›Šè®¾ç½®æ­¢ç›ˆæ­¢æŸ</strong>ï¼šç”¨æˆ·è®¾å®šç›®æ ‡æ”¶ç›Šé‡‘é¢ï¼Œç³»ç»Ÿè®¡ç®—å‡ºå¯¹åº”çš„æ­¢ç›ˆã€æ­¢æŸä»·æ ¼ã€‚ä¾‹å¦‚ï¼ŒæŠ•èµ„è€…æŒæœ‰æŸè‚¡ç¥¨ï¼Œæˆæœ¬ä»·ä¸º100å…ƒ&#x2F;è‚¡ï¼Œç›®æ ‡æ”¶ç›Šä¸º1000å…ƒï¼Œå‡è®¾æŒä»“10æ‰‹ï¼ˆ1000è‚¡ï¼‰ï¼Œé‚£ä¹ˆæ¯è‚¡éœ€è¦ä¸Šæ¶¨10å…ƒï¼ˆå³110å…ƒï¼‰æ‰å¯å®ç°ç›®æ ‡æ”¶ç›Šã€‚</li><li><strong>æ ¹æ®æ”¶ç›Šç‡è®¾ç½®æ­¢ç›ˆæ­¢æŸ</strong>ï¼šç”¨æˆ·è®¾å®šç›®æ ‡æ”¶ç›Šç‡ï¼Œç³»ç»Ÿåæ¨æ­¢ç›ˆæ­¢æŸä»·æ ¼ã€‚ä¾‹å¦‚ï¼ŒæŸè‚¡ç¥¨æˆæœ¬ä»·100å…ƒ&#x2F;è‚¡ï¼Œç”¨æˆ·è®¾å®šæ­¢ç›ˆæ”¶ç›Šç‡ä¸º20%ï¼Œé‚£ä¹ˆæ­¢ç›ˆä»·æ ¼ä¸º120å…ƒã€‚</li><li><strong>æ ¹æ®æ¶¨è·Œå¹…è®¾ç½®æ­¢ç›ˆæ­¢æŸ</strong>ï¼šç”¨æˆ·è®¾å®šä»·æ ¼çš„æ¶¨è·Œå¹…åº¦ï¼Œæ¯”å¦‚æŸè‚¡ç¥¨å½“å‰ä»·æ ¼100å…ƒï¼Œç”¨æˆ·è®¾ç½®5%çš„æ¶¨å¹…ä¸ºæ­¢ç›ˆç‚¹ï¼Œ10%çš„è·Œå¹…ä¸ºæ­¢æŸç‚¹ï¼Œåˆ™æ­¢ç›ˆç‚¹ä¸º105å…ƒï¼Œæ­¢æŸç‚¹ä¸º90å…ƒã€‚</li><li><strong>éƒ¨åˆ†ä»“ä½æ­¢ç›ˆæ­¢æŸ</strong>ï¼šé’ˆå¯¹åŒä¸€ä»“ä½è®¾å®šä¸åŒçš„æ­¢ç›ˆæ­¢æŸç‚¹ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·ä¹°å…¥1000è‚¡è‚¡ç¥¨ï¼Œç›®æ ‡æ”¶ç›Šç‡100%ï¼Œå¯ä»¥åœ¨æ¶¨å¹…50%æ—¶å–å‡º50%é”å®šåˆ©æ¶¦ï¼Œå‰©ä½™éƒ¨åˆ†ç»§ç»­æŒæœ‰ã€‚</li></ul><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>**æ”¶ç›Šç¿»å€åå¹³ä»“50%**ï¼šä¾‹å¦‚ï¼Œ100å…ƒä¹°å…¥è‚¡ç¥¨ï¼Œæ¶¨åˆ°200å…ƒåå–æ‰50%ï¼Œå‰©ä½™ä»“ä½ç»§ç»­æŒæœ‰ï¼ŒæœŸå¾…æ›´é«˜æ”¶ç›Šã€‚</li><li><strong>å¹³ä»“åæŒ‚ç½‘æ ¼äº¤æ˜“</strong>ï¼šå½“ä»·æ ¼è¾¾åˆ°æ­¢ç›ˆç‚¹åï¼Œè‡ªåŠ¨æ‰§è¡Œç½‘æ ¼äº¤æ˜“ç­–ç•¥ï¼Œç»§ç»­åˆ©ç”¨ä»·æ ¼æ³¢åŠ¨è·åˆ©ã€‚</li></ul><hr><h3 id="2-è·Ÿè¸ªå§”æ‰˜ï¼ˆTrailing-Stop-Orderï¼‰"><a href="#2-è·Ÿè¸ªå§”æ‰˜ï¼ˆTrailing-Stop-Orderï¼‰" class="headerlink" title="2. è·Ÿè¸ªå§”æ‰˜ï¼ˆTrailing Stop Orderï¼‰"></a><strong>2. è·Ÿè¸ªå§”æ‰˜ï¼ˆTrailing Stop Orderï¼‰</strong></h3><p><strong>æ¦‚å¿µ</strong>ï¼šè·Ÿè¸ªå§”æ‰˜æ˜¯ä¸€ç§åŠ¨æ€æ­¢ç›ˆæ­¢æŸç­–ç•¥ï¼Œå¸‚åœºä»·æ ¼ä¸Šæ¶¨æ—¶è°ƒæ•´æ­¢ç›ˆç‚¹ï¼Œå¸‚åœºä»·æ ¼å›è½åˆ°æŸä¸ªå›è°ƒå¹…åº¦åè‡ªåŠ¨è§¦å‘å¸‚ä»·å–å‡ºã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ul><li>æŸè‚¡ç¥¨å½“å‰ä»·æ ¼100å…ƒï¼Œç”¨æˆ·è®¾ç½®å›è°ƒå¹…åº¦5%ã€‚</li><li>è‚¡ç¥¨æ¶¨è‡³120å…ƒï¼Œç³»ç»Ÿè°ƒæ•´æ­¢ç›ˆç‚¹åˆ°114å…ƒï¼ˆ120 - 5%ï¼‰ã€‚</li><li>è‹¥ä»·æ ¼ç»§ç»­ä¸Šæ¶¨ï¼Œæ­¢ç›ˆç‚¹ä¹Ÿéšä¹‹ä¸Šç§»ï¼›ä¸€æ—¦ä»·æ ¼å›è°ƒ5%ï¼Œåœ¨114å…ƒè‡ªåŠ¨å–å‡ºã€‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>æ•æ‰è¶‹åŠ¿è¡Œæƒ…ï¼Œé¿å…å› çŸ­æœŸå›è°ƒé”™è¿‡æ›´å¤§æ”¶ç›Šã€‚</li><li>é€‚ç”¨äºéœ‡è¡æˆ–è¶‹åŠ¿ä¸Šæ¶¨è¡Œæƒ…ã€‚</li></ul><hr><h3 id="3-è¿½é€é™ä»·å•"><a href="#3-è¿½é€é™ä»·å•" class="headerlink" title="3. è¿½é€é™ä»·å•"></a><strong>3. è¿½é€é™ä»·å•</strong></h3><p><strong>æ¦‚å¿µ</strong>ï¼šä¸€ç§åŠ¨æ€è°ƒæ•´é™ä»·å•çš„è®¢å•ç±»å‹ï¼Œç³»ç»Ÿä¼šæ ¹æ®å¸‚åœºä¹°ä¸€æˆ–å–ä¸€ä»·æ ¼ä¸æ–­è°ƒæ•´å§”æ‰˜ä»·æ ¼ï¼Œç›´è‡³æˆäº¤æˆ–å–æ¶ˆã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ul><li>æŸè‚¡ç¥¨å½“å‰ä¹°ä¸€ä»·100å…ƒï¼Œå–ä¸€ä»·101å…ƒï¼ŒæŠ•èµ„è€…å¸Œæœ›ä»¥æœ€ä¼˜ä»·æ ¼ä¹°å…¥ï¼Œç³»ç»Ÿè®¾å®šè‡ªåŠ¨è¿½é€é™ä»·å•ï¼Œåœ¨ä¹°ä¸€ä»·è°ƒæ•´æ—¶éšä¹‹è°ƒæ•´ï¼Œé¿å…æˆäº¤ä»·è¿‡é«˜ã€‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>é€‚ç”¨äºé«˜æ³¢åŠ¨å¸‚åœºï¼Œç¡®ä¿è®¢å•å¿«é€Ÿæˆäº¤ä¸”ä»·æ ¼åˆç†ã€‚</li></ul><hr><h3 id="4-ç§»åŠ¨æ­¢ç›ˆæ­¢æŸ"><a href="#4-ç§»åŠ¨æ­¢ç›ˆæ­¢æŸ" class="headerlink" title="4. ç§»åŠ¨æ­¢ç›ˆæ­¢æŸ"></a><strong>4. ç§»åŠ¨æ­¢ç›ˆæ­¢æŸ</strong></h3><p><strong>æ¦‚å¿µ</strong>ï¼šç±»ä¼¼äºè·Ÿè¸ªå§”æ‰˜ï¼Œé€šå¸¸ç”¨äºå¹³ä»“ï¼Œä½†ä¹Ÿå¯ä»¥ç”¨äºå¼€ä»“ï¼Œé€»è¾‘ç±»ä¼¼äºè¿½é€é™ä»·å•ã€‚</p><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>é€‚ç”¨äºè¶‹åŠ¿å¸‚åœºï¼Œåœ¨ä¸Šæ¶¨è¿‡ç¨‹ä¸­é€æ­¥è°ƒæ•´æ­¢ç›ˆç‚¹ï¼Œç¡®ä¿åˆ©æ¶¦æœ€å¤§åŒ–ã€‚</li></ul><hr><h3 id="5-åˆ†æ®µè®¢å•ï¼ˆScaled-Orderï¼‰"><a href="#5-åˆ†æ®µè®¢å•ï¼ˆScaled-Orderï¼‰" class="headerlink" title="5. åˆ†æ®µè®¢å•ï¼ˆScaled Orderï¼‰"></a><strong>5. åˆ†æ®µè®¢å•ï¼ˆScaled Orderï¼‰</strong></h3><p><strong>æ¦‚å¿µ</strong>ï¼šåœ¨ä¸€å®šä»·æ ¼èŒƒå›´å†…è‡ªåŠ¨ç”Ÿæˆå¤šä¸ªé™ä»·å•ï¼Œå°†å¤§å•æ‹†åˆ†æˆå°å•æ‰§è¡Œï¼Œé¿å…å¯¹å¸‚åœºé€ æˆå†²å‡»ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ul><li>ç”¨æˆ·å¸Œæœ›åœ¨100~105å…ƒä¹‹é—´ä¹°å…¥10000è‚¡è‚¡ç¥¨ï¼Œå¯ä»¥åˆ†æˆ5ä¸ªè®¢å•ï¼Œæ¯ä¸ªä»·æ ¼é—´éš”1å…ƒï¼Œæ¯æ¬¡ä¹°å…¥2000è‚¡ï¼Œé™ä½å¸‚åœºå†²å‡»ã€‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>é€‚ç”¨äºèµ„é‡‘é‡è¾ƒå¤§çš„æŠ•èµ„è€…ï¼Œå‡å°‘äº¤æ˜“å½±å“ï¼Œæé«˜æˆäº¤ç‡ã€‚</li></ul><hr><h3 id="6-åˆ†æ—¶å§”æ‰˜"><a href="#6-åˆ†æ—¶å§”æ‰˜" class="headerlink" title="6. åˆ†æ—¶å§”æ‰˜"></a><strong>6. åˆ†æ—¶å§”æ‰˜</strong></h3><p><strong>æ¦‚å¿µ</strong>ï¼šå°†å¤§å•æ‹†åˆ†æˆå¤šä¸ªå°å•ï¼Œåœ¨å›ºå®šæ—¶é—´é—´éš”å†…æ‰§è¡Œï¼Œä»¥å¸‚ä»·æˆäº¤ï¼Œç›´è‡³è®¢å•å®Œæˆã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ul><li>ç”¨æˆ·è®¡åˆ’ä¹°å…¥10ä¸‡è‚¡è‚¡ç¥¨ï¼Œä¸æƒ³ä¸€æ¬¡æ€§æˆäº¤å¯¼è‡´ä»·æ ¼å‰§çƒˆæ³¢åŠ¨ï¼Œè®¾ç½®åˆ†æ—¶å§”æ‰˜ï¼Œæ¯5åˆ†é’Ÿæˆäº¤2000è‚¡ã€‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>é€‚ç”¨äºæ‰§è¡Œå¤§é¢äº¤æ˜“ï¼Œå‡å°‘å¸‚åœºå†²å‡»ï¼Œæé«˜æˆäº¤å‡ä»·çš„ç¨³å®šæ€§ã€‚</li></ul><hr><h3 id="7-å†°å±±å§”æ‰˜"><a href="#7-å†°å±±å§”æ‰˜" class="headerlink" title="7. å†°å±±å§”æ‰˜"></a><strong>7. å†°å±±å§”æ‰˜</strong></h3><p><strong>æ¦‚å¿µ</strong>ï¼šå°†å¤§å•æ‹†åˆ†æˆå¤šä¸ªå°å•ï¼Œä»…éƒ¨åˆ†å§”æ‰˜å•å¯¹å¤–å¯è§ï¼Œå…¶ä½™éƒ¨åˆ†éšè—ï¼Œé˜²æ­¢å¸‚åœºå‘ç°å¤§é¢ä¹°å–æ„å›¾ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ul><li>ç”¨æˆ·è®¡åˆ’å–å‡º10ä¸‡è‚¡ï¼Œä½†å¸‚åœºæ·±åº¦ä¸è¶³ï¼Œä¸€æ¬¡æ€§æŒ‚å•ä¼šå½±å“ä»·æ ¼ã€‚å› æ­¤ï¼Œç”¨æˆ·è®¾ç½®å†°å±±å§”æ‰˜ï¼Œæ¯æ¬¡åªæ˜¾ç¤º1000è‚¡ï¼Œç³»ç»Ÿåœ¨æˆäº¤åè‡ªåŠ¨æŒ‚å‡ºä¸‹ä¸€ç¬”è®¢å•ã€‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>é€‚ç”¨äºå¤§é¢äº¤æ˜“ï¼Œé˜²æ­¢å¸‚åœºæ“çºµï¼Œæé«˜æˆäº¤æ•ˆç‡ã€‚</li></ul><hr><h3 id="8-ç½‘æ ¼äº¤æ˜“"><a href="#8-ç½‘æ ¼äº¤æ˜“" class="headerlink" title="8. ç½‘æ ¼äº¤æ˜“"></a><strong>8. ç½‘æ ¼äº¤æ˜“</strong></h3><p><strong>æ¦‚å¿µ</strong>ï¼šé€šè¿‡è®¾ç½®å¤šä¸ªä»·æ ¼åŒºé—´ï¼ˆç½‘æ ¼ï¼‰ï¼Œåœ¨ä¸åŒä»·ä½è‡ªåŠ¨è¿›è¡Œä¹°å…¥å–å‡ºï¼Œé€‚ç”¨äºéœ‡è¡å¸‚åœºã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ul><li>ç”¨æˆ·è®¾å®šä»·æ ¼åŒºé—´90~110å…ƒï¼Œæ¯éš”2å…ƒè®¾ç½®ä¹°å…¥å’Œå–å‡ºè®¢å•ï¼š<ul><li>90å…ƒä¹°å…¥ï¼Œ92å…ƒå–å‡º</li><li>92å…ƒä¹°å…¥ï¼Œ94å…ƒå–å‡º</li><li>ä¾æ¬¡ç±»æ¨</li></ul></li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>é€‚ç”¨äºéœ‡è¡å¸‚åœºï¼Œä¸éœ€è¦é¢„æµ‹å¸‚åœºæ–¹å‘ï¼Œåˆ©ç”¨æ³¢åŠ¨è·åˆ©ã€‚</li></ul><hr><h3 id="9-é©¬ä¸æ ¼å°”äº¤æ˜“"><a href="#9-é©¬ä¸æ ¼å°”äº¤æ˜“" class="headerlink" title="9. é©¬ä¸æ ¼å°”äº¤æ˜“"></a><strong>9. é©¬ä¸æ ¼å°”äº¤æ˜“</strong></h3><p><strong>æ¦‚å¿µ</strong>ï¼šé€†åŠ¿åŠ ä»“ç­–ç•¥ï¼Œæ¯æ¬¡äºæŸååŠ å€æŠ•å…¥èµ„é‡‘ï¼Œä»¥æœŸåœ¨ä»·æ ¼åå¼¹æ—¶å¼¥è¡¥äºæŸå¹¶ç›ˆåˆ©ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ul><li>ç”¨æˆ·åœ¨100å…ƒä¹°å…¥1æ‰‹ï¼Œè·Œè‡³95å…ƒäºæŸæ—¶ï¼Œå†ä¹°å…¥2æ‰‹ï¼Œè·Œè‡³90å…ƒäºæŸæ—¶ï¼Œå†ä¹°å…¥4æ‰‹ï¼Œæœ€ç»ˆä»·æ ¼åå¼¹åˆ°95å…ƒï¼Œæ•´ä½“å®ç°ç›ˆåˆ©ã€‚</li></ul><p><strong>é£é™©æç¤º</strong>ï¼š</p><ul><li>è‹¥å¸‚åœºæŒç»­å•è¾¹ä¸‹è·Œï¼Œä»“ä½ä¼šæŒ‡æ•°çº§å¢é•¿ï¼Œå¯èƒ½å¯¼è‡´èµ„é‡‘è€—å°½ã€‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>é€‚ç”¨äºçŸ­æœŸå›è°ƒå¸‚åœºï¼Œä¸é€‚åˆé•¿æœŸå•è¾¹å¸‚åœºã€‚</li></ul><hr><h3 id="10-å‘¨æœŸç­–ç•¥"><a href="#10-å‘¨æœŸç­–ç•¥" class="headerlink" title="10. å‘¨æœŸç­–ç•¥"></a><strong>10. å‘¨æœŸç­–ç•¥</strong></h3><p><strong>æ¦‚å¿µ</strong>ï¼šæ ¹æ®å¸‚åœºå‘¨æœŸè®¾ç½®äº¤æ˜“ç­–ç•¥ï¼Œåˆ†ä¸ºçŸ­å‘¨æœŸï¼ˆæ—¥å†…ç­–ç•¥ï¼‰å’Œé•¿å‘¨æœŸï¼ˆæ—¥é—´ç­–ç•¥ï¼‰ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><ul><li>æ—¥å†…äº¤æ˜“è€…å¯ä»¥è®¾å®šæ¯å°æ—¶è‡ªåŠ¨å¹³ä»“ï¼Œé¿å…æŒä»“è¿‡å¤œé£é™©ã€‚</li><li>é•¿å‘¨æœŸäº¤æ˜“è€…å¯ä»¥åŸºäºæŠ€æœ¯æŒ‡æ ‡ï¼Œå¦‚å‡çº¿ã€MACDç­‰ï¼Œè®¾å®šæ¯å‘¨æ‰§è¡Œä¸€æ¬¡äº¤æ˜“ã€‚</li></ul><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>é€‚ç”¨äºä¸åŒäº¤æ˜“é£æ ¼çš„æŠ•èµ„è€…ï¼Œæ ¹æ®å¸‚åœºèŠ‚å¥è¿›è¡Œäº¤æ˜“ã€‚</li></ul><hr><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3><p>ä¸åŒçš„äº¤æ˜“ç­–ç•¥é€‚ç”¨äºä¸åŒçš„å¸‚åœºç¯å¢ƒå’Œäº¤æ˜“éœ€æ±‚ï¼ŒæŠ•èµ„è€…å¯ä»¥ç»“åˆè‡ªèº«èµ„é‡‘ç®¡ç†å’Œé£é™©åå¥½ï¼Œé€‰æ‹©åˆé€‚çš„ç­–ç•¥è¿›è¡Œäº¤æ˜“ã€‚ä¾‹å¦‚ï¼š</p><ul><li><strong>ç¨³å¥æŠ•èµ„è€…</strong>ï¼šå¯ä»¥é€‰æ‹©â€œçµæ´»æ­¢ç›ˆæ­¢æŸ+åˆ†æ®µè®¢å•â€ç­–ç•¥ï¼Œæ§åˆ¶é£é™©å¹¶é™ä½å¸‚åœºå†²å‡»ã€‚</li><li><strong>è¶‹åŠ¿äº¤æ˜“è€…</strong>ï¼šå¯ä»¥ä½¿ç”¨â€œè·Ÿè¸ªå§”æ‰˜+ç§»åŠ¨æ­¢ç›ˆæ­¢æŸâ€ç­–ç•¥ï¼Œæœ€å¤§åŒ–è¶‹åŠ¿æ”¶ç›Šã€‚</li><li><strong>é«˜é¢‘äº¤æ˜“è€…</strong>ï¼šå¯ä»¥ä½¿ç”¨â€œè¿½é€é™ä»·å•+ç½‘æ ¼äº¤æ˜“â€ç­–ç•¥ï¼Œæé«˜äº¤æ˜“é¢‘ç‡å’Œæ”¶ç›Šã€‚</li></ul><p>é€‰æ‹©åˆé€‚çš„ç­–ç•¥ï¼Œå¯ä»¥åœ¨ä¸åŒå¸‚åœºæ¡ä»¶ä¸‹æé«˜æ”¶ç›Šã€é™ä½é£é™©ï¼Œå®ç°é•¿æœŸç¨³å®šç›ˆåˆ©ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>äº¤æ˜“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>äº¤æ˜“ç­–ç•¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>esé«˜çº§å‘½ä»¤</title>
    <link href="/elasticsearch/es%E9%AB%98%E7%BA%A7%E5%91%BD%E4%BB%A4/"/>
    <url>/elasticsearch/es%E9%AB%98%E7%BA%A7%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<p>ä»¥ä¸‹æ˜¯ä¼˜åŒ–è¿‡çš„ç¬”è®°ï¼Œå·²åŠ å…¥æ³¨é‡Šå¹¶è°ƒæ•´æ ¼å¼ï¼Œä½¿å…¶æ›´ç¬¦åˆMarkdownæ ‡å‡†ï¼š</p><hr><h1 id="Elasticsearch-é›†ç¾¤ç®¡ç†ä¸ä¼˜åŒ–ç¬”è®°"><a href="#Elasticsearch-é›†ç¾¤ç®¡ç†ä¸ä¼˜åŒ–ç¬”è®°" class="headerlink" title="Elasticsearch é›†ç¾¤ç®¡ç†ä¸ä¼˜åŒ–ç¬”è®°"></a>Elasticsearch é›†ç¾¤ç®¡ç†ä¸ä¼˜åŒ–ç¬”è®°</h1><h2 id="1-ç§»åŠ¨åˆ†ç‰‡åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹"><a href="#1-ç§»åŠ¨åˆ†ç‰‡åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹" class="headerlink" title="1. ç§»åŠ¨åˆ†ç‰‡åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹"></a>1. ç§»åŠ¨åˆ†ç‰‡åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _cluster/reroute<br>&#123;<br>  <span class="hljs-string">&quot;commands&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;move&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-string">&quot;index_name&quot;</span>,   <span class="hljs-comment"># ç´¢å¼•åç§°</span><br>        <span class="hljs-string">&quot;shard&quot;</span>: 0,               <span class="hljs-comment"># åˆ†ç‰‡ç¼–å·</span><br>        <span class="hljs-string">&quot;from_node&quot;</span>: <span class="hljs-string">&quot;node_name_1&quot;</span>, <span class="hljs-comment"># æºèŠ‚ç‚¹</span><br>        <span class="hljs-string">&quot;to_node&quot;</span>: <span class="hljs-string">&quot;node_name_2&quot;</span>   <span class="hljs-comment"># ç›®æ ‡èŠ‚ç‚¹</span><br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-å¼ºåˆ¶åˆ†é…æœªåˆ†é…çš„åˆ†ç‰‡ï¼ˆå¸¦åŸå› è¯´æ˜ï¼‰"><a href="#2-å¼ºåˆ¶åˆ†é…æœªåˆ†é…çš„åˆ†ç‰‡ï¼ˆå¸¦åŸå› è¯´æ˜ï¼‰" class="headerlink" title="2. å¼ºåˆ¶åˆ†é…æœªåˆ†é…çš„åˆ†ç‰‡ï¼ˆå¸¦åŸå› è¯´æ˜ï¼‰"></a>2. å¼ºåˆ¶åˆ†é…æœªåˆ†é…çš„åˆ†ç‰‡ï¼ˆå¸¦åŸå› è¯´æ˜ï¼‰</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _cluster/reroute?explain<br>&#123;<br>  <span class="hljs-string">&quot;commands&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;allocate&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-string">&quot;index_name&quot;</span>,   <span class="hljs-comment"># ç´¢å¼•åç§°</span><br>        <span class="hljs-string">&quot;shard&quot;</span>: 0,              <span class="hljs-comment"># åˆ†ç‰‡ç¼–å·</span><br>        <span class="hljs-string">&quot;node&quot;</span>: <span class="hljs-string">&quot;nodename&quot;</span>       <span class="hljs-comment"># ç›®æ ‡èŠ‚ç‚¹</span><br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-ä»é›†ç¾¤ä¸­ç§»é™¤èŠ‚ç‚¹"><a href="#3-ä»é›†ç¾¤ä¸­ç§»é™¤èŠ‚ç‚¹" class="headerlink" title="3. ä»é›†ç¾¤ä¸­ç§»é™¤èŠ‚ç‚¹"></a>3. ä»é›†ç¾¤ä¸­ç§»é™¤èŠ‚ç‚¹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT _cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;transient&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;cluster.routing.allocation.exclude._ip&quot;</span>: <span class="hljs-string">&quot;the_IP_of_your_node&quot;</span>   <span class="hljs-comment"># è¦æ’é™¤çš„èŠ‚ç‚¹IP</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-å¼ºåˆ¶æ‰§è¡ŒåŒæ­¥åˆ·æ–°"><a href="#4-å¼ºåˆ¶æ‰§è¡ŒåŒæ­¥åˆ·æ–°" class="headerlink" title="4. å¼ºåˆ¶æ‰§è¡ŒåŒæ­¥åˆ·æ–°"></a>4. å¼ºåˆ¶æ‰§è¡ŒåŒæ­¥åˆ·æ–°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _flush/synced<br></code></pre></td></tr></table></figure><h2 id="5-è°ƒæ•´é›†ç¾¤å¹³è¡¡æ—¶ç§»åŠ¨çš„åˆ†ç‰‡æ•°é‡"><a href="#5-è°ƒæ•´é›†ç¾¤å¹³è¡¡æ—¶ç§»åŠ¨çš„åˆ†ç‰‡æ•°é‡" class="headerlink" title="5. è°ƒæ•´é›†ç¾¤å¹³è¡¡æ—¶ç§»åŠ¨çš„åˆ†ç‰‡æ•°é‡"></a>5. è°ƒæ•´é›†ç¾¤å¹³è¡¡æ—¶ç§»åŠ¨çš„åˆ†ç‰‡æ•°é‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT /_cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;transient&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;cluster.routing.allocation.cluster_concurrent_rebalance&quot;</span>: 2   <span class="hljs-comment"># åŒæ—¶å¹³è¡¡çš„åˆ†ç‰‡æ•°</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="6-è°ƒæ•´æ¯ä¸ªèŠ‚ç‚¹åŒæ—¶æ¢å¤çš„åˆ†ç‰‡æ•°é‡"><a href="#6-è°ƒæ•´æ¯ä¸ªèŠ‚ç‚¹åŒæ—¶æ¢å¤çš„åˆ†ç‰‡æ•°é‡" class="headerlink" title="6. è°ƒæ•´æ¯ä¸ªèŠ‚ç‚¹åŒæ—¶æ¢å¤çš„åˆ†ç‰‡æ•°é‡"></a>6. è°ƒæ•´æ¯ä¸ªèŠ‚ç‚¹åŒæ—¶æ¢å¤çš„åˆ†ç‰‡æ•°é‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT _cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;transient&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;cluster.routing.allocation.node_concurrent_recoveries&quot;</span>: 5   <span class="hljs-comment"># æ¯ä¸ªèŠ‚ç‚¹å¹¶è¡Œæ¢å¤çš„åˆ†ç‰‡æ•°</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="7-è°ƒæ•´æ¢å¤é€Ÿåº¦"><a href="#7-è°ƒæ•´æ¢å¤é€Ÿåº¦" class="headerlink" title="7. è°ƒæ•´æ¢å¤é€Ÿåº¦"></a>7. è°ƒæ•´æ¢å¤é€Ÿåº¦</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT _cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;transient&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;indices.recovery.max_bytes_per_sec&quot;</span>: <span class="hljs-string">&quot;80mb&quot;</span>   <span class="hljs-comment"># æ¢å¤é€Ÿç‡</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="8-è°ƒæ•´å•èŠ‚ç‚¹æ¢å¤æ—¶å¹¶å‘æµæ•°é‡"><a href="#8-è°ƒæ•´å•èŠ‚ç‚¹æ¢å¤æ—¶å¹¶å‘æµæ•°é‡" class="headerlink" title="8. è°ƒæ•´å•èŠ‚ç‚¹æ¢å¤æ—¶å¹¶å‘æµæ•°é‡"></a>8. è°ƒæ•´å•èŠ‚ç‚¹æ¢å¤æ—¶å¹¶å‘æµæ•°é‡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT _cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;transient&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;indices.recovery.concurrent_streams&quot;</span>: 6   <span class="hljs-comment"># å•èŠ‚ç‚¹æ¢å¤æ—¶çš„å¹¶å‘æµæ•°</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="9-è°ƒæ•´æœç´¢é˜Ÿåˆ—å¤§å°"><a href="#9-è°ƒæ•´æœç´¢é˜Ÿåˆ—å¤§å°" class="headerlink" title="9. è°ƒæ•´æœç´¢é˜Ÿåˆ—å¤§å°"></a>9. è°ƒæ•´æœç´¢é˜Ÿåˆ—å¤§å°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT _cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;transient&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;threadpool.search.queue_size&quot;</span>: 2000   <span class="hljs-comment"># æœç´¢é˜Ÿåˆ—å¤§å°</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="10-æ¸…é™¤èŠ‚ç‚¹ç¼“å­˜"><a href="#10-æ¸…é™¤èŠ‚ç‚¹ç¼“å­˜" class="headerlink" title="10. æ¸…é™¤èŠ‚ç‚¹ç¼“å­˜"></a>10. æ¸…é™¤èŠ‚ç‚¹ç¼“å­˜</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _cache/clear<br></code></pre></td></tr></table></figure><h2 id="11-è°ƒæ•´æ–­è·¯å™¨é…ç½®"><a href="#11-è°ƒæ•´æ–­è·¯å™¨é…ç½®" class="headerlink" title="11. è°ƒæ•´æ–­è·¯å™¨é…ç½®"></a>11. è°ƒæ•´æ–­è·¯å™¨é…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT _cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;persistent&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;indices.breaker.total.limit&quot;</span>: <span class="hljs-string">&quot;40%&quot;</span>   <span class="hljs-comment"># è®¾ç½®å†…å­˜æ–­è·¯å™¨çš„æ€»å†…å­˜é™åˆ¶</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h1 id="ç›‘æ§-Elasticsearch-é›†ç¾¤"><a href="#ç›‘æ§-Elasticsearch-é›†ç¾¤" class="headerlink" title="ç›‘æ§ Elasticsearch é›†ç¾¤"></a>ç›‘æ§ Elasticsearch é›†ç¾¤</h1><h2 id="1-èŠ‚ç‚¹ç»Ÿè®¡"><a href="#1-èŠ‚ç‚¹ç»Ÿè®¡" class="headerlink" title="1. èŠ‚ç‚¹ç»Ÿè®¡"></a>1. èŠ‚ç‚¹ç»Ÿè®¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _nodes/stats<br></code></pre></td></tr></table></figure><h2 id="2-é›†ç¾¤ç»Ÿè®¡"><a href="#2-é›†ç¾¤ç»Ÿè®¡" class="headerlink" title="2. é›†ç¾¤ç»Ÿè®¡"></a>2. é›†ç¾¤ç»Ÿè®¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _cluster/stats<br></code></pre></td></tr></table></figure><h2 id="3-ç´¢å¼•ç»Ÿè®¡"><a href="#3-ç´¢å¼•ç»Ÿè®¡" class="headerlink" title="3. ç´¢å¼•ç»Ÿè®¡"></a>3. ç´¢å¼•ç»Ÿè®¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET kibana_sample_data_ecommerce/_stats<br></code></pre></td></tr></table></figure><h2 id="4-æŸ¥çœ‹å¾…å¤„ç†çš„é›†ç¾¤ä»»åŠ¡"><a href="#4-æŸ¥çœ‹å¾…å¤„ç†çš„é›†ç¾¤ä»»åŠ¡" class="headerlink" title="4. æŸ¥çœ‹å¾…å¤„ç†çš„é›†ç¾¤ä»»åŠ¡"></a>4. æŸ¥çœ‹å¾…å¤„ç†çš„é›†ç¾¤ä»»åŠ¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _cluster/pending_tasks<br></code></pre></td></tr></table></figure><h2 id="5-æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡ï¼Œæ”¯æŒå–æ¶ˆä»»åŠ¡"><a href="#5-æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡ï¼Œæ”¯æŒå–æ¶ˆä»»åŠ¡" class="headerlink" title="5. æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡ï¼Œæ”¯æŒå–æ¶ˆä»»åŠ¡"></a>5. æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡ï¼Œæ”¯æŒå–æ¶ˆä»»åŠ¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _tasks<br></code></pre></td></tr></table></figure><h2 id="6-æŸ¥çœ‹èŠ‚ç‚¹çš„çº¿ç¨‹æ± ä¿¡æ¯"><a href="#6-æŸ¥çœ‹èŠ‚ç‚¹çš„çº¿ç¨‹æ± ä¿¡æ¯" class="headerlink" title="6. æŸ¥çœ‹èŠ‚ç‚¹çš„çº¿ç¨‹æ± ä¿¡æ¯"></a>6. æŸ¥çœ‹èŠ‚ç‚¹çš„çº¿ç¨‹æ± ä¿¡æ¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _nodes/thread_pool<br>GET _nodes/stats/thread_pool<br>GET _cat/thread_pool?v<br>GET _nodes/hot_threads<br>GET _nodes/stats/thread_pool<br></code></pre></td></tr></table></figure><h2 id="7-è®¾ç½®ç´¢å¼•æ…¢æ—¥å¿—ï¼ˆSlowlogï¼‰"><a href="#7-è®¾ç½®ç´¢å¼•æ…¢æ—¥å¿—ï¼ˆSlowlogï¼‰" class="headerlink" title="7. è®¾ç½®ç´¢å¼•æ…¢æ—¥å¿—ï¼ˆSlowlogï¼‰"></a>7. è®¾ç½®ç´¢å¼•æ…¢æ—¥å¿—ï¼ˆSlowlogï¼‰</h2><ul><li><p>è®¾ç½®ç´¢å¼•æ…¢æ—¥å¿—é˜ˆå€¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT my_index/_settings<br>&#123;<br>  <span class="hljs-string">&quot;index.indexing.slowlog&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;threshold.index&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;warn&quot;</span>: <span class="hljs-string">&quot;10s&quot;</span>,    <span class="hljs-comment"># è­¦å‘Šçº§åˆ«</span><br>      <span class="hljs-string">&quot;info&quot;</span>: <span class="hljs-string">&quot;4s&quot;</span>,     <span class="hljs-comment"># ä¿¡æ¯çº§åˆ«</span><br>      <span class="hljs-string">&quot;debug&quot;</span>: <span class="hljs-string">&quot;2s&quot;</span>,    <span class="hljs-comment"># è°ƒè¯•çº§åˆ«</span><br>      <span class="hljs-string">&quot;trace&quot;</span>: <span class="hljs-string">&quot;0s&quot;</span>     <span class="hljs-comment"># è·Ÿè¸ªçº§åˆ«</span><br>    &#125;,<br>    <span class="hljs-string">&quot;level&quot;</span>: <span class="hljs-string">&quot;trace&quot;</span>,<br>    <span class="hljs-string">&quot;source&quot;</span>: 1000   <span class="hljs-comment"># æ—¥å¿—æºçš„æœ€å¤§å­—ç¬¦æ•°</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>è®¾ç½®æŸ¥è¯¢æ…¢æ—¥å¿—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE my_index<br>PUT my_index/<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index.search.slowlog.threshold&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;query.warn&quot;</span>: <span class="hljs-string">&quot;10s&quot;</span>,   <span class="hljs-comment"># æŸ¥è¯¢æ…¢æ—¥å¿—è­¦å‘Šçº§åˆ«</span><br>      <span class="hljs-string">&quot;query.info&quot;</span>: <span class="hljs-string">&quot;3s&quot;</span>,    <span class="hljs-comment"># æŸ¥è¯¢æ…¢æ—¥å¿—ä¿¡æ¯çº§åˆ«</span><br>      <span class="hljs-string">&quot;query.debug&quot;</span>: <span class="hljs-string">&quot;2s&quot;</span>,   <span class="hljs-comment"># æŸ¥è¯¢æ…¢æ—¥å¿—è°ƒè¯•çº§åˆ«</span><br>      <span class="hljs-string">&quot;query.trace&quot;</span>: <span class="hljs-string">&quot;0s&quot;</span>,   <span class="hljs-comment"># æŸ¥è¯¢æ…¢æ—¥å¿—è·Ÿè¸ªçº§åˆ«</span><br>      <span class="hljs-string">&quot;fetch.warn&quot;</span>: <span class="hljs-string">&quot;1s&quot;</span>,    <span class="hljs-comment"># è·å–æ…¢æ—¥å¿—è­¦å‘Šçº§åˆ«</span><br>      <span class="hljs-string">&quot;fetch.info&quot;</span>: <span class="hljs-string">&quot;600ms&quot;</span>, <span class="hljs-comment"># è·å–æ…¢æ—¥å¿—ä¿¡æ¯çº§åˆ«</span><br>      <span class="hljs-string">&quot;fetch.debug&quot;</span>: <span class="hljs-string">&quot;400ms&quot;</span>,<span class="hljs-comment"># è·å–æ…¢æ—¥å¿—è°ƒè¯•çº§åˆ«</span><br>      <span class="hljs-string">&quot;fetch.trace&quot;</span>: <span class="hljs-string">&quot;0s&quot;</span>    <span class="hljs-comment"># è·å–æ…¢æ—¥å¿—è·Ÿè¸ªçº§åˆ«</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><hr><h1 id="è§£å†³é›†ç¾¤-Yellow-ä¸-Red-çŠ¶æ€é—®é¢˜"><a href="#è§£å†³é›†ç¾¤-Yellow-ä¸-Red-çŠ¶æ€é—®é¢˜" class="headerlink" title="è§£å†³é›†ç¾¤ Yellow ä¸ Red çŠ¶æ€é—®é¢˜"></a>è§£å†³é›†ç¾¤ Yellow ä¸ Red çŠ¶æ€é—®é¢˜</h1><h2 id="1-æ£€æŸ¥é›†ç¾¤å¥åº·çŠ¶æ€"><a href="#1-æ£€æŸ¥é›†ç¾¤å¥åº·çŠ¶æ€" class="headerlink" title="1. æ£€æŸ¥é›†ç¾¤å¥åº·çŠ¶æ€"></a>1. æ£€æŸ¥é›†ç¾¤å¥åº·çŠ¶æ€</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cluster/health/<br></code></pre></td></tr></table></figure><h2 id="2-æŸ¥çœ‹ç´¢å¼•çº§åˆ«å¥åº·çŠ¶æ€ï¼Œæ‰¾å‡ºçº¢è‰²ç´¢å¼•"><a href="#2-æŸ¥çœ‹ç´¢å¼•çº§åˆ«å¥åº·çŠ¶æ€ï¼Œæ‰¾å‡ºçº¢è‰²ç´¢å¼•" class="headerlink" title="2. æŸ¥çœ‹ç´¢å¼•çº§åˆ«å¥åº·çŠ¶æ€ï¼Œæ‰¾å‡ºçº¢è‰²ç´¢å¼•"></a>2. æŸ¥çœ‹ç´¢å¼•çº§åˆ«å¥åº·çŠ¶æ€ï¼Œæ‰¾å‡ºçº¢è‰²ç´¢å¼•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cluster/health?level=indices<br></code></pre></td></tr></table></figure><h2 id="3-æŸ¥çœ‹åˆ†ç‰‡çº§åˆ«å¥åº·çŠ¶æ€"><a href="#3-æŸ¥çœ‹åˆ†ç‰‡çº§åˆ«å¥åº·çŠ¶æ€" class="headerlink" title="3. æŸ¥çœ‹åˆ†ç‰‡çº§åˆ«å¥åº·çŠ¶æ€"></a>3. æŸ¥çœ‹åˆ†ç‰‡çº§åˆ«å¥åº·çŠ¶æ€</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _cluster/health?level=shards<br></code></pre></td></tr></table></figure><h2 id="4-è§£é‡Šç´¢å¼•åˆ†ç‰‡æ— æ³•åˆ†é…çš„åŸå› "><a href="#4-è§£é‡Šç´¢å¼•åˆ†ç‰‡æ— æ³•åˆ†é…çš„åŸå› " class="headerlink" title="4. è§£é‡Šç´¢å¼•åˆ†ç‰‡æ— æ³•åˆ†é…çš„åŸå› "></a>4. è§£é‡Šç´¢å¼•åˆ†ç‰‡æ— æ³•åˆ†é…çš„åŸå› </h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cluster/allocation/explain<br></code></pre></td></tr></table></figure><h2 id="5-åˆ é™¤å¹¶é‡æ–°åˆ›å»ºç´¢å¼•"><a href="#5-åˆ é™¤å¹¶é‡æ–°åˆ›å»ºç´¢å¼•" class="headerlink" title="5. åˆ é™¤å¹¶é‡æ–°åˆ›å»ºç´¢å¼•"></a>5. åˆ é™¤å¹¶é‡æ–°åˆ›å»ºç´¢å¼•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE mytest<br>PUT mytest<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>: 3,    <span class="hljs-comment"># åˆ†ç‰‡æ•°</span><br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span>: 0,   <span class="hljs-comment"># å‰¯æœ¬æ•°</span><br>    <span class="hljs-string">&quot;index.routing.allocation.require.box_type&quot;</span>: <span class="hljs-string">&quot;hot&quot;</span>   <span class="hljs-comment"># æŒ‡å®šèŠ‚ç‚¹ç±»å‹</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h1 id="æå‡é›†ç¾¤å†™æ€§èƒ½"><a href="#æå‡é›†ç¾¤å†™æ€§èƒ½" class="headerlink" title="æå‡é›†ç¾¤å†™æ€§èƒ½"></a>æå‡é›†ç¾¤å†™æ€§èƒ½</h1><h2 id="1-è®¾ç½®ä¼˜åŒ–å†™å…¥æ€§èƒ½çš„ç´¢å¼•è®¾ç½®"><a href="#1-è®¾ç½®ä¼˜åŒ–å†™å…¥æ€§èƒ½çš„ç´¢å¼•è®¾ç½®" class="headerlink" title="1. è®¾ç½®ä¼˜åŒ–å†™å…¥æ€§èƒ½çš„ç´¢å¼•è®¾ç½®"></a>1. è®¾ç½®ä¼˜åŒ–å†™å…¥æ€§èƒ½çš„ç´¢å¼•è®¾ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE myindex<br>PUT myindex<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;refresh_interval&quot;</span>: <span class="hljs-string">&quot;30s&quot;</span>,     <span class="hljs-comment"># åˆ·æ–°é—´éš”</span><br>      <span class="hljs-string">&quot;number_of_shards&quot;</span>: <span class="hljs-string">&quot;2&quot;</span>        <span class="hljs-comment"># åˆ†ç‰‡æ•°</span><br>    &#125;,<br>    <span class="hljs-string">&quot;routing&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;allocation&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;total_shards_per_node&quot;</span>: <span class="hljs-string">&quot;3&quot;</span> <span class="hljs-comment"># æ¯ä¸ªèŠ‚ç‚¹çš„æœ€å¤§åˆ†ç‰‡æ•°</span><br>      &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;translog&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;sync_interval&quot;</span>: <span class="hljs-string">&quot;30s&quot;</span>,         <span class="hljs-comment"># äº‹åŠ¡æ—¥å¿—åŒæ­¥é—´éš”</span><br>      <span class="hljs-string">&quot;durability&quot;</span>: <span class="hljs-string">&quot;async&quot;</span>           <span class="hljs-comment"># å¼‚æ­¥æŒä¹…åŒ–</span><br>    &#125;,<br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span>: 0          <span class="hljs-comment"># å‰¯æœ¬æ•°</span><br>  &#125;,<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;dynamic&quot;</span>: <span class="hljs-literal">false</span>,                <span class="hljs-comment"># ç¦ç”¨åŠ¨æ€æ˜ å°„</span><br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h1 id="æå‡é›†ç¾¤è¯»æ€§èƒ½"><a href="#æå‡é›†ç¾¤è¯»æ€§èƒ½" class="headerlink" title="æå‡é›†ç¾¤è¯»æ€§èƒ½"></a>æå‡é›†ç¾¤è¯»æ€§èƒ½</h1><h2 id="1-ç¤ºä¾‹ï¼šæŸ¥è¯¢ä¼˜åŒ–"><a href="#1-ç¤ºä¾‹ï¼šæŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="1. ç¤ºä¾‹ï¼šæŸ¥è¯¢ä¼˜åŒ–"></a>1. ç¤ºä¾‹ï¼šæŸ¥è¯¢ä¼˜åŒ–</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT blogs/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;elasticsearch&quot;</span><br>&#125;<br><br>GET blogs/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [<br>        &#123;<span class="hljs-string">&quot;match&quot;</span>: &#123; <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;elasticsearch&quot;</span> &#125;&#125;<br>      ],<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;script&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;script&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;source&quot;</span>: <span class="hljs-string">&quot;doc[&#x27;title.keyword&#x27;].value.length()&gt;5&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>GET blogs/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [<br>        &#123;<span class="hljs-string">&quot;match&quot;</span>: &#123;<span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;elasticsearch&quot;</span>&#125;&#125;,<br>        &#123;<br>          <span class="hljs-string">&quot;range&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;publish_date&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;gte&quot;</span>: 2017,<br>              <span class="hljs-string">&quot;lte&quot;</span>: 2019<br>            &#125;<br>          &#125;<br>        &#125;<br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h1 id="é›†ç¾¤å‹åŠ›æµ‹è¯•"><a href="#é›†ç¾¤å‹åŠ›æµ‹è¯•" class="headerlink" title="é›†ç¾¤å‹åŠ›æµ‹è¯•"></a>é›†ç¾¤å‹åŠ›æµ‹è¯•</h1><h2 id="1-å®‰è£…å¹¶é…ç½®-esrally"><a href="#1-å®‰è£…å¹¶é…ç½®-esrally" class="headerlink" title="1. å®‰è£…å¹¶é…ç½® esrally"></a>1. å®‰è£…å¹¶é…ç½® esrally</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip3 install esrally<br>esrally configure<br></code></pre></td></tr></table></figure><h2 id="2-æ‰§è¡Œç®€å•çš„å‹åŠ›æµ‹è¯•"><a href="#2-æ‰§è¡Œç®€å•çš„å‹åŠ›æµ‹è¯•" class="headerlink" title="2. æ‰§è¡Œç®€å•çš„å‹åŠ›æµ‹è¯•"></a>2. æ‰§è¡Œç®€å•çš„å‹åŠ›æµ‹è¯•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">esrally --distribution-version=7.1.0 --test-mode<br></code></pre></td></tr></table></figure><h2 id="3-æ‰§è¡Œå®Œæ•´æ•°æ®æµ‹è¯•"><a href="#3-æ‰§è¡Œå®Œæ•´æ•°æ®æµ‹è¯•" class="headerlink" title="3. æ‰§è¡Œå®Œæ•´æ•°æ®æµ‹è¯•"></a>3. æ‰§è¡Œå®Œæ•´æ•°æ®æµ‹è¯•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">esrally --distribution-version=7.1.0<br></code></pre></td></tr></table></figure><hr><h1 id="ä½¿ç”¨ç¼“å­˜ä¸-Breaker-é™åˆ¶å†…å­˜ä½¿ç”¨"><a href="#ä½¿ç”¨ç¼“å­˜ä¸-Breaker-é™åˆ¶å†…å­˜ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨ç¼“å­˜ä¸ Breaker é™åˆ¶å†…å­˜ä½¿ç”¨"></a>ä½¿ç”¨ç¼“å­˜ä¸ Breaker é™åˆ¶å†…å­˜ä½¿ç”¨</h1><h2 id="1-è·å–èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯"><a href="#1-è·å–èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯" class="headerlink" title="1. è·å–èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯"></a>1. è·å–èŠ‚ç‚¹ç»Ÿè®¡ä¿¡æ¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _cat/nodes?v<br>GET _nodes/stats/indices?pretty<br>GET _cat/nodes?v&amp;h=name,queryCacheMemory,queryCacheEvictions,requestCacheMemory,requestCacheHitCount,request_cache.miss_count<br></code></pre></td></tr></table></figure><h2 id="2-è®¾ç½®å†…å­˜é™åˆ¶"><a href="#2-è®¾ç½®å†…å­˜é™åˆ¶" class="headerlink" title="2. è®¾ç½®å†…å­˜é™åˆ¶"></a>2. è®¾ç½®å†…å­˜é™åˆ¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT /_cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;persistent&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;indices.breaker.request.limit&quot;</span>: <span class="hljs-string">&quot;90%&quot;</span>   <span class="hljs-comment"># è®¾ç½®è¯·æ±‚æ–­è·¯å™¨å†…å­˜é™åˆ¶</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h1 id="ä½¿ç”¨-Shrink-ä¸-Rollover-API-ç®¡ç†ç´¢å¼•"><a href="#ä½¿ç”¨-Shrink-ä¸-Rollover-API-ç®¡ç†ç´¢å¼•" class="headerlink" title="ä½¿ç”¨ Shrink ä¸ Rollover API ç®¡ç†ç´¢å¼•"></a>ä½¿ç”¨ Shrink ä¸ Rollover API ç®¡ç†ç´¢å¼•</h1><h2 id="1-Shrink-ç´¢å¼•"><a href="#1-Shrink-ç´¢å¼•" class="headerlink" title="1. Shrink ç´¢å¼•"></a>1. Shrink ç´¢å¼•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST my_source_index/_shrink/my_target_index<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index.number_of_replicas&quot;</span>: 0,<br>    <span class="hljs-string">&quot;index.number_of_shards&quot;</span>: 2,<br>    <span class="hljs-string">&quot;index.codec&quot;</span>: <span class="hljs-string">&quot;best_compression&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;aliases&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;my_search_indices&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-Rollover-ç´¢å¼•"><a href="#2-Rollover-ç´¢å¼•" class="headerlink" title="2. Rollover ç´¢å¼•"></a>2. Rollover ç´¢å¼•</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST nginx_logs_write/_rollover<br>&#123;<br>  <span class="hljs-string">&quot;conditions&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;max_age&quot;</span>: <span class="hljs-string">&quot;1d&quot;</span>,<br>    <span class="hljs-string">&quot;max_docs&quot;</span>: 5,<br>    <span class="hljs-string">&quot;max_size&quot;</span>: <span class="hljs-string">&quot;5gb&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># 11.2-ç´¢å¼•å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠå·¥å…·ä»‹ç».md</span><br><br><span class="hljs-meta"># ç´¢å¼•å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠå·¥å…·ä»‹ç»</span><br></code></pre></td></tr></table></figure><h1 id="è¿è¡Œä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ†ç‰‡-å°†box-typeè®¾ç½®æˆ-hotï¼Œwarmå’Œcold"><a href="#è¿è¡Œä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ†ç‰‡-å°†box-typeè®¾ç½®æˆ-hotï¼Œwarmå’Œcold" class="headerlink" title="è¿è¡Œä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ†ç‰‡ å°†box_typeè®¾ç½®æˆ hotï¼Œwarmå’Œcold"></a>è¿è¡Œä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ†ç‰‡ å°†box_typeè®¾ç½®æˆ hotï¼Œwarmå’Œcold</h1><h1 id="å…·ä½“å‚è€ƒ-githubä¸‹ï¼Œdocker-hot-warm-cold-ä¸‹çš„docker-compose-æ–‡ä»¶"><a href="#å…·ä½“å‚è€ƒ-githubä¸‹ï¼Œdocker-hot-warm-cold-ä¸‹çš„docker-compose-æ–‡ä»¶" class="headerlink" title="å…·ä½“å‚è€ƒ githubä¸‹ï¼Œdocker-hot-warm-cold ä¸‹çš„docker-compose æ–‡ä»¶"></a>å…·ä½“å‚è€ƒ githubä¸‹ï¼Œdocker-hot-warm-cold ä¸‹çš„docker-compose æ–‡ä»¶</h1><p>DELETE *</p><h1 id="è®¾ç½®-1ç§’åˆ·æ–°1æ¬¡ï¼Œç”Ÿäº§ç¯å¢ƒ10åˆ†ç§åˆ·æ–°ä¸€æ¬¡"><a href="#è®¾ç½®-1ç§’åˆ·æ–°1æ¬¡ï¼Œç”Ÿäº§ç¯å¢ƒ10åˆ†ç§åˆ·æ–°ä¸€æ¬¡" class="headerlink" title="è®¾ç½® 1ç§’åˆ·æ–°1æ¬¡ï¼Œç”Ÿäº§ç¯å¢ƒ10åˆ†ç§åˆ·æ–°ä¸€æ¬¡"></a>è®¾ç½® 1ç§’åˆ·æ–°1æ¬¡ï¼Œç”Ÿäº§ç¯å¢ƒ10åˆ†ç§åˆ·æ–°ä¸€æ¬¡</h1><p>PUT _cluster&#x2F;settings<br>{<br>  â€œpersistentâ€: {<br>    â€œindices.lifecycle.poll_intervalâ€:â€1sâ€<br>  }<br>}</p><h1 id="è®¾ç½®-Policy"><a href="#è®¾ç½®-Policy" class="headerlink" title="è®¾ç½® Policy"></a>è®¾ç½® Policy</h1><p>PUT &#x2F;_ilm&#x2F;policy&#x2F;log_ilm_policy<br>{<br>  â€œpolicyâ€: {<br>    â€œphasesâ€: {<br>      â€œhotâ€: {<br>        â€œactionsâ€: {<br>          â€œrolloverâ€: {<br>            â€œmax_docsâ€: 5<br>          }<br>        }<br>      },<br>      â€œwarmâ€: {<br>        â€œmin_ageâ€: â€œ10sâ€,<br>        â€œactionsâ€: {<br>          â€œallocateâ€: {<br>            â€œincludeâ€: {<br>              â€œbox_typeâ€: â€œwarmâ€<br>            }<br>          }<br>        }<br>      },<br>      â€œcoldâ€: {<br>        â€œmin_ageâ€: â€œ15sâ€,<br>        â€œactionsâ€: {<br>          â€œallocateâ€: {<br>            â€œincludeâ€: {<br>              â€œbox_typeâ€: â€œcoldâ€<br>            }<br>          }<br>        }<br>      },<br>      â€œdeleteâ€: {<br>        â€œmin_ageâ€: â€œ20sâ€,<br>        â€œactionsâ€: {<br>          â€œdeleteâ€: {}<br>        }<br>      }<br>    }<br>  }<br>}</p><h1 id="è®¾ç½®ç´¢å¼•æ¨¡ç‰ˆ"><a href="#è®¾ç½®ç´¢å¼•æ¨¡ç‰ˆ" class="headerlink" title="è®¾ç½®ç´¢å¼•æ¨¡ç‰ˆ"></a>è®¾ç½®ç´¢å¼•æ¨¡ç‰ˆ</h1><p>PUT &#x2F;_template&#x2F;log_ilm_template<br>{<br>  â€œindex_patternsâ€ : [<br>      â€œilm_index-*â€<br>    ],<br>    â€œsettingsâ€ : {<br>      â€œindexâ€ : {<br>        â€œlifecycleâ€ : {<br>          â€œnameâ€ : â€œlog_ilm_policyâ€,<br>          â€œrollover_aliasâ€ : â€œilm_aliasâ€<br>        },<br>        â€œroutingâ€ : {<br>          â€œallocationâ€ : {<br>            â€œincludeâ€ : {<br>              â€œbox_typeâ€ : â€œhotâ€<br>            }<br>          }<br>        },<br>        â€œnumber_of_shardsâ€ : â€œ1â€,<br>        â€œnumber_of_replicasâ€ : â€œ0â€<br>      }<br>    },<br>    â€œmappingsâ€ : { },<br>    â€œaliasesâ€ : { }<br>}</p><p>#åˆ›å»ºç´¢å¼•<br>PUT ilm_index-000001<br>{<br>  â€œsettingsâ€: {<br>    â€œnumber_of_shardsâ€: 1,<br>    â€œnumber_of_replicasâ€: 0,<br>    â€œindex.lifecycle.nameâ€: â€œlog_ilm_policyâ€,<br>    â€œindex.lifecycle.rollover_aliasâ€: â€œilm_aliasâ€,<br>    â€œindex.routing.allocation.include.box_typeâ€:â€hotâ€<br>  },<br>  â€œaliasesâ€: {<br>    â€œilm_aliasâ€: {<br>      â€œis_write_indexâ€: true<br>    }<br>  }<br>}</p><h1 id="å¯¹-Aliaså†™å…¥æ–‡æ¡£"><a href="#å¯¹-Aliaså†™å…¥æ–‡æ¡£" class="headerlink" title="å¯¹ Aliaså†™å…¥æ–‡æ¡£"></a>å¯¹ Aliaså†™å…¥æ–‡æ¡£</h1><p>POST  ilm_alias&#x2F;_doc<br>{<br>  â€œdfdâ€:â€dfdsfâ€<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># 12.1-Logstashå…¥é—¨åŠæ¶æ„ä»‹ç».md</span><br><br><span class="hljs-meta"># Logstash å…¥é—¨åŠæ¶æ„ä»‹ç»</span><br></code></pre></td></tr></table></figure><h1 id="ä¸€ä¸ª-Demoï¼Œ-demo-è¿è¡Œ"><a href="#ä¸€ä¸ª-Demoï¼Œ-demo-è¿è¡Œ" class="headerlink" title="ä¸€ä¸ª Demoï¼Œ demo è¿è¡Œ"></a>ä¸€ä¸ª Demoï¼Œ demo è¿è¡Œ</h1><p>sudo bin&#x2F;logstash -f logstash-filter.conf</p><h1 id="demoæ•°æ®"><a href="#demoæ•°æ®" class="headerlink" title="demoæ•°æ®"></a>demoæ•°æ®</h1><p>127.0.0.1 - - [11&#x2F;Dec&#x2F;2013:00:01:45 -0800] â€œGET &#x2F;xampp&#x2F;status.php HTTP&#x2F;1.1â€ 200 3891 â€œ<a href="http://cadenza/xampp/navi.php">http://cadenza/xampp/navi.php</a>â€œ â€œMozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10.9; rv:25.0) Gecko&#x2F;20100101 Firefox&#x2F;25.0â€</p><h1 id="codec-demo"><a href="#codec-demo" class="headerlink" title="codec demo"></a>codec demo</h1><p>sudo bin&#x2F;logstash -e â€œinput{stdin{codec&#x3D;&gt;line}}output{stdout{codec&#x3D;&gt; rubydebug}}â€<br>sudo bin&#x2F;logstash -e â€œinput{stdin{codec&#x3D;&gt;json}}output{stdout{codec&#x3D;&gt; rubydebug}}â€<br>sudo bin&#x2F;logstash -e â€œinput{stdin{codec&#x3D;&gt;line}}output{stdout{codec&#x3D;&gt; dots}}â€</p><p>sudo bin&#x2F;logstash -f multiline-exception.conf</p><h1 id="å¤šè¡Œæ•°æ®ï¼Œå¼‚å¸¸"><a href="#å¤šè¡Œæ•°æ®ï¼Œå¼‚å¸¸" class="headerlink" title="å¤šè¡Œæ•°æ®ï¼Œå¼‚å¸¸"></a>å¤šè¡Œæ•°æ®ï¼Œå¼‚å¸¸</h1><p>Exception in thread â€œmainâ€ java.lang.NullPointerException<br>        at com.example.myproject.Book.getTitle(Book.java:16)<br>        at com.example.myproject.Author.getBookTitles(Author.java:25)<br>        at com.example.myproject.Bootstrap.main(Bootstrap.java:14)</p><h1 id="ä¸€ä¸ªå®ä¾‹"><a href="#ä¸€ä¸ªå®ä¾‹" class="headerlink" title="ä¸€ä¸ªå®ä¾‹"></a>ä¸€ä¸ªå®ä¾‹</h1><p><a href="https://github.com/onebirdrocks/geektime-ELK/blob/master/part-1/2.4-Logstash%E5%AE%89%E8%A3%85%E4%B8%8E%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE/movielens/logstash.conf">https://github.com/onebirdrocks/geektime-ELK/blob/master/part-1/2.4-Logstash%E5%AE%89%E8%A3%85%E4%B8%8E%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE/movielens/logstash.conf</a></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><br><span class="hljs-meta"># 12.2-åˆ©ç”¨JDBCæ’ä»¶å¯¼å…¥æ•°æ®åˆ°Elasticsearch.md</span><br><br><span class="hljs-meta"># Logstashæ’ä»¶åŠæ–‡æ¡£ä»‹ç»</span><br></code></pre></td></tr></table></figure><p><a href="https://spring.io/guides/gs/accessing-data-mysql/">https://spring.io/guides/gs/accessing-data-mysql/</a><br>create database db_example;<br>use db_example;<br>show tables;<br>drop table user;<br>select * from user;</p><h1 id="æ–°å¢ç”¨æˆ·"><a href="#æ–°å¢ç”¨æˆ·" class="headerlink" title="æ–°å¢ç”¨æˆ·"></a>æ–°å¢ç”¨æˆ·</h1><p>curl localhost:8080&#x2F;demo&#x2F;add -d name&#x3D;Mike -d email&#x3D;<a href="mailto:&#109;&#105;&#107;&#x65;&#64;&#120;&#121;&#x7a;&#46;&#99;&#x6f;&#x6d;">&#109;&#105;&#107;&#x65;&#64;&#120;&#121;&#x7a;&#46;&#99;&#x6f;&#x6d;</a> -d tags&#x3D;Elasticsearch,IntelliJ<br>curl localhost:8080&#x2F;demo&#x2F;add -d name&#x3D;Jack -d email&#x3D;<a href="mailto:&#x6a;&#97;&#x63;&#x6b;&#x40;&#120;&#x79;&#122;&#46;&#x63;&#x6f;&#x6d;">&#x6a;&#97;&#x63;&#x6b;&#x40;&#120;&#x79;&#122;&#46;&#x63;&#x6f;&#x6d;</a> -d tags&#x3D;Mysql,IntelliJ<br>curl localhost:8080&#x2F;demo&#x2F;add -d name&#x3D;Bob -d email&#x3D;<a href="mailto:&#98;&#111;&#98;&#64;&#120;&#x79;&#x7a;&#x2e;&#99;&#x6f;&#x6d;">&#98;&#111;&#98;&#64;&#120;&#x79;&#x7a;&#x2e;&#99;&#x6f;&#x6d;</a> -d tags&#x3D;Mysql,IntelliJ</p><p>#æŸ¥çœ‹æ‰€æœ‰çš„ç”¨æˆ·<br>curl â€˜localhost:8080&#x2F;demo&#x2F;allâ€™</p><h1 id="æ›´æ–°ç”¨æˆ·"><a href="#æ›´æ–°ç”¨æˆ·" class="headerlink" title="æ›´æ–°ç”¨æˆ·"></a>æ›´æ–°ç”¨æˆ·</h1><p>curl -X PUT localhost:8080&#x2F;demo&#x2F;update -d id&#x3D;16 -d name&#x3D;Bob2 -d email&#x3D;<a href="mailto:&#x62;&#x6f;&#x62;&#50;&#64;&#120;&#x79;&#122;&#x2e;&#x63;&#111;&#109;">&#x62;&#x6f;&#x62;&#50;&#64;&#120;&#x79;&#122;&#x2e;&#x63;&#111;&#109;</a> -d tags&#x3D;Mysql,IntelliJ</p><h1 id="åˆ é™¤ç”¨æˆ·"><a href="#åˆ é™¤ç”¨æˆ·" class="headerlink" title="åˆ é™¤ç”¨æˆ·"></a>åˆ é™¤ç”¨æˆ·</h1><p>curl -X DELETE localhost:8080&#x2F;demo&#x2F;delete -d id&#x3D;15</p><p>mysql-demo.conf</p><h1 id="åˆ›å»º-aliasï¼Œåªæ˜¾ç¤ºæ²¡æœ‰è¢«æ ‡è®°-deletedçš„ç”¨æˆ·"><a href="#åˆ›å»º-aliasï¼Œåªæ˜¾ç¤ºæ²¡æœ‰è¢«æ ‡è®°-deletedçš„ç”¨æˆ·" class="headerlink" title="åˆ›å»º aliasï¼Œåªæ˜¾ç¤ºæ²¡æœ‰è¢«æ ‡è®° deletedçš„ç”¨æˆ·"></a>åˆ›å»º aliasï¼Œåªæ˜¾ç¤ºæ²¡æœ‰è¢«æ ‡è®° deletedçš„ç”¨æˆ·</h1><p>POST &#x2F;_aliases<br>{<br>  â€œactionsâ€: [<br>    {<br>      â€œaddâ€: {<br>        â€œindexâ€: â€œusersâ€,<br>        â€œaliasâ€: â€œview_usersâ€,<br>         â€œfilterâ€ : { â€œtermâ€ : { â€œis_deletedâ€ : false } }<br>      }<br>    }<br>  ]<br>}</p><h1 id="é€šè¿‡-AliasæŸ¥è¯¢ï¼ŒæŸ¥ä¸åˆ°è¢«æ ‡è®°æˆ-deletedçš„ç”¨æˆ·"><a href="#é€šè¿‡-AliasæŸ¥è¯¢ï¼ŒæŸ¥ä¸åˆ°è¢«æ ‡è®°æˆ-deletedçš„ç”¨æˆ·" class="headerlink" title="é€šè¿‡ AliasæŸ¥è¯¢ï¼ŒæŸ¥ä¸åˆ°è¢«æ ‡è®°æˆ deletedçš„ç”¨æˆ·"></a>é€šè¿‡ AliasæŸ¥è¯¢ï¼ŒæŸ¥ä¸åˆ°è¢«æ ‡è®°æˆ deletedçš„ç”¨æˆ·</h1><p>POST view_users&#x2F;_search<br>{</p><p>}</p><p>POST view_users&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œname.keywordâ€: {<br>        â€œvalueâ€: â€œJackâ€<br>      }<br>    }<br>  }<br>}</p><p>POST users&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œname.keywordâ€: {<br>        â€œvalueâ€: â€œJackâ€<br>      }<br>    }<br>  }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><br><span class="hljs-meta"># 12.3-Beatsä»‹ç».md</span><br><br><span class="hljs-meta"># Beatsä»‹ç»</span><br></code></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h1 id="æŸ¥çœ‹-packetbeat-æ¨¡å—"><a href="#æŸ¥çœ‹-packetbeat-æ¨¡å—" class="headerlink" title="æŸ¥çœ‹ packetbeat æ¨¡å—"></a>æŸ¥çœ‹ packetbeat æ¨¡å—</h1><h1 id="è®¾ç½®-packetbeat-çš„mysql-æ¨¡å—"><a href="#è®¾ç½®-packetbeat-çš„mysql-æ¨¡å—" class="headerlink" title="è®¾ç½® packetbeat çš„mysql æ¨¡å—"></a>è®¾ç½® packetbeat çš„mysql æ¨¡å—</h1><h1 id="å¯åŠ¨è¿è¡Œ"><a href="#å¯åŠ¨è¿è¡Œ" class="headerlink" title="å¯åŠ¨è¿è¡Œ"></a>å¯åŠ¨è¿è¡Œ</h1><h1 id="-1"><a href="#-1" class="headerlink" title=""></a></h1><p>.&#x2F;metricbeat modules list<br>.&#x2F;metricbeat modules enable mysql<br>.&#x2F;metricbeat setup â€“dashboards</p><h1 id="å®‰è£…mysql"><a href="#å®‰è£…mysql" class="headerlink" title="å®‰è£…mysql"></a>å®‰è£…mysql</h1><p>create database db_example<br>use db_example;<br>show tables;<br>select * from user</p><p>curl localhost:8080&#x2F;demo&#x2F;add -d name&#x3D;Mike -d email&#x3D;<a href="mailto:&#x6d;&#105;&#x6b;&#x65;&#x40;&#120;&#x79;&#122;&#46;&#x63;&#111;&#x6d;">&#x6d;&#105;&#x6b;&#x65;&#x40;&#120;&#x79;&#122;&#46;&#x63;&#111;&#x6d;</a> -d tags&#x3D;Elasticsearch,IntelliJ<br>curl localhost:8080&#x2F;demo&#x2F;add -d name&#x3D;Jack -d email&#x3D;<a href="mailto:&#x6a;&#97;&#x63;&#107;&#64;&#x78;&#x79;&#x7a;&#x2e;&#99;&#x6f;&#x6d;">&#x6a;&#97;&#x63;&#107;&#64;&#x78;&#x79;&#x7a;&#x2e;&#99;&#x6f;&#x6d;</a> -d tags&#x3D;Mysql,IntelliJ<br>curl localhost:8080&#x2F;demo&#x2F;add -d name&#x3D;Bob -d email&#x3D;<a href="mailto:&#98;&#x6f;&#98;&#64;&#x78;&#121;&#122;&#x2e;&#99;&#x6f;&#109;">&#98;&#x6f;&#98;&#64;&#x78;&#121;&#122;&#x2e;&#99;&#x6f;&#109;</a> -d tags&#x3D;Mysql,IntelliJ</p><p>curl â€˜localhost:8080&#x2F;demo&#x2F;allâ€™</p><h1 id="é…ç½®-packetbeat"><a href="#é…ç½®-packetbeat" class="headerlink" title="é…ç½® packetbeat"></a>é…ç½® packetbeat</h1><h1 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h1><p>ä¿®æ”¹ packetbeatï¼Œæ‰“å¼€ http 5601 9200 å’Œ mysql 3306ç›‘æ§</p><p>sudo chown root packetbeat.yml<br>sudo .&#x2F;packetbeat setup â€“dashboards<br>sudo .&#x2F;packetbeat</p><h1 id="æŸ¥çœ‹æ‰€æœ‰-Filebeat-æ¨¡å—"><a href="#æŸ¥çœ‹æ‰€æœ‰-Filebeat-æ¨¡å—" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰ Filebeat æ¨¡å—"></a>æŸ¥çœ‹æ‰€æœ‰ Filebeat æ¨¡å—</h1><h1 id="æŸ¥çœ‹æ‰€æœ‰çš„modules"><a href="#æŸ¥çœ‹æ‰€æœ‰çš„modules" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰çš„modules"></a>æŸ¥çœ‹æ‰€æœ‰çš„modules</h1><p>.&#x2F;filebeat modules list</p><h1 id="-2"><a href="#-2" class="headerlink" title=""></a></h1><p>.&#x2F;filebeat modules enable mysql</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><br><span class="hljs-meta"># 13.1-ä½¿ç”¨IndexPatterné…ç½®æ•°æ®.md</span><br><br><br></code></pre></td></tr></table></figure><p>localhost:5601&#x2F;status</p><p>PUT &#x2F;logstash-2015.05.18<br>{<br>  â€œmappingsâ€: {<br>    â€œpropertiesâ€: {<br>      â€œgeoâ€: {<br>        â€œpropertiesâ€: {<br>          â€œcoordinatesâ€: {<br>            â€œtypeâ€: â€œgeo_pointâ€<br>          }<br>        }<br>      }<br>    }<br>  }<br>}</p><p>PUT &#x2F;logstash-2015.05.19<br>{<br>  â€œmappingsâ€: {<br>    â€œpropertiesâ€: {<br>      â€œgeoâ€: {<br>        â€œpropertiesâ€: {<br>          â€œcoordinatesâ€: {<br>            â€œtypeâ€: â€œgeo_pointâ€<br>          }<br>        }<br>      }<br>    }<br>  }<br>}</p><p>PUT &#x2F;logstash-2015.05.20<br>{<br>  â€œmappingsâ€: {<br>    â€œpropertiesâ€: {<br>      â€œgeoâ€: {<br>        â€œpropertiesâ€: {<br>          â€œcoordinatesâ€: {<br>            â€œtypeâ€: â€œgeo_pointâ€<br>          }<br>        }<br>      }<br>    }<br>  }<br>}</p><h1 id="For-Mac-Windows"><a href="#For-Mac-Windows" class="headerlink" title="For Mac &amp; Windows"></a>For Mac &amp; Windows</h1><p>curl -H â€˜Content-Type: application&#x2F;x-ndjsonâ€™ -XPOST â€˜localhost:9200&#x2F;_bulk?prettyâ€™ â€“data-binary @logs.jsonl</p><p>curl -H â€˜Content-Type: application&#x2F;x-ndjsonâ€™ -XPOST â€˜localhost:9200&#x2F;bank&#x2F;account&#x2F;_bulk?prettyâ€™ â€“data-binary @accounts.json</p><p>#For Windows<br>Invoke-RestMethod â€œ<a href="http://localhost:9200/_bulk?pretty">http://localhost:9200/_bulk?pretty</a>â€œ -Method Post -ContentType â€˜application&#x2F;x-ndjsonâ€™ -InFile â€œlogs.jsonlâ€</p><p>GET &#x2F;_cat&#x2F;indices?v</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><br><span class="hljs-meta"># 13.2-ä½¿ç”¨KibanaDiscoveræ¢ç´¢æ•°æ®.md</span><br><br><span class="hljs-meta"># ä½¿ç”¨Kibana Discovery æ¢ç´¢æ•°æ®</span><br></code></pre></td></tr></table></figure><p>è®¾ç½®æ—¶é—´è¿‡æ»¤å™¨<br>æœç´¢ä½ çš„æ•°æ®<br>æ ¹æ®å­—æ®µè¿›è¡Œè¿‡æ»¤<br>æŸ¥çœ‹æ–‡æ¡£æ•°æ®<br>æŸ¥çœ‹æ–‡æ¡£ä¸Šä¸‹æ–‡<br>æš‚æ—¶å­—æ®µæ•°æ®ç»Ÿè®¡<br>Save Query</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><br><span class="hljs-meta"># 13.3-åŸºæœ¬å¯è§†åŒ–ç»„ä»¶ä»‹ç».md</span><br><br><span class="hljs-meta"># åŸºæœ¬å¯è§†åŒ–ç»„ä»¶ä»‹ç»</span><br></code></pre></td></tr></table></figure><p>PUT &#x2F;shakespeare<br>{<br>  â€œmappingsâ€: {<br>    â€œpropertiesâ€: {<br>    â€œspeakerâ€: {â€œtypeâ€: â€œkeywordâ€},<br>    â€œplay_nameâ€: {â€œtypeâ€: â€œkeywordâ€},<br>    â€œline_idâ€: {â€œtypeâ€: â€œintegerâ€},<br>    â€œspeech_numberâ€: {â€œtypeâ€: â€œintegerâ€}<br>    }<br>  }<br>}</p><h1 id="For-Mac-Windows-1"><a href="#For-Mac-Windows-1" class="headerlink" title="For Mac &amp; Windows"></a>For Mac &amp; Windows</h1><p>curl -H â€˜Content-Type: application&#x2F;x-ndjsonâ€™ -XPOST â€˜localhost:9200&#x2F;bank&#x2F;account&#x2F;_bulk?prettyâ€™ â€“data-binary @accounts.json<br>curl -H â€˜Content-Type: application&#x2F;x-ndjsonâ€™ -XPOST â€˜localhost:9200&#x2F;shakespeare&#x2F;_bulk?prettyâ€™ â€“data-binary @shakespeare.json</p><p>#For Windows<br>Invoke-RestMethod â€œ<a href="http://localhost:9200/bank/account/_bulk?pretty">http://localhost:9200/bank/account/_bulk?pretty</a>â€œ -Method Post -ContentType â€˜application&#x2F;x-ndjsonâ€™ -InFile â€œaccounts.jsonâ€<br>Invoke-RestMethod â€œ<a href="http://localhost:9200/shakespeare/_bulk?pretty">http://localhost:9200/shakespeare/_bulk?pretty</a>â€œ -Method Post -ContentType â€˜application&#x2F;x-ndjsonâ€™ -InFile â€œshakespeare.jsonâ€</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><br><span class="hljs-meta"># 13.4-æ„å»ºDashboard.md</span><br><br><span class="hljs-meta"># æ„å»ºDashboard</span><br></code></pre></td></tr></table></figure><ul><li>åˆ›å»ºä»ªè¡¨æ½˜</li><li>åŠ è½½ä»ªè¡¨ç›˜</li><li>å…±äº«ä»ªè¡¨ç›˜</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br><br><span class="hljs-comment"># 14.3ç”¨æœºå™¨å­¦ä¹ å®ç°æ—¶åºæ•°æ®çš„å¼‚å¸¸æ£€æµ‹-ä¸Š.md</span><br><br>mkdir server_metrics<br>cd server_metrics<br>wget https:<span class="hljs-regexp">//</span>download.elasticsearch.org<span class="hljs-regexp">/demos/m</span>achine_learning<span class="hljs-regexp">/gettingstarted/</span>server_metrics.tar.gz<br>tar -xvf server_metrics.tar.gz<br><br><br><span class="hljs-comment"># 14.5-ç”¨ELKè¿›è¡Œæ—¥å¿—ç®¡ç†.md</span><br><br><span class="hljs-comment"># ç”¨ ELK æ¥åšæ—¥å¿—ç®¡ç†</span><br></code></pre></td></tr></table></figure><p>.&#x2F;filebeat modules list<br>.&#x2F;filebeat modules enable system<br>.&#x2F;filebeat modules enable elasticsearch</p><h2 id="è¿›-modules-d-ç¼–è¾‘ç›¸åº”çš„æ–‡ä»¶ï¼Œä¿®æ”¹logè·¯å¾„"><a href="#è¿›-modules-d-ç¼–è¾‘ç›¸åº”çš„æ–‡ä»¶ï¼Œä¿®æ”¹logè·¯å¾„" class="headerlink" title="è¿› modules.d ç¼–è¾‘ç›¸åº”çš„æ–‡ä»¶ï¼Œä¿®æ”¹logè·¯å¾„"></a>è¿› modules.d ç¼–è¾‘ç›¸åº”çš„æ–‡ä»¶ï¼Œä¿®æ”¹logè·¯å¾„</h2><p>.&#x2F;filebeat setup â€“dashboards</p><p>.&#x2F;filebeat export template | more</p><p>.&#x2F;filebeat -e</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># 14.6-ç”¨Canvasåšæ•°æ®æ¼”ç¤º.md</span><br><br>POST elasticoffee/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0, <br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;by&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;beverage.keyword&quot;</span>,<br>        <span class="hljs-string">&quot;size&quot;</span>: 10<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># 4.1-åŸºäºè¯é¡¹å’ŒåŸºäºå…¨æ–‡çš„æœç´¢.md</span><br><br><span class="hljs-comment"># åŸºäºè¯é¡¹å’ŒåŸºäºå…¨æ–‡çš„æœç´¢</span><br><br><br></code></pre></td></tr></table></figure><p>DELETE products<br>PUT products<br>{<br>  â€œsettingsâ€: {<br>    â€œnumber_of_shardsâ€: 1<br>  }<br>}</p><p>POST &#x2F;products&#x2F;_bulk<br>{ â€œindexâ€: { â€œ_idâ€: 1 }}<br>{ â€œproductIDâ€ : â€œXHDK-A-1293-#fJ3â€,â€descâ€:â€iPhoneâ€ }<br>{ â€œindexâ€: { â€œ_idâ€: 2 }}<br>{ â€œproductIDâ€ : â€œKDKE-B-9947-#kL5â€,â€descâ€:â€iPadâ€ }<br>{ â€œindexâ€: { â€œ_idâ€: 3 }}<br>{ â€œproductIDâ€ : â€œJODL-X-1937-#pV7â€,â€descâ€:â€MBPâ€ }</p><p>GET &#x2F;products</p><p>POST &#x2F;products&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œdescâ€: {<br>        &#x2F;&#x2F;â€œvalueâ€: â€œiPhoneâ€<br>        â€œvalueâ€:â€iphoneâ€<br>      }<br>    }<br>  }<br>}</p><p>POST &#x2F;products&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œdesc.keywordâ€: {<br>        &#x2F;&#x2F;â€œvalueâ€: â€œiPhoneâ€<br>        &#x2F;&#x2F;â€œvalueâ€:â€iphoneâ€<br>      }<br>    }<br>  }<br>}</p><p>POST &#x2F;products&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œproductIDâ€: {<br>        â€œvalueâ€: â€œXHDK-A-1293-#fJ3â€<br>      }<br>    }<br>  }<br>}</p><p>POST &#x2F;products&#x2F;_search<br>{<br>  &#x2F;&#x2F;â€œexplainâ€: true,<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œproductID.keywordâ€: {<br>        â€œvalueâ€: â€œXHDK-A-1293-#fJ3â€<br>      }<br>    }<br>  }<br>}</p><p>POST &#x2F;products&#x2F;_search<br>{<br>  â€œexplainâ€: true,<br>  â€œqueryâ€: {<br>    â€œconstant_scoreâ€: {<br>      â€œfilterâ€: {<br>        â€œtermâ€: {<br>          â€œproductID.keywordâ€: â€œXHDK-A-1293-#fJ3â€<br>        }<br>      }</p><pre><code class="hljs">&#125;</code></pre><p>  }<br>}</p><p>#è®¾ç½® position_increment_gap<br>DELETE groups<br>PUT groups<br>{<br>  â€œmappingsâ€: {<br>    â€œpropertiesâ€: {<br>      â€œnamesâ€:{<br>        â€œtypeâ€: â€œtextâ€,<br>        â€œposition_increment_gapâ€: 0<br>      }<br>    }<br>  }<br>}</p><p>GET groups&#x2F;_mapping</p><p>POST groups&#x2F;_doc<br>{<br>  â€œnamesâ€: [ â€œJohn Waterâ€, â€œWater Smithâ€]<br>}</p><p>POST groups&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œmatch_phraseâ€: {<br>      â€œnamesâ€: {<br>        â€œqueryâ€: â€œWater Waterâ€,<br>        â€œslopâ€: 100<br>      }<br>    }<br>  }<br>}</p><p>POST groups&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œmatch_phraseâ€: {<br>      â€œnamesâ€: â€œWater Smithâ€<br>    }<br>  }<br>}</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ada"><br># <span class="hljs-number">4.10</span>-ç»¼åˆæ’åºï¼š<span class="hljs-keyword">Function</span> <span class="hljs-title">Score</span> Query ä¼˜åŒ–ç®—åˆ†.md<br><br># ç»¼åˆæ’åºï¼š<span class="hljs-keyword">Function</span> <span class="hljs-title">Score</span> Query ä¼˜åŒ–ç®—åˆ†<br></code></pre></td></tr></table></figure><p>DELETE blogs<br>PUT &#x2F;blogs&#x2F;_doc&#x2F;1<br>{<br>  â€œtitleâ€:   â€œAbout popularityâ€,<br>  â€œcontentâ€: â€œIn this post we will talk aboutâ€¦â€,<br>  â€œvotesâ€:   0<br>}</p><p>PUT &#x2F;blogs&#x2F;_doc&#x2F;2<br>{<br>  â€œtitleâ€:   â€œAbout popularityâ€,<br>  â€œcontentâ€: â€œIn this post we will talk aboutâ€¦â€,<br>  â€œvotesâ€:   100<br>}</p><p>PUT &#x2F;blogs&#x2F;_doc&#x2F;3<br>{<br>  â€œtitleâ€:   â€œAbout popularityâ€,<br>  â€œcontentâ€: â€œIn this post we will talk aboutâ€¦â€,<br>  â€œvotesâ€:   1000000<br>}</p><p>POST &#x2F;blogs&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œfunction_scoreâ€: {<br>      â€œqueryâ€: {<br>        â€œmulti_matchâ€: {<br>          â€œqueryâ€:    â€œpopularityâ€,<br>          â€œfieldsâ€: [ â€œtitleâ€, â€œcontentâ€ ]<br>        }<br>      },<br>      â€œfield_value_factorâ€: {<br>        â€œfieldâ€: â€œvotesâ€<br>      }<br>    }<br>  }<br>}</p><p>POST &#x2F;blogs&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œfunction_scoreâ€: {<br>      â€œqueryâ€: {<br>        â€œmulti_matchâ€: {<br>          â€œqueryâ€:    â€œpopularityâ€,<br>          â€œfieldsâ€: [ â€œtitleâ€, â€œcontentâ€ ]<br>        }<br>      },<br>      â€œfield_value_factorâ€: {<br>        â€œfieldâ€: â€œvotesâ€,<br>        â€œmodifierâ€: â€œlog1pâ€<br>      }<br>    }<br>  }<br>}</p><p>POST &#x2F;blogs&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œfunction_scoreâ€: {<br>      â€œqueryâ€: {<br>        â€œmulti_matchâ€: {<br>          â€œqueryâ€:    â€œpopularityâ€,<br>          â€œfieldsâ€: [ â€œtitleâ€, â€œcontentâ€ ]<br>        }<br>      },<br>      â€œfield_value_factorâ€: {<br>        â€œfieldâ€: â€œvotesâ€,<br>        â€œmodifierâ€: â€œlog1pâ€ ,<br>        â€œfactorâ€: 0.1<br>      }<br>    }<br>  }<br>}</p><p>POST &#x2F;blogs&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œfunction_scoreâ€: {<br>      â€œqueryâ€: {<br>        â€œmulti_matchâ€: {<br>          â€œqueryâ€:    â€œpopularityâ€,<br>          â€œfieldsâ€: [ â€œtitleâ€, â€œcontentâ€ ]<br>        }<br>      },<br>      â€œfield_value_factorâ€: {<br>        â€œfieldâ€: â€œvotesâ€,<br>        â€œmodifierâ€: â€œlog1pâ€ ,<br>        â€œfactorâ€: 0.1<br>      },<br>      â€œboost_modeâ€: â€œsumâ€,<br>      â€œmax_boostâ€: 3<br>    }<br>  }<br>}</p><p>POST &#x2F;blogs&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œfunction_scoreâ€: {<br>      â€œrandom_scoreâ€: {<br>        â€œseedâ€: 911119<br>      }<br>    }<br>  }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># 4.12-è‡ªåŠ¨è¡¥å…¨ä¸åŸºäºä¸Šä¸‹æ–‡çš„æç¤º.md</span><br><br><span class="hljs-meta"># è‡ªåŠ¨è¡¥å…¨ä¸åŸºäºä¸Šä¸‹æ–‡çš„æç¤º</span><br></code></pre></td></tr></table></figure><p>DELETE articles<br>PUT articles<br>{<br>  â€œmappingsâ€: {<br>    â€œpropertiesâ€: {<br>      â€œtitle_completionâ€:{<br>        â€œtypeâ€: â€œcompletionâ€<br>      }<br>    }<br>  }<br>}</p><p>POST articles&#x2F;_bulk<br>{ â€œindexâ€ : { } }<br>{ â€œtitle_completionâ€: â€œlucene is very coolâ€}<br>{ â€œindexâ€ : { } }<br>{ â€œtitle_completionâ€: â€œElasticsearch builds on top of luceneâ€}<br>{ â€œindexâ€ : { } }<br>{ â€œtitle_completionâ€: â€œElasticsearch rocksâ€}<br>{ â€œindexâ€ : { } }<br>{ â€œtitle_completionâ€: â€œelastic is the company behind ELK stackâ€}<br>{ â€œindexâ€ : { } }<br>{ â€œtitle_completionâ€: â€œElk stack rocksâ€}<br>{ â€œindexâ€ : {} }</p><p>POST articles&#x2F;_search?pretty<br>{<br>  â€œsizeâ€: 0,<br>  â€œsuggestâ€: {<br>    â€œarticle-suggesterâ€: {<br>      â€œprefixâ€: â€œelk â€œ,<br>      â€œcompletionâ€: {<br>        â€œfieldâ€: â€œtitle_completionâ€<br>      }<br>    }<br>  }<br>}</p><p>DELETE comments<br>PUT comments<br>PUT comments&#x2F;_mapping<br>{<br>  â€œpropertiesâ€: {<br>    â€œcomment_autocompleteâ€:{<br>      â€œtypeâ€: â€œcompletionâ€,<br>      â€œcontextsâ€:[{<br>        â€œtypeâ€:â€categoryâ€,<br>        â€œnameâ€:â€comment_categoryâ€<br>      }]<br>    }<br>  }<br>}</p><p>POST comments&#x2F;_doc<br>{<br>  â€œcommentâ€:â€I love the star war moviesâ€,<br>  â€œcomment_autocompleteâ€:{<br>    â€œinputâ€:[â€œstar warsâ€],<br>    â€œcontextsâ€:{<br>      â€œcomment_categoryâ€:â€moviesâ€<br>    }<br>  }<br>}</p><p>POST comments&#x2F;_doc<br>{<br>  â€œcommentâ€:â€Where can I find a Starbucksâ€,<br>  â€œcomment_autocompleteâ€:{<br>    â€œinputâ€:[â€œstarbucksâ€],<br>    â€œcontextsâ€:{<br>      â€œcomment_categoryâ€:â€coffeeâ€<br>    }<br>  }<br>}</p><p>POST comments&#x2F;_search<br>{<br>  â€œsuggestâ€: {<br>    â€œMY_SUGGESTIONâ€: {<br>      â€œprefixâ€: â€œstaâ€,<br>      â€œcompletionâ€:{<br>        â€œfieldâ€:â€comment_autocompleteâ€,<br>        â€œcontextsâ€:{<br>          â€œcomment_categoryâ€:â€coffeeâ€<br>        }<br>      }<br>    }<br>  }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><br><span class="hljs-meta"># 4.13-è·¨é›†ç¾¤æœç´¢.md</span><br><br><span class="hljs-meta"># è·¨é›†ç¾¤æœç´¢</span><br></code></pre></td></tr></table></figure><p>&#x2F;&#x2F;å¯åŠ¨3ä¸ªé›†ç¾¤</p><p>bin&#x2F;elasticsearch -E node.name&#x3D;cluster0node -E cluster.name&#x3D;cluster0 -E path.data&#x3D;cluster0_data -E discovery.type&#x3D;single-node -E http.port&#x3D;9200 -E transport.port&#x3D;9300<br>bin&#x2F;elasticsearch -E node.name&#x3D;cluster1node -E cluster.name&#x3D;cluster1 -E path.data&#x3D;cluster1_data -E discovery.type&#x3D;single-node -E http.port&#x3D;9201 -E transport.port&#x3D;9301<br>bin&#x2F;elasticsearch -E node.name&#x3D;cluster2node -E cluster.name&#x3D;cluster2 -E path.data&#x3D;cluster2_data -E discovery.type&#x3D;single-node -E http.port&#x3D;9202 -E transport.port&#x3D;9302</p><p>&#x2F;&#x2F;åœ¨æ¯ä¸ªé›†ç¾¤ä¸Šè®¾ç½®åŠ¨æ€çš„è®¾ç½®<br>PUT _cluster&#x2F;settings<br>{<br>  â€œpersistentâ€: {<br>    â€œclusterâ€: {<br>      â€œremoteâ€: {<br>        â€œcluster0â€: {<br>          â€œseedsâ€: [<br>            â€œ127.0.0.1:9300â€<br>          ],<br>          â€œtransport.ping_scheduleâ€: â€œ30sâ€<br>        },<br>        â€œcluster1â€: {<br>          â€œseedsâ€: [<br>            â€œ127.0.0.1:9301â€<br>          ],<br>          â€œtransport.compressâ€: true,<br>          â€œskip_unavailableâ€: true<br>        },<br>        â€œcluster2â€: {<br>          â€œseedsâ€: [<br>            â€œ127.0.0.1:9302â€<br>          ]<br>        }<br>      }<br>    }<br>  }<br>}</p><p>#cURL<br>curl -XPUT â€œ<a href="http://localhost:9200/_cluster/settings">http://localhost:9200/_cluster/settings</a>â€œ -H â€˜Content-Type: application&#x2F;jsonâ€™ -dâ€™<br>{â€œpersistentâ€:{â€œclusterâ€:{â€œremoteâ€:{â€œcluster0â€:{â€œseedsâ€:[â€œ127.0.0.1:9300â€],â€transport.ping_scheduleâ€:â€30sâ€},â€cluster1â€:{â€œseedsâ€:[â€œ127.0.0.1:9301â€],â€transport.compressâ€:true,â€skip_unavailableâ€:true},â€cluster2â€:{â€œseedsâ€:[â€œ127.0.0.1:9302â€]}}}}}â€™</p><p>curl -XPUT â€œ<a href="http://localhost:9201/_cluster/settings">http://localhost:9201/_cluster/settings</a>â€œ -H â€˜Content-Type: application&#x2F;jsonâ€™ -dâ€™<br>{â€œpersistentâ€:{â€œclusterâ€:{â€œremoteâ€:{â€œcluster0â€:{â€œseedsâ€:[â€œ127.0.0.1:9300â€],â€transport.ping_scheduleâ€:â€30sâ€},â€cluster1â€:{â€œseedsâ€:[â€œ127.0.0.1:9301â€],â€transport.compressâ€:true,â€skip_unavailableâ€:true},â€cluster2â€:{â€œseedsâ€:[â€œ127.0.0.1:9302â€]}}}}}â€™</p><p>curl -XPUT â€œ<a href="http://localhost:9202/_cluster/settings">http://localhost:9202/_cluster/settings</a>â€œ -H â€˜Content-Type: application&#x2F;jsonâ€™ -dâ€™<br>{â€œpersistentâ€:{â€œclusterâ€:{â€œremoteâ€:{â€œcluster0â€:{â€œseedsâ€:[â€œ127.0.0.1:9300â€],â€transport.ping_scheduleâ€:â€30sâ€},â€cluster1â€:{â€œseedsâ€:[â€œ127.0.0.1:9301â€],â€transport.compressâ€:true,â€skip_unavailableâ€:true},â€cluster2â€:{â€œseedsâ€:[â€œ127.0.0.1:9302â€]}}}}}â€™</p><p>#åˆ›å»ºæµ‹è¯•æ•°æ®<br>curl -XPOST â€œ<a href="http://localhost:9200/users/_doc">http://localhost:9200/users/_doc</a>â€œ -H â€˜Content-Type: application&#x2F;jsonâ€™ -dâ€™<br>{â€œnameâ€:â€user1â€,â€ageâ€:10}â€™</p><p>curl -XPOST â€œ<a href="http://localhost:9201/users/_doc">http://localhost:9201/users/_doc</a>â€œ -H â€˜Content-Type: application&#x2F;jsonâ€™ -dâ€™<br>{â€œnameâ€:â€user2â€,â€ageâ€:20}â€™</p><p>curl -XPOST â€œ<a href="http://localhost:9202/users/_doc">http://localhost:9202/users/_doc</a>â€œ -H â€˜Content-Type: application&#x2F;jsonâ€™ -dâ€™<br>{â€œnameâ€:â€user3â€,â€ageâ€:30}â€™</p><p>#æŸ¥è¯¢<br>GET &#x2F;users,cluster1:users,cluster2:users&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œrangeâ€: {<br>      â€œageâ€: {<br>        â€œgteâ€: 20,<br>        â€œlteâ€: 40<br>      }<br>    }<br>  }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><br><span class="hljs-meta"># 4.2-ç»“æ„åŒ–æœç´¢.md</span><br><br><span class="hljs-meta"># ç»“æ„åŒ–æœç´¢</span><br><br></code></pre></td></tr></table></figure><p>#ç»“æ„åŒ–æœç´¢ï¼Œç²¾ç¡®åŒ¹é…<br>DELETE products<br>POST &#x2F;products&#x2F;_bulk<br>{ â€œindexâ€: { â€œ_idâ€: 1 }}<br>{ â€œpriceâ€ : 10,â€avaliableâ€:true,â€dateâ€:â€2018-01-01â€, â€œproductIDâ€ : â€œXHDK-A-1293-#fJ3â€ }<br>{ â€œindexâ€: { â€œ_idâ€: 2 }}<br>{ â€œpriceâ€ : 20,â€avaliableâ€:true,â€dateâ€:â€2019-01-01â€, â€œproductIDâ€ : â€œKDKE-B-9947-#kL5â€ }<br>{ â€œindexâ€: { â€œ_idâ€: 3 }}<br>{ â€œpriceâ€ : 30,â€avaliableâ€:true, â€œproductIDâ€ : â€œJODL-X-1937-#pV7â€ }<br>{ â€œindexâ€: { â€œ_idâ€: 4 }}<br>{ â€œpriceâ€ : 30,â€avaliableâ€:false, â€œproductIDâ€ : â€œQQPX-R-3956-#aD8â€ }</p><p>GET products&#x2F;_mapping</p><p>#å¯¹å¸ƒå°”å€¼ match æŸ¥è¯¢ï¼Œæœ‰ç®—åˆ†<br>POST products&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œexplainâ€: true,<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œavaliableâ€: true<br>    }<br>  }<br>}</p><p>#å¯¹å¸ƒå°”å€¼ï¼Œé€šè¿‡constant score è½¬æˆ filteringï¼Œæ²¡æœ‰ç®—åˆ†<br>POST products&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œexplainâ€: true,<br>  â€œqueryâ€: {<br>    â€œconstant_scoreâ€: {<br>      â€œfilterâ€: {<br>        â€œtermâ€: {<br>          â€œavaliableâ€: true<br>        }<br>      }<br>    }<br>  }<br>}</p><p>#æ•°å­—ç±»å‹ Term<br>POST products&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œexplainâ€: true,<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œpriceâ€: 30<br>    }<br>  }<br>}</p><p>#æ•°å­—ç±»å‹ terms<br>POST products&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œconstant_scoreâ€: {<br>      â€œfilterâ€: {<br>        â€œtermsâ€: {<br>          â€œpriceâ€: [<br>            â€œ20â€,<br>            â€œ30â€<br>          ]<br>        }<br>      }<br>    }<br>  }<br>}</p><p>#æ•°å­— Range æŸ¥è¯¢<br>GET products&#x2F;_search<br>{<br>    â€œqueryâ€ : {<br>        â€œconstant_scoreâ€ : {<br>            â€œfilterâ€ : {<br>                â€œrangeâ€ : {<br>                    â€œpriceâ€ : {<br>                        â€œgteâ€ : 20,<br>                        â€œlteâ€  : 30<br>                    }<br>                }<br>            }<br>        }<br>    }<br>}</p><h1 id="æ—¥æœŸ-range"><a href="#æ—¥æœŸ-range" class="headerlink" title="æ—¥æœŸ range"></a>æ—¥æœŸ range</h1><p>POST products&#x2F;_search<br>{<br>    â€œqueryâ€ : {<br>        â€œconstant_scoreâ€ : {<br>            â€œfilterâ€ : {<br>                â€œrangeâ€ : {<br>                    â€œdateâ€ : {<br>                      â€œgteâ€ : â€œnow-1yâ€<br>                    }<br>                }<br>            }<br>        }<br>    }<br>}</p><p>#existsæŸ¥è¯¢<br>POST products&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œconstant_scoreâ€: {<br>      â€œfilterâ€: {<br>        â€œexistsâ€: {<br>          â€œfieldâ€: â€œdateâ€<br>        }<br>      }<br>    }<br>  }<br>}</p><p>#å¤„ç†å¤šå€¼å­—æ®µ<br>POST &#x2F;movies&#x2F;_bulk<br>{ â€œindexâ€: { â€œ_idâ€: 1 }}<br>{ â€œtitleâ€ : â€œFather of the Bridge Part IIâ€,â€yearâ€:1995, â€œgenreâ€:â€Comedyâ€}<br>{ â€œindexâ€: { â€œ_idâ€: 2 }}<br>{ â€œtitleâ€ : â€œDaveâ€,â€yearâ€:1993,â€genreâ€:[â€œComedyâ€,â€Romanceâ€] }</p><p>#å¤„ç†å¤šå€¼å­—æ®µï¼Œterm æŸ¥è¯¢æ˜¯åŒ…å«ï¼Œè€Œä¸æ˜¯ç­‰äº<br>POST movies&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œconstant_scoreâ€: {<br>      â€œfilterâ€: {<br>        â€œtermâ€: {<br>          â€œgenre.keywordâ€: â€œComedyâ€<br>        }<br>      }<br>    }<br>  }<br>}</p><p>#å­—ç¬¦ç±»å‹ terms<br>POST products&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œconstant_scoreâ€: {<br>      â€œfilterâ€: {<br>        â€œtermsâ€: {<br>          â€œproductID.keywordâ€: [<br>            â€œQQPX-R-3956-#aD8â€,<br>            â€œJODL-X-1937-#pV7â€<br>          ]<br>        }<br>      }<br>    }<br>  }<br>}</p><p>POST products&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œexplainâ€: true,<br>  â€œqueryâ€: {<br>    â€œmatchâ€: {<br>      â€œpriceâ€: 30<br>    }<br>  }<br>}</p><p>POST products&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œexplainâ€: true,<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œdateâ€: â€œ2019-01-01â€<br>    }<br>  }<br>}</p><p>POST products&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œexplainâ€: true,<br>  â€œqueryâ€: {<br>    â€œmatchâ€: {<br>      â€œdateâ€: â€œ2019-01-01â€<br>    }<br>  }<br>}</p><p>POST products&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œexplainâ€: true,<br>  â€œqueryâ€: {<br>    â€œconstant_scoreâ€: {<br>      â€œfilterâ€: {<br>        â€œtermâ€: {<br>          â€œproductID.keywordâ€: â€œXHDK-A-1293-#fJ3â€<br>        }<br>      }<br>    }<br>  }<br>}</p><p>POST products&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œexplainâ€: true,<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œproductID.keywordâ€: â€œXHDK-A-1293-#fJ3â€<br>    }<br>  }<br>}</p><p>#å¯¹å¸ƒå°”æ•°å€¼<br>POST products&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œconstant_scoreâ€: {<br>      â€œfilterâ€: {<br>        â€œtermâ€: {<br>          â€œavaliableâ€: â€œfalseâ€<br>        }<br>      }<br>    }<br>  }<br>}</p><p>POST products&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œavaliableâ€: {<br>        â€œvalueâ€: â€œfalseâ€<br>      }<br>    }<br>  }<br>}</p><p>POST products&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œexplainâ€: true,<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œpriceâ€: {<br>        â€œvalueâ€: â€œ20â€<br>      }<br>    }<br>  }<br>}</p><p>POST products&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œexplainâ€: true,<br>  â€œqueryâ€: {<br>    â€œmatchâ€: {<br>      â€œpriceâ€: â€œ20â€<br>    }<br>    }<br>  }<br>}</p><p>POST products&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œconstant_scoreâ€: {<br>      â€œfilterâ€: {<br>        â€œboolâ€: {<br>          â€œmust_notâ€: {<br>            â€œexistsâ€: {<br>              â€œfieldâ€: â€œdateâ€<br>            }<br>          }<br>        }<br>      }<br>    }<br>  }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># 4.3-æœç´¢çš„ç›¸å…³æ€§ç®—åˆ†.md</span><br><br><span class="hljs-meta"># æœç´¢çš„ç›¸å…³æ€§ç®—åˆ†</span><br><br></code></pre></td></tr></table></figure><p>PUT testscore<br>{<br>  â€œsettingsâ€: {<br>    â€œnumber_of_shardsâ€: 1<br>  },<br>  â€œmappingsâ€: {<br>    â€œpropertiesâ€: {<br>      â€œcontentâ€: {<br>        â€œtypeâ€: â€œtextâ€<br>      }<br>    }<br>  }<br>}</p><p>PUT testscore&#x2F;_bulk<br>{ â€œindexâ€: { â€œ_idâ€: 1 }}<br>{ â€œcontentâ€:â€we use Elasticsearch to power the searchâ€ }<br>{ â€œindexâ€: { â€œ_idâ€: 2 }}<br>{ â€œcontentâ€:â€we like elasticsearchâ€ }<br>{ â€œindexâ€: { â€œ_idâ€: 3 }}<br>{ â€œcontentâ€:â€The scoring of documents is caculated by the scoring formulaâ€ }<br>{ â€œindexâ€: { â€œ_idâ€: 4 }}<br>{ â€œcontentâ€:â€you know, for searchâ€ }</p><p>POST &#x2F;testscore&#x2F;_search<br>{<br>  &#x2F;&#x2F;â€œexplainâ€: true,<br>  â€œqueryâ€: {<br>    â€œmatchâ€: {<br>      â€œcontentâ€:â€youâ€<br>      &#x2F;&#x2F;â€œcontentâ€: â€œelasticsearchâ€<br>      &#x2F;&#x2F;â€œcontentâ€:â€theâ€<br>      &#x2F;&#x2F;â€œcontentâ€: â€œthe elasticsearchâ€<br>    }<br>  }<br>}</p><p>POST testscore&#x2F;_search<br>{<br>    â€œqueryâ€: {<br>        â€œboostingâ€ : {<br>            â€œpositiveâ€ : {<br>                â€œtermâ€ : {<br>                    â€œcontentâ€ : â€œelasticsearchâ€<br>                }<br>            },<br>            â€œnegativeâ€ : {<br>                 â€œtermâ€ : {<br>                     â€œcontentâ€ : â€œlikeâ€<br>                }<br>            },<br>            â€œnegative_boostâ€ : 0.2<br>        }<br>    }<br>}</p><p>POST tmdb&#x2F;_search<br>{<br>  â€œ_sourceâ€: [â€œtitleâ€,â€overviewâ€],<br>  â€œqueryâ€: {<br>    â€œmore_like_thisâ€: {<br>      â€œfieldsâ€: [<br>        â€œtitle^10â€,â€overviewâ€<br>      ],<br>      â€œlikeâ€: [{â€œ_idâ€:â€14191â€}],<br>      â€œmin_term_freqâ€: 1,<br>      â€œmax_query_termsâ€: 12<br>    }<br>  }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><br><span class="hljs-meta"># 4.4-Query&amp;Filteringå®ç°å¤šå­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢.md</span><br><br><span class="hljs-meta"># Query &amp; Filtering ä¸å¤šå­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢</span><br><br></code></pre></td></tr></table></figure><p>POST &#x2F;products&#x2F;_bulk<br>{ â€œindexâ€: { â€œ_idâ€: 1 }}<br>{ â€œpriceâ€ : 10,â€avaliableâ€:true,â€dateâ€:â€2018-01-01â€, â€œproductIDâ€ : â€œXHDK-A-1293-#fJ3â€ }<br>{ â€œindexâ€: { â€œ_idâ€: 2 }}<br>{ â€œpriceâ€ : 20,â€avaliableâ€:true,â€dateâ€:â€2019-01-01â€, â€œproductIDâ€ : â€œKDKE-B-9947-#kL5â€ }<br>{ â€œindexâ€: { â€œ_idâ€: 3 }}<br>{ â€œpriceâ€ : 30,â€avaliableâ€:true, â€œproductIDâ€ : â€œJODL-X-1937-#pV7â€ }<br>{ â€œindexâ€: { â€œ_idâ€: 4 }}<br>{ â€œpriceâ€ : 30,â€avaliableâ€:false, â€œproductIDâ€ : â€œQQPX-R-3956-#aD8â€ }</p><p>#åŸºæœ¬è¯­æ³•<br>POST &#x2F;products&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€ : {<br>      â€œmustâ€ : {<br>        â€œtermâ€ : { â€œpriceâ€ : â€œ30â€ }<br>      },<br>      â€œfilterâ€: {<br>        â€œtermâ€ : { â€œavaliableâ€ : â€œtrueâ€ }<br>      },<br>      â€œmust_notâ€ : {<br>        â€œrangeâ€ : {<br>          â€œpriceâ€ : { â€œlteâ€ : 10 }<br>        }<br>      },<br>      â€œshouldâ€ : [<br>        { â€œtermâ€ : { â€œproductID.keywordâ€ : â€œJODL-X-1937-#pV7â€ } },<br>        { â€œtermâ€ : { â€œproductID.keywordâ€ : â€œXHDK-A-1293-#fJ3â€ } }<br>      ],<br>      â€œminimum_should_matchâ€ :1<br>    }<br>  }<br>}</p><p>#æ”¹å˜æ•°æ®æ¨¡å‹ï¼Œå¢åŠ å­—æ®µã€‚è§£å†³æ•°ç»„åŒ…å«è€Œä¸æ˜¯ç²¾ç¡®åŒ¹é…çš„é—®é¢˜<br>POST &#x2F;newmovies&#x2F;_bulk<br>{ â€œindexâ€: { â€œ_idâ€: 1 }}<br>{ â€œtitleâ€ : â€œFather of the Bridge Part IIâ€,â€yearâ€:1995, â€œgenreâ€:â€Comedyâ€,â€genre_countâ€:1 }<br>{ â€œindexâ€: { â€œ_idâ€: 2 }}<br>{ â€œtitleâ€ : â€œDaveâ€,â€yearâ€:1993,â€genreâ€:[â€œComedyâ€,â€Romanceâ€],â€genre_countâ€:2 }</p><p>#mustï¼Œæœ‰ç®—åˆ†<br>POST &#x2F;newmovies&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€: {<br>      â€œmustâ€: [<br>        {â€œtermâ€: {â€œgenre.keywordâ€: {â€œvalueâ€: â€œComedyâ€}}},<br>        {â€œtermâ€: {â€œgenre_countâ€: {â€œvalueâ€: 1}}}</p><pre><code class="hljs">  ]&#125;</code></pre><p>  }<br>}</p><p>#Filterã€‚ä¸å‚ä¸ç®—åˆ†ï¼Œç»“æœçš„scoreæ˜¯0<br>POST &#x2F;newmovies&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€: {<br>      â€œfilterâ€: [<br>        {â€œtermâ€: {â€œgenre.keywordâ€: {â€œvalueâ€: â€œComedyâ€}}},<br>        {â€œtermâ€: {â€œgenre_countâ€: {â€œvalueâ€: 1}}}<br>        ]</p><pre><code class="hljs">&#125;</code></pre><p>  }<br>}</p><p>#Filtering Context<br>POST _search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€ : {</p><pre><code class="hljs">  &quot;filter&quot;: &#123;    &quot;term&quot; : &#123; &quot;avaliable&quot; : &quot;true&quot; &#125;  &#125;,  &quot;must_not&quot; : &#123;    &quot;range&quot; : &#123;      &quot;price&quot; : &#123; &quot;lte&quot; : 10 &#125;    &#125;  &#125;&#125;</code></pre><p>  }<br>}</p><p>#Query Context<br>POST &#x2F;products&#x2F;_bulk<br>{ â€œindexâ€: { â€œ_idâ€: 1 }}<br>{ â€œpriceâ€ : 10,â€avaliableâ€:true,â€dateâ€:â€2018-01-01â€, â€œproductIDâ€ : â€œXHDK-A-1293-#fJ3â€ }<br>{ â€œindexâ€: { â€œ_idâ€: 2 }}<br>{ â€œpriceâ€ : 20,â€avaliableâ€:true,â€dateâ€:â€2019-01-01â€, â€œproductIDâ€ : â€œKDKE-B-9947-#kL5â€ }<br>{ â€œindexâ€: { â€œ_idâ€: 3 }}<br>{ â€œpriceâ€ : 30,â€avaliableâ€:true, â€œproductIDâ€ : â€œJODL-X-1937-#pV7â€ }<br>{ â€œindexâ€: { â€œ_idâ€: 4 }}<br>{ â€œpriceâ€ : 30,â€avaliableâ€:false, â€œproductIDâ€ : â€œQQPX-R-3956-#aD8â€ }</p><p>POST &#x2F;products&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€: {<br>      â€œshouldâ€: [<br>        {<br>          â€œtermâ€: {<br>            â€œproductID.keywordâ€: {<br>              â€œvalueâ€: â€œJODL-X-1937-#pV7â€}}<br>        },<br>        {â€œtermâ€: {â€œavaliableâ€: {â€œvalueâ€: true}}<br>        }<br>      ]<br>    }<br>  }<br>}</p><p>#åµŒå¥—ï¼Œå®ç°äº† should not é€»è¾‘<br>POST &#x2F;products&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€: {<br>      â€œmustâ€: {<br>        â€œtermâ€: {<br>          â€œpriceâ€: â€œ30â€<br>        }<br>      },<br>      â€œshouldâ€: [<br>        {<br>          â€œboolâ€: {<br>            â€œmust_notâ€: {<br>              â€œtermâ€: {<br>                â€œavaliableâ€: â€œfalseâ€<br>              }<br>            }<br>          }<br>        }<br>      ],<br>      â€œminimum_should_matchâ€: 1<br>    }<br>  }<br>}</p><p>#Controll the Precision<br>POST _search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€ : {<br>      â€œmustâ€ : {<br>        â€œtermâ€ : { â€œpriceâ€ : â€œ30â€ }<br>      },<br>      â€œfilterâ€: {<br>        â€œtermâ€ : { â€œavaliableâ€ : â€œtrueâ€ }<br>      },<br>      â€œmust_notâ€ : {<br>        â€œrangeâ€ : {<br>          â€œpriceâ€ : { â€œlteâ€ : 10 }<br>        }<br>      },<br>      â€œshouldâ€ : [<br>        { â€œtermâ€ : { â€œproductID.keywordâ€ : â€œJODL-X-1937-#pV7â€ } },<br>        { â€œtermâ€ : { â€œproductID.keywordâ€ : â€œXHDK-A-1293-#fJ3â€ } }<br>      ],<br>      â€œminimum_should_matchâ€ :2<br>    }<br>  }<br>}</p><p>POST &#x2F;animals&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€: {<br>      â€œshouldâ€: [<br>        { â€œtermâ€: { â€œtextâ€: â€œbrownâ€ }},<br>        { â€œtermâ€: { â€œtextâ€: â€œredâ€ }},<br>        { â€œtermâ€: { â€œtextâ€: â€œquickâ€   }},<br>        { â€œtermâ€: { â€œtextâ€: â€œdogâ€   }}<br>      ]<br>    }<br>  }<br>}</p><p>POST &#x2F;animals&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€: {<br>      â€œshouldâ€: [<br>        { â€œtermâ€: { â€œtextâ€: â€œquickâ€ }},<br>        { â€œtermâ€: { â€œtextâ€: â€œdogâ€   }},<br>        {<br>          â€œboolâ€:{<br>            â€œshouldâ€:[<br>               { â€œtermâ€: { â€œtextâ€: â€œbrownâ€ }},<br>                 { â€œtermâ€: { â€œtextâ€: â€œbrownâ€ }},<br>            ]<br>          }</p><pre><code class="hljs">    &#125;  ]&#125;</code></pre><p>  }<br>}</p><p>DELETE blogs<br>POST &#x2F;blogs&#x2F;_bulk<br>{ â€œindexâ€: { â€œ_idâ€: 1 }}<br>{â€œtitleâ€:â€Apple iPadâ€, â€œcontentâ€:â€Apple iPad,Apple iPadâ€ }<br>{ â€œindexâ€: { â€œ_idâ€: 2 }}<br>{â€œtitleâ€:â€Apple iPad,Apple iPadâ€, â€œcontentâ€:â€Apple iPadâ€ }</p><p>POST blogs&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€: {<br>      â€œshouldâ€: [<br>        {â€œmatchâ€: {<br>          â€œtitleâ€: {<br>            â€œqueryâ€: â€œapple,ipadâ€,<br>            â€œboostâ€: 1.1<br>          }<br>        }},</p><pre><code class="hljs">    &#123;&quot;match&quot;: &#123;      &quot;content&quot;: &#123;        &quot;query&quot;: &quot;apple,ipad&quot;,        &quot;boost&quot;:      &#125;    &#125;&#125;  ]&#125;</code></pre><p>  }<br>}</p><p>DELETE news<br>POST &#x2F;news&#x2F;_bulk<br>{ â€œindexâ€: { â€œ_idâ€: 1 }}<br>{ â€œcontentâ€:â€Apple Macâ€ }<br>{ â€œindexâ€: { â€œ_idâ€: 2 }}<br>{ â€œcontentâ€:â€Apple iPadâ€ }<br>{ â€œindexâ€: { â€œ_idâ€: 3 }}<br>{ â€œcontentâ€:â€Apple employee like Apple Pie and Apple Juiceâ€ }</p><p>POST news&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€: {<br>      â€œmustâ€: {<br>        â€œmatchâ€:{â€œcontentâ€:â€appleâ€}<br>      }<br>    }<br>  }<br>}</p><p>POST news&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€: {<br>      â€œmustâ€: {<br>        â€œmatchâ€:{â€œcontentâ€:â€appleâ€}<br>      },<br>      â€œmust_notâ€: {<br>        â€œmatchâ€:{â€œcontentâ€:â€pieâ€}<br>      }<br>    }<br>  }<br>}</p><p>POST news&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œboostingâ€: {<br>      â€œpositiveâ€: {<br>        â€œmatchâ€: {<br>          â€œcontentâ€: â€œappleâ€<br>        }<br>      },<br>      â€œnegativeâ€: {<br>        â€œmatchâ€: {<br>          â€œcontentâ€: â€œpieâ€<br>        }<br>      },<br>      â€œnegative_boostâ€: 0.5<br>    }<br>  }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><span class="hljs-meta"># 4.5-å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢-DisMaxQuery.md</span><br><br><span class="hljs-meta"># å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢ï¼šDis Max Query</span><br></code></pre></td></tr></table></figure><p>PUT &#x2F;blogs&#x2F;_doc&#x2F;1<br>{<br>    â€œtitleâ€: â€œQuick brown rabbitsâ€,<br>    â€œbodyâ€:  â€œBrown rabbits are commonly seen.â€<br>}</p><p>PUT &#x2F;blogs&#x2F;_doc&#x2F;2<br>{<br>    â€œtitleâ€: â€œKeeping pets healthyâ€,<br>    â€œbodyâ€:  â€œMy quick brown fox eats rabbits on a regular basis.â€<br>}</p><p>POST &#x2F;blogs&#x2F;_search<br>{<br>    â€œqueryâ€: {<br>        â€œboolâ€: {<br>            â€œshouldâ€: [<br>                { â€œmatchâ€: { â€œtitleâ€: â€œBrown foxâ€ }},<br>                { â€œmatchâ€: { â€œbodyâ€:  â€œBrown foxâ€ }}<br>            ]<br>        }<br>    }<br>}</p><p>POST blogs&#x2F;_search<br>{<br>    â€œqueryâ€: {<br>        â€œdis_maxâ€: {<br>            â€œqueriesâ€: [<br>                { â€œmatchâ€: { â€œtitleâ€: â€œQuick petsâ€ }},<br>                { â€œmatchâ€: { â€œbodyâ€:  â€œQuick petsâ€ }}<br>            ]<br>        }<br>    }<br>}</p><p>POST blogs&#x2F;_search<br>{<br>    â€œqueryâ€: {<br>        â€œdis_maxâ€: {<br>            â€œqueriesâ€: [<br>                { â€œmatchâ€: { â€œtitleâ€: â€œQuick petsâ€ }},<br>                { â€œmatchâ€: { â€œbodyâ€:  â€œQuick petsâ€ }}<br>            ],<br>            â€œtie_breakerâ€: 0.2<br>        }<br>    }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># 4.6-å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢-Multi-Match.md</span><br><br><span class="hljs-meta"># å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢ï¼šMulti Match</span><br></code></pre></td></tr></table></figure><p>POST blogs&#x2F;_search<br>{<br>    â€œqueryâ€: {<br>        â€œdis_maxâ€: {<br>            â€œqueriesâ€: [<br>                { â€œmatchâ€: { â€œtitleâ€: â€œQuick petsâ€ }},<br>                { â€œmatchâ€: { â€œbodyâ€:  â€œQuick petsâ€ }}<br>            ],<br>            â€œtie_breakerâ€: 0.2<br>        }<br>    }<br>}</p><p>POST blogs&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œmulti_matchâ€: {<br>      â€œtypeâ€: â€œbest_fieldsâ€,<br>      â€œqueryâ€: â€œQuick petsâ€,<br>      â€œfieldsâ€: [â€œtitleâ€,â€bodyâ€],<br>      â€œtie_breakerâ€: 0.2,<br>      â€œminimum_should_matchâ€: â€œ20%â€<br>    }<br>  }<br>}</p><p>POST books&#x2F;_search<br>{<br>    â€œmulti_matchâ€: {<br>        â€œqueryâ€:  â€œQuick brown foxâ€,<br>        â€œfieldsâ€: â€œ*_titleâ€<br>    }<br>}</p><p>POST books&#x2F;_search<br>{<br>    â€œmulti_matchâ€: {<br>        â€œqueryâ€:  â€œQuick brown foxâ€,<br>        â€œfieldsâ€: [ â€œ*_titleâ€, â€œchapter_title^2â€ ]<br>    }<br>}</p><p>DELETE &#x2F;titles<br>PUT &#x2F;titles<br>{<br>    â€œsettingsâ€: { â€œnumber_of_shardsâ€: 1 },<br>    â€œmappingsâ€: {<br>        â€œmy_typeâ€: {<br>            â€œpropertiesâ€: {<br>                â€œtitleâ€: {<br>                    â€œtypeâ€:     â€œstringâ€,<br>                    â€œanalyzerâ€: â€œenglishâ€,<br>                    â€œfieldsâ€: {<br>                        â€œstdâ€:   {<br>                            â€œtypeâ€:     â€œstringâ€,<br>                            â€œanalyzerâ€: â€œstandardâ€<br>                        }<br>                    }<br>                }<br>            }<br>        }<br>    }<br>}</p><p>PUT &#x2F;titles<br>{<br>  â€œmappingsâ€: {<br>    â€œpropertiesâ€: {<br>      â€œtitleâ€: {<br>        â€œtypeâ€: â€œtextâ€,<br>        â€œanalyzerâ€: â€œenglishâ€<br>      }<br>    }<br>  }<br>}</p><p>POST titles&#x2F;_bulk<br>{ â€œindexâ€: { â€œ_idâ€: 1 }}<br>{ â€œtitleâ€: â€œMy dog barksâ€ }<br>{ â€œindexâ€: { â€œ_idâ€: 2 }}<br>{ â€œtitleâ€: â€œI see a lot of barking dogs on the road â€œ }</p><p>GET titles&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œmatchâ€: {<br>      â€œtitleâ€: â€œbarking dogsâ€<br>    }<br>  }<br>}</p><p>DELETE &#x2F;titles<br>PUT &#x2F;titles<br>{<br>  â€œmappingsâ€: {<br>    â€œpropertiesâ€: {<br>      â€œtitleâ€: {<br>        â€œtypeâ€: â€œtextâ€,<br>        â€œanalyzerâ€: â€œenglishâ€,<br>        â€œfieldsâ€: {â€œstdâ€: {â€œtypeâ€: â€œtextâ€,â€analyzerâ€: â€œstandardâ€}}<br>      }<br>    }<br>  }<br>}</p><p>POST titles&#x2F;_bulk<br>{ â€œindexâ€: { â€œ_idâ€: 1 }}<br>{ â€œtitleâ€: â€œMy dog barksâ€ }<br>{ â€œindexâ€: { â€œ_idâ€: 2 }}<br>{ â€œtitleâ€: â€œI see a lot of barking dogs on the road â€œ }</p><p>GET &#x2F;titles&#x2F;_search<br>{<br>   â€œqueryâ€: {<br>        â€œmulti_matchâ€: {<br>            â€œqueryâ€:  â€œbarking dogsâ€,<br>            â€œtypeâ€:   â€œmost_fieldsâ€,<br>            â€œfieldsâ€: [ â€œtitleâ€, â€œtitle.stdâ€ ]<br>        }<br>    }<br>}</p><p>GET &#x2F;titles&#x2F;_search<br>{<br>   â€œqueryâ€: {<br>        â€œmulti_matchâ€: {<br>            â€œqueryâ€:  â€œbarking dogsâ€,<br>            â€œtypeâ€:   â€œmost_fieldsâ€,<br>            â€œfieldsâ€: [ â€œtitle^10â€, â€œtitle.stdâ€ ]<br>        }<br>    }<br>}</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><br><span class="hljs-section"># 4.7-å¤šè¯­è¨€åŠä¸­æ–‡åˆ†è¯ä¸æ£€ç´¢.md</span><br><br><span class="hljs-section"># å¤šè¯­è¨€åŠä¸­æ–‡åˆ†è¯ä¸æ£€ç´¢</span><br><br><span class="hljs-bullet">-</span> æ¥åˆ°æ¨è¿‡æ›¾ç»ç”Ÿæ´»è¿‡çš„åœ°æ–¹ï¼Œå°é¾™å¥³åŠ¨æƒ…åœ°è¯´ï¼šâ€œæˆ‘ä¹Ÿæƒ³è¿‡è¿‡è¿‡å„¿è¿‡è¿‡çš„ç”Ÿæ´»ã€‚â€<br><br><span class="hljs-bullet">-</span> ä½ ä¹Ÿæƒ³çŠ¯èŒƒèŒƒç®çªçŠ¯è¿‡çš„é”™å—<br><span class="hljs-bullet">-</span> æ ¡é•¿è¯´è¡£æœä¸Šé™¤äº†æ ¡å¾½åˆ«åˆ«åˆ«çš„<br><span class="hljs-bullet">-</span> è¿™å‡ å¤©å¤©å¤©å¤©æ°”ä¸å¥½<br><span class="hljs-bullet">-</span> æˆ‘èƒŒæœ‰ç‚¹é©¼ï¼Œéº»éº»è¯´â€œä½ çš„èƒŒå¾—èƒŒèƒŒèƒŒèƒŒä½³<br><br></code></pre></td></tr></table></figure><p>#stop word</p><p>DELETE my_index<br>PUT &#x2F;my_index&#x2F;_doc&#x2F;1<br>{ â€œtitleâ€: â€œIâ€™m happy for this foxâ€ }</p><p>PUT &#x2F;my_index&#x2F;_doc&#x2F;2<br>{ â€œtitleâ€: â€œIâ€™m not happy about my fox problemâ€ }</p><p>POST my_index&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œmatchâ€: {<br>      â€œtitleâ€: â€œnot happy foxâ€<br>    }<br>  }<br>}</p><p>#è™½ç„¶é€šè¿‡ä½¿ç”¨ english ï¼ˆè‹±è¯­ï¼‰åˆ†æå™¨ï¼Œä½¿å¾—åŒ¹é…è§„åˆ™æ›´åŠ å®½æ¾ï¼Œæˆ‘ä»¬ä¹Ÿå› æ­¤æé«˜äº†å¬å›ç‡ï¼Œä½†å´é™ä½äº†ç²¾å‡†åŒ¹é…æ–‡æ¡£çš„èƒ½åŠ›ã€‚ä¸ºäº†è·å¾—ä¸¤æ–¹é¢çš„ä¼˜åŠ¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨multifieldsï¼ˆå¤šå­—æ®µï¼‰å¯¹ title å­—æ®µå»ºç«‹ä¸¤æ¬¡ç´¢å¼•ï¼š ä¸€æ¬¡ä½¿ç”¨ <code>english</code>ï¼ˆè‹±è¯­ï¼‰åˆ†æå™¨ï¼Œå¦ä¸€æ¬¡ä½¿ç”¨ <code>standard</code>ï¼ˆæ ‡å‡†ï¼‰åˆ†æå™¨:</p><p>DELETE my_index</p><p>PUT &#x2F;my_index<br>{<br>  â€œmappingsâ€: {<br>    â€œblogâ€: {<br>      â€œpropertiesâ€: {<br>        â€œtitleâ€: {<br>          â€œtypeâ€: â€œstringâ€,<br>          â€œanalyzerâ€: â€œenglishâ€<br>        }<br>      }<br>    }<br>  }<br>}</p><p>PUT &#x2F;my_index<br>{<br>  â€œmappingsâ€: {<br>    â€œblogâ€: {<br>      â€œpropertiesâ€: {<br>        â€œtitleâ€: {<br>          â€œtypeâ€: â€œstringâ€,<br>          â€œfieldsâ€: {<br>            â€œenglishâ€: {<br>              â€œtypeâ€:     â€œstringâ€,<br>              â€œanalyzerâ€: â€œenglishâ€<br>            }<br>          }<br>        }<br>      }<br>    }<br>  }<br>}</p><p>PUT &#x2F;my_index&#x2F;blog&#x2F;1<br>{ â€œtitleâ€: â€œIâ€™m happy for this foxâ€ }</p><p>PUT &#x2F;my_index&#x2F;blog&#x2F;2<br>{ â€œtitleâ€: â€œIâ€™m not happy about my fox problemâ€ }</p><p>GET &#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œmulti_matchâ€: {<br>      â€œtypeâ€:     â€œmost_fieldsâ€,<br>      â€œqueryâ€:    â€œnot happy foxesâ€,<br>      â€œfieldsâ€: [ â€œtitleâ€, â€œtitle.englishâ€ ]<br>    }<br>  }<br>}</p><p>#å®‰è£…æ’ä»¶<br>.&#x2F;elasticsearch-plugin install <a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.1.0/elasticsearch-analysis-ik-7.1.0.zip">https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.1.0/elasticsearch-analysis-ik-7.1.0.zip</a><br>#å®‰è£…æ’ä»¶<br>bin&#x2F;elasticsearch install <a href="https://github.com/KennFalcon/elasticsearch-analysis-hanlp/releases/download/v7.1.0/elasticsearch-analysis-hanlp-7.1.0.zip">https://github.com/KennFalcon/elasticsearch-analysis-hanlp/releases/download/v7.1.0/elasticsearch-analysis-hanlp-7.1.0.zip</a></p><p>#ik_max_word<br>#ik_smart<br>#hanlp: hanlpé»˜è®¤åˆ†è¯<br>#hanlp_standard: æ ‡å‡†åˆ†è¯<br>#hanlp_index: ç´¢å¼•åˆ†è¯<br>#hanlp_nlp: NLPåˆ†è¯<br>#hanlp_n_short: N-æœ€çŸ­è·¯åˆ†è¯<br>#hanlp_dijkstra: æœ€çŸ­è·¯åˆ†è¯<br>#hanlp_crf: CRFåˆ†è¯ï¼ˆåœ¨hanlp 1.6.6å·²å¼€å§‹åºŸå¼ƒï¼‰<br>#hanlp_speed: æé€Ÿè¯å…¸åˆ†è¯</p><p>POST _analyze<br>{<br>  â€œanalyzerâ€: â€œhanlp_standardâ€,<br>  â€œtextâ€: [â€œå‰‘æ¡¥åˆ†æå…¬å¸å¤šä½é«˜ç®¡å¯¹å§åº•è®°è€…è¯´ï¼Œä»–ä»¬ç¡®ä¿äº†å”çº³å¾·Â·ç‰¹æœ—æ™®åœ¨æ€»ç»Ÿå¤§é€‰ä¸­è·èƒœâ€]</p><p>}     </p><p>#Pinyin<br>PUT &#x2F;artists&#x2F;<br>{<br>    â€œsettingsâ€ : {<br>        â€œanalysisâ€ : {<br>            â€œanalyzerâ€ : {<br>                â€œuser_name_analyzerâ€ : {<br>                    â€œtokenizerâ€ : â€œwhitespaceâ€,<br>                    â€œfilterâ€ : â€œpinyin_first_letter_and_full_pinyin_filterâ€<br>                }<br>            },<br>            â€œfilterâ€ : {<br>                â€œpinyin_first_letter_and_full_pinyin_filterâ€ : {<br>                    â€œtypeâ€ : â€œpinyinâ€,<br>                    â€œkeep_first_letterâ€ : true,<br>                    â€œkeep_full_pinyinâ€ : false,<br>                    â€œkeep_none_chineseâ€ : true,<br>                    â€œkeep_originalâ€ : false,<br>                    â€œlimit_first_letter_lengthâ€ : 16,<br>                    â€œlowercaseâ€ : true,<br>                    â€œtrim_whitespaceâ€ : true,<br>                    â€œkeep_none_chinese_in_first_letterâ€ : true<br>                }<br>            }<br>        }<br>    }<br>}</p><p>GET &#x2F;artists&#x2F;_analyze<br>{<br>  â€œtextâ€: [â€œåˆ˜å¾·å å¼ å­¦å‹ éƒ­å¯ŒåŸ é»æ˜ å››å¤§å¤©ç‹â€],<br>  â€œanalyzerâ€: â€œuser_name_analyzerâ€<br>}</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br><span class="hljs-comment">## ç›¸å…³èµ„æº</span><br>- Elasticsearch IKåˆ†è¯æ’ä»¶ https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/medcl/</span>elasticsearch-analysis-ik/releases<br>- Elasticsearch hanlp åˆ†è¯æ’ä»¶ https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/KennFalcon/</span>elasticsearch-analysis-hanlp<br><br>- åˆ†è¯ç®—æ³•ç»¼è¿° https:<span class="hljs-regexp">//</span>zhuanlan.zhihu.com<span class="hljs-regexp">/p/</span><span class="hljs-number">50444885</span><br><br><span class="hljs-comment">### ä¸€äº›åˆ†è¯å·¥å…·ï¼Œä¾›å‚è€ƒï¼š</span><br>- ä¸­ç§‘é™¢è®¡ç®—æ‰€NLPIR http:<span class="hljs-regexp">//i</span>ctclas.nlpir.org<span class="hljs-regexp">/nlpir/</span><br>- ansjåˆ†è¯å™¨ https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/NLPchina/</span>ansj_seg<br>- å“ˆå·¥å¤§çš„LTP https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/HIT-SCIR/</span>ltp<br>- æ¸…åå¤§å­¦THULAC https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/thunlp/</span>THULAC<br>- æ–¯å¦ç¦åˆ†è¯å™¨ https:<span class="hljs-regexp">//</span>nlp.stanford.edu<span class="hljs-regexp">/software/</span>segmenter.shtml<br>- Hanlpåˆ†è¯å™¨ https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/hankcs/</span>HanLP<br>- ç»“å·´åˆ†è¯ https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/yanyiwu/</span>cppjieba<br>- KCWSåˆ†è¯å™¨(å­—åµŒå…¥+Bi-LSTM+CRF) https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/koth/</span>kcws<br>- ZPar https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/frcchang/</span>zpar/releases<br>- IKAnalyzer https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/wks/i</span>k-analyzer<br><br><br><span class="hljs-comment"># 4.8-SpaceJamä¸€ä¸ªå…¨æ–‡æœç´¢çš„å®ä¾‹.md</span><br><br><span class="hljs-comment"># Space Jamï¼Œä¸€æ¬¡å…¨æ–‡æœç´¢çš„å®ä¾‹</span><br><br><span class="hljs-comment">## ç¯å¢ƒè¦æ±‚</span><br>- Python <span class="hljs-number">2.7</span>.<span class="hljs-number">15</span><br>- å¯ä»¥ä½¿ç”¨pyenvç®¡ç†å¤šä¸ªpythonç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰<br><br><span class="hljs-comment">## è¿›å…¥ tmdb-searchç›®å½•</span><br>Run<br>pip install -r requirements.txt<br>Run python ./ingest_tmdb_from_file.py<br></code></pre></td></tr></table></figure><p>POST tmdb&#x2F;_search<br>{<br>â€œ_sourceâ€: [â€œtitleâ€,â€overviewâ€],<br> â€œqueryâ€: {<br>   â€œmatch_allâ€: {}<br> }<br>}</p><p>POST tmdb&#x2F;_search<br>{<br>  â€œ_sourceâ€: [â€œtitleâ€,â€overviewâ€],<br>  â€œqueryâ€: {<br>    â€œmulti_matchâ€: {<br>      â€œqueryâ€: â€œbasketball with cartoon aliensâ€,<br>      â€œfieldsâ€: [â€œtitleâ€,â€overviewâ€]<br>    }<br>  },<br>  â€œhighlightâ€ : {<br>        â€œfieldsâ€ : {<br>            â€œoverviewâ€ : { â€œpre_tagsâ€ : [â€œ\033[0;32;40mâ€], â€œpost_tagsâ€ : [â€œ\033[0mâ€] },<br>            â€œtitleâ€ : { â€œpre_tagsâ€ : [â€œ\033[0;32;40mâ€], â€œpost_tagsâ€ : [â€œ\033[0mâ€] }</p><pre><code class="hljs">    &#125;&#125;</code></pre><p>}</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br><span class="hljs-comment">## ç›¸å…³</span><br>- Windows å®‰è£… pyenv https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/pyenv-win/</span>pyenv-win<br>- Mac å®‰è£…pyenv https:<span class="hljs-regexp">//</span>segmentfault.com<span class="hljs-regexp">/a/</span><span class="hljs-number">1190000017403221</span><br>- Linux å®‰è£… pyenv https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/GX_1_11_real/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">80237064</span><br>- Python.org https:<span class="hljs-regexp">//</span>www.python.org/<br><br><br><span class="hljs-comment"># 4.9-ä½¿ç”¨SearchTemplateå’ŒIndexAliasè¿›è¡ŒæŸ¥è¯¢.md</span><br><br><span class="hljs-comment"># ä½¿ç”¨ Search Template å’Œ Index Alias æŸ¥è¯¢</span><br><br></code></pre></td></tr></table></figure><p>POST _scripts&#x2F;tmdb<br>{<br>  â€œscriptâ€: {<br>    â€œlangâ€: â€œmustacheâ€,<br>    â€œsourceâ€: {<br>      â€œ_sourceâ€: [<br>        â€œtitleâ€,â€overviewâ€<br>      ],<br>      â€œsizeâ€: 20,<br>      â€œqueryâ€: {<br>        â€œmulti_matchâ€: {<br>          â€œqueryâ€: â€œâ€œ,<br>          â€œfieldsâ€: [â€œtitleâ€,â€overviewâ€]<br>        }<br>      }<br>    }<br>  }<br>}<br>DELETE _scripts&#x2F;tmdb</p><p>GET _scripts&#x2F;tmdb</p><p>POST tmdb&#x2F;_search&#x2F;template<br>{<br>    â€œidâ€:â€tmdbâ€,<br>    â€œparamsâ€: {<br>        â€œqâ€: â€œbasketball with cartoon aliensâ€<br>    }<br>}</p><p>PUT movies-2019&#x2F;_doc&#x2F;1<br>{<br>  â€œnameâ€:â€the matrixâ€,<br>  â€œratingâ€:5<br>}</p><p>PUT movies-2019&#x2F;_doc&#x2F;2<br>{<br>  â€œnameâ€:â€Speedâ€,<br>  â€œratingâ€:3<br>}</p><p>POST _aliases<br>{<br>  â€œactionsâ€: [<br>    {<br>      â€œaddâ€: {<br>        â€œindexâ€: â€œmovies-2019â€,<br>        â€œaliasâ€: â€œmovies-latestâ€<br>      }<br>    }<br>  ]<br>}</p><p>POST movies-latest&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œmatch_allâ€: {}<br>  }<br>}</p><p>POST _aliases<br>{<br>  â€œactionsâ€: [<br>    {<br>      â€œaddâ€: {<br>        â€œindexâ€: â€œmovies-2019â€,<br>        â€œaliasâ€: â€œmovies-lastest-highrateâ€,<br>        â€œfilterâ€: {<br>          â€œrangeâ€: {<br>            â€œratingâ€: {<br>              â€œgteâ€: 4<br>            }<br>          }<br>        }<br>      }<br>    }<br>  ]<br>}</p><p>POST movies-lastest-highrate&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œmatch_allâ€: {}<br>  }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><br><span class="hljs-meta"># 5.1-é›†ç¾¤åˆ†å¸ƒå¼æ¨¡å‹åŠé€‰ä¸»ä¸è„‘è£‚é—®é¢˜.md</span><br><br><span class="hljs-meta"># é›†ç¾¤åˆ†å¸ƒå¼æ¨¡å‹åŠé€‰ä¸»ä¸è„‘è£‚é—®é¢˜</span><br><br></code></pre></td></tr></table></figure><p>bin&#x2F;elasticsearch -E node.name&#x3D;node1 -E cluster.name&#x3D;geektime -E path.data&#x3D;node1_data<br>bin&#x2F;elasticsearch -E node.name&#x3D;node2 -E cluster.name&#x3D;geektime -E path.data&#x3D;node2_data<br>bin&#x2F;elasticsearch -E node.name&#x3D;node3 -E cluster.name&#x3D;geektime -E path.data&#x3D;node3_data</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># 5.2-åˆ†ç‰‡ä¸é›†ç¾¤çš„æ•…éšœè½¬ç§».md</span><br><br><span class="hljs-meta"># åˆ†ç‰‡ä¸é›†ç¾¤çš„æ•…éšœè½¬ç§»</span><br><br><br><span class="hljs-meta"># 5.3-æ–‡æ¡£åˆ†å¸ƒå¼å­˜å‚¨.md</span><br><br><span class="hljs-meta"># æ–‡æ¡£åˆ†å¸ƒå¼å­˜å‚¨</span><br><br><br><span class="hljs-meta"># 5.4-åˆ†ç‰‡åŠå…¶ç”Ÿå‘½å‘¨æœŸ.md</span><br><br><span class="hljs-meta"># åˆ†ç‰‡åŠå…¶ç”Ÿå‘½å‘¨æœŸ</span><br><br><br><span class="hljs-meta"># 5.5-å‰–æåˆ†å¸ƒå¼æŸ¥è¯¢åŠç›¸å…³æ€§è¯„åˆ†.md</span><br><br><span class="hljs-meta"># å‰–æåˆ†å¸ƒå¼æŸ¥è¯¢åŠç›¸å…³æ€§è¯„åˆ†</span><br></code></pre></td></tr></table></figure><p>DELETE message<br>PUT message<br>{<br>  â€œsettingsâ€: {<br>    â€œnumber_of_shardsâ€: 20<br>  }<br>}</p><p>GET message</p><p>POST message&#x2F;_doc?routing&#x3D;1<br>{<br>  â€œcontentâ€:â€goodâ€<br>}</p><p>POST message&#x2F;_doc?routing&#x3D;2<br>{<br>  â€œcontentâ€:â€good morningâ€<br>}</p><p>POST message&#x2F;_doc?routing&#x3D;3<br>{<br>  â€œcontentâ€:â€good morning everyoneâ€<br>}</p><p>POST message&#x2F;_search<br>{<br>  â€œexplainâ€: true,<br>  â€œqueryâ€: {<br>    â€œmatch_allâ€: {}<br>  }<br>}</p><p>POST message&#x2F;_search<br>{<br>  â€œexplainâ€: true,<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œcontentâ€: {<br>        â€œvalueâ€: â€œgoodâ€<br>      }<br>    }<br>  }<br>}</p><p>POST message&#x2F;_search?search_type&#x3D;dfs_query_then_fetch<br>{</p><p>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œcontentâ€: {<br>        â€œvalueâ€: â€œgoodâ€<br>      }<br>    }<br>  }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><br><span class="hljs-meta"># 5.6-æ’åºåŠDocValues&amp;Fielddata.md</span><br><br><span class="hljs-meta"># æ’åºåŠDoc Values &amp; Fielddata</span><br></code></pre></td></tr></table></figure><p>#å•å­—æ®µæ’åº<br>POST &#x2F;kibana_sample_data_ecommerce&#x2F;_search<br>{<br>  â€œsizeâ€: 5,<br>  â€œqueryâ€: {<br>    â€œmatch_allâ€: {</p><pre><code class="hljs">&#125;</code></pre><p>  },<br>  â€œsortâ€: [<br>    {â€œorder_dateâ€: {â€œorderâ€: â€œdescâ€}}<br>  ]<br>}</p><p>#å¤šå­—æ®µæ’åº<br>POST &#x2F;kibana_sample_data_ecommerce&#x2F;_search<br>{<br>  â€œsizeâ€: 5,<br>  â€œqueryâ€: {<br>    â€œmatch_allâ€: {</p><pre><code class="hljs">&#125;</code></pre><p>  },<br>  â€œsortâ€: [<br>    {â€œorder_dateâ€: {â€œorderâ€: â€œdescâ€}},<br>    {â€œ_docâ€:{â€œorderâ€: â€œascâ€}},<br>    {â€œ_scoreâ€:{ â€œorderâ€: â€œdescâ€}}<br>  ]<br>}</p><p>GET kibana_sample_data_ecommerce&#x2F;_mapping</p><p>#å¯¹ text å­—æ®µè¿›è¡Œæ’åºã€‚é»˜è®¤ä¼šæŠ¥é”™ï¼Œéœ€æ‰“å¼€fielddata<br>POST &#x2F;kibana_sample_data_ecommerce&#x2F;_search<br>{<br>  â€œsizeâ€: 5,<br>  â€œqueryâ€: {<br>    â€œmatch_allâ€: {</p><pre><code class="hljs">&#125;</code></pre><p>  },<br>  â€œsortâ€: [<br>    {â€œcustomer_full_nameâ€: {â€œorderâ€: â€œdescâ€}}<br>  ]<br>}</p><p>#æ‰“å¼€ textçš„ fielddata<br>PUT kibana_sample_data_ecommerce&#x2F;_mapping<br>{<br>  â€œpropertiesâ€: {<br>    â€œcustomer_full_nameâ€ : {<br>          â€œtypeâ€ : â€œtextâ€,<br>          â€œfielddataâ€: true,<br>          â€œfieldsâ€ : {<br>            â€œkeywordâ€ : {<br>              â€œtypeâ€ : â€œkeywordâ€,<br>              â€œignore_aboveâ€ : 256<br>            }<br>          }<br>        }<br>  }<br>}</p><p>#å…³é—­ keywordçš„ doc values<br>PUT test_keyword<br>PUT test_keyword&#x2F;_mapping<br>{<br>  â€œpropertiesâ€: {<br>    â€œuser_nameâ€:{<br>      â€œtypeâ€: â€œkeywordâ€,<br>      â€œdoc_valuesâ€:false<br>    }<br>  }<br>}</p><p>DELETE test_keyword</p><p>PUT test_text<br>PUT test_text&#x2F;_mapping<br>{<br>  â€œpropertiesâ€: {<br>    â€œintroâ€:{<br>      â€œtypeâ€: â€œtextâ€,<br>      â€œdoc_valuesâ€:true<br>    }<br>  }<br>}</p><p>DELETE test_text</p><p>DELETE temp_users<br>PUT temp_users<br>PUT temp_users&#x2F;_mapping<br>{<br>  â€œpropertiesâ€: {<br>    â€œnameâ€:{â€œtypeâ€: â€œtextâ€,â€fielddataâ€: true},<br>    â€œdescâ€:{â€œtypeâ€: â€œtextâ€,â€fielddataâ€: true}<br>  }<br>}</p><p>Post temp_users&#x2F;_doc<br>{â€œnameâ€:â€Jackâ€,â€descâ€:â€Jack is a good boy!â€,â€ageâ€:10}</p><p>#æ‰“å¼€fielddata åï¼ŒæŸ¥çœ‹ docvalue_fieldsæ•°æ®<br>POST  temp_users&#x2F;_search<br>{<br>  â€œdocvalue_fieldsâ€: [<br>    â€œnameâ€,â€descâ€<br>    ]<br>}</p><p>#æŸ¥çœ‹æ•´å‹å­—æ®µçš„docvalues<br>POST  temp_users&#x2F;_search<br>{<br>  â€œdocvalue_fieldsâ€: [<br>    â€œageâ€<br>    ]<br>}</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sas"><br><br># 5.7-åˆ†é¡µä¸éå†-FromSize<span class="hljs-variable">&amp;SearchAfter</span><span class="hljs-variable">&amp;ScrollAPI.</span>md<br><br># åˆ†é¡µä¸éå† - <span class="hljs-keyword">From</span>, Size, Search_after &amp; Scroll API<br></code></pre></td></tr></table></figure><p>POST tmdb&#x2F;_search<br>{<br>  â€œfromâ€: 10000,<br>  â€œsizeâ€: 1,<br>  â€œqueryâ€: {<br>    â€œmatch_allâ€: {</p><pre><code class="hljs">&#125;</code></pre><p>  }<br>}</p><p>#Scroll API<br>DELETE users</p><p>POST users&#x2F;_doc<br>{â€œnameâ€:â€user1â€,â€ageâ€:10}</p><p>POST users&#x2F;_doc<br>{â€œnameâ€:â€user2â€,â€ageâ€:11}</p><p>POST users&#x2F;_doc<br>{â€œnameâ€:â€user2â€,â€ageâ€:12}</p><p>POST users&#x2F;_doc<br>{â€œnameâ€:â€user2â€,â€ageâ€:13}</p><p>POST users&#x2F;_count</p><p>POST users&#x2F;_search<br>{<br>    â€œsizeâ€: 1,<br>    â€œqueryâ€: {<br>        â€œmatch_allâ€: {}<br>    },<br>    â€œsortâ€: [<br>        {â€œageâ€: â€œdescâ€} ,<br>        {â€œ_idâ€: â€œascâ€}<br>    ]<br>}</p><p>POST users&#x2F;_search<br>{<br>    â€œsizeâ€: 1,<br>    â€œqueryâ€: {<br>        â€œmatch_allâ€: {}<br>    },<br>    â€œsearch_afterâ€:<br>        [<br>          10,<br>          â€œZQ0vYGsBrR8X3IP75QqXâ€],<br>    â€œsortâ€: [<br>        {â€œageâ€: â€œdescâ€} ,<br>        {â€œ_idâ€: â€œascâ€}<br>    ]<br>}</p><p>#Scroll API<br>DELETE users<br>POST users&#x2F;_doc<br>{â€œnameâ€:â€user1â€,â€ageâ€:10}</p><p>POST users&#x2F;_doc<br>{â€œnameâ€:â€user2â€,â€ageâ€:20}</p><p>POST users&#x2F;_doc<br>{â€œnameâ€:â€user3â€,â€ageâ€:30}</p><p>POST users&#x2F;_doc<br>{â€œnameâ€:â€user4â€,â€ageâ€:40}</p><p>POST &#x2F;users&#x2F;_search?scroll&#x3D;5m<br>{<br>    â€œsizeâ€: 1,<br>    â€œqueryâ€: {<br>        â€œmatch_allâ€ : {<br>        }<br>    }<br>}</p><p>POST users&#x2F;_doc<br>{â€œnameâ€:â€user5â€,â€ageâ€:50}<br>POST &#x2F;_search&#x2F;scroll<br>{<br>    â€œscrollâ€ : â€œ1mâ€,<br>    â€œscroll_idâ€ : â€œDXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAWAWbWdoQXR2d3ZUd2kzSThwVTh4bVE0QQ&#x3D;&#x3D;â€<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><br><span class="hljs-meta"># 5.8-å¤„ç†å¹¶å‘è¯»å†™.md</span><br><br><span class="hljs-meta"># å¤„ç†å¹¶å‘è¯»å†™æ“ä½œ</span><br></code></pre></td></tr></table></figure><p>DELETE products<br>PUT products</p><p>PUT products&#x2F;_doc&#x2F;1<br>{<br>  â€œtitleâ€:â€iphoneâ€,<br>  â€œcountâ€:100<br>}</p><p>GET products&#x2F;_doc&#x2F;1</p><p>PUT products&#x2F;_doc&#x2F;1?if_seq_no&#x3D;1&amp;if_primary_term&#x3D;1<br>{<br>  â€œtitleâ€:â€iphoneâ€,<br>  â€œcountâ€:100<br>}</p><p>PUT products&#x2F;_doc&#x2F;1?version&#x3D;30000&amp;version_type&#x3D;external<br>{<br>  â€œtitleâ€:â€iphoneâ€,<br>  â€œcountâ€:100<br>}</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs clean"><br><br># <span class="hljs-number">6.1</span>-Bucket&amp;Metricèšåˆåˆ†æåŠåµŒå¥—èšåˆ.md<br><br># Bucket &amp; Metric Aggregation<br>## demos<br></code></pre></td></tr></table></figure><p>DELETE &#x2F;employees<br>PUT &#x2F;employees&#x2F;<br>{<br>  â€œmappingsâ€ : {<br>      â€œpropertiesâ€ : {<br>        â€œageâ€ : {<br>          â€œtypeâ€ : â€œintegerâ€<br>        },<br>        â€œgenderâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œjobâ€ : {<br>          â€œtypeâ€ : â€œtextâ€,<br>          â€œfieldsâ€ : {<br>            â€œkeywordâ€ : {<br>              â€œtypeâ€ : â€œkeywordâ€,<br>              â€œignore_aboveâ€ : 50<br>            }<br>          }<br>        },<br>        â€œnameâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œsalaryâ€ : {<br>          â€œtypeâ€ : â€œintegerâ€<br>        }<br>      }<br>    }<br>}</p><p>PUT &#x2F;employees&#x2F;_bulk<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ1â€ } }<br>{ â€œnameâ€ : â€œEmmaâ€,â€ageâ€:32,â€jobâ€:â€Product Managerâ€,â€genderâ€:â€femaleâ€,â€salaryâ€:35000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ2â€ } }<br>{ â€œnameâ€ : â€œUnderwoodâ€,â€ageâ€:41,â€jobâ€:â€Dev Managerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 50000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ3â€ } }<br>{ â€œnameâ€ : â€œTranâ€,â€ageâ€:25,â€jobâ€:â€Web Designerâ€,â€genderâ€:â€maleâ€,â€salaryâ€:18000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ4â€ } }<br>{ â€œnameâ€ : â€œRiveraâ€,â€ageâ€:26,â€jobâ€:â€Web Designerâ€,â€genderâ€:â€femaleâ€,â€salaryâ€: 22000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ5â€ } }<br>{ â€œnameâ€ : â€œRoseâ€,â€ageâ€:25,â€jobâ€:â€QAâ€,â€genderâ€:â€femaleâ€,â€salaryâ€:18000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ6â€ } }<br>{ â€œnameâ€ : â€œLucyâ€,â€ageâ€:31,â€jobâ€:â€QAâ€,â€genderâ€:â€femaleâ€,â€salaryâ€: 25000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ7â€ } }<br>{ â€œnameâ€ : â€œByrdâ€,â€ageâ€:27,â€jobâ€:â€QAâ€,â€genderâ€:â€maleâ€,â€salaryâ€:20000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ8â€ } }<br>{ â€œnameâ€ : â€œFosterâ€,â€ageâ€:27,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 20000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ9â€ } }<br>{ â€œnameâ€ : â€œGregoryâ€,â€ageâ€:32,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€:22000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ10â€ } }<br>{ â€œnameâ€ : â€œBryantâ€,â€ageâ€:20,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 9000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ11â€ } }<br>{ â€œnameâ€ : â€œJennyâ€,â€ageâ€:36,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€femaleâ€,â€salaryâ€:38000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ12â€ } }<br>{ â€œnameâ€ : â€œMcdonaldâ€,â€ageâ€:31,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 32000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ13â€ } }<br>{ â€œnameâ€ : â€œJonthnaâ€,â€ageâ€:30,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€femaleâ€,â€salaryâ€:30000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ14â€ } }<br>{ â€œnameâ€ : â€œMarshallâ€,â€ageâ€:32,â€jobâ€:â€Javascript Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 25000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ15â€ } }<br>{ â€œnameâ€ : â€œKingâ€,â€ageâ€:33,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€:28000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ16â€ } }<br>{ â€œnameâ€ : â€œMccarthyâ€,â€ageâ€:21,â€jobâ€:â€Javascript Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 16000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ17â€ } }<br>{ â€œnameâ€ : â€œGoodwinâ€,â€ageâ€:25,â€jobâ€:â€Javascript Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 16000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ18â€ } }<br>{ â€œnameâ€ : â€œCatherineâ€,â€ageâ€:29,â€jobâ€:â€Javascript Programmerâ€,â€genderâ€:â€femaleâ€,â€salaryâ€: 20000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ19â€ } }<br>{ â€œnameâ€ : â€œBooneâ€,â€ageâ€:30,â€jobâ€:â€DBAâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 30000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ20â€ } }<br>{ â€œnameâ€ : â€œKathyâ€,â€ageâ€:29,â€jobâ€:â€DBAâ€,â€genderâ€:â€femaleâ€,â€salaryâ€: 20000}</p><h1 id="Metric-èšåˆï¼Œæ‰¾åˆ°æœ€ä½çš„å·¥èµ„"><a href="#Metric-èšåˆï¼Œæ‰¾åˆ°æœ€ä½çš„å·¥èµ„" class="headerlink" title="Metric èšåˆï¼Œæ‰¾åˆ°æœ€ä½çš„å·¥èµ„"></a>Metric èšåˆï¼Œæ‰¾åˆ°æœ€ä½çš„å·¥èµ„</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œmin_salaryâ€: {<br>      â€œminâ€: {<br>        â€œfieldâ€:â€salaryâ€<br>      }<br>    }<br>  }<br>}</p><h1 id="Metric-èšåˆï¼Œæ‰¾åˆ°æœ€é«˜çš„å·¥èµ„"><a href="#Metric-èšåˆï¼Œæ‰¾åˆ°æœ€é«˜çš„å·¥èµ„" class="headerlink" title="Metric èšåˆï¼Œæ‰¾åˆ°æœ€é«˜çš„å·¥èµ„"></a>Metric èšåˆï¼Œæ‰¾åˆ°æœ€é«˜çš„å·¥èµ„</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œmax_salaryâ€: {<br>      â€œmaxâ€: {<br>        â€œfieldâ€:â€salaryâ€<br>      }<br>    }<br>  }<br>}</p><h1 id="å¤šä¸ª-Metric-èšåˆï¼Œæ‰¾åˆ°æœ€ä½æœ€é«˜å’Œå¹³å‡å·¥èµ„"><a href="#å¤šä¸ª-Metric-èšåˆï¼Œæ‰¾åˆ°æœ€ä½æœ€é«˜å’Œå¹³å‡å·¥èµ„" class="headerlink" title="å¤šä¸ª Metric èšåˆï¼Œæ‰¾åˆ°æœ€ä½æœ€é«˜å’Œå¹³å‡å·¥èµ„"></a>å¤šä¸ª Metric èšåˆï¼Œæ‰¾åˆ°æœ€ä½æœ€é«˜å’Œå¹³å‡å·¥èµ„</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œmax_salaryâ€: {<br>      â€œmaxâ€: {<br>        â€œfieldâ€: â€œsalaryâ€<br>      }<br>    },<br>    â€œmin_salaryâ€: {<br>      â€œminâ€: {<br>        â€œfieldâ€: â€œsalaryâ€<br>      }<br>    },<br>    â€œavg_salaryâ€: {<br>      â€œavgâ€: {<br>        â€œfieldâ€: â€œsalaryâ€<br>      }<br>    }<br>  }<br>}</p><h1 id="ä¸€ä¸ªèšåˆï¼Œè¾“å‡ºå¤šå€¼"><a href="#ä¸€ä¸ªèšåˆï¼Œè¾“å‡ºå¤šå€¼" class="headerlink" title="ä¸€ä¸ªèšåˆï¼Œè¾“å‡ºå¤šå€¼"></a>ä¸€ä¸ªèšåˆï¼Œè¾“å‡ºå¤šå€¼</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œstats_salaryâ€: {<br>      â€œstatsâ€: {<br>        â€œfieldâ€:â€salaryâ€<br>      }<br>    }<br>  }<br>}</p><h1 id="å¯¹keword-è¿›è¡Œèšåˆ"><a href="#å¯¹keword-è¿›è¡Œèšåˆ" class="headerlink" title="å¯¹keword è¿›è¡Œèšåˆ"></a>å¯¹keword è¿›è¡Œèšåˆ</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€:â€job.keywordâ€<br>      }<br>    }<br>  }<br>}</p><h1 id="å¯¹-Text-å­—æ®µè¿›è¡Œ-terms-èšåˆæŸ¥è¯¢ï¼Œå¤±è´¥"><a href="#å¯¹-Text-å­—æ®µè¿›è¡Œ-terms-èšåˆæŸ¥è¯¢ï¼Œå¤±è´¥" class="headerlink" title="å¯¹ Text å­—æ®µè¿›è¡Œ terms èšåˆæŸ¥è¯¢ï¼Œå¤±è´¥"></a>å¯¹ Text å­—æ®µè¿›è¡Œ terms èšåˆæŸ¥è¯¢ï¼Œå¤±è´¥</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€:â€jobâ€<br>      }<br>    }<br>  }<br>}</p><h1 id="å¯¹-Text-å­—æ®µæ‰“å¼€-fielddataï¼Œæ”¯æŒterms-aggregation"><a href="#å¯¹-Text-å­—æ®µæ‰“å¼€-fielddataï¼Œæ”¯æŒterms-aggregation" class="headerlink" title="å¯¹ Text å­—æ®µæ‰“å¼€ fielddataï¼Œæ”¯æŒterms aggregation"></a>å¯¹ Text å­—æ®µæ‰“å¼€ fielddataï¼Œæ”¯æŒterms aggregation</h1><p>PUT employees&#x2F;_mapping<br>{<br>  â€œpropertiesâ€ : {<br>    â€œjobâ€:{<br>       â€œtypeâ€:     â€œtextâ€,<br>       â€œfielddataâ€: true<br>    }<br>  }<br>}</p><h1 id="å¯¹-Text-å­—æ®µè¿›è¡Œ-terms-åˆ†è¯ã€‚åˆ†è¯åçš„terms"><a href="#å¯¹-Text-å­—æ®µè¿›è¡Œ-terms-åˆ†è¯ã€‚åˆ†è¯åçš„terms" class="headerlink" title="å¯¹ Text å­—æ®µè¿›è¡Œ terms åˆ†è¯ã€‚åˆ†è¯åçš„terms"></a>å¯¹ Text å­—æ®µè¿›è¡Œ terms åˆ†è¯ã€‚åˆ†è¯åçš„terms</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€:â€jobâ€<br>      }<br>    }<br>  }<br>}</p><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€:â€job.keywordâ€<br>      }<br>    }<br>  }<br>}</p><h1 id="å¯¹job-keyword-å’Œ-job-è¿›è¡Œ-terms-èšåˆï¼Œåˆ†æ¡¶çš„æ€»æ•°å¹¶ä¸ä¸€æ ·"><a href="#å¯¹job-keyword-å’Œ-job-è¿›è¡Œ-terms-èšåˆï¼Œåˆ†æ¡¶çš„æ€»æ•°å¹¶ä¸ä¸€æ ·" class="headerlink" title="å¯¹job.keyword å’Œ job è¿›è¡Œ terms èšåˆï¼Œåˆ†æ¡¶çš„æ€»æ•°å¹¶ä¸ä¸€æ ·"></a>å¯¹job.keyword å’Œ job è¿›è¡Œ terms èšåˆï¼Œåˆ†æ¡¶çš„æ€»æ•°å¹¶ä¸ä¸€æ ·</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œcardinateâ€: {<br>      â€œcardinalityâ€: {<br>        â€œfieldâ€: â€œjobâ€<br>      }<br>    }<br>  }<br>}</p><h1 id="å¯¹-æ€§åˆ«çš„-keyword-è¿›è¡Œèšåˆ"><a href="#å¯¹-æ€§åˆ«çš„-keyword-è¿›è¡Œèšåˆ" class="headerlink" title="å¯¹ æ€§åˆ«çš„ keyword è¿›è¡Œèšåˆ"></a>å¯¹ æ€§åˆ«çš„ keyword è¿›è¡Œèšåˆ</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œgenderâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€:â€genderâ€<br>      }<br>    }<br>  }<br>}</p><p>#æŒ‡å®š bucket çš„ size<br>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œages_5â€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€:â€ageâ€,<br>        â€œsizeâ€:3<br>      }<br>    }<br>  }<br>}</p><h1 id="æŒ‡å®šsizeï¼Œä¸åŒå·¥ç§ä¸­ï¼Œå¹´çºªæœ€å¤§çš„3ä¸ªå‘˜å·¥çš„å…·ä½“ä¿¡æ¯"><a href="#æŒ‡å®šsizeï¼Œä¸åŒå·¥ç§ä¸­ï¼Œå¹´çºªæœ€å¤§çš„3ä¸ªå‘˜å·¥çš„å…·ä½“ä¿¡æ¯" class="headerlink" title="æŒ‡å®šsizeï¼Œä¸åŒå·¥ç§ä¸­ï¼Œå¹´çºªæœ€å¤§çš„3ä¸ªå‘˜å·¥çš„å…·ä½“ä¿¡æ¯"></a>æŒ‡å®šsizeï¼Œä¸åŒå·¥ç§ä¸­ï¼Œå¹´çºªæœ€å¤§çš„3ä¸ªå‘˜å·¥çš„å…·ä½“ä¿¡æ¯</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€:â€job.keywordâ€<br>      },<br>      â€œaggsâ€:{<br>        â€œold_employeeâ€:{<br>          â€œtop_hitsâ€:{<br>            â€œsizeâ€:3,<br>            â€œsortâ€:[<br>              {<br>                â€œageâ€:{<br>                  â€œorderâ€:â€descâ€<br>                }<br>              }<br>            ]<br>          }<br>        }<br>      }<br>    }<br>  }<br>}</p><p>#Salary Ranges åˆ†æ¡¶ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰ key<br>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œsalary_rangeâ€: {<br>      â€œrangeâ€: {<br>        â€œfieldâ€:â€salaryâ€,<br>        â€œrangesâ€:[<br>          {<br>            â€œtoâ€:10000<br>          },<br>          {<br>            â€œfromâ€:10000,<br>            â€œtoâ€:20000<br>          },<br>          {<br>            â€œkeyâ€:â€&gt;20000â€,<br>            â€œfromâ€:20000<br>          }<br>        ]<br>      }<br>    }<br>  }<br>}</p><p>#Salary Histogram,å·¥èµ„0åˆ°10ä¸‡ï¼Œä»¥ 5000ä¸€ä¸ªåŒºé—´è¿›è¡Œåˆ†æ¡¶<br>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œsalary_histrogramâ€: {<br>      â€œhistogramâ€: {<br>        â€œfieldâ€:â€salaryâ€,<br>        â€œintervalâ€:5000,<br>        â€œextended_boundsâ€:{<br>          â€œminâ€:0,<br>          â€œmaxâ€:100000</p><pre><code class="hljs">    &#125;  &#125;&#125;</code></pre><p>  }<br>}</p><h1 id="åµŒå¥—èšåˆ1ï¼ŒæŒ‰ç…§å·¥ä½œç±»å‹åˆ†æ¡¶ï¼Œå¹¶ç»Ÿè®¡å·¥èµ„ä¿¡æ¯"><a href="#åµŒå¥—èšåˆ1ï¼ŒæŒ‰ç…§å·¥ä½œç±»å‹åˆ†æ¡¶ï¼Œå¹¶ç»Ÿè®¡å·¥èµ„ä¿¡æ¯" class="headerlink" title="åµŒå¥—èšåˆ1ï¼ŒæŒ‰ç…§å·¥ä½œç±»å‹åˆ†æ¡¶ï¼Œå¹¶ç»Ÿè®¡å·¥èµ„ä¿¡æ¯"></a>åµŒå¥—èšåˆ1ï¼ŒæŒ‰ç…§å·¥ä½œç±»å‹åˆ†æ¡¶ï¼Œå¹¶ç»Ÿè®¡å·¥èµ„ä¿¡æ¯</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œJob_salary_statsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€: â€œjob.keywordâ€<br>      },<br>      â€œaggsâ€: {<br>        â€œsalaryâ€: {<br>          â€œstatsâ€: {<br>            â€œfieldâ€: â€œsalaryâ€<br>          }<br>        }<br>      }<br>    }<br>  }<br>}</p><h1 id="å¤šæ¬¡åµŒå¥—ã€‚æ ¹æ®å·¥ä½œç±»å‹åˆ†æ¡¶ï¼Œç„¶åæŒ‰ç…§æ€§åˆ«åˆ†æ¡¶ï¼Œè®¡ç®—å·¥èµ„çš„ç»Ÿè®¡ä¿¡æ¯"><a href="#å¤šæ¬¡åµŒå¥—ã€‚æ ¹æ®å·¥ä½œç±»å‹åˆ†æ¡¶ï¼Œç„¶åæŒ‰ç…§æ€§åˆ«åˆ†æ¡¶ï¼Œè®¡ç®—å·¥èµ„çš„ç»Ÿè®¡ä¿¡æ¯" class="headerlink" title="å¤šæ¬¡åµŒå¥—ã€‚æ ¹æ®å·¥ä½œç±»å‹åˆ†æ¡¶ï¼Œç„¶åæŒ‰ç…§æ€§åˆ«åˆ†æ¡¶ï¼Œè®¡ç®—å·¥èµ„çš„ç»Ÿè®¡ä¿¡æ¯"></a>å¤šæ¬¡åµŒå¥—ã€‚æ ¹æ®å·¥ä½œç±»å‹åˆ†æ¡¶ï¼Œç„¶åæŒ‰ç…§æ€§åˆ«åˆ†æ¡¶ï¼Œè®¡ç®—å·¥èµ„çš„ç»Ÿè®¡ä¿¡æ¯</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œJob_gender_statsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€: â€œjob.keywordâ€<br>      },<br>      â€œaggsâ€: {<br>        â€œgender_statsâ€: {<br>          â€œtermsâ€: {<br>            â€œfieldâ€: â€œgenderâ€<br>          },<br>          â€œaggsâ€: {<br>            â€œsalary_statsâ€: {<br>              â€œstatsâ€: {<br>                â€œfieldâ€: â€œsalaryâ€<br>              }<br>            }<br>          }<br>        }<br>      }<br>    }<br>  }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><br><span class="hljs-meta"># 6.2-Pipelineèšåˆåˆ†æ.md</span><br><br><span class="hljs-meta"># Pipeline èšåˆåˆ†æ</span><br></code></pre></td></tr></table></figure><p>DELETE employees<br>PUT &#x2F;employees&#x2F;_bulk<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ1â€ } }<br>{ â€œnameâ€ : â€œEmmaâ€,â€ageâ€:32,â€jobâ€:â€Product Managerâ€,â€genderâ€:â€femaleâ€,â€salaryâ€:35000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ2â€ } }<br>{ â€œnameâ€ : â€œUnderwoodâ€,â€ageâ€:41,â€jobâ€:â€Dev Managerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 50000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ3â€ } }<br>{ â€œnameâ€ : â€œTranâ€,â€ageâ€:25,â€jobâ€:â€Web Designerâ€,â€genderâ€:â€maleâ€,â€salaryâ€:18000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ4â€ } }<br>{ â€œnameâ€ : â€œRiveraâ€,â€ageâ€:26,â€jobâ€:â€Web Designerâ€,â€genderâ€:â€femaleâ€,â€salaryâ€: 22000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ5â€ } }<br>{ â€œnameâ€ : â€œRoseâ€,â€ageâ€:25,â€jobâ€:â€QAâ€,â€genderâ€:â€femaleâ€,â€salaryâ€:18000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ6â€ } }<br>{ â€œnameâ€ : â€œLucyâ€,â€ageâ€:31,â€jobâ€:â€QAâ€,â€genderâ€:â€femaleâ€,â€salaryâ€: 25000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ7â€ } }<br>{ â€œnameâ€ : â€œByrdâ€,â€ageâ€:27,â€jobâ€:â€QAâ€,â€genderâ€:â€maleâ€,â€salaryâ€:20000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ8â€ } }<br>{ â€œnameâ€ : â€œFosterâ€,â€ageâ€:27,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 20000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ9â€ } }<br>{ â€œnameâ€ : â€œGregoryâ€,â€ageâ€:32,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€:22000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ10â€ } }<br>{ â€œnameâ€ : â€œBryantâ€,â€ageâ€:20,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 9000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ11â€ } }<br>{ â€œnameâ€ : â€œJennyâ€,â€ageâ€:36,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€femaleâ€,â€salaryâ€:38000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ12â€ } }<br>{ â€œnameâ€ : â€œMcdonaldâ€,â€ageâ€:31,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 32000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ13â€ } }<br>{ â€œnameâ€ : â€œJonthnaâ€,â€ageâ€:30,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€femaleâ€,â€salaryâ€:30000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ14â€ } }<br>{ â€œnameâ€ : â€œMarshallâ€,â€ageâ€:32,â€jobâ€:â€Javascript Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 25000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ15â€ } }<br>{ â€œnameâ€ : â€œKingâ€,â€ageâ€:33,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€:28000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ16â€ } }<br>{ â€œnameâ€ : â€œMccarthyâ€,â€ageâ€:21,â€jobâ€:â€Javascript Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 16000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ17â€ } }<br>{ â€œnameâ€ : â€œGoodwinâ€,â€ageâ€:25,â€jobâ€:â€Javascript Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 16000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ18â€ } }<br>{ â€œnameâ€ : â€œCatherineâ€,â€ageâ€:29,â€jobâ€:â€Javascript Programmerâ€,â€genderâ€:â€femaleâ€,â€salaryâ€: 20000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ19â€ } }<br>{ â€œnameâ€ : â€œBooneâ€,â€ageâ€:30,â€jobâ€:â€DBAâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 30000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ20â€ } }<br>{ â€œnameâ€ : â€œKathyâ€,â€ageâ€:29,â€jobâ€:â€DBAâ€,â€genderâ€:â€femaleâ€,â€salaryâ€: 20000}</p><h1 id="å¹³å‡å·¥èµ„æœ€ä½çš„å·¥ä½œç±»å‹"><a href="#å¹³å‡å·¥èµ„æœ€ä½çš„å·¥ä½œç±»å‹" class="headerlink" title="å¹³å‡å·¥èµ„æœ€ä½çš„å·¥ä½œç±»å‹"></a>å¹³å‡å·¥èµ„æœ€ä½çš„å·¥ä½œç±»å‹</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€: â€œjob.keywordâ€,<br>        â€œsizeâ€: 10<br>      },<br>      â€œaggsâ€: {<br>        â€œavg_salaryâ€: {<br>          â€œavgâ€: {<br>            â€œfieldâ€: â€œsalaryâ€<br>          }<br>        }<br>      }<br>    },<br>    â€œmin_salary_by_jobâ€:{<br>      â€œmin_bucketâ€: {<br>        â€œbuckets_pathâ€: â€œjobs&gt;avg_salaryâ€<br>      }<br>    }<br>  }<br>}</p><h1 id="å¹³å‡å·¥èµ„æœ€é«˜çš„å·¥ä½œç±»å‹"><a href="#å¹³å‡å·¥èµ„æœ€é«˜çš„å·¥ä½œç±»å‹" class="headerlink" title="å¹³å‡å·¥èµ„æœ€é«˜çš„å·¥ä½œç±»å‹"></a>å¹³å‡å·¥èµ„æœ€é«˜çš„å·¥ä½œç±»å‹</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€: â€œjob.keywordâ€,<br>        â€œsizeâ€: 10<br>      },<br>      â€œaggsâ€: {<br>        â€œavg_salaryâ€: {<br>          â€œavgâ€: {<br>            â€œfieldâ€: â€œsalaryâ€<br>          }<br>        }<br>      }<br>    },<br>    â€œmax_salary_by_jobâ€:{<br>      â€œmax_bucketâ€: {<br>        â€œbuckets_pathâ€: â€œjobs&gt;avg_salaryâ€<br>      }<br>    }<br>  }<br>}</p><h1 id="å¹³å‡å·¥èµ„çš„å¹³å‡å·¥èµ„"><a href="#å¹³å‡å·¥èµ„çš„å¹³å‡å·¥èµ„" class="headerlink" title="å¹³å‡å·¥èµ„çš„å¹³å‡å·¥èµ„"></a>å¹³å‡å·¥èµ„çš„å¹³å‡å·¥èµ„</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€: â€œjob.keywordâ€,<br>        â€œsizeâ€: 10<br>      },<br>      â€œaggsâ€: {<br>        â€œavg_salaryâ€: {<br>          â€œavgâ€: {<br>            â€œfieldâ€: â€œsalaryâ€<br>          }<br>        }<br>      }<br>    },<br>    â€œavg_salary_by_jobâ€:{<br>      â€œavg_bucketâ€: {<br>        â€œbuckets_pathâ€: â€œjobs&gt;avg_salaryâ€<br>      }<br>    }<br>  }<br>}</p><h1 id="å¹³å‡å·¥èµ„çš„ç»Ÿè®¡åˆ†æ"><a href="#å¹³å‡å·¥èµ„çš„ç»Ÿè®¡åˆ†æ" class="headerlink" title="å¹³å‡å·¥èµ„çš„ç»Ÿè®¡åˆ†æ"></a>å¹³å‡å·¥èµ„çš„ç»Ÿè®¡åˆ†æ</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€: â€œjob.keywordâ€,<br>        â€œsizeâ€: 10<br>      },<br>      â€œaggsâ€: {<br>        â€œavg_salaryâ€: {<br>          â€œavgâ€: {<br>            â€œfieldâ€: â€œsalaryâ€<br>          }<br>        }<br>      }<br>    },<br>    â€œstats_salary_by_jobâ€:{<br>      â€œstats_bucketâ€: {<br>        â€œbuckets_pathâ€: â€œjobs&gt;avg_salaryâ€<br>      }<br>    }<br>  }<br>}</p><h1 id="å¹³å‡å·¥èµ„çš„ç™¾åˆ†ä½æ•°"><a href="#å¹³å‡å·¥èµ„çš„ç™¾åˆ†ä½æ•°" class="headerlink" title="å¹³å‡å·¥èµ„çš„ç™¾åˆ†ä½æ•°"></a>å¹³å‡å·¥èµ„çš„ç™¾åˆ†ä½æ•°</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€: â€œjob.keywordâ€,<br>        â€œsizeâ€: 10<br>      },<br>      â€œaggsâ€: {<br>        â€œavg_salaryâ€: {<br>          â€œavgâ€: {<br>            â€œfieldâ€: â€œsalaryâ€<br>          }<br>        }<br>      }<br>    },<br>    â€œpercentiles_salary_by_jobâ€:{<br>      â€œpercentiles_bucketâ€: {<br>        â€œbuckets_pathâ€: â€œjobs&gt;avg_salaryâ€<br>      }<br>    }<br>  }<br>}</p><p>#æŒ‰ç…§å¹´é¾„å¯¹å¹³å‡å·¥èµ„æ±‚å¯¼<br>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œageâ€: {<br>      â€œhistogramâ€: {<br>        â€œfieldâ€: â€œageâ€,<br>        â€œmin_doc_countâ€: 1,<br>        â€œintervalâ€: 1<br>      },<br>      â€œaggsâ€: {<br>        â€œavg_salaryâ€: {<br>          â€œavgâ€: {<br>            â€œfieldâ€: â€œsalaryâ€<br>          }<br>        },<br>        â€œderivative_avg_salaryâ€:{<br>          â€œderivativeâ€: {<br>            â€œbuckets_pathâ€: â€œavg_salaryâ€<br>          }<br>        }<br>      }<br>    }<br>  }<br>}</p><p>#Cumulative_sum<br>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œageâ€: {<br>      â€œhistogramâ€: {<br>        â€œfieldâ€: â€œageâ€,<br>        â€œmin_doc_countâ€: 1,<br>        â€œintervalâ€: 1<br>      },<br>      â€œaggsâ€: {<br>        â€œavg_salaryâ€: {<br>          â€œavgâ€: {<br>            â€œfieldâ€: â€œsalaryâ€<br>          }<br>        },<br>        â€œcumulative_salaryâ€:{<br>          â€œcumulative_sumâ€: {<br>            â€œbuckets_pathâ€: â€œavg_salaryâ€<br>          }<br>        }<br>      }<br>    }<br>  }<br>}</p><p>#Moving Function<br>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œageâ€: {<br>      â€œhistogramâ€: {<br>        â€œfieldâ€: â€œageâ€,<br>        â€œmin_doc_countâ€: 1,<br>        â€œintervalâ€: 1<br>      },<br>      â€œaggsâ€: {<br>        â€œavg_salaryâ€: {<br>          â€œavgâ€: {<br>            â€œfieldâ€: â€œsalaryâ€<br>          }<br>        },<br>        â€œmoving_avg_salaryâ€:{<br>          â€œmoving_fnâ€: {<br>            â€œbuckets_pathâ€: â€œavg_salaryâ€,<br>            â€œwindowâ€:10,<br>            â€œscriptâ€: â€œMovingFunctions.min(values)â€<br>          }<br>        }<br>      }<br>    }<br>  }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><span class="hljs-meta"># 6.3-ä½œç”¨èŒƒå›´ä¸æ’åº.md</span><br><br><span class="hljs-meta"># ä½œç”¨èŒƒå›´ä¸æ’åº</span><br></code></pre></td></tr></table></figure><p>DELETE &#x2F;employees<br>PUT &#x2F;employees&#x2F;<br>{<br>  â€œmappingsâ€ : {<br>      â€œpropertiesâ€ : {<br>        â€œageâ€ : {<br>          â€œtypeâ€ : â€œintegerâ€<br>        },<br>        â€œgenderâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œjobâ€ : {<br>          â€œtypeâ€ : â€œtextâ€,<br>          â€œfieldsâ€ : {<br>            â€œkeywordâ€ : {<br>              â€œtypeâ€ : â€œkeywordâ€,<br>              â€œignore_aboveâ€ : 50<br>            }<br>          }<br>        },<br>        â€œnameâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œsalaryâ€ : {<br>          â€œtypeâ€ : â€œintegerâ€<br>        }<br>      }<br>    }<br>}</p><p>PUT &#x2F;employees&#x2F;_bulk<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ1â€ } }<br>{ â€œnameâ€ : â€œEmmaâ€,â€ageâ€:32,â€jobâ€:â€Product Managerâ€,â€genderâ€:â€femaleâ€,â€salaryâ€:35000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ2â€ } }<br>{ â€œnameâ€ : â€œUnderwoodâ€,â€ageâ€:41,â€jobâ€:â€Dev Managerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 50000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ3â€ } }<br>{ â€œnameâ€ : â€œTranâ€,â€ageâ€:25,â€jobâ€:â€Web Designerâ€,â€genderâ€:â€maleâ€,â€salaryâ€:18000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ4â€ } }<br>{ â€œnameâ€ : â€œRiveraâ€,â€ageâ€:26,â€jobâ€:â€Web Designerâ€,â€genderâ€:â€femaleâ€,â€salaryâ€: 22000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ5â€ } }<br>{ â€œnameâ€ : â€œRoseâ€,â€ageâ€:25,â€jobâ€:â€QAâ€,â€genderâ€:â€femaleâ€,â€salaryâ€:18000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ6â€ } }<br>{ â€œnameâ€ : â€œLucyâ€,â€ageâ€:31,â€jobâ€:â€QAâ€,â€genderâ€:â€femaleâ€,â€salaryâ€: 25000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ7â€ } }<br>{ â€œnameâ€ : â€œByrdâ€,â€ageâ€:27,â€jobâ€:â€QAâ€,â€genderâ€:â€maleâ€,â€salaryâ€:20000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ8â€ } }<br>{ â€œnameâ€ : â€œFosterâ€,â€ageâ€:27,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 20000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ9â€ } }<br>{ â€œnameâ€ : â€œGregoryâ€,â€ageâ€:32,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€:22000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ10â€ } }<br>{ â€œnameâ€ : â€œBryantâ€,â€ageâ€:20,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 9000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ11â€ } }<br>{ â€œnameâ€ : â€œJennyâ€,â€ageâ€:36,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€femaleâ€,â€salaryâ€:38000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ12â€ } }<br>{ â€œnameâ€ : â€œMcdonaldâ€,â€ageâ€:31,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 32000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ13â€ } }<br>{ â€œnameâ€ : â€œJonthnaâ€,â€ageâ€:30,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€femaleâ€,â€salaryâ€:30000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ14â€ } }<br>{ â€œnameâ€ : â€œMarshallâ€,â€ageâ€:32,â€jobâ€:â€Javascript Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 25000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ15â€ } }<br>{ â€œnameâ€ : â€œKingâ€,â€ageâ€:33,â€jobâ€:â€Java Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€:28000 }<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ16â€ } }<br>{ â€œnameâ€ : â€œMccarthyâ€,â€ageâ€:21,â€jobâ€:â€Javascript Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 16000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ17â€ } }<br>{ â€œnameâ€ : â€œGoodwinâ€,â€ageâ€:25,â€jobâ€:â€Javascript Programmerâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 16000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ18â€ } }<br>{ â€œnameâ€ : â€œCatherineâ€,â€ageâ€:29,â€jobâ€:â€Javascript Programmerâ€,â€genderâ€:â€femaleâ€,â€salaryâ€: 20000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ19â€ } }<br>{ â€œnameâ€ : â€œBooneâ€,â€ageâ€:30,â€jobâ€:â€DBAâ€,â€genderâ€:â€maleâ€,â€salaryâ€: 30000}<br>{ â€œindexâ€ : {  â€œ_idâ€ : â€œ20â€ } }<br>{ â€œnameâ€ : â€œKathyâ€,â€ageâ€:29,â€jobâ€:â€DBAâ€,â€genderâ€:â€femaleâ€,â€salaryâ€: 20000}</p><h1 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h1><p>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œqueryâ€: {<br>    â€œrangeâ€: {<br>      â€œageâ€: {<br>        â€œgteâ€: 20<br>      }<br>    }<br>  },<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€:â€job.keywordâ€</p><pre><code class="hljs">  &#125;&#125;</code></pre><p>  }<br>}</p><p>#Filter<br>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œolder_personâ€: {<br>      â€œfilterâ€:{<br>        â€œrangeâ€:{<br>          â€œageâ€:{<br>            â€œfromâ€:35<br>          }<br>        }<br>      },<br>      â€œaggsâ€:{<br>         â€œjobsâ€:{<br>           â€œtermsâ€: {<br>        â€œfieldâ€:â€job.keywordâ€<br>      }<br>      }<br>    }},<br>    â€œall_jobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€:â€job.keywordâ€</p><pre><code class="hljs">  &#125;&#125;</code></pre><p>  }<br>}</p><p>#Post field. ä¸€æ¡è¯­å¥ï¼Œæ‰¾å‡ºæ‰€æœ‰çš„jobç±»å‹ã€‚è¿˜èƒ½æ‰¾åˆ°èšåˆåç¬¦åˆæ¡ä»¶çš„ç»“æœ<br>POST employees&#x2F;_search<br>{<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€: â€œjob.keywordâ€<br>      }<br>    }<br>  },<br>  â€œpost_filterâ€: {<br>    â€œmatchâ€: {<br>      â€œjob.keywordâ€: â€œDev Managerâ€<br>    }<br>  }<br>}</p><p>#global<br>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œqueryâ€: {<br>    â€œrangeâ€: {<br>      â€œageâ€: {<br>        â€œgteâ€: 40<br>      }<br>    }<br>  },<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€:â€job.keywordâ€</p><pre><code class="hljs">  &#125;&#125;,&quot;all&quot;:&#123;  &quot;global&quot;:&#123;&#125;,  &quot;aggs&quot;:&#123;    &quot;salary_avg&quot;:&#123;      &quot;avg&quot;:&#123;        &quot;field&quot;:&quot;salary&quot;      &#125;    &#125;  &#125;&#125;</code></pre><p>  }<br>}</p><p>#æ’åº order<br>#count and key<br>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œqueryâ€: {<br>    â€œrangeâ€: {<br>      â€œageâ€: {<br>        â€œgteâ€: 20<br>      }<br>    }<br>  },<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€:â€job.keywordâ€,<br>        â€œorderâ€:[<br>          {â€œ_countâ€:â€ascâ€},<br>          {â€œ_keyâ€:â€descâ€}<br>          ]</p><pre><code class="hljs">  &#125;&#125;</code></pre><p>  }<br>}</p><p>#æ’åº order<br>#count and key<br>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€:â€job.keywordâ€,<br>        â€œorderâ€:[  {<br>            â€œavg_salaryâ€:â€descâ€<br>          }]</p><pre><code class="hljs">  &#125;,&quot;aggs&quot;: &#123;  &quot;avg_salary&quot;: &#123;    &quot;avg&quot;: &#123;      &quot;field&quot;:&quot;salary&quot;    &#125;  &#125;&#125;&#125;</code></pre><p>  }<br>}</p><p>#æ’åº order<br>#count and key<br>POST employees&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œjobsâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€:â€job.keywordâ€,<br>        â€œorderâ€:[  {<br>            â€œstats_salary.minâ€:â€descâ€<br>          }]</p><pre><code class="hljs">  &#125;,&quot;aggs&quot;: &#123;  &quot;stats_salary&quot;: &#123;    &quot;stats&quot;: &#123;      &quot;field&quot;:&quot;salary&quot;    &#125;  &#125;&#125;&#125;</code></pre><p>  }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><span class="hljs-meta"># 6.4-èšåˆåˆ†æçš„åŸç†åŠç²¾å‡†åº¦é—®é¢˜.md</span><br><br><span class="hljs-meta"># èšåˆåˆ†æçš„åŸç†åŠç²¾å‡†åº¦é—®é¢˜</span><br></code></pre></td></tr></table></figure><p>DELETE my_flights<br>PUT my_flights<br>{<br>  â€œsettingsâ€: {<br>    â€œnumber_of_shardsâ€: 20<br>  },<br>  â€œmappingsâ€ : {<br>      â€œpropertiesâ€ : {<br>        â€œAvgTicketPriceâ€ : {<br>          â€œtypeâ€ : â€œfloatâ€<br>        },<br>        â€œCancelledâ€ : {<br>          â€œtypeâ€ : â€œbooleanâ€<br>        },<br>        â€œCarrierâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œDestâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œDestAirportIDâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œDestCityNameâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œDestCountryâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œDestLocationâ€ : {<br>          â€œtypeâ€ : â€œgeo_pointâ€<br>        },<br>        â€œDestRegionâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œDestWeatherâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œDistanceKilometersâ€ : {<br>          â€œtypeâ€ : â€œfloatâ€<br>        },<br>        â€œDistanceMilesâ€ : {<br>          â€œtypeâ€ : â€œfloatâ€<br>        },<br>        â€œFlightDelayâ€ : {<br>          â€œtypeâ€ : â€œbooleanâ€<br>        },<br>        â€œFlightDelayMinâ€ : {<br>          â€œtypeâ€ : â€œintegerâ€<br>        },<br>        â€œFlightDelayTypeâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œFlightNumâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œFlightTimeHourâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œFlightTimeMinâ€ : {<br>          â€œtypeâ€ : â€œfloatâ€<br>        },<br>        â€œOriginâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œOriginAirportIDâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œOriginCityNameâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œOriginCountryâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œOriginLocationâ€ : {<br>          â€œtypeâ€ : â€œgeo_pointâ€<br>        },<br>        â€œOriginRegionâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œOriginWeatherâ€ : {<br>          â€œtypeâ€ : â€œkeywordâ€<br>        },<br>        â€œdayOfWeekâ€ : {<br>          â€œtypeâ€ : â€œintegerâ€<br>        },<br>        â€œtimestampâ€ : {<br>          â€œtypeâ€ : â€œdateâ€<br>        }<br>      }<br>    }<br>}</p><p>POST _reindex<br>{<br>  â€œsourceâ€: {<br>    â€œindexâ€: â€œkibana_sample_data_flightsâ€<br>  },<br>  â€œdestâ€: {<br>    â€œindexâ€: â€œmy_flightsâ€<br>  }<br>}</p><p>GET kibana_sample_data_flights&#x2F;_count<br>GET my_flights&#x2F;_count</p><p>get kibana_sample_data_flights&#x2F;_search</p><p>GET kibana_sample_data_flights&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œweatherâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€:â€OriginWeatherâ€,<br>        â€œsizeâ€:5,<br>        â€œshow_term_doc_count_errorâ€:true<br>      }<br>    }<br>  }<br>}</p><p>GET my_flights&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œweatherâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€:â€OriginWeatherâ€,<br>        â€œsizeâ€:1,<br>        â€œshard_sizeâ€:1,<br>        â€œshow_term_doc_count_errorâ€:true<br>      }<br>    }<br>  }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># 7.1-å¯¹è±¡åŠ Nested å¯¹è±¡.md</span><br><br><span class="hljs-meta"># å¯¹è±¡åŠNestedå¯¹è±¡</span><br></code></pre></td></tr></table></figure><p>DELETE blog</p><h1 id="è®¾ç½®blogçš„-Mapping"><a href="#è®¾ç½®blogçš„-Mapping" class="headerlink" title="è®¾ç½®blogçš„ Mapping"></a>è®¾ç½®blogçš„ Mapping</h1><p>PUT &#x2F;blog<br>{<br>  â€œmappingsâ€: {<br>    â€œpropertiesâ€: {<br>      â€œcontentâ€: {<br>        â€œtypeâ€: â€œtextâ€<br>      },<br>      â€œtimeâ€: {<br>        â€œtypeâ€: â€œdateâ€<br>      },<br>      â€œuserâ€: {<br>        â€œpropertiesâ€: {<br>          â€œcityâ€: {<br>            â€œtypeâ€: â€œtextâ€<br>          },<br>          â€œuseridâ€: {<br>            â€œtypeâ€: â€œlongâ€<br>          },<br>          â€œusernameâ€: {<br>            â€œtypeâ€: â€œkeywordâ€<br>          }<br>        }<br>      }<br>    }<br>  }<br>}</p><h1 id="æ’å…¥ä¸€æ¡-Blog-ä¿¡æ¯"><a href="#æ’å…¥ä¸€æ¡-Blog-ä¿¡æ¯" class="headerlink" title="æ’å…¥ä¸€æ¡ Blog ä¿¡æ¯"></a>æ’å…¥ä¸€æ¡ Blog ä¿¡æ¯</h1><p>PUT blog&#x2F;_doc&#x2F;1<br>{<br>  â€œcontentâ€:â€I like Elasticsearchâ€,<br>  â€œtimeâ€:â€2019-01-01T00:00:00â€,<br>  â€œuserâ€:{<br>    â€œuseridâ€:1,<br>    â€œusernameâ€:â€Jackâ€,<br>    â€œcityâ€:â€Shanghaiâ€<br>  }<br>}</p><h1 id="æŸ¥è¯¢-Blog-ä¿¡æ¯"><a href="#æŸ¥è¯¢-Blog-ä¿¡æ¯" class="headerlink" title="æŸ¥è¯¢ Blog ä¿¡æ¯"></a>æŸ¥è¯¢ Blog ä¿¡æ¯</h1><p>POST blog&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€: {<br>      â€œmustâ€: [<br>        {â€œmatchâ€: {â€œcontentâ€: â€œElasticsearchâ€}},<br>        {â€œmatchâ€: {â€œuser.usernameâ€: â€œJackâ€}}<br>      ]<br>    }<br>  }<br>}</p><p>DELETE my_movies</p><h1 id="ç”µå½±çš„Mappingä¿¡æ¯"><a href="#ç”µå½±çš„Mappingä¿¡æ¯" class="headerlink" title="ç”µå½±çš„Mappingä¿¡æ¯"></a>ç”µå½±çš„Mappingä¿¡æ¯</h1><p>PUT my_movies<br>{<br>      â€œmappingsâ€ : {<br>      â€œpropertiesâ€ : {<br>        â€œactorsâ€ : {<br>          â€œpropertiesâ€ : {<br>            â€œfirst_nameâ€ : {<br>              â€œtypeâ€ : â€œkeywordâ€<br>            },<br>            â€œlast_nameâ€ : {<br>              â€œtypeâ€ : â€œkeywordâ€<br>            }<br>          }<br>        },<br>        â€œtitleâ€ : {<br>          â€œtypeâ€ : â€œtextâ€,<br>          â€œfieldsâ€ : {<br>            â€œkeywordâ€ : {<br>              â€œtypeâ€ : â€œkeywordâ€,<br>              â€œignore_aboveâ€ : 256<br>            }<br>          }<br>        }<br>      }<br>    }<br>}</p><h1 id="å†™å…¥ä¸€æ¡ç”µå½±ä¿¡æ¯"><a href="#å†™å…¥ä¸€æ¡ç”µå½±ä¿¡æ¯" class="headerlink" title="å†™å…¥ä¸€æ¡ç”µå½±ä¿¡æ¯"></a>å†™å…¥ä¸€æ¡ç”µå½±ä¿¡æ¯</h1><p>POST my_movies&#x2F;_doc&#x2F;1<br>{<br>  â€œtitleâ€:â€Speedâ€,<br>  â€œactorsâ€:[<br>    {<br>      â€œfirst_nameâ€:â€Keanuâ€,<br>      â€œlast_nameâ€:â€Reevesâ€<br>    },</p><pre><code class="hljs">&#123;  &quot;first_name&quot;:&quot;Dennis&quot;,  &quot;last_name&quot;:&quot;Hopper&quot;&#125;</code></pre><p>  ]<br>}</p><h1 id="æŸ¥è¯¢ç”µå½±ä¿¡æ¯"><a href="#æŸ¥è¯¢ç”µå½±ä¿¡æ¯" class="headerlink" title="æŸ¥è¯¢ç”µå½±ä¿¡æ¯"></a>æŸ¥è¯¢ç”µå½±ä¿¡æ¯</h1><p>POST my_movies&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€: {<br>      â€œmustâ€: [<br>        {â€œmatchâ€: {â€œactors.first_nameâ€: â€œKeanuâ€}},<br>        {â€œmatchâ€: {â€œactors.last_nameâ€: â€œHopperâ€}}<br>      ]<br>    }<br>  }</p><p>}</p><p>DELETE my_movies</p><h1 id="åˆ›å»º-Nested-å¯¹è±¡-Mapping"><a href="#åˆ›å»º-Nested-å¯¹è±¡-Mapping" class="headerlink" title="åˆ›å»º Nested å¯¹è±¡ Mapping"></a>åˆ›å»º Nested å¯¹è±¡ Mapping</h1><p>PUT my_movies<br>{<br>      â€œmappingsâ€ : {<br>      â€œpropertiesâ€ : {<br>        â€œactorsâ€ : {<br>          â€œtypeâ€: â€œnestedâ€,<br>          â€œpropertiesâ€ : {<br>            â€œfirst_nameâ€ : {â€œtypeâ€ : â€œkeywordâ€},<br>            â€œlast_nameâ€ : {â€œtypeâ€ : â€œkeywordâ€}<br>          }},<br>        â€œtitleâ€ : {<br>          â€œtypeâ€ : â€œtextâ€,<br>          â€œfieldsâ€ : {â€œkeywordâ€:{â€œtypeâ€:â€keywordâ€,â€ignore_aboveâ€:256}}<br>        }<br>      }<br>    }<br>}</p><p>POST my_movies&#x2F;_doc&#x2F;1<br>{<br>  â€œtitleâ€:â€Speedâ€,<br>  â€œactorsâ€:[<br>    {<br>      â€œfirst_nameâ€:â€Keanuâ€,<br>      â€œlast_nameâ€:â€Reevesâ€<br>    },</p><pre><code class="hljs">&#123;  &quot;first_name&quot;:&quot;Dennis&quot;,  &quot;last_name&quot;:&quot;Hopper&quot;&#125;</code></pre><p>  ]<br>}</p><h1 id="Nested-æŸ¥è¯¢"><a href="#Nested-æŸ¥è¯¢" class="headerlink" title="Nested æŸ¥è¯¢"></a>Nested æŸ¥è¯¢</h1><p>POST my_movies&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€: {<br>      â€œmustâ€: [<br>        {â€œmatchâ€: {â€œtitleâ€: â€œSpeedâ€}},<br>        {<br>          â€œnestedâ€: {<br>            â€œpathâ€: â€œactorsâ€,<br>            â€œqueryâ€: {<br>              â€œboolâ€: {<br>                â€œmustâ€: [<br>                  {â€œmatchâ€: {<br>                    â€œactors.first_nameâ€: â€œKeanuâ€<br>                  }},</p><pre><code class="hljs">              &#123;&quot;match&quot;: &#123;                &quot;actors.last_name&quot;: &quot;Hopper&quot;              &#125;&#125;            ]          &#125;        &#125;      &#125;    &#125;  ]&#125;</code></pre><p>  }<br>}</p><h1 id="Nested-Aggregation"><a href="#Nested-Aggregation" class="headerlink" title="Nested Aggregation"></a>Nested Aggregation</h1><p>POST my_movies&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œactorsâ€: {<br>      â€œnestedâ€: {<br>        â€œpathâ€: â€œactorsâ€<br>      },<br>      â€œaggsâ€: {<br>        â€œactor_nameâ€: {<br>          â€œtermsâ€: {<br>            â€œfieldâ€: â€œactors.first_nameâ€,<br>            â€œsizeâ€: 10<br>          }<br>        }<br>      }<br>    }<br>  }<br>}</p><h1 id="æ™®é€š-aggregationä¸å·¥ä½œ"><a href="#æ™®é€š-aggregationä¸å·¥ä½œ" class="headerlink" title="æ™®é€š aggregationä¸å·¥ä½œ"></a>æ™®é€š aggregationä¸å·¥ä½œ</h1><p>POST my_movies&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œNAMEâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€: â€œactors.first_nameâ€,<br>        â€œsizeâ€: 10<br>      }<br>    }<br>  }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><span class="hljs-meta"># 7.2-æ–‡æ¡£çš„çˆ¶å­å…³ç³».md</span><br><br><span class="hljs-meta"># æ–‡æ¡£çš„çˆ¶å­å…³ç³»</span><br></code></pre></td></tr></table></figure><p>DELETE my_blogs</p><h1 id="è®¾å®š-Parent-Child-Mapping"><a href="#è®¾å®š-Parent-Child-Mapping" class="headerlink" title="è®¾å®š Parent&#x2F;Child Mapping"></a>è®¾å®š Parent&#x2F;Child Mapping</h1><p>PUT my_blogs<br>{<br>  â€œsettingsâ€: {<br>    â€œnumber_of_shardsâ€: 2<br>  },<br>  â€œmappingsâ€: {<br>    â€œpropertiesâ€: {<br>      â€œblog_comments_relationâ€: {<br>        â€œtypeâ€: â€œjoinâ€,<br>        â€œrelationsâ€: {<br>          â€œblogâ€: â€œcommentâ€<br>        }<br>      },<br>      â€œcontentâ€: {<br>        â€œtypeâ€: â€œtextâ€<br>      },<br>      â€œtitleâ€: {<br>        â€œtypeâ€: â€œkeywordâ€<br>      }<br>    }<br>  }<br>}</p><p>#ç´¢å¼•çˆ¶æ–‡æ¡£<br>PUT my_blogs&#x2F;_doc&#x2F;blog1<br>{<br>  â€œtitleâ€:â€Learning Elasticsearchâ€,<br>  â€œcontentâ€:â€learning ELK @ geektimeâ€,<br>  â€œblog_comments_relationâ€:{<br>    â€œnameâ€:â€blogâ€<br>  }<br>}</p><p>#ç´¢å¼•çˆ¶æ–‡æ¡£<br>PUT my_blogs&#x2F;_doc&#x2F;blog2<br>{<br>  â€œtitleâ€:â€Learning Hadoopâ€,<br>  â€œcontentâ€:â€learning Hadoopâ€,<br>    â€œblog_comments_relationâ€:{<br>    â€œnameâ€:â€blogâ€<br>  }<br>}</p><p>#ç´¢å¼•å­æ–‡æ¡£<br>PUT my_blogs&#x2F;_doc&#x2F;comment1?routing&#x3D;blog1<br>{<br>  â€œcommentâ€:â€I am learning ELKâ€,<br>  â€œusernameâ€:â€Jackâ€,<br>  â€œblog_comments_relationâ€:{<br>    â€œnameâ€:â€commentâ€,<br>    â€œparentâ€:â€blog1â€<br>  }<br>}</p><p>#ç´¢å¼•å­æ–‡æ¡£<br>PUT my_blogs&#x2F;_doc&#x2F;comment2?routing&#x3D;blog2<br>{<br>  â€œcommentâ€:â€I like Hadoop!!!!!â€,<br>  â€œusernameâ€:â€Jackâ€,<br>  â€œblog_comments_relationâ€:{<br>    â€œnameâ€:â€commentâ€,<br>    â€œparentâ€:â€blog2â€<br>  }<br>}</p><p>#ç´¢å¼•å­æ–‡æ¡£<br>PUT my_blogs&#x2F;_doc&#x2F;comment3?routing&#x3D;blog2<br>{<br>  â€œcommentâ€:â€Hello Hadoopâ€,<br>  â€œusernameâ€:â€Bobâ€,<br>  â€œblog_comments_relationâ€:{<br>    â€œnameâ€:â€commentâ€,<br>    â€œparentâ€:â€blog2â€<br>  }<br>}</p><h1 id="æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£"><a href="#æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£" class="headerlink" title="æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£"></a>æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£</h1><p>POST my_blogs&#x2F;_search<br>{</p><p>}</p><p>#æ ¹æ®çˆ¶æ–‡æ¡£IDæŸ¥çœ‹<br>GET my_blogs&#x2F;_doc&#x2F;blog2</p><h1 id="Parent-Id-æŸ¥è¯¢"><a href="#Parent-Id-æŸ¥è¯¢" class="headerlink" title="Parent Id æŸ¥è¯¢"></a>Parent Id æŸ¥è¯¢</h1><p>POST my_blogs&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œparent_idâ€: {<br>      â€œtypeâ€: â€œcommentâ€,<br>      â€œidâ€: â€œblog2â€<br>    }<br>  }<br>}</p><h1 id="Has-Child-æŸ¥è¯¢-è¿”å›çˆ¶æ–‡æ¡£"><a href="#Has-Child-æŸ¥è¯¢-è¿”å›çˆ¶æ–‡æ¡£" class="headerlink" title="Has Child æŸ¥è¯¢,è¿”å›çˆ¶æ–‡æ¡£"></a>Has Child æŸ¥è¯¢,è¿”å›çˆ¶æ–‡æ¡£</h1><p>POST my_blogs&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œhas_childâ€: {<br>      â€œtypeâ€: â€œcommentâ€,<br>      â€œqueryâ€ : {<br>                â€œmatchâ€: {<br>                    â€œusernameâ€ : â€œJackâ€<br>                }<br>            }<br>    }<br>  }<br>}</p><h1 id="Has-Parent-æŸ¥è¯¢ï¼Œè¿”å›ç›¸å…³çš„å­æ–‡æ¡£"><a href="#Has-Parent-æŸ¥è¯¢ï¼Œè¿”å›ç›¸å…³çš„å­æ–‡æ¡£" class="headerlink" title="Has Parent æŸ¥è¯¢ï¼Œè¿”å›ç›¸å…³çš„å­æ–‡æ¡£"></a>Has Parent æŸ¥è¯¢ï¼Œè¿”å›ç›¸å…³çš„å­æ–‡æ¡£</h1><p>POST my_blogs&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œhas_parentâ€: {<br>      â€œparent_typeâ€: â€œblogâ€,<br>      â€œqueryâ€ : {<br>                â€œmatchâ€: {<br>                    â€œtitleâ€ : â€œLearning Hadoopâ€<br>                }<br>            }<br>    }<br>  }<br>}</p><p>#é€šè¿‡ID ï¼Œè®¿é—®å­æ–‡æ¡£<br>GET my_blogs&#x2F;_doc&#x2F;comment3<br>#é€šè¿‡IDå’Œrouting ï¼Œè®¿é—®å­æ–‡æ¡£<br>GET my_blogs&#x2F;_doc&#x2F;comment3?routing&#x3D;blog2</p><p>#æ›´æ–°å­æ–‡æ¡£<br>PUT my_blogs&#x2F;_doc&#x2F;comment3?routing&#x3D;blog2<br>{<br>    â€œcommentâ€: â€œHello Hadoop??â€,<br>    â€œblog_comments_relationâ€: {<br>      â€œnameâ€: â€œcommentâ€,<br>      â€œparentâ€: â€œblog2â€<br>    }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><span class="hljs-meta"># 7.5-Elasticsearchæ•°æ®å»ºæ¨¡å®ä¾‹.md</span><br><br><span class="hljs-meta"># Elasticsearch æ•°æ®å»ºæ¨¡å®ä¾‹</span><br></code></pre></td></tr></table></figure><h6 id="Data-Modeling-Example"><a href="#Data-Modeling-Example" class="headerlink" title="Data Modeling Example"></a>Data Modeling Example</h6><h1 id="Index-ä¸€æœ¬ä¹¦çš„ä¿¡æ¯"><a href="#Index-ä¸€æœ¬ä¹¦çš„ä¿¡æ¯" class="headerlink" title="Index ä¸€æœ¬ä¹¦çš„ä¿¡æ¯"></a>Index ä¸€æœ¬ä¹¦çš„ä¿¡æ¯</h1><p>PUT books&#x2F;_doc&#x2F;1<br>{<br>  â€œtitleâ€:â€Mastering ElasticSearch 5.0â€,<br>  â€œdescriptionâ€:â€Master the searching, indexing, and aggregation features in ElasticSearch Improve usersâ€™ search experience with Elasticsearchâ€™s functionalities and develop your own Elasticsearch pluginsâ€,<br>  â€œauthorâ€:â€Bharvi Dixitâ€,<br>  â€œpublic_dateâ€:â€2017â€,<br>  â€œcover_urlâ€:â€<a href="https://images-na.ssl-images-amazon.com/images/I/51OeaMFxcML.jpg">https://images-na.ssl-images-amazon.com/images/I/51OeaMFxcML.jpg</a>â€œ<br>}</p><p>#æŸ¥è¯¢è‡ªåŠ¨åˆ›å»ºçš„Mapping<br>GET books&#x2F;_mapping</p><p>DELETE books</p><p>#ä¼˜åŒ–å­—æ®µç±»å‹<br>PUT books<br>{<br>      â€œmappingsâ€ : {<br>      â€œpropertiesâ€ : {<br>        â€œauthorâ€ : {â€œtypeâ€ : â€œkeywordâ€},<br>        â€œcover_urlâ€ : {â€œtypeâ€ : â€œkeywordâ€,â€indexâ€: false},<br>        â€œdescriptionâ€ : {â€œtypeâ€ : â€œtextâ€},<br>        â€œpublic_dateâ€ : {â€œtypeâ€ : â€œdateâ€},<br>        â€œtitleâ€ : {<br>          â€œtypeâ€ : â€œtextâ€,<br>          â€œfieldsâ€ : {<br>            â€œkeywordâ€ : {<br>              â€œtypeâ€ : â€œkeywordâ€,<br>              â€œignore_aboveâ€ : 100<br>            }<br>          }<br>        }<br>      }<br>    }<br>}</p><p>#Cover URL index è®¾ç½®æˆfalseï¼Œæ— æ³•å¯¹è¯¥å­—æ®µè¿›è¡Œæœç´¢<br>POST books&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œcover_urlâ€: {<br>        â€œvalueâ€: â€œ<a href="https://images-na.ssl-images-amazon.com/images/I/51OeaMFxcML.jpg">https://images-na.ssl-images-amazon.com/images/I/51OeaMFxcML.jpg</a>â€œ<br>      }<br>    }<br>  }<br>}</p><p>#Cover URL index è®¾ç½®æˆfalseï¼Œä¾ç„¶æ”¯æŒèšåˆåˆ†æ<br>POST books&#x2F;_search<br>{<br>  â€œaggsâ€: {<br>    â€œcoverâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€: â€œcover_urlâ€,<br>        â€œsizeâ€: 10<br>      }<br>    }<br>  }<br>}</p><p>DELETE books<br>#æ–°å¢ Contentå­—æ®µã€‚æ•°æ®é‡å¾ˆå¤§ã€‚é€‰æ‹©å°†Source å…³é—­<br>PUT books<br>{<br>      â€œmappingsâ€ : {<br>      â€œ_sourceâ€: {â€œenabledâ€: false},<br>      â€œpropertiesâ€ : {<br>        â€œauthorâ€ : {â€œtypeâ€ : â€œkeywordâ€,â€storeâ€: true},<br>        â€œcover_urlâ€ : {â€œtypeâ€ : â€œkeywordâ€,â€indexâ€: false,â€storeâ€: true},<br>        â€œdescriptionâ€ : {â€œtypeâ€ : â€œtextâ€,â€storeâ€: true},<br>         â€œcontentâ€ : {â€œtypeâ€ : â€œtextâ€,â€storeâ€: true},<br>        â€œpublic_dateâ€ : {â€œtypeâ€ : â€œdateâ€,â€storeâ€: true},<br>        â€œtitleâ€ : {<br>          â€œtypeâ€ : â€œtextâ€,<br>          â€œfieldsâ€ : {<br>            â€œkeywordâ€ : {<br>              â€œtypeâ€ : â€œkeywordâ€,<br>              â€œignore_aboveâ€ : 100<br>            }<br>          },<br>          â€œstoreâ€: true<br>        }<br>      }<br>    }<br>}</p><h1 id="Index-ä¸€æœ¬ä¹¦çš„ä¿¡æ¯-åŒ…å«Content"><a href="#Index-ä¸€æœ¬ä¹¦çš„ä¿¡æ¯-åŒ…å«Content" class="headerlink" title="Index ä¸€æœ¬ä¹¦çš„ä¿¡æ¯,åŒ…å«Content"></a>Index ä¸€æœ¬ä¹¦çš„ä¿¡æ¯,åŒ…å«Content</h1><p>PUT books&#x2F;_doc&#x2F;1<br>{<br>  â€œtitleâ€:â€Mastering ElasticSearch 5.0â€,<br>  â€œdescriptionâ€:â€Master the searching, indexing, and aggregation features in ElasticSearch Improve usersâ€™ search experience with Elasticsearchâ€™s functionalities and develop your own Elasticsearch pluginsâ€,<br>  â€œcontentâ€:â€The content of the bookâ€¦â€¦Indexing data, aggregation, searching.    something else. something in the wayâ€¦â€¦â€¦â€¦â€,<br>  â€œauthorâ€:â€Bharvi Dixitâ€,<br>  â€œpublic_dateâ€:â€2017â€,<br>  â€œcover_urlâ€:â€<a href="https://images-na.ssl-images-amazon.com/images/I/51OeaMFxcML.jpg">https://images-na.ssl-images-amazon.com/images/I/51OeaMFxcML.jpg</a>â€œ<br>}</p><p>#æŸ¥è¯¢ç»“æœä¸­ï¼ŒSourceä¸åŒ…å«æ•°æ®<br>POST books&#x2F;_search<br>{}</p><p>#æœç´¢ï¼Œé€šè¿‡store å­—æ®µæ˜¾ç¤ºæ•°æ®ï¼ŒåŒæ—¶é«˜äº®æ˜¾ç¤º conentçš„å†…å®¹<br>POST books&#x2F;_search<br>{<br>  â€œstored_fieldsâ€: [â€œtitleâ€,â€authorâ€,â€public_dateâ€],<br>  â€œqueryâ€: {<br>    â€œmatchâ€: {<br>      â€œcontentâ€: â€œsearchingâ€<br>    }<br>  },</p><p>  â€œhighlightâ€: {<br>    â€œfieldsâ€: {<br>      â€œcontentâ€:{}<br>    }<br>  }</p><p>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># 7.6-Elasticsearch æ•°æ®å»ºæ¨¡æœ€ä½³å®è·µ.md</span><br><br><span class="hljs-meta"># Elasticsearch æ•°æ®å»ºæ¨¡æœ€ä½³å®è·µ</span><br><br><br></code></pre></td></tr></table></figure><h6 id="Cookie-Service"><a href="#Cookie-Service" class="headerlink" title="Cookie Service"></a>Cookie Service</h6><p>##ç´¢å¼•æ•°æ®ï¼Œdynamic mapping ä¼šä¸æ–­åŠ å…¥æ–°å¢å­—æ®µ<br>PUT cookie_service&#x2F;_doc&#x2F;1<br>{<br> â€œurlâ€:â€<a href="http://www.google.com/">www.google.com</a>â€œ,<br> â€œcookiesâ€:{<br>   â€œusernameâ€:â€tomâ€,<br>   â€œageâ€:32<br> }<br>}</p><p>PUT cookie_service&#x2F;_doc&#x2F;2<br>{<br> â€œurlâ€:â€<a href="http://www.amazon.com/">www.amazon.com</a>â€œ,<br> â€œcookiesâ€:{<br>   â€œloginâ€:â€2019-01-01â€,<br>   â€œemailâ€:â€<a href="mailto:&#x78;&#x79;&#122;&#x40;&#97;&#98;&#x63;&#x2e;&#x63;&#x6f;&#x6d;">&#x78;&#x79;&#122;&#x40;&#97;&#98;&#x63;&#x2e;&#x63;&#x6f;&#x6d;</a>â€œ<br> }<br>}</p><p>DELETE cookie_service<br>#ä½¿ç”¨ Nested å¯¹è±¡ï¼Œå¢åŠ key&#x2F;value<br>PUT cookie_service<br>{<br>  â€œmappingsâ€: {<br>    â€œpropertiesâ€: {<br>      â€œcookiesâ€: {<br>        â€œtypeâ€: â€œnestedâ€,<br>        â€œpropertiesâ€: {<br>          â€œnameâ€: {<br>            â€œtypeâ€: â€œkeywordâ€<br>          },<br>          â€œdateValueâ€: {<br>            â€œtypeâ€: â€œdateâ€<br>          },<br>          â€œkeywordValueâ€: {<br>            â€œtypeâ€: â€œkeywordâ€<br>          },<br>          â€œIntValueâ€: {<br>            â€œtypeâ€: â€œintegerâ€<br>          }<br>        }<br>      },<br>      â€œurlâ€: {<br>        â€œtypeâ€: â€œtextâ€,<br>        â€œfieldsâ€: {<br>          â€œkeywordâ€: {<br>            â€œtypeâ€: â€œkeywordâ€,<br>            â€œignore_aboveâ€: 256<br>          }<br>        }<br>      }<br>    }<br>  }<br>}</p><p>##å†™å…¥æ•°æ®ï¼Œä½¿ç”¨keyå’Œåˆé€‚ç±»å‹çš„valueå­—æ®µ<br>PUT cookie_service&#x2F;_doc&#x2F;1<br>{<br> â€œurlâ€:â€<a href="http://www.google.com/">www.google.com</a>â€œ,<br> â€œcookiesâ€:[<br>    {<br>      â€œnameâ€:â€usernameâ€,<br>      â€œkeywordValueâ€:â€tomâ€<br>    },<br>    {<br>       â€œnameâ€:â€ageâ€,<br>      â€œintValueâ€:32</p><pre><code class="hljs">&#125;</code></pre><p>   ]<br> }</p><p>PUT cookie_service&#x2F;_doc&#x2F;2<br>{<br> â€œurlâ€:â€<a href="http://www.amazon.com/">www.amazon.com</a>â€œ,<br> â€œcookiesâ€:[<br>    {<br>      â€œnameâ€:â€loginâ€,<br>      â€œdateValueâ€:â€2019-01-01â€<br>    },<br>    {<br>       â€œnameâ€:â€emailâ€,<br>      â€œIntValueâ€:32</p><pre><code class="hljs">&#125;</code></pre><p>   ]<br> }</p><h1 id="Nested-æŸ¥è¯¢ï¼Œé€šè¿‡boolæŸ¥è¯¢è¿›è¡Œè¿‡æ»¤"><a href="#Nested-æŸ¥è¯¢ï¼Œé€šè¿‡boolæŸ¥è¯¢è¿›è¡Œè¿‡æ»¤" class="headerlink" title="Nested æŸ¥è¯¢ï¼Œé€šè¿‡boolæŸ¥è¯¢è¿›è¡Œè¿‡æ»¤"></a>Nested æŸ¥è¯¢ï¼Œé€šè¿‡boolæŸ¥è¯¢è¿›è¡Œè¿‡æ»¤</h1><p>POST cookie_service&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œnestedâ€: {<br>      â€œpathâ€: â€œcookiesâ€,<br>      â€œqueryâ€: {<br>        â€œboolâ€: {<br>          â€œfilterâ€: [<br>            {<br>            â€œtermâ€: {<br>              â€œcookies.nameâ€: â€œageâ€<br>            }},<br>            {<br>              â€œrangeâ€:{<br>                â€œcookies.intValueâ€:{<br>                  â€œgteâ€:30<br>                }<br>              }<br>            }<br>          ]<br>        }<br>      }<br>    }<br>  }<br>}</p><h1 id="åœ¨Mappingä¸­åŠ å…¥å…ƒä¿¡æ¯ï¼Œä¾¿äºç®¡ç†"><a href="#åœ¨Mappingä¸­åŠ å…¥å…ƒä¿¡æ¯ï¼Œä¾¿äºç®¡ç†" class="headerlink" title="åœ¨Mappingä¸­åŠ å…¥å…ƒä¿¡æ¯ï¼Œä¾¿äºç®¡ç†"></a>åœ¨Mappingä¸­åŠ å…¥å…ƒä¿¡æ¯ï¼Œä¾¿äºç®¡ç†</h1><p>PUT softwares&#x2F;<br>{<br>  â€œmappingsâ€: {<br>    â€œ_metaâ€: {<br>      â€œsoftware_version_mappingâ€: â€œ1.0â€<br>    }<br>  }<br>}</p><p>GET softwares&#x2F;_mapping<br>PUT softwares&#x2F;_doc&#x2F;1<br>{<br>  â€œsoftware_versionâ€:â€7.1.0â€<br>}</p><p>DELETE softwares</p><h1 id="ä¼˜åŒ–-ä½¿ç”¨inner-object"><a href="#ä¼˜åŒ–-ä½¿ç”¨inner-object" class="headerlink" title="ä¼˜åŒ–,ä½¿ç”¨inner object"></a>ä¼˜åŒ–,ä½¿ç”¨inner object</h1><p>PUT softwares&#x2F;<br>{<br>  â€œmappingsâ€: {<br>    â€œ_metaâ€: {<br>      â€œsoftware_version_mappingâ€: â€œ1.1â€<br>    },<br>    â€œpropertiesâ€: {<br>      â€œversionâ€: {<br>        â€œpropertiesâ€: {<br>          â€œdisplay_nameâ€: {<br>            â€œtypeâ€: â€œkeywordâ€<br>          },<br>          â€œhot_fixâ€: {<br>            â€œtypeâ€: â€œbyteâ€<br>          },<br>          â€œmarjorâ€: {<br>            â€œtypeâ€: â€œbyteâ€<br>          },<br>          â€œminorâ€: {<br>            â€œtypeâ€: â€œbyteâ€<br>          }<br>        }<br>      }<br>    }<br>  }<br>}</p><p>#é€šè¿‡ Inner Object å†™å…¥å¤šä¸ªæ–‡æ¡£<br>PUT softwares&#x2F;_doc&#x2F;1<br>{<br>  â€œversionâ€:{<br>  â€œdisplay_nameâ€:â€7.1.0â€,<br>  â€œmarjorâ€:7,<br>  â€œminorâ€:1,<br>  â€œhot_fixâ€:0<br>  }</p><p>}</p><p>PUT softwares&#x2F;_doc&#x2F;2<br>{<br>  â€œversionâ€:{<br>  â€œdisplay_nameâ€:â€7.2.0â€,<br>  â€œmarjorâ€:7,<br>  â€œminorâ€:2,<br>  â€œhot_fixâ€:0<br>  }<br>}</p><p>PUT softwares&#x2F;_doc&#x2F;3<br>{<br>  â€œversionâ€:{<br>  â€œdisplay_nameâ€:â€7.2.1â€,<br>  â€œmarjorâ€:7,<br>  â€œminorâ€:2,<br>  â€œhot_fixâ€:1<br>  }<br>}</p><h1 id="é€šè¿‡-bool-æŸ¥è¯¢ï¼Œ"><a href="#é€šè¿‡-bool-æŸ¥è¯¢ï¼Œ" class="headerlink" title="é€šè¿‡ bool æŸ¥è¯¢ï¼Œ"></a>é€šè¿‡ bool æŸ¥è¯¢ï¼Œ</h1><p>POST softwares&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œboolâ€: {<br>      â€œfilterâ€: [<br>        {<br>          â€œmatchâ€:{<br>            â€œversion.marjorâ€:7<br>          }<br>        },<br>        {<br>          â€œmatchâ€:{<br>            â€œversion.minorâ€:2<br>          }<br>        }</p><pre><code class="hljs">  ]&#125;</code></pre><p>  }<br>}</p><h1 id="Not-Null-è§£å†³èšåˆçš„é—®é¢˜"><a href="#Not-Null-è§£å†³èšåˆçš„é—®é¢˜" class="headerlink" title="Not Null è§£å†³èšåˆçš„é—®é¢˜"></a>Not Null è§£å†³èšåˆçš„é—®é¢˜</h1><p>DELETE ratings<br>PUT ratings<br>{<br>  â€œmappingsâ€: {<br>      â€œpropertiesâ€: {<br>        â€œratingâ€: {<br>          â€œtypeâ€: â€œfloatâ€,<br>          â€œnull_valueâ€: 1.0<br>        }<br>      }<br>    }<br>}</p><p>PUT ratings&#x2F;_doc&#x2F;1<br>{<br> â€œratingâ€:5<br>}<br>PUT ratings&#x2F;_doc&#x2F;2<br>{<br> â€œratingâ€:null<br>}</p><p>POST ratings&#x2F;_search<br>POST ratings&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œavgâ€: {<br>      â€œavgâ€: {<br>        â€œfieldâ€: â€œratingâ€<br>      }<br>    }<br>  }<br>}</p><p>POST ratings&#x2F;_search<br>{<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œratingâ€: {<br>        â€œvalueâ€: 1<br>      }<br>    }<br>  }<br>}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><br><br><span class="hljs-meta"># 7.7-ç¬¬äºŒéƒ¨åˆ†æ€»ç»“ä¸æµ‹éªŒ.md</span><br><br><span class="hljs-meta"># ç¬¬äºŒéƒ¨åˆ†æ€»ç»“ä¸æµ‹éªŒ</span><br></code></pre></td></tr></table></figure><p>DELETE test<br>PUT test&#x2F;_doc&#x2F;1<br>{<br>  â€œcontentâ€:â€Hello Worldâ€<br>}</p><p>POST test&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œqueryâ€: {<br>    â€œmatchâ€: {<br>      â€œcontentâ€: â€œHello Worldâ€<br>    }<br>  }<br>}</p><p>POST test&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œqueryâ€: {<br>    â€œmatchâ€: {<br>      â€œcontentâ€: â€œhello worldâ€<br>    }<br>  }<br>}</p><p>POST test&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œqueryâ€: {<br>    â€œmatchâ€: {<br>      â€œcontent.keywordâ€: â€œHello Worldâ€<br>    }<br>  }<br>}</p><p>POST test&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œqueryâ€: {<br>    â€œmatchâ€: {<br>      â€œcontent.keywordâ€: â€œhello worldâ€<br>    }<br>  }<br>}</p><p>POST test&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œcontentâ€: â€œHello Worldâ€<br>    }<br>  }<br>}</p><p>POST test&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œcontentâ€: â€œhello worldâ€<br>    }<br>  }<br>}</p><p>POST test&#x2F;_search<br>{<br>  â€œprofileâ€: â€œtrueâ€,<br>  â€œqueryâ€: {<br>    â€œtermâ€: {<br>      â€œcontent.keywordâ€: â€œHello Worldâ€<br>    }<br>  }<br>}</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><br><br><span class="hljs-comment"># 8.1-é›†ç¾¤èº«ä»½è®¤è¯ä¸ç”¨æˆ·é‰´æƒ.md</span><br><br><span class="hljs-comment"># é›†ç¾¤èº«ä»½è®¤è¯ä¸ç”¨æˆ·é‰´æƒ</span><br>- å¦‚ä½•ä¸ºé›†ç¾¤å¯ç”¨X-Pack Security<br>- å¦‚ä½•ä¸ºå†…ç½®ç”¨æˆ·è®¾ç½®å¯†ç <br>- è®¾ç½® Kibanaä¸ElasticSearché€šä¿¡é‰´æƒ<br>- ä½¿ç”¨å®‰å…¨APIåˆ›å»ºå¯¹ç‰¹å®šç´¢å¼•å…·æœ‰æœ‰é™è®¿é—®æƒé™çš„ç”¨æˆ·<br><br>This tutorial involves a single <span class="hljs-keyword">node</span> <span class="hljs-title">cluster</span>, but if you had multiple nodes, you would enable Elasticsearch security features on every <span class="hljs-keyword">node</span> <span class="hljs-title">in</span> the cluster <span class="hljs-keyword">and</span> configure Transport Layer Security (TLS) for internode-communication, which is beyond the scope of this tutorial. By enabling single-<span class="hljs-keyword">node</span> <span class="hljs-title">discovery</span>, we are postponing the configuration of TLS. For example, add the following setting:<br><br>discovery.<span class="hljs-keyword">type</span>: single-<span class="hljs-keyword">node</span><br><span class="hljs-title"></span><br></code></pre></td></tr></table></figure><p>#å¯åŠ¨å•èŠ‚ç‚¹<br>bin&#x2F;elasticsearch -E node.name&#x3D;node0 -E cluster.name&#x3D;geektime -E path.data&#x3D;node0_data -E http.port&#x3D;9200 -E xpack.security.enabled&#x3D;true</p><p>#ä½¿ç”¨Curlè®¿é—®ESï¼Œæˆ–è€…æµè§ˆå™¨è®¿é—® â€œlocalhost:9200&#x2F;_cat&#x2F;nodes?prettyâ€ã€‚è¿”å›401é”™è¯¯<br>curl â€˜localhost:9200&#x2F;_cat&#x2F;nodes?prettyâ€™</p><p>#è¿è¡Œå¯†ç è®¾å®šçš„å‘½ä»¤ï¼Œè®¾ç½®ESå†…ç½®ç”¨æˆ·åŠå…¶åˆå§‹å¯†ç ã€‚<br>bin&#x2F;elasticsearch-setup-passwords interactive</p><p>curl -u elastic â€˜localhost:9200&#x2F;_cat&#x2F;nodes?prettyâ€™</p><h1 id="ä¿®æ”¹-kibana-yml"><a href="#ä¿®æ”¹-kibana-yml" class="headerlink" title="ä¿®æ”¹ kibana.yml"></a>ä¿®æ”¹ kibana.yml</h1><p>elasticsearch.username: â€œkibanaâ€<br>elasticsearch.password: â€œchangemeâ€</p><p>#å¯åŠ¨ã€‚ä½¿ç”¨ç”¨æˆ·åï¼Œelasticï¼Œå¯†ç elastic<br>.&#x2F;bin&#x2F;kibana</p><p>POST orders&#x2F;_bulk<br>{â€œindexâ€:{}}<br>{â€œproductâ€ : â€œ1â€,â€priceâ€ : 18,â€paymentâ€ : â€œmasterâ€,â€cardâ€ : â€œ9876543210123456â€,â€nameâ€ : â€œjackâ€}<br>{â€œindexâ€:{}}<br>{â€œproductâ€ : â€œ2â€,â€priceâ€ : 99,â€paymentâ€ : â€œvisaâ€,â€cardâ€ : â€œ1234567890123456â€,â€nameâ€ : â€œbobâ€}</p><p>#create a new role named read_only_orders, that satisfies the following criteria:<br>#The role has no cluster privileges<br>#The role only has access to indices that match the pattern sales_record<br>#The index privileges are read, and view_index_metadata</p><p>#create sales_user that satisfies the following criteria:</p><h1 id="Use-your-own-email-address"><a href="#Use-your-own-email-address" class="headerlink" title="Use your own email address"></a>Use your own email address</h1><h1 id="Assign-the-user-to-two-roles-read-only-orders-and-kibana-user"><a href="#Assign-the-user-to-two-roles-read-only-orders-and-kibana-user" class="headerlink" title="Assign the user to two roles: read_only_orders and kibana_user"></a>Assign the user to two roles: read_only_orders and kibana_user</h1><p>#éªŒè¯è¯»æƒé™,å¯ä»¥æ‰§è¡Œ<br>POST orders&#x2F;_search<br>{}</p><p>#éªŒè¯å†™æƒé™,æŠ¥é”™<br>POST orders&#x2F;_bulk<br>{â€œindexâ€:{}}<br>{â€œproductâ€ : â€œ1â€,â€priceâ€ : 18,â€paymentâ€ : â€œmasterâ€,â€cardâ€ : â€œ9876543210123456â€,â€nameâ€ : â€œjackâ€}<br>{â€œindexâ€:{}}<br>{â€œproductâ€ : â€œ2â€,â€priceâ€ : 99,â€paymentâ€ : â€œvisaâ€,â€cardâ€ : â€œ1234567890123456â€,â€nameâ€ : â€œbobâ€}</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><span class="hljs-meta"># 8.2-é›†ç¾¤å†…éƒ¨å®‰å…¨é€šä¿¡.md</span><br><br><span class="hljs-meta">#</span><br><br></code></pre></td></tr></table></figure><h1 id="ç”Ÿæˆè¯ä¹¦"><a href="#ç”Ÿæˆè¯ä¹¦" class="headerlink" title="ç”Ÿæˆè¯ä¹¦"></a>ç”Ÿæˆè¯ä¹¦</h1><h1 id="ä¸ºæ‚¨çš„Elasticearché›†ç¾¤åˆ›å»ºä¸€ä¸ªè¯ä¹¦é¢å‘æœºæ„ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨elasticsearch-certutil-caå‘½ä»¤ï¼š"><a href="#ä¸ºæ‚¨çš„Elasticearché›†ç¾¤åˆ›å»ºä¸€ä¸ªè¯ä¹¦é¢å‘æœºæ„ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨elasticsearch-certutil-caå‘½ä»¤ï¼š" class="headerlink" title="ä¸ºæ‚¨çš„Elasticearché›†ç¾¤åˆ›å»ºä¸€ä¸ªè¯ä¹¦é¢å‘æœºæ„ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨elasticsearch-certutil caå‘½ä»¤ï¼š"></a>ä¸ºæ‚¨çš„Elasticearché›†ç¾¤åˆ›å»ºä¸€ä¸ªè¯ä¹¦é¢å‘æœºæ„ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨elasticsearch-certutil caå‘½ä»¤ï¼š</h1><p>bin&#x2F;elasticsearch-certutil ca</p><p>#ä¸ºç¾¤é›†ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆè¯ä¹¦å’Œç§é’¥ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨elasticsearch-certutil cert å‘½ä»¤ï¼š<br>bin&#x2F;elasticsearch-certutil cert â€“ca elastic-stack-ca.p12</p><p>#å°†è¯ä¹¦æ‹·è´åˆ° config&#x2F;certsç›®å½•ä¸‹<br>elastic-certificates.p12</p><p>bin&#x2F;elasticsearch -E node.name&#x3D;node0 -E cluster.name&#x3D;geektime -E path.data&#x3D;node0_data -E http.port&#x3D;9200 -E xpack.security.enabled&#x3D;true -E xpack.security.transport.ssl.enabled&#x3D;true -E xpack.security.transport.ssl.verification_mode&#x3D;certificate -E xpack.security.transport.ssl.keystore.path&#x3D;certs&#x2F;elastic-certificates.p12 -E xpack.security.transport.ssl.truststore.path&#x3D;certs&#x2F;elastic-certificates.p12</p><p>bin&#x2F;elasticsearch -E node.name&#x3D;node1 -E cluster.name&#x3D;geektime -E path.data&#x3D;node1_data -E http.port&#x3D;9201 -E xpack.security.enabled&#x3D;true -E xpack.security.transport.ssl.enabled&#x3D;true -E xpack.security.transport.ssl.verification_mode&#x3D;certificate -E xpack.security.transport.ssl.keystore.path&#x3D;certs&#x2F;elastic-certificates.p12 -E xpack.security.transport.ssl.truststore.path&#x3D;certs&#x2F;elastic-certificates.p12</p><p>#ä¸æä¾›è¯ä¹¦çš„èŠ‚ç‚¹ï¼Œæ— æ³•åŠ å…¥<br>bin&#x2F;elasticsearch -E node.name&#x3D;node2 -E cluster.name&#x3D;geektime -E path.data&#x3D;node2_data -E http.port&#x3D;9202 -E xpack.security.enabled&#x3D;true -E xpack.security.transport.ssl.enabled&#x3D;true -E xpack.security.transport.ssl.verification_mode&#x3D;certificate</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs"><br><br></code></pre></td></tr></table></figure><h2 id="elasticsearch-yml-é…ç½®"><a href="#elasticsearch-yml-é…ç½®" class="headerlink" title="elasticsearch.yml é…ç½®"></a>elasticsearch.yml é…ç½®</h2><p>#xpack.security.transport.ssl.enabled: true<br>#xpack.security.transport.ssl.verification_mode: certificate</p><p>#xpack.security.transport.ssl.keystore.path: certs&#x2F;elastic-certificates.p12<br>#xpack.security.transport.ssl.truststore.path: certs&#x2F;elastic-certificates.p12</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><span class="hljs-meta"># 8.3-é›†ç¾¤ä¸å¤–éƒ¨é—´çš„å®‰å…¨é€šä¿¡.md</span><br><br><br><br></code></pre></td></tr></table></figure><p>xpack.security.http.ssl.enabled: true<br>xpack.security.http.ssl.keystore.path: certs&#x2F;elastic-certificates.p12<br>xpack.security.http.ssl.truststore.path: certs&#x2F;elastic-certificates.p12</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">```<br><br><br><span class="hljs-comment"># ES å¯ç”¨ https</span><br>bin/elasticsearch -E node.<span class="hljs-attribute">name</span>=node0 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node0_data -E http.<span class="hljs-attribute">port</span>=9200 -E xpack.security.<span class="hljs-attribute">enabled</span>=<span class="hljs-literal">true</span> -E xpack.security.transport.ssl.<span class="hljs-attribute">enabled</span>=<span class="hljs-literal">true</span> -E xpack.security.transport.ssl.<span class="hljs-attribute">verification_mode</span>=certificate -E xpack.security.transport.ssl.keystore.<span class="hljs-attribute">path</span>=certs/elastic-certificates.p12 -E xpack.security.http.ssl.<span class="hljs-attribute">enabled</span>=<span class="hljs-literal">true</span> -E xpack.security.http.ssl.keystore.<span class="hljs-attribute">path</span>=certs/elastic-certificates.p12 -E xpack.security.http.ssl.truststore.<span class="hljs-attribute">path</span>=certs/elastic-certificates.p12<br><br></code></pre></td></tr></table></figure><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-meta">#Kibana è¿æ¥ ES https</span><br><br><br><br><span class="hljs-meta"># ä¸ºkibanaç”Ÿæˆpem</span><br>openssl pkcs12 -<span class="hljs-keyword">in</span> elastic-certificates.p12 -cacerts -nokeys -<span class="hljs-keyword">out</span> elastic-ca.pem<br><br><br><span class="hljs-symbol">elasticsearch.hosts:</span> [<span class="hljs-string">&quot;https://localhost:9200&quot;</span>]<br><span class="hljs-symbol">elasticsearch.ssl.certificateAuthorities:</span> [ <span class="hljs-string">&quot;/Users/yiruan/geektime/kibana-7.1.0/config/certs/elastic-ca.pem&quot;</span> ]<br><span class="hljs-symbol">elasticsearch.ssl.verificationMode:</span> certificate<br><br><br><br><span class="hljs-meta"># ä¸º Kibna é…ç½® HTTPS</span><br><span class="hljs-meta"># ç”Ÿæˆåè§£å‹ï¼ŒåŒ…å«äº†instance.crt å’Œ instance.key</span><br>bin/elasticsearch-certutil ca --pem<br><br><span class="hljs-symbol">server.ssl.enabled:</span> true<br><span class="hljs-symbol">server.ssl.certificate:</span> config/certs/instance.crt<br><span class="hljs-symbol">server.ssl.key:</span> config/certs/instance.key<br><br><br></code></pre></td></tr></table></figure><h1 id="9-1-å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼-md"><a href="#9-1-å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼-md" class="headerlink" title="9.1-å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼.md"></a>9.1-å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼.md</h1><h1 id="å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼"><a href="#å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼" class="headerlink" title="å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼"></a>å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼</h1><h1 id="9-2-Hot-Warmæ¶æ„ä¸ShardFiltering-md"><a href="#9-2-Hot-Warmæ¶æ„ä¸ShardFiltering-md" class="headerlink" title="9.2-Hot&amp;Warmæ¶æ„ä¸ShardFiltering.md"></a>9.2-Hot&amp;Warmæ¶æ„ä¸ShardFiltering.md</h1><h1 id="Hot-Warm-æ¶æ„ä¸-Shard-Filtering"><a href="#Hot-Warm-æ¶æ„ä¸-Shard-Filtering" class="headerlink" title="Hot &amp; Warm æ¶æ„ä¸ Shard Filtering"></a>Hot &amp; Warm æ¶æ„ä¸ Shard Filtering</h1><h2 id="è¯¾ç¨‹ä»£ç "><a href="#è¯¾ç¨‹ä»£ç " class="headerlink" title="è¯¾ç¨‹ä»£ç "></a>è¯¾ç¨‹ä»£ç </h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># æ ‡è®°ä¸€ä¸ª Hot èŠ‚ç‚¹</span><br>bin/elasticsearch  -E node.<span class="hljs-attribute">name</span>=hotnode -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=hot_data -E node.attr.<span class="hljs-attribute">my_node_type</span>=hot<br><br><span class="hljs-comment"># æ ‡è®°ä¸€ä¸ª warm èŠ‚ç‚¹</span><br>bin/elasticsearch  -E node.<span class="hljs-attribute">name</span>=warmnode -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=warm_data -E node.attr.<span class="hljs-attribute">my_node_type</span>=warm<br><br><span class="hljs-comment"># æŸ¥çœ‹èŠ‚ç‚¹</span><br><span class="hljs-built_in">GET</span> /_cat/nodeattrs?v<br><br><span class="hljs-comment"># é…ç½®åˆ° HotèŠ‚ç‚¹</span><br>PUT logs-2019-06-27<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>:2,<br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span>:0,<br>    <span class="hljs-string">&quot;index.routing.allocation.require.my_node_type&quot;</span>:<span class="hljs-string">&quot;hot&quot;</span><br>  &#125;<br>&#125;<br><br><br><br>PUT my_index1/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;value&quot;</span><br>&#125;<br><br><br><br><span class="hljs-built_in">GET</span> _cat/shards?v<br><br><br><span class="hljs-comment"># é…ç½®åˆ° warm èŠ‚ç‚¹</span><br>PUT PUT logs-2019-06-27/_settings<br>&#123;  <br>  <span class="hljs-string">&quot;index.routing.allocation.require.my_node_type&quot;</span>:<span class="hljs-string">&quot;warm&quot;</span><br>&#125;<br><br><br><span class="hljs-comment"># æ ‡è®°ä¸€ä¸ª rack 1</span><br>bin/elasticsearch  -E node.<span class="hljs-attribute">name</span>=node1 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node1_data -E node.attr.<span class="hljs-attribute">my_rack_id</span>=rack1<br><br><span class="hljs-comment"># æ ‡è®°ä¸€ä¸ª rack 2</span><br>bin/elasticsearch  -E node.<span class="hljs-attribute">name</span>=node2 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node2_data -E node.attr.<span class="hljs-attribute">my_rack_id</span>=rack2<br><br>PUT _cluster<span class="hljs-built_in">/settings</span><br><span class="hljs-built_in"></span>&#123;<br>  <span class="hljs-string">&quot;persistent&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;cluster.routing.allocation.awareness.attributes&quot;</span>: <span class="hljs-string">&quot;my_rack_id&quot;</span><br>  &#125;<br>&#125;<br><br>PUT my_index1<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>:2,<br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span>:1<br>  &#125;<br>&#125;<br><br>PUT my_index1/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;value&quot;</span><br>&#125;<br><br><br><span class="hljs-built_in">GET</span> _cat/shards?v<br>DELETE my_index1/_doc/1<br><br><br><br><span class="hljs-comment"># Fore awareness</span><br><span class="hljs-comment"># æ ‡è®°ä¸€ä¸ª rack 1</span><br>bin/elasticsearch  -E node.<span class="hljs-attribute">name</span>=node1 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node1_data -E node.attr.<span class="hljs-attribute">my_rack_id</span>=rack1<br><br><span class="hljs-comment"># æ ‡è®°ä¸€ä¸ª rack 2</span><br>bin/elasticsearch  -E node.<span class="hljs-attribute">name</span>=node2 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node2_data -E node.attr.<span class="hljs-attribute">my_rack_id</span>=rack1<br><br><br>PUT _cluster<span class="hljs-built_in">/settings</span><br><span class="hljs-built_in"></span>&#123;<br>  <span class="hljs-string">&quot;persistent&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;cluster.routing.allocation.awareness.attributes&quot;</span>: <span class="hljs-string">&quot;my_rack_id&quot;</span>,<br>    <span class="hljs-string">&quot;cluster.routing.allocation.awareness.force.my_rack_id.values&quot;</span>: <span class="hljs-string">&quot;rack1,rack2&quot;</span><br>  &#125;<br>&#125;<br><span class="hljs-built_in">GET</span> _cluster<span class="hljs-built_in">/settings</span><br><span class="hljs-built_in"></span><br><span class="hljs-comment"># é›†ç¾¤é»„è‰²</span><br><span class="hljs-built_in">GET</span> _cluster<span class="hljs-built_in">/health</span><br><span class="hljs-built_in"></span><br><span class="hljs-comment"># å‰¯æœ¬æ— æ³•åˆ†é…</span><br><span class="hljs-built_in">GET</span> _cat/shards?v<br><br><br><span class="hljs-built_in">GET</span> _cluster/allocation/explain?pretty<br></code></pre></td></tr></table></figure><h1 id="9-3-å¦‚ä½•å¯¹é›†ç¾¤è¿›è¡Œå®¹é‡è§„åˆ’-md"><a href="#9-3-å¦‚ä½•å¯¹é›†ç¾¤è¿›è¡Œå®¹é‡è§„åˆ’-md" class="headerlink" title="9.3-å¦‚ä½•å¯¹é›†ç¾¤è¿›è¡Œå®¹é‡è§„åˆ’.md"></a>9.3-å¦‚ä½•å¯¹é›†ç¾¤è¿›è¡Œå®¹é‡è§„åˆ’.md</h1><h1 id="å¦‚ä½•å¯¹é›†ç¾¤è¿›è¡Œå®¹é‡è§„åˆ’"><a href="#å¦‚ä½•å¯¹é›†ç¾¤è¿›è¡Œå®¹é‡è§„åˆ’" class="headerlink" title="å¦‚ä½•å¯¹é›†ç¾¤è¿›è¡Œå®¹é‡è§„åˆ’"></a>å¦‚ä½•å¯¹é›†ç¾¤è¿›è¡Œå®¹é‡è§„åˆ’</h1><h2 id="ä»£ç Demo"><a href="#ä»£ç Demo" class="headerlink" title="ä»£ç Demo"></a>ä»£ç Demo</h2><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs llvm">PUT logs_<span class="hljs-number">2019</span><span class="hljs-number">-06</span><span class="hljs-number">-27</span><br>PUT logs_<span class="hljs-number">2019</span><span class="hljs-number">-06</span><span class="hljs-number">-26</span><br><br><br>POST _aliases<br>&#123;<br>  <span class="hljs-string">&quot;actions&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;add&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-string">&quot;logs_2019-06-27&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;alias&quot;</span>: <span class="hljs-string">&quot;logs_write&quot;</span><br>      &#125;<br>    &#125;<span class="hljs-punctuation">,</span><br>    &#123;<br>      <span class="hljs-string">&quot;remove&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-string">&quot;logs_2019-06-26&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;alias&quot;</span>: <span class="hljs-string">&quot;logs_write&quot;</span><br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br><br><br># POST /&lt;logs-&#123;now/d&#125;/_search<br>POST /<span class="hljs-variable">%3</span>Clogs-<span class="hljs-variable">%7</span>Bnow<span class="hljs-variable">%2</span>Fd<span class="hljs-variable">%7</span>D<span class="hljs-variable">%3</span>E/_search<br><br># POST /&lt;logs-&#123;now/w&#125;/_search<br>POST /<span class="hljs-variable">%3</span>Clogs-<span class="hljs-variable">%7</span>Bnow<span class="hljs-variable">%2</span>Fw<span class="hljs-variable">%7</span>D<span class="hljs-variable">%3</span>E/_search<br><br></code></pre></td></tr></table></figure><h1 id="9-4-åˆ†ç‰‡è®¾è®¡åŠç®¡ç†-md"><a href="#9-4-åˆ†ç‰‡è®¾è®¡åŠç®¡ç†-md" class="headerlink" title="9.4-åˆ†ç‰‡è®¾è®¡åŠç®¡ç†.md"></a>9.4-åˆ†ç‰‡è®¾è®¡åŠç®¡ç†.md</h1><h1 id="åˆ†ç‰‡è®¾è®¡åŠç®¡ç†"><a href="#åˆ†ç‰‡è®¾è®¡åŠç®¡ç†" class="headerlink" title="åˆ†ç‰‡è®¾è®¡åŠç®¡ç†"></a>åˆ†ç‰‡è®¾è®¡åŠç®¡ç†</h1><h1 id="9-5-åœ¨ç§æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½²Elasticsearché›†ç¾¤-md"><a href="#9-5-åœ¨ç§æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½²Elasticsearché›†ç¾¤-md" class="headerlink" title="9.5-åœ¨ç§æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½²Elasticsearché›†ç¾¤.md"></a>9.5-åœ¨ç§æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½²Elasticsearché›†ç¾¤.md</h1><h1 id="åœ¨ç§æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½²-Elasticsearch-é›†ç¾¤"><a href="#åœ¨ç§æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½²-Elasticsearch-é›†ç¾¤" class="headerlink" title="åœ¨ç§æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½² Elasticsearch é›†ç¾¤"></a>åœ¨ç§æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½² Elasticsearch é›†ç¾¤</h1><h1 id="9-6-åœ¨å…¬æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½²Elasticsearché›†ç¾¤-md"><a href="#9-6-åœ¨å…¬æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½²Elasticsearché›†ç¾¤-md" class="headerlink" title="9.6-åœ¨å…¬æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½²Elasticsearché›†ç¾¤.md"></a>9.6-åœ¨å…¬æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½²Elasticsearché›†ç¾¤.md</h1><h1 id="åœ¨å…¬æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½²-Elasticsearch-é›†ç¾¤"><a href="#åœ¨å…¬æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½²-Elasticsearch-é›†ç¾¤" class="headerlink" title="åœ¨å…¬æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½² Elasticsearch é›†ç¾¤"></a>åœ¨å…¬æœ‰äº‘ä¸Šç®¡ç†ä¸éƒ¨ç½² Elasticsearch é›†ç¾¤</h1><h1 id="result-md"><a href="#result-md" class="headerlink" title="result.md"></a>result.md</h1><h1 id="10-1-ç”Ÿäº§ç¯å¢ƒå¸¸ç”¨é…ç½®ä¸ä¸Šçº¿æ¸…å•-md"><a href="#10-1-ç”Ÿäº§ç¯å¢ƒå¸¸ç”¨é…ç½®ä¸ä¸Šçº¿æ¸…å•-md" class="headerlink" title="10.1-ç”Ÿäº§ç¯å¢ƒå¸¸ç”¨é…ç½®ä¸ä¸Šçº¿æ¸…å•.md"></a>10.1-ç”Ÿäº§ç¯å¢ƒå¸¸ç”¨é…ç½®ä¸ä¸Šçº¿æ¸…å•.md</h1><h1 id="ç”Ÿäº§ç¯å¢ƒæŸ¥ç”¨é…ç½®ä¸çº¿ä¸Šæ¸…å•"><a href="#ç”Ÿäº§ç¯å¢ƒæŸ¥ç”¨é…ç½®ä¸çº¿ä¸Šæ¸…å•" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒæŸ¥ç”¨é…ç½®ä¸çº¿ä¸Šæ¸…å•"></a>ç”Ÿäº§ç¯å¢ƒæŸ¥ç”¨é…ç½®ä¸çº¿ä¸Šæ¸…å•</h1><h1 id="10-10-ä¸€äº›è¿ç»´ç›¸å…³çš„å»ºè®®-md"><a href="#10-10-ä¸€äº›è¿ç»´ç›¸å…³çš„å»ºè®®-md" class="headerlink" title="10.10-ä¸€äº›è¿ç»´ç›¸å…³çš„å»ºè®®.md"></a>10.10-ä¸€äº›è¿ç»´ç›¸å…³çš„å»ºè®®.md</h1><h1 id="ä¸€äº›è¿ç»´ç›¸å…³çš„å»ºè®®"><a href="#ä¸€äº›è¿ç»´ç›¸å…³çš„å»ºè®®" class="headerlink" title="ä¸€äº›è¿ç»´ç›¸å…³çš„å»ºè®®"></a>ä¸€äº›è¿ç»´ç›¸å…³çš„å»ºè®®</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ç§»åŠ¨ä¸€ä¸ªåˆ†ç‰‡ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹</span><br><br>POST _cluster/reroute<br>&#123;<br>  <span class="hljs-string">&quot;commands&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;move&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-string">&quot;index_name&quot;</span>,<br>        <span class="hljs-string">&quot;shard&quot;</span>: 0,<br>        <span class="hljs-string">&quot;from_node&quot;</span>: <span class="hljs-string">&quot;node_name_1&quot;</span>,<br>        <span class="hljs-string">&quot;to_node&quot;</span>: <span class="hljs-string">&quot;node_name_2&quot;</span><br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br><br><br><span class="hljs-comment"># Fore the allocation of an unassinged shard with a reason</span><br><br>POST _cluster/reroute?explain<br>&#123;<br>  <span class="hljs-string">&quot;commands&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;allocate&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-string">&quot;index_name&quot;</span>,<br>        <span class="hljs-string">&quot;shard&quot;</span>: 0,<br>        <span class="hljs-string">&quot;node&quot;</span>: <span class="hljs-string">&quot;nodename&quot;</span><br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br><br><br><span class="hljs-comment"># remove the nodes from cluster </span><br>PUT _cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;transient&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;cluster.routing.allocation.exclude._ip&quot;</span>:<span class="hljs-string">&quot;the_IP_of_your_node&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># Force a synced flush</span><br>POST _flush/synced<br><br><br><span class="hljs-comment"># change the number of moving shards to balance the cluster</span><br>PUT /_cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;transient&quot;</span>: &#123;<span class="hljs-string">&quot;cluster.routing.allocation.cluster_concurrent_rebalance&quot;</span>:2&#125;<br>&#125;<br><br><span class="hljs-comment"># change the number of shards being recovered simultanceously per node</span><br>PUT _cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;transient&quot;</span>: &#123;<span class="hljs-string">&quot;cluster.routing.allocation.node_concurrent_recoveries&quot;</span>:5&#125;<br>&#125;<br><br><span class="hljs-comment"># Change the recovery speed</span><br>PUT /_cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;transient&quot;</span>: &#123;<span class="hljs-string">&quot;indices.recovery.max_bytes_per_sec&quot;</span>: <span class="hljs-string">&quot;80mb&quot;</span>&#125;<br>&#125;<br><br><span class="hljs-comment"># Change the number of concurrent streams for a recovery on a single node</span><br>PUT _cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;transient&quot;</span>: &#123;<span class="hljs-string">&quot;indices.recovery.concurrent_streams&quot;</span>:6&#125;<br>&#125;<br><br><br><span class="hljs-comment"># Change the sinze of the search queue</span><br>PUT _cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;transient&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;threadpool.search.queue_size&quot;</span>:2000<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># Clear the cache on a node</span><br>POST _cache/clear<br><br><br><span class="hljs-comment">#Adjust the circuit breakers</span><br>PUT _cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;persistent&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;indices.breaker.total.limit&quot;</span>:<span class="hljs-string">&quot;40%&quot;</span><br>  &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><h1 id="10-2-ç›‘æ§Elasticsearché›†ç¾¤-md"><a href="#10-2-ç›‘æ§Elasticsearché›†ç¾¤-md" class="headerlink" title="10.2-ç›‘æ§Elasticsearché›†ç¾¤.md"></a>10.2-ç›‘æ§Elasticsearché›†ç¾¤.md</h1><h1 id="ç›‘æ§-Elasticsearch-é›†ç¾¤-1"><a href="#ç›‘æ§-Elasticsearch-é›†ç¾¤-1" class="headerlink" title="ç›‘æ§ Elasticsearch é›†ç¾¤"></a>ç›‘æ§ Elasticsearch é›†ç¾¤</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Node Statsï¼š</span><br>GET _nodes/stats<br><br><span class="hljs-comment">#Cluster Stats:</span><br>GET _cluster/stats<br><br><span class="hljs-comment">#Index Stats:</span><br>GET kibana_sample_data_ecommerce/_stats<br><br><span class="hljs-comment">#Pending Cluster Tasks API:</span><br>GET _cluster/pending_tasks<br><br><span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰çš„ tasksï¼Œä¹Ÿæ”¯æŒ cancel task</span><br>GET _tasks<br><br><br>GET _nodes/thread_pool<br>GET _nodes/stats/thread_pool<br>GET _cat/thread_pool?v<br>GET _nodes/hot_threads<br>GET _nodes/stats/thread_pool<br><br><br><span class="hljs-comment"># è®¾ç½® Index Slowlogs</span><br><span class="hljs-comment"># the first 1000 characters of the doc&#x27;s source will be logged</span><br>PUT my_index/_settings<br>&#123;<br>  <span class="hljs-string">&quot;index.indexing.slowlog&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;threshold.index&quot;</span>:&#123;<br>      <span class="hljs-string">&quot;warn&quot;</span>:<span class="hljs-string">&quot;10s&quot;</span>,<br>      <span class="hljs-string">&quot;info&quot;</span>: <span class="hljs-string">&quot;4s&quot;</span>,<br>      <span class="hljs-string">&quot;debug&quot;</span>:<span class="hljs-string">&quot;2s&quot;</span>,<br>      <span class="hljs-string">&quot;trace&quot;</span>:<span class="hljs-string">&quot;0s&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;level&quot;</span>:<span class="hljs-string">&quot;trace&quot;</span>,<br>    <span class="hljs-string">&quot;source&quot;</span>:1000  <br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># è®¾ç½®æŸ¥è¯¢</span><br>DELETE my_index<br>//<span class="hljs-string">&quot;0&quot;</span> logs all queries<br>PUT my_index/<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index.search.slowlog.threshold&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;query.warn&quot;</span>: <span class="hljs-string">&quot;10s&quot;</span>,<br>      <span class="hljs-string">&quot;query.info&quot;</span>: <span class="hljs-string">&quot;3s&quot;</span>,<br>      <span class="hljs-string">&quot;query.debug&quot;</span>: <span class="hljs-string">&quot;2s&quot;</span>,<br>      <span class="hljs-string">&quot;query.trace&quot;</span>: <span class="hljs-string">&quot;0s&quot;</span>,<br>      <span class="hljs-string">&quot;fetch.warn&quot;</span>: <span class="hljs-string">&quot;1s&quot;</span>,<br>      <span class="hljs-string">&quot;fetch.info&quot;</span>: <span class="hljs-string">&quot;600ms&quot;</span>,<br>      <span class="hljs-string">&quot;fetch.debug&quot;</span>: <span class="hljs-string">&quot;400ms&quot;</span>,<br>      <span class="hljs-string">&quot;fetch.trace&quot;</span>: <span class="hljs-string">&quot;0s&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br>GET my_index<br><br><br></code></pre></td></tr></table></figure><h1 id="10-3-è¯Šæ–­é›†ç¾¤çš„æ½œåœ¨é—®é¢˜-md"><a href="#10-3-è¯Šæ–­é›†ç¾¤çš„æ½œåœ¨é—®é¢˜-md" class="headerlink" title="10.3-è¯Šæ–­é›†ç¾¤çš„æ½œåœ¨é—®é¢˜.md"></a>10.3-è¯Šæ–­é›†ç¾¤çš„æ½œåœ¨é—®é¢˜.md</h1><h1 id="è¯Šæ–­é›†ç¾¤çš„æ½œåœ¨é—®é¢˜"><a href="#è¯Šæ–­é›†ç¾¤çš„æ½œåœ¨é—®é¢˜" class="headerlink" title="è¯Šæ–­é›†ç¾¤çš„æ½œåœ¨é—®é¢˜"></a>è¯Šæ–­é›†ç¾¤çš„æ½œåœ¨é—®é¢˜</h1><h1 id="10-4-è§£å†³é›†ç¾¤Yellowä¸Redçš„é—®é¢˜-md"><a href="#10-4-è§£å†³é›†ç¾¤Yellowä¸Redçš„é—®é¢˜-md" class="headerlink" title="10.4-è§£å†³é›†ç¾¤Yellowä¸Redçš„é—®é¢˜.md"></a>10.4-è§£å†³é›†ç¾¤Yellowä¸Redçš„é—®é¢˜.md</h1><h1 id="é›†ç¾¤å¥åº·ä¸é—®é¢˜æ’æŸ¥"><a href="#é›†ç¾¤å¥åº·ä¸é—®é¢˜æ’æŸ¥" class="headerlink" title="é›†ç¾¤å¥åº·ä¸é—®é¢˜æ’æŸ¥"></a>é›†ç¾¤å¥åº·ä¸é—®é¢˜æ’æŸ¥</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">#æ¡ˆä¾‹1</span><br>DELETE mytest<br>PUT mytest<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>:3,<br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span>:0,<br>    <span class="hljs-string">&quot;index.routing.allocation.require.box_type&quot;</span>:<span class="hljs-string">&quot;hott&quot;</span><br>  &#125;<br>&#125;<br><br><br><br><br><br><span class="hljs-comment"># æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰èŠ‚ç‚¹ä¸¢å¤±ï¼Œæœ‰å¤šå°‘åˆ†ç‰‡æ— æ³•åˆ†é…</span><br><span class="hljs-built_in">GET</span> /_cluster/health/<br><br><span class="hljs-comment"># æŸ¥çœ‹ç´¢å¼•çº§åˆ«,æ‰¾åˆ°çº¢è‰²çš„ç´¢å¼•</span><br><span class="hljs-built_in">GET</span> /_cluster/health?<span class="hljs-attribute">level</span>=indices<br><br><br><span class="hljs-comment">#æŸ¥çœ‹ç´¢å¼•çš„åˆ†ç‰‡</span><br><span class="hljs-built_in">GET</span> _cluster/health?<span class="hljs-attribute">level</span>=shards<br><br><span class="hljs-comment"># Explain å˜çº¢çš„åŸå› </span><br><span class="hljs-built_in">GET</span> /_cluster/allocation/explain<br><br><span class="hljs-built_in">GET</span> /_cat/shards/mytest<br><span class="hljs-built_in">GET</span> _cat/nodeattrs<br><br>DELETE mytest<br><span class="hljs-built_in">GET</span> /_cluster/health/<br><br>PUT mytest<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>:3,<br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span>:0,<br>    <span class="hljs-string">&quot;index.routing.allocation.require.box_type&quot;</span>:<span class="hljs-string">&quot;hot&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-built_in">GET</span> /_cluster/health/<br><br><span class="hljs-comment">#æ¡ˆä¾‹2, Explain çœ‹ hot ä¸Šçš„ explain</span><br>DELETE mytest<br>PUT mytest<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>:2,<br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span>:1,<br>    <span class="hljs-string">&quot;index.routing.allocation.require.box_type&quot;</span>:<span class="hljs-string">&quot;hot&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-built_in">GET</span> _cluster<span class="hljs-built_in">/health</span><br><span class="hljs-built_in"></span><span class="hljs-built_in">GET</span> _cat/shards/mytest<br><span class="hljs-built_in">GET</span> /_cluster/allocation/explain<br><br>PUT mytest/_settings<br>&#123;<br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span>: 0<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="10-5-æå‡é›†ç¾¤å†™æ€§èƒ½-md"><a href="#10-5-æå‡é›†ç¾¤å†™æ€§èƒ½-md" class="headerlink" title="10.5-æå‡é›†ç¾¤å†™æ€§èƒ½.md"></a>10.5-æå‡é›†ç¾¤å†™æ€§èƒ½.md</h1><h1 id="æå‡é›†ç¾¤å†™æ€§èƒ½-1"><a href="#æå‡é›†ç¾¤å†™æ€§èƒ½-1" class="headerlink" title="æå‡é›†ç¾¤å†™æ€§èƒ½"></a>æå‡é›†ç¾¤å†™æ€§èƒ½</h1><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs fsharp">DELETE myindex<br>PUT <span class="hljs-keyword">myindex</span><br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span><span class="hljs-operator">:</span> &#123;<br>    <span class="hljs-string">&quot;index&quot;</span><span class="hljs-operator">:</span> &#123;<br>      <span class="hljs-string">&quot;refresh_interval&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;30s&quot;</span>,<br>      <span class="hljs-string">&quot;number_of_shards&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;2&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;routing&quot;</span><span class="hljs-operator">:</span> &#123;<br>      <span class="hljs-string">&quot;allocation&quot;</span><span class="hljs-operator">:</span> &#123;<br>        <span class="hljs-string">&quot;total_shards_per_node&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;3&quot;</span><br>      &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;translog&quot;</span><span class="hljs-operator">:</span> &#123;<br>      <span class="hljs-string">&quot;sync_interval&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;30s&quot;</span>,<br>      <span class="hljs-string">&quot;durability&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;async&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span><span class="hljs-operator">:</span> 0<br>  &#125;,<br>  <span class="hljs-string">&quot;mappings&quot;</span><span class="hljs-operator">:</span> &#123;<br>    <span class="hljs-string">&quot;dynamic&quot;</span><span class="hljs-operator">:</span> <span class="hljs-literal">false</span>,<br>    <span class="hljs-string">&quot;properties&quot;</span><span class="hljs-operator">:</span> &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="10-6-æå‡é›†ç¾¤è¯»æ€§èƒ½-md"><a href="#10-6-æå‡é›†ç¾¤è¯»æ€§èƒ½-md" class="headerlink" title="10.6-æå‡é›†ç¾¤è¯»æ€§èƒ½.md"></a>10.6-æå‡é›†ç¾¤è¯»æ€§èƒ½.md</h1><h1 id="æå‡é›†ç¾¤è¯»æ€§èƒ½-1"><a href="#æå‡é›†ç¾¤è¯»æ€§èƒ½-1" class="headerlink" title="æå‡é›†ç¾¤è¯»æ€§èƒ½"></a>æå‡é›†ç¾¤è¯»æ€§èƒ½</h1><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs sqf">PUT blogs/<span class="hljs-variable">_doc</span>/<span class="hljs-number">1</span><br>&#123;<br>  <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;elasticsearch&quot;</span><br>&#125;<br><span class="hljs-built_in">GET</span> blogs/<span class="hljs-variable">_search</span><br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [<br>        &#123;<span class="hljs-string">&quot;match&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;elasticsearch&quot;</span><br>        &#125;&#125;<br>      ],<br>      <br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;script&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;script&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;source&quot;</span>: <span class="hljs-string">&quot;doc[&#x27;title.keyword&#x27;].value.length()&gt;5&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-built_in">GET</span> blogs/<span class="hljs-variable">_search</span><br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [<br>        &#123;<span class="hljs-string">&quot;match&quot;</span>: &#123;<span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;elasticsearch&quot;</span>&#125;&#125;,<br>        &#123;<br>          <span class="hljs-string">&quot;range&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;publish_date&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;gte&quot;</span>: <span class="hljs-number">2017</span>,<br>              <span class="hljs-string">&quot;lte&quot;</span>: <span class="hljs-number">2019</span><br>            &#125;<br>          &#125;<br>        &#125;<br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="10-7-é›†ç¾¤å‹åŠ›æµ‹è¯•-md"><a href="#10-7-é›†ç¾¤å‹åŠ›æµ‹è¯•-md" class="headerlink" title="10.7-é›†ç¾¤å‹åŠ›æµ‹è¯•.md"></a>10.7-é›†ç¾¤å‹åŠ›æµ‹è¯•.md</h1><h1 id="é›†ç¾¤å‹åŠ›æµ‹è¯•-1"><a href="#é›†ç¾¤å‹åŠ›æµ‹è¯•-1" class="headerlink" title="é›†ç¾¤å‹åŠ›æµ‹è¯•"></a>é›†ç¾¤å‹åŠ›æµ‹è¯•</h1><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">pip3</span> install esrally<br><br><span class="hljs-attribute">esrally</span> configure<br><br><span class="hljs-comment"># åªæµ‹è¯• 1000æ¡æ•°æ®</span><br><span class="hljs-attribute">esrally</span> --distribution-version=<span class="hljs-number">7</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span> --test-mode<br><br><span class="hljs-comment"># æµ‹è¯•å®Œæ•´æ•°æ®</span><br><span class="hljs-attribute">esrally</span> --distribution-version=<span class="hljs-number">7</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span><br><br></code></pre></td></tr></table></figure><ul><li><a href="https://github.com/elastic/rally-tracks">https://github.com/elastic/rally-tracks</a></li><li><a href="https://logz.io/blog/rally/">https://logz.io/blog/rally/</a></li></ul><h1 id="10-9-ç¼“å­˜åŠä½¿ç”¨Breakeré™åˆ¶å†…å­˜ä½¿ç”¨-md"><a href="#10-9-ç¼“å­˜åŠä½¿ç”¨Breakeré™åˆ¶å†…å­˜ä½¿ç”¨-md" class="headerlink" title="10.9-ç¼“å­˜åŠä½¿ç”¨Breakeré™åˆ¶å†…å­˜ä½¿ç”¨.md"></a>10.9-ç¼“å­˜åŠä½¿ç”¨Breakeré™åˆ¶å†…å­˜ä½¿ç”¨.md</h1><h1 id="ç¼“å­˜åŠä½¿ç”¨Circuit-Breakeré™åˆ¶å†…å­˜ä½¿ç”¨"><a href="#ç¼“å­˜åŠä½¿ç”¨Circuit-Breakeré™åˆ¶å†…å­˜ä½¿ç”¨" class="headerlink" title="ç¼“å­˜åŠä½¿ç”¨Circuit Breakeré™åˆ¶å†…å­˜ä½¿ç”¨"></a>ç¼“å­˜åŠä½¿ç”¨Circuit Breakeré™åˆ¶å†…å­˜ä½¿ç”¨</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> _cat/nodes?v<br><br><span class="hljs-built_in">GET</span> _nodes/stats/indices?pretty<br><br><span class="hljs-built_in">GET</span> _cat/nodes?v&amp;<span class="hljs-attribute">h</span>=name,queryCacheMemory,queryCacheEvictions,requestCacheMemory,requestCacheHitCount,request_cache.miss_count<br><br><span class="hljs-built_in">GET</span> _cat/nodes?<span class="hljs-attribute">h</span>=name,port,segments.memory,segments.index_writer_memory,fielddata.memory_size,query_cache.memory_size,request_cache.memory_size&amp;v<br><br><br>PUT /_cluster<span class="hljs-built_in">/settings</span><br><span class="hljs-built_in"></span>&#123;<br>    <span class="hljs-string">&quot;persistent&quot;</span> : &#123;<br>       <span class="hljs-string">&quot;indices.breaker.request.limit&quot;</span> : <span class="hljs-string">&quot;90%&quot;</span><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="è¡¥å……é˜…è¯»"><a href="#è¡¥å……é˜…è¯»" class="headerlink" title="è¡¥å……é˜…è¯»"></a>è¡¥å……é˜…è¯»</h2><ul><li><a href="https://www.elastic.co/blog/improving-node-resiliency-with-the-real-memory-circuit-breaker">https://www.elastic.co/blog/improving-node-resiliency-with-the-real-memory-circuit-breaker</a></li></ul><h1 id="11-1-ä½¿ç”¨Shrinkä¸RolloverAPIæœ‰æ•ˆç®¡ç†æ—¶é—´åºåˆ—ç´¢å¼•-md"><a href="#11-1-ä½¿ç”¨Shrinkä¸RolloverAPIæœ‰æ•ˆç®¡ç†æ—¶é—´åºåˆ—ç´¢å¼•-md" class="headerlink" title="11.1-ä½¿ç”¨Shrinkä¸RolloverAPIæœ‰æ•ˆç®¡ç†æ—¶é—´åºåˆ—ç´¢å¼•.md"></a>11.1-ä½¿ç”¨Shrinkä¸RolloverAPIæœ‰æ•ˆç®¡ç†æ—¶é—´åºåˆ—ç´¢å¼•.md</h1><h1 id="ä½¿ç”¨-shrinkä¸rolloverAPIæœ‰æ•ˆçš„ç®¡ç†ç´¢å¼•"><a href="#ä½¿ç”¨-shrinkä¸rolloverAPIæœ‰æ•ˆçš„ç®¡ç†ç´¢å¼•" class="headerlink" title="ä½¿ç”¨ shrinkä¸rolloverAPIæœ‰æ•ˆçš„ç®¡ç†ç´¢å¼•"></a>ä½¿ç”¨ shrinkä¸rolloverAPIæœ‰æ•ˆçš„ç®¡ç†ç´¢å¼•</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><br><span class="hljs-comment"># æ‰“å¼€å…³é—­ç´¢å¼•</span><br>DELETE <span class="hljs-built_in">test</span><br><span class="hljs-comment">#æŸ¥çœ‹ç´¢å¼•æ˜¯å¦å­˜åœ¨</span><br>HEAD <span class="hljs-built_in">test</span><br><br>PUT <span class="hljs-built_in">test</span>/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;value&quot;</span><br>&#125;<br><br><span class="hljs-comment">#å…³é—­ç´¢å¼•</span><br>POST /test/_close<br><span class="hljs-comment">#ç´¢å¼•å­˜åœ¨</span><br>HEAD <span class="hljs-built_in">test</span><br><span class="hljs-comment"># æ— æ³•æŸ¥è¯¢</span><br>POST <span class="hljs-built_in">test</span>/_count<br><br><span class="hljs-comment">#æ‰“å¼€ç´¢å¼•</span><br>POST /test/_open<br>POST <span class="hljs-built_in">test</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br>POST <span class="hljs-built_in">test</span>/_count<br><br><br><span class="hljs-comment"># åœ¨ä¸€ä¸ª hot-warm-coldçš„é›†ç¾¤ä¸Šè¿›è¡Œæµ‹è¯•</span><br>GET _cat/nodes<br>GET _cat/nodeattrs<br><br>DELETE my_source_index<br>DELETE my_target_index<br>PUT my_source_index<br>&#123;<br> <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>   <span class="hljs-string">&quot;number_of_shards&quot;</span>: 4,<br>   <span class="hljs-string">&quot;number_of_replicas&quot;</span>: 0<br> &#125;<br>&#125;<br><br>PUT my_source_index/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;value&quot;</span><br>&#125;<br><br>GET _cat/shards/my_source_index<br><br><span class="hljs-comment"># åˆ†ç‰‡æ•°3ï¼Œä¼šå¤±è´¥</span><br>POST my_source_index/_shrink/my_target_index<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index.number_of_replicas&quot;</span>: 0,<br>    <span class="hljs-string">&quot;index.number_of_shards&quot;</span>: 3,<br>    <span class="hljs-string">&quot;index.codec&quot;</span>: <span class="hljs-string">&quot;best_compression&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;aliases&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;my_search_indices&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br><br><br><br><span class="hljs-comment"># æŠ¥é”™ï¼Œå› ä¸ºæ²¡æœ‰ç½®æˆ readonly</span><br>POST my_source_index/_shrink/my_target_index<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index.number_of_replicas&quot;</span>: 0,<br>    <span class="hljs-string">&quot;index.number_of_shards&quot;</span>: 2,<br>    <span class="hljs-string">&quot;index.codec&quot;</span>: <span class="hljs-string">&quot;best_compression&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;aliases&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;my_search_indices&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">#å°† my_source_index è®¾ç½®ä¸ºåªè¯»</span><br>PUT /my_source_index/_settings<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index.blocks.write&quot;</span>: <span class="hljs-literal">true</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># æŠ¥é”™ï¼Œå¿…é¡»éƒ½åœ¨ä¸€ä¸ªèŠ‚ç‚¹</span><br>POST my_source_index/_shrink/my_target_index<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index.number_of_replicas&quot;</span>: 0,<br>    <span class="hljs-string">&quot;index.number_of_shards&quot;</span>: 2,<br>    <span class="hljs-string">&quot;index.codec&quot;</span>: <span class="hljs-string">&quot;best_compression&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;aliases&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;my_search_indices&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br><br>DELETE my_source_index<br><span class="hljs-comment">## ç¡®ä¿åˆ†ç‰‡éƒ½åœ¨ hot</span><br>PUT my_source_index<br>&#123;<br> <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>   <span class="hljs-string">&quot;number_of_shards&quot;</span>: 4,<br>   <span class="hljs-string">&quot;number_of_replicas&quot;</span>: 0,<br>   <span class="hljs-string">&quot;index.routing.allocation.include.box_type&quot;</span>:<span class="hljs-string">&quot;hot&quot;</span><br> &#125;<br>&#125;<br><br>PUT my_source_index/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;value&quot;</span><br>&#125;<br><br>GET _cat/shards/my_source_index<br><br><span class="hljs-comment">#è®¾ç½®ä¸ºåªè¯»</span><br>PUT /my_source_index/_settings<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index.blocks.write&quot;</span>: <span class="hljs-literal">true</span><br>  &#125;<br>&#125;<br><br><br>POST my_source_index/_shrink/my_target_index<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index.number_of_replicas&quot;</span>: 0,<br>    <span class="hljs-string">&quot;index.number_of_shards&quot;</span>: 2,<br>    <span class="hljs-string">&quot;index.codec&quot;</span>: <span class="hljs-string">&quot;best_compression&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;aliases&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;my_search_indices&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br><br><br>GET _cat/shards/my_target_index<br><br><span class="hljs-comment"># My target_indexçŠ¶æ€ä¸ºä¹Ÿåªè¯»</span><br>PUT my_target_index/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;value&quot;</span><br>&#125;<br><br><br><br><span class="hljs-comment"># Split Index</span><br>DELETE my_source_index<br>DELETE my_target_index<br><br>PUT my_source_index<br>&#123;<br> <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>   <span class="hljs-string">&quot;number_of_shards&quot;</span>: 4,<br>   <span class="hljs-string">&quot;number_of_replicas&quot;</span>: 0<br> &#125;<br>&#125;<br><br>PUT my_source_index/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;value&quot;</span><br>&#125;<br><br>GET _cat/shards/my_source_index<br><br><span class="hljs-comment"># å¿…é¡»æ˜¯å€æ•°</span><br>POST my_source_index/_split/my_target<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index.number_of_shards&quot;</span>: 10<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># å¿…é¡»æ˜¯åªè¯»</span><br>POST my_source_index/_split/my_target<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index.number_of_shards&quot;</span>: 8<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#è®¾ç½®ä¸ºåªè¯»</span><br>PUT /my_source_index/_settings<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index.blocks.write&quot;</span>: <span class="hljs-literal">true</span><br>  &#125;<br>&#125;<br><br><br>POST my_source_index/_split/my_target_index<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index.number_of_shards&quot;</span>: 8,<br>    <span class="hljs-string">&quot;index.number_of_replicas&quot;</span>:0<br>  &#125;<br>&#125;<br><br>GET _cat/shards/my_target_index<br><br><br><br><span class="hljs-comment"># write block</span><br>PUT my_target_index/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;value&quot;</span><br>&#125;<br><br><br><br><span class="hljs-comment">#Rollover API</span><br>DELETE nginx-logs*<br><span class="hljs-comment"># ä¸è®¾å®š is_write_true</span><br><span class="hljs-comment"># åå­—ç¬¦åˆå‘½åè§„èŒƒ</span><br>PUT /nginx-logs-000001<br>&#123;<br>  <span class="hljs-string">&quot;aliases&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;nginx_logs_write&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># å¤šæ¬¡å†™å…¥æ–‡æ¡£</span><br>POST nginx_logs_write/_doc<br>&#123;<br>  <span class="hljs-string">&quot;log&quot;</span>:<span class="hljs-string">&quot;something&quot;</span><br>&#125;<br><br><br>POST /nginx_logs_write/_rollover<br>&#123;<br>  <span class="hljs-string">&quot;conditions&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;max_age&quot;</span>:   <span class="hljs-string">&quot;1d&quot;</span>,<br>    <span class="hljs-string">&quot;max_docs&quot;</span>:  5,<br>    <span class="hljs-string">&quot;max_size&quot;</span>:  <span class="hljs-string">&quot;5gb&quot;</span><br>  &#125;<br>&#125;<br><br>GET /nginx_logs_write/_count<br><span class="hljs-comment"># æŸ¥çœ‹ Aliasä¿¡æ¯</span><br>GET /nginx_logs_write<br><br><br>DELETE apache-logs*<br><br><br><span class="hljs-comment"># è®¾ç½® is_write_index</span><br>PUT apache-logs1<br>&#123;<br>  <span class="hljs-string">&quot;aliases&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;apache_logs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;is_write_index&quot;</span>:<span class="hljs-literal">true</span><br>    &#125;<br>  &#125;<br>&#125;<br>POST apache_logs/_count<br><br>POST apache_logs/_doc<br>&#123;<br>  <span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;value&quot;</span><br>&#125;<br><br><span class="hljs-comment"># éœ€è¦æŒ‡å®š target çš„åå­—</span><br>POST /apache_logs/_rollover/apache-logs8xxxx<br>&#123;<br>  <span class="hljs-string">&quot;conditions&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;max_age&quot;</span>:   <span class="hljs-string">&quot;1d&quot;</span>,<br>    <span class="hljs-string">&quot;max_docs&quot;</span>:  1,<br>    <span class="hljs-string">&quot;max_size&quot;</span>:  <span class="hljs-string">&quot;5gb&quot;</span><br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># æŸ¥çœ‹ Aliasä¿¡æ¯</span><br>GET /apache_logs<br><br><br></code></pre></td></tr></table></figure><h1 id="11-2-ç´¢å¼•å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠå·¥å…·ä»‹ç»-md"><a href="#11-2-ç´¢å¼•å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠå·¥å…·ä»‹ç»-md" class="headerlink" title="11.2-ç´¢å¼•å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠå·¥å…·ä»‹ç».md"></a>11.2-ç´¢å¼•å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠå·¥å…·ä»‹ç».md</h1><h1 id="ç´¢å¼•å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠå·¥å…·ä»‹ç»"><a href="#ç´¢å¼•å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠå·¥å…·ä»‹ç»" class="headerlink" title="ç´¢å¼•å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠå·¥å…·ä»‹ç»"></a>ç´¢å¼•å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†åŠå·¥å…·ä»‹ç»</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment"># è¿è¡Œä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ†ç‰‡ å°†box_typeè®¾ç½®æˆ hotï¼Œwarmå’Œcold</span><br><span class="hljs-comment"># å…·ä½“å‚è€ƒ githubä¸‹ï¼Œdocker-hot-warm-cold ä¸‹çš„docker-compose æ–‡ä»¶</span><br><br><br><br>DELETE *<br><br><br><br><span class="hljs-comment"># è®¾ç½® 1ç§’åˆ·æ–°1æ¬¡ï¼Œç”Ÿäº§ç¯å¢ƒ10åˆ†ç§åˆ·æ–°ä¸€æ¬¡</span><br>PUT _cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;persistent&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;indices.lifecycle.poll_interval&quot;</span>:<span class="hljs-string">&quot;1s&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># è®¾ç½® Policy</span><br>PUT /_ilm/policy/log_ilm_policy<br>&#123;<br>  <span class="hljs-string">&quot;policy&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;phases&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;hot&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;actions&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;rollover&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;max_docs&quot;</span>: 5<br>          &#125;<br>        &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;warm&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;min_age&quot;</span>: <span class="hljs-string">&quot;10s&quot;</span>,<br>        <span class="hljs-string">&quot;actions&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;allocate&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;include&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;box_type&quot;</span>: <span class="hljs-string">&quot;warm&quot;</span><br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;cold&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;min_age&quot;</span>: <span class="hljs-string">&quot;15s&quot;</span>,<br>        <span class="hljs-string">&quot;actions&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;allocate&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;include&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;box_type&quot;</span>: <span class="hljs-string">&quot;cold&quot;</span><br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;delete&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;min_age&quot;</span>: <span class="hljs-string">&quot;20s&quot;</span>,<br>        <span class="hljs-string">&quot;actions&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;delete&quot;</span>: &#123;&#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br><span class="hljs-comment"># è®¾ç½®ç´¢å¼•æ¨¡ç‰ˆ</span><br>PUT /_template/log_ilm_template<br>&#123;<br>  <span class="hljs-string">&quot;index_patterns&quot;</span> : [<br>      <span class="hljs-string">&quot;ilm_index-*&quot;</span><br>    ],<br>    <span class="hljs-string">&quot;settings&quot;</span> : &#123;<br>      <span class="hljs-string">&quot;index&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;lifecycle&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;log_ilm_policy&quot;</span>,<br>          <span class="hljs-string">&quot;rollover_alias&quot;</span> : <span class="hljs-string">&quot;ilm_alias&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;routing&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;allocation&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;include&quot;</span> : &#123;<br>              <span class="hljs-string">&quot;box_type&quot;</span> : <span class="hljs-string">&quot;hot&quot;</span><br>            &#125;<br>          &#125;<br>        &#125;,<br>        <span class="hljs-string">&quot;number_of_shards&quot;</span> : <span class="hljs-string">&quot;1&quot;</span>,<br>        <span class="hljs-string">&quot;number_of_replicas&quot;</span> : <span class="hljs-string">&quot;0&quot;</span><br>      &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;mappings&quot;</span> : &#123; &#125;,<br>    <span class="hljs-string">&quot;aliases&quot;</span> : &#123; &#125;<br>&#125;<br><br><br><br><span class="hljs-comment">#åˆ›å»ºç´¢å¼•</span><br>PUT ilm_index-000001<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>: 1,<br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span>: 0,<br>    <span class="hljs-string">&quot;index.lifecycle.name&quot;</span>: <span class="hljs-string">&quot;log_ilm_policy&quot;</span>,<br>    <span class="hljs-string">&quot;index.lifecycle.rollover_alias&quot;</span>: <span class="hljs-string">&quot;ilm_alias&quot;</span>,<br>    <span class="hljs-string">&quot;index.routing.allocation.include.box_type&quot;</span>:<span class="hljs-string">&quot;hot&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;aliases&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;ilm_alias&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;is_write_index&quot;</span>: <span class="hljs-literal">true</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># å¯¹ Aliaså†™å…¥æ–‡æ¡£</span><br>POST  ilm_alias/_doc<br>&#123;<br>  <span class="hljs-string">&quot;dfd&quot;</span>:<span class="hljs-string">&quot;dfdsf&quot;</span><br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="12-1-Logstashå…¥é—¨åŠæ¶æ„ä»‹ç»-md"><a href="#12-1-Logstashå…¥é—¨åŠæ¶æ„ä»‹ç»-md" class="headerlink" title="12.1-Logstashå…¥é—¨åŠæ¶æ„ä»‹ç».md"></a>12.1-Logstashå…¥é—¨åŠæ¶æ„ä»‹ç».md</h1><h1 id="Logstash-å…¥é—¨åŠæ¶æ„ä»‹ç»"><a href="#Logstash-å…¥é—¨åŠæ¶æ„ä»‹ç»" class="headerlink" title="Logstash å…¥é—¨åŠæ¶æ„ä»‹ç»"></a>Logstash å…¥é—¨åŠæ¶æ„ä»‹ç»</h1><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><br><br># ä¸€ä¸ª Demoï¼Œ demo è¿è¡Œ<br>sudo bin/logstash -f logstash-<span class="hljs-keyword">filter</span>.conf<br><br># demoæ•°æ®<br><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> - - [<span class="hljs-number">11</span>/Dec/<span class="hljs-number">2013</span>:<span class="hljs-number">00</span>:<span class="hljs-number">01</span>:<span class="hljs-number">45</span> <span class="hljs-number">-0800</span>] <span class="hljs-string">&quot;GET /xampp/status.php HTTP/1.1&quot;</span> <span class="hljs-number">200</span> <span class="hljs-number">3891</span> <span class="hljs-string">&quot;http://cadenza/xampp/navi.php&quot;</span> <span class="hljs-string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:25.0) Gecko/20100101 Firefox/25.0&quot;</span><br><br><br># codec demo<br><br><br>sudo bin/logstash -e <span class="hljs-string">&quot;input&#123;stdin&#123;codec=&gt;line&#125;&#125;output&#123;stdout&#123;codec=&gt; rubydebug&#125;&#125;&quot;</span><br>sudo bin/logstash -e <span class="hljs-string">&quot;input&#123;stdin&#123;codec=&gt;json&#125;&#125;output&#123;stdout&#123;codec=&gt; rubydebug&#125;&#125;&quot;</span><br>sudo bin/logstash -e <span class="hljs-string">&quot;input&#123;stdin&#123;codec=&gt;line&#125;&#125;output&#123;stdout&#123;codec=&gt; dots&#125;&#125;&quot;</span><br><br><br>sudo bin/logstash -f multiline-exception.conf<br><br># å¤šè¡Œæ•°æ®ï¼Œå¼‚å¸¸<br>Exception in thread <span class="hljs-string">&quot;main&quot;</span> java.lang.NullPointerException<br>        at com.example.myproject.Book.getTitle(Book.java:<span class="hljs-number">16</span>)<br>        at com.example.myproject.Author.getBookTitles(Author.java:<span class="hljs-number">25</span>)<br>        at com.example.myproject.Bootstrap.main(Bootstrap.java:<span class="hljs-number">14</span>)<br><br><br><br># ä¸€ä¸ªå®ä¾‹<br><span class="hljs-symbol">https:</span>//github.com/onebirdrocks/geektime-ELK/blob/master/part<span class="hljs-number">-1</span>/<span class="hljs-number">2.4</span>-Logstash<span class="hljs-variable">%E5</span><span class="hljs-variable">%AE</span><span class="hljs-variable">%89</span><span class="hljs-variable">%E8</span><span class="hljs-variable">%A3</span><span class="hljs-variable">%85</span><span class="hljs-variable">%E4</span><span class="hljs-variable">%B8</span><span class="hljs-variable">%8</span>E<span class="hljs-variable">%E5</span><span class="hljs-variable">%AF</span><span class="hljs-variable">%BC</span><span class="hljs-variable">%E5</span><span class="hljs-variable">%85</span><span class="hljs-variable">%A5</span><span class="hljs-variable">%E6</span><span class="hljs-variable">%95</span><span class="hljs-variable">%B0</span><span class="hljs-variable">%E6</span><span class="hljs-variable">%8</span>D<span class="hljs-variable">%AE</span>/movielens/logstash.conf<br><br></code></pre></td></tr></table></figure><h1 id="12-2-åˆ©ç”¨JDBCæ’ä»¶å¯¼å…¥æ•°æ®åˆ°Elasticsearch-md"><a href="#12-2-åˆ©ç”¨JDBCæ’ä»¶å¯¼å…¥æ•°æ®åˆ°Elasticsearch-md" class="headerlink" title="12.2-åˆ©ç”¨JDBCæ’ä»¶å¯¼å…¥æ•°æ®åˆ°Elasticsearch.md"></a>12.2-åˆ©ç”¨JDBCæ’ä»¶å¯¼å…¥æ•°æ®åˆ°Elasticsearch.md</h1><h1 id="Logstashæ’ä»¶åŠæ–‡æ¡£ä»‹ç»"><a href="#Logstashæ’ä»¶åŠæ–‡æ¡£ä»‹ç»" class="headerlink" title="Logstashæ’ä»¶åŠæ–‡æ¡£ä»‹ç»"></a>Logstashæ’ä»¶åŠæ–‡æ¡£ä»‹ç»</h1><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">https://spring.io/guides/gs/accessing-data-mysql/<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> db_example;<br>use db_example;<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">tables</span>;<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">user</span>;<br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span>;<br><br><br><br># æ–°å¢ç”¨æˆ·<br>curl localhost:<span class="hljs-number">8080</span>/demo/<span class="hljs-keyword">add</span> -d <span class="hljs-type">name</span>=Mike -d email=mike@xyz.com -d tags=Elasticsearch,IntelliJ<br>curl localhost:<span class="hljs-number">8080</span>/demo/<span class="hljs-keyword">add</span> -d <span class="hljs-type">name</span>=Jack -d email=jack@xyz.com -d tags=Mysql,IntelliJ<br>curl localhost:<span class="hljs-number">8080</span>/demo/<span class="hljs-keyword">add</span> -d <span class="hljs-type">name</span>=Bob -d email=bob@xyz.com -d tags=Mysql,IntelliJ<br><br>#æŸ¥çœ‹æ‰€æœ‰çš„ç”¨æˆ·<br>curl <span class="hljs-string">&#x27;localhost:8080/demo/all&#x27;</span><br><br># æ›´æ–°ç”¨æˆ·<br>curl -X PUT localhost:<span class="hljs-number">8080</span>/demo/<span class="hljs-keyword">update</span> -d id=<span class="hljs-number">16</span> -d <span class="hljs-type">name</span>=Bob2 -d email=bob2@xyz.com -d tags=Mysql,IntelliJ<br><br># åˆ é™¤ç”¨æˆ·<br>curl -X <span class="hljs-keyword">DELETE</span> localhost:<span class="hljs-number">8080</span>/demo/<span class="hljs-keyword">delete</span> -d id=<span class="hljs-number">15</span><br><br><br><br>mysql-demo.conf<br><br># åˆ›å»º <span class="hljs-keyword">alias</span>ï¼Œåªæ˜¾ç¤ºæ²¡æœ‰è¢«æ ‡è®° deletedçš„ç”¨æˆ·<br>POST /_aliases<br>&#123;<br>  &quot;actions&quot;: [<br>    &#123;<br>      &quot;add&quot;: &#123;<br>        &quot;index&quot;: &quot;users&quot;,<br>        &quot;alias&quot;: &quot;view_users&quot;,<br>         &quot;filter&quot; : &#123; &quot;term&quot; : &#123; &quot;is_deleted&quot; : <span class="hljs-keyword">false</span> &#125; &#125;<br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br><br># é€šè¿‡ <span class="hljs-keyword">Alias</span>æŸ¥è¯¢ï¼ŒæŸ¥ä¸åˆ°è¢«æ ‡è®°æˆ deletedçš„ç”¨æˆ·<br>POST view_users/_search<br>&#123;<br><br>&#125;<br><br><br>POST view_users/_search<br>&#123;<br>  &quot;query&quot;: &#123;<br>    &quot;term&quot;: &#123;<br>      &quot;name.keyword&quot;: &#123;<br>        &quot;value&quot;: &quot;Jack&quot;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST users/_search<br>&#123;<br>  &quot;query&quot;: &#123;<br>    &quot;term&quot;: &#123;<br>      &quot;name.keyword&quot;: &#123;<br>        &quot;value&quot;: &quot;Jack&quot;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="12-3-Beatsä»‹ç»-md"><a href="#12-3-Beatsä»‹ç»-md" class="headerlink" title="12.3-Beatsä»‹ç».md"></a>12.3-Beatsä»‹ç».md</h1><h1 id="Beatsä»‹ç»"><a href="#Beatsä»‹ç»" class="headerlink" title="Beatsä»‹ç»"></a>Beatsä»‹ç»</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><span class="hljs-comment">##</span><br><span class="hljs-comment"># æŸ¥çœ‹ packetbeat æ¨¡å—</span><br><span class="hljs-comment"># è®¾ç½® packetbeat çš„mysql æ¨¡å—</span><br><span class="hljs-comment"># å¯åŠ¨è¿è¡Œ</span><br><span class="hljs-comment">#</span><br>./metricbeat modules list<br>./metricbeat modules <span class="hljs-built_in">enable</span> mysql<br>./metricbeat setup --dashboards<br><br><span class="hljs-comment"># å®‰è£…mysql</span><br>create database db_example<br>use db_example;<br>show tables;<br>select * <span class="hljs-keyword">from</span><span class="hljs-built_in"> user</span><br><span class="hljs-built_in"></span><br>curl localhost:8080/demo/<span class="hljs-built_in">add</span> -d <span class="hljs-attribute">name</span>=Mike -d <span class="hljs-attribute">email</span>=mike@xyz.com -d <span class="hljs-attribute">tags</span>=Elasticsearch,IntelliJ<br>curl localhost:8080/demo/<span class="hljs-built_in">add</span> -d <span class="hljs-attribute">name</span>=Jack -d <span class="hljs-attribute">email</span>=jack@xyz.com -d <span class="hljs-attribute">tags</span>=Mysql,IntelliJ<br>curl localhost:8080/demo/<span class="hljs-built_in">add</span> -d <span class="hljs-attribute">name</span>=Bob -d <span class="hljs-attribute">email</span>=bob@xyz.com -d <span class="hljs-attribute">tags</span>=Mysql,IntelliJ<br><br>curl <span class="hljs-string">&#x27;localhost:8080/demo/all&#x27;</span><br><br><br><span class="hljs-comment"># é…ç½® packetbeat</span><br><span class="hljs-comment"># å¯åŠ¨</span><br>ä¿®æ”¹ packetbeatï¼Œæ‰“å¼€ http 5601 9200 å’Œ mysql 3306ç›‘æ§<br><br>sudo chown root packetbeat.yml<br>sudo ./packetbeat setup --dashboards<br>sudo ./packetbeat<br><br><br><span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰ Filebeat æ¨¡å—</span><br><span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰çš„modules</span><br>./filebeat modules list<br><br><span class="hljs-comment">#</span><br>./filebeat modules <span class="hljs-built_in">enable</span> mysql<br><br></code></pre></td></tr></table></figure><h1 id="13-1-ä½¿ç”¨IndexPatterné…ç½®æ•°æ®-md"><a href="#13-1-ä½¿ç”¨IndexPatterné…ç½®æ•°æ®-md" class="headerlink" title="13.1-ä½¿ç”¨IndexPatterné…ç½®æ•°æ®.md"></a>13.1-ä½¿ç”¨IndexPatterné…ç½®æ•°æ®.md</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>localhost:5601/status<br><br><br><br><br>PUT /logstash-2015.05.18<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;geo&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;coordinates&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;geo_point&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br>PUT /logstash-2015.05.19<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;geo&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;coordinates&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;geo_point&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br>PUT /logstash-2015.05.20<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;geo&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;coordinates&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;geo_point&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># For Mac &amp; Windows</span><br>curl -H <span class="hljs-string">&#x27;Content-Type: application/x-ndjson&#x27;</span> -XPOST <span class="hljs-string">&#x27;localhost:9200/_bulk?pretty&#x27;</span> --data-binary @logs.jsonl<br><br>curl -H <span class="hljs-string">&#x27;Content-Type: application/x-ndjson&#x27;</span> -XPOST <span class="hljs-string">&#x27;localhost:9200/bank/account/_bulk?pretty&#x27;</span> --data-binary @accounts.json<br><br><br><span class="hljs-comment">#For Windows</span><br>Invoke-RestMethod <span class="hljs-string">&quot;http://localhost:9200/_bulk?pretty&quot;</span> -Method Post -ContentType <span class="hljs-string">&#x27;application/x-ndjson&#x27;</span> -InFile <span class="hljs-string">&quot;logs.jsonl&quot;</span><br><br><br><br>GET /_cat/indices?v<br><br></code></pre></td></tr></table></figure><h1 id="13-2-ä½¿ç”¨KibanaDiscoveræ¢ç´¢æ•°æ®-md"><a href="#13-2-ä½¿ç”¨KibanaDiscoveræ¢ç´¢æ•°æ®-md" class="headerlink" title="13.2-ä½¿ç”¨KibanaDiscoveræ¢ç´¢æ•°æ®.md"></a>13.2-ä½¿ç”¨KibanaDiscoveræ¢ç´¢æ•°æ®.md</h1><h1 id="ä½¿ç”¨Kibana-Discovery-æ¢ç´¢æ•°æ®"><a href="#ä½¿ç”¨Kibana-Discovery-æ¢ç´¢æ•°æ®" class="headerlink" title="ä½¿ç”¨Kibana Discovery æ¢ç´¢æ•°æ®"></a>ä½¿ç”¨Kibana Discovery æ¢ç´¢æ•°æ®</h1><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><br>è®¾ç½®æ—¶é—´è¿‡æ»¤å™¨<br>æœç´¢ä½ çš„æ•°æ®<br>æ ¹æ®å­—æ®µè¿›è¡Œè¿‡æ»¤<br>æŸ¥çœ‹æ–‡æ¡£æ•°æ®<br>æŸ¥çœ‹æ–‡æ¡£ä¸Šä¸‹æ–‡<br>æš‚æ—¶å­—æ®µæ•°æ®ç»Ÿè®¡<br><span class="hljs-built_in">Save</span> <span class="hljs-built_in">Query</span><br><br><br></code></pre></td></tr></table></figure><h1 id="13-3-åŸºæœ¬å¯è§†åŒ–ç»„ä»¶ä»‹ç»-md"><a href="#13-3-åŸºæœ¬å¯è§†åŒ–ç»„ä»¶ä»‹ç»-md" class="headerlink" title="13.3-åŸºæœ¬å¯è§†åŒ–ç»„ä»¶ä»‹ç».md"></a>13.3-åŸºæœ¬å¯è§†åŒ–ç»„ä»¶ä»‹ç».md</h1><h1 id="åŸºæœ¬å¯è§†åŒ–ç»„ä»¶ä»‹ç»"><a href="#åŸºæœ¬å¯è§†åŒ–ç»„ä»¶ä»‹ç»" class="headerlink" title="åŸºæœ¬å¯è§†åŒ–ç»„ä»¶ä»‹ç»"></a>åŸºæœ¬å¯è§†åŒ–ç»„ä»¶ä»‹ç»</h1><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><br>PUT /shakespeare<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;speaker&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span>&#125;,<br>    <span class="hljs-string">&quot;play_name&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span>&#125;,<br>    <span class="hljs-string">&quot;line_id&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;integer&quot;</span>&#125;,<br>    <span class="hljs-string">&quot;speech_number&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;integer&quot;</span>&#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-meta"># For Mac &amp; Windows</span><br>curl -H <span class="hljs-string">&#x27;Content-Type: application/x-ndjson&#x27;</span> -XPOST <span class="hljs-string">&#x27;localhost:9200/bank/account/_bulk?pretty&#x27;</span> --data-<span class="hljs-built_in">binary</span> <span class="hljs-symbol">@accounts</span>.json<br>curl -H <span class="hljs-string">&#x27;Content-Type: application/x-ndjson&#x27;</span> -XPOST <span class="hljs-string">&#x27;localhost:9200/shakespeare/_bulk?pretty&#x27;</span> --data-<span class="hljs-built_in">binary</span> <span class="hljs-symbol">@shakespeare</span>.json<br><br><span class="hljs-meta">#For Windows</span><br>Invoke-RestMethod <span class="hljs-string">&quot;http://localhost:9200/bank/account/_bulk?pretty&quot;</span> -Method Post -ContentType <span class="hljs-string">&#x27;application/x-ndjson&#x27;</span> -InFile <span class="hljs-string">&quot;accounts.json&quot;</span><br>Invoke-RestMethod <span class="hljs-string">&quot;http://localhost:9200/shakespeare/_bulk?pretty&quot;</span> -Method Post -ContentType <span class="hljs-string">&#x27;application/x-ndjson&#x27;</span> -InFile <span class="hljs-string">&quot;shakespeare.json&quot;</span><br><br><br></code></pre></td></tr></table></figure><h1 id="13-4-æ„å»ºDashboard-md"><a href="#13-4-æ„å»ºDashboard-md" class="headerlink" title="13.4-æ„å»ºDashboard.md"></a>13.4-æ„å»ºDashboard.md</h1><h1 id="æ„å»ºDashboard"><a href="#æ„å»ºDashboard" class="headerlink" title="æ„å»ºDashboard"></a>æ„å»ºDashboard</h1><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-bullet">- </span>åˆ›å»ºä»ªè¡¨æ½˜<br><span class="hljs-bullet">- </span>åŠ è½½ä»ªè¡¨ç›˜<br><span class="hljs-bullet">- </span>å…±äº«ä»ªè¡¨ç›˜<br><br></code></pre></td></tr></table></figure><h1 id="14-3ç”¨æœºå™¨å­¦ä¹ å®ç°æ—¶åºæ•°æ®çš„å¼‚å¸¸æ£€æµ‹-ä¸Š-md"><a href="#14-3ç”¨æœºå™¨å­¦ä¹ å®ç°æ—¶åºæ•°æ®çš„å¼‚å¸¸æ£€æµ‹-ä¸Š-md" class="headerlink" title="14.3ç”¨æœºå™¨å­¦ä¹ å®ç°æ—¶åºæ•°æ®çš„å¼‚å¸¸æ£€æµ‹-ä¸Š.md"></a>14.3ç”¨æœºå™¨å­¦ä¹ å®ç°æ—¶åºæ•°æ®çš„å¼‚å¸¸æ£€æµ‹-ä¸Š.md</h1><p>mkdir server_metrics<br>cd server_metrics<br>wget <a href="https://download.elasticsearch.org/demos/machine_learning/gettingstarted/server_metrics.tar.gz">https://download.elasticsearch.org/demos/machine_learning/gettingstarted/server_metrics.tar.gz</a><br>tar -xvf server_metrics.tar.gz</p><h1 id="14-5-ç”¨ELKè¿›è¡Œæ—¥å¿—ç®¡ç†-md"><a href="#14-5-ç”¨ELKè¿›è¡Œæ—¥å¿—ç®¡ç†-md" class="headerlink" title="14.5-ç”¨ELKè¿›è¡Œæ—¥å¿—ç®¡ç†.md"></a>14.5-ç”¨ELKè¿›è¡Œæ—¥å¿—ç®¡ç†.md</h1><h1 id="ç”¨-ELK-æ¥åšæ—¥å¿—ç®¡ç†"><a href="#ç”¨-ELK-æ¥åšæ—¥å¿—ç®¡ç†" class="headerlink" title="ç”¨ ELK æ¥åšæ—¥å¿—ç®¡ç†"></a>ç”¨ ELK æ¥åšæ—¥å¿—ç®¡ç†</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">./filebeat modules list<br>./filebeat modules <span class="hljs-built_in">enable</span> system<br>./filebeat modules <span class="hljs-built_in">enable</span> elasticsearch<br><br><br><span class="hljs-comment">## è¿› modules.d ç¼–è¾‘ç›¸åº”çš„æ–‡ä»¶ï¼Œä¿®æ”¹logè·¯å¾„</span><br><br>./filebeat setup â€“dashboards<br><br>./filebeat <span class="hljs-built_in">export</span> template | more<br><br>./filebeat -e<br><br></code></pre></td></tr></table></figure><h1 id="14-6-ç”¨Canvasåšæ•°æ®æ¼”ç¤º-md"><a href="#14-6-ç”¨Canvasåšæ•°æ®æ¼”ç¤º-md" class="headerlink" title="14.6-ç”¨Canvasåšæ•°æ®æ¼”ç¤º.md"></a>14.6-ç”¨Canvasåšæ•°æ®æ¼”ç¤º.md</h1><p>POST elasticoffee&#x2F;_search<br>{<br>  â€œsizeâ€: 0,<br>  â€œaggsâ€: {<br>    â€œbyâ€: {<br>      â€œtermsâ€: {<br>        â€œfieldâ€: â€œbeverage.keywordâ€,<br>        â€œsizeâ€: 10<br>      }<br>    }<br>  }<br>}</p><h1 id="4-1-åŸºäºè¯é¡¹å’ŒåŸºäºå…¨æ–‡çš„æœç´¢-md"><a href="#4-1-åŸºäºè¯é¡¹å’ŒåŸºäºå…¨æ–‡çš„æœç´¢-md" class="headerlink" title="4.1-åŸºäºè¯é¡¹å’ŒåŸºäºå…¨æ–‡çš„æœç´¢.md"></a>4.1-åŸºäºè¯é¡¹å’ŒåŸºäºå…¨æ–‡çš„æœç´¢.md</h1><h1 id="åŸºäºè¯é¡¹å’ŒåŸºäºå…¨æ–‡çš„æœç´¢"><a href="#åŸºäºè¯é¡¹å’ŒåŸºäºå…¨æ–‡çš„æœç´¢" class="headerlink" title="åŸºäºè¯é¡¹å’ŒåŸºäºå…¨æ–‡çš„æœç´¢"></a>åŸºäºè¯é¡¹å’ŒåŸºäºå…¨æ–‡çš„æœç´¢</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE products<br>PUT products<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>: 1<br>  &#125;<br>&#125;<br><br><br>POST /products/_bulk<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 1 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;productID&quot;</span> : <span class="hljs-string">&quot;XHDK-A-1293-#fJ3&quot;</span>,<span class="hljs-string">&quot;desc&quot;</span>:<span class="hljs-string">&quot;iPhone&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 2 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;productID&quot;</span> : <span class="hljs-string">&quot;KDKE-B-9947-#kL5&quot;</span>,<span class="hljs-string">&quot;desc&quot;</span>:<span class="hljs-string">&quot;iPad&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 3 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;productID&quot;</span> : <span class="hljs-string">&quot;JODL-X-1937-#pV7&quot;</span>,<span class="hljs-string">&quot;desc&quot;</span>:<span class="hljs-string">&quot;MBP&quot;</span> &#125;<br><br>GET /products<br><br>POST /products/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;desc&quot;</span>: &#123;<br>        //<span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;iPhone&quot;</span><br>        <span class="hljs-string">&quot;value&quot;</span>:<span class="hljs-string">&quot;iphone&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST /products/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;desc.keyword&quot;</span>: &#123;<br>        //<span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;iPhone&quot;</span><br>        //<span class="hljs-string">&quot;value&quot;</span>:<span class="hljs-string">&quot;iphone&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br>POST /products/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;productID&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;XHDK-A-1293-#fJ3&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST /products/_search<br>&#123;<br>  //<span class="hljs-string">&quot;explain&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;productID.keyword&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;XHDK-A-1293-#fJ3&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br><br>POST /products/_search<br>&#123;<br>  <span class="hljs-string">&quot;explain&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;constant_score&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;productID.keyword&quot;</span>: <span class="hljs-string">&quot;XHDK-A-1293-#fJ3&quot;</span><br>        &#125;<br>      &#125;<br><br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#è®¾ç½® position_increment_gap</span><br>DELETE <span class="hljs-built_in">groups</span><br>PUT <span class="hljs-built_in">groups</span><br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;names&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>        <span class="hljs-string">&quot;position_increment_gap&quot;</span>: 0<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>GET <span class="hljs-built_in">groups</span>/_mapping<br><br>POST <span class="hljs-built_in">groups</span>/_doc<br>&#123;<br>  <span class="hljs-string">&quot;names&quot;</span>: [ <span class="hljs-string">&quot;John Water&quot;</span>, <span class="hljs-string">&quot;Water Smith&quot;</span>]<br>&#125;<br><br>POST <span class="hljs-built_in">groups</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_phrase&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;names&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;Water Water&quot;</span>,<br>        <span class="hljs-string">&quot;slop&quot;</span>: 100<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br>POST <span class="hljs-built_in">groups</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_phrase&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;names&quot;</span>: <span class="hljs-string">&quot;Water Smith&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="4-10-ç»¼åˆæ’åºï¼šFunction-Score-Query-ä¼˜åŒ–ç®—åˆ†-md"><a href="#4-10-ç»¼åˆæ’åºï¼šFunction-Score-Query-ä¼˜åŒ–ç®—åˆ†-md" class="headerlink" title="4.10-ç»¼åˆæ’åºï¼šFunction Score Query ä¼˜åŒ–ç®—åˆ†.md"></a>4.10-ç»¼åˆæ’åºï¼šFunction Score Query ä¼˜åŒ–ç®—åˆ†.md</h1><h1 id="ç»¼åˆæ’åºï¼šFunction-Score-Query-ä¼˜åŒ–ç®—åˆ†"><a href="#ç»¼åˆæ’åºï¼šFunction-Score-Query-ä¼˜åŒ–ç®—åˆ†" class="headerlink" title="ç»¼åˆæ’åºï¼šFunction Score Query ä¼˜åŒ–ç®—åˆ†"></a>ç»¼åˆæ’åºï¼šFunction Score Query ä¼˜åŒ–ç®—åˆ†</h1><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs dts">DELETE blogs<br>PUT <span class="hljs-keyword">/blogs/</span>_doc/<span class="hljs-number">1</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-string">&quot;title&quot;</span>:   <span class="hljs-string">&quot;About popularity&quot;</span>,<br>  <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;In this post we will talk about...&quot;</span>,<br>  <span class="hljs-string">&quot;votes&quot;</span>:   <span class="hljs-number">0</span><br><span class="hljs-punctuation">&#125;</span><br><br>PUT <span class="hljs-keyword">/blogs/</span>_doc/<span class="hljs-number">2</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-string">&quot;title&quot;</span>:   <span class="hljs-string">&quot;About popularity&quot;</span>,<br>  <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;In this post we will talk about...&quot;</span>,<br>  <span class="hljs-string">&quot;votes&quot;</span>:   <span class="hljs-number">100</span><br><span class="hljs-punctuation">&#125;</span><br><br>PUT <span class="hljs-keyword">/blogs/</span>_doc/<span class="hljs-number">3</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-string">&quot;title&quot;</span>:   <span class="hljs-string">&quot;About popularity&quot;</span>,<br>  <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;In this post we will talk about...&quot;</span>,<br>  <span class="hljs-string">&quot;votes&quot;</span>:   <span class="hljs-number">1000000</span><br><span class="hljs-punctuation">&#125;</span><br><br><br>POST <span class="hljs-keyword">/blogs/</span><span class="hljs-title class_">_search</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-string">&quot;function_score&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-string">&quot;multi_match&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-string">&quot;query&quot;</span>:    <span class="hljs-string">&quot;popularity&quot;</span>,<br>          <span class="hljs-string">&quot;fields&quot;</span>: [ <span class="hljs-string">&quot;title&quot;</span>, <span class="hljs-string">&quot;content&quot;</span> ]<br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span>,<br>      <span class="hljs-string">&quot;field_value_factor&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;votes&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br>POST <span class="hljs-keyword">/blogs/</span><span class="hljs-title class_">_search</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-string">&quot;function_score&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-string">&quot;multi_match&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-string">&quot;query&quot;</span>:    <span class="hljs-string">&quot;popularity&quot;</span>,<br>          <span class="hljs-string">&quot;fields&quot;</span>: [ <span class="hljs-string">&quot;title&quot;</span>, <span class="hljs-string">&quot;content&quot;</span> ]<br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span>,<br>      <span class="hljs-string">&quot;field_value_factor&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;votes&quot;</span>,<br>        <span class="hljs-string">&quot;modifier&quot;</span>: <span class="hljs-string">&quot;log1p&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br><br>POST <span class="hljs-keyword">/blogs/</span><span class="hljs-title class_">_search</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-string">&quot;function_score&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-string">&quot;multi_match&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-string">&quot;query&quot;</span>:    <span class="hljs-string">&quot;popularity&quot;</span>,<br>          <span class="hljs-string">&quot;fields&quot;</span>: [ <span class="hljs-string">&quot;title&quot;</span>, <span class="hljs-string">&quot;content&quot;</span> ]<br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span>,<br>      <span class="hljs-string">&quot;field_value_factor&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;votes&quot;</span>,<br>        <span class="hljs-string">&quot;modifier&quot;</span>: <span class="hljs-string">&quot;log1p&quot;</span> ,<br>        <span class="hljs-string">&quot;factor&quot;</span>: <span class="hljs-number">0.1</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br><br>POST <span class="hljs-keyword">/blogs/</span><span class="hljs-title class_">_search</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-string">&quot;function_score&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-string">&quot;multi_match&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-string">&quot;query&quot;</span>:    <span class="hljs-string">&quot;popularity&quot;</span>,<br>          <span class="hljs-string">&quot;fields&quot;</span>: [ <span class="hljs-string">&quot;title&quot;</span>, <span class="hljs-string">&quot;content&quot;</span> ]<br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span>,<br>      <span class="hljs-string">&quot;field_value_factor&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;votes&quot;</span>,<br>        <span class="hljs-string">&quot;modifier&quot;</span>: <span class="hljs-string">&quot;log1p&quot;</span> ,<br>        <span class="hljs-string">&quot;factor&quot;</span>: <span class="hljs-number">0.1</span><br>      <span class="hljs-punctuation">&#125;</span>,<br>      <span class="hljs-string">&quot;boost_mode&quot;</span>: <span class="hljs-string">&quot;sum&quot;</span>,<br>      <span class="hljs-string">&quot;max_boost&quot;</span>: <span class="hljs-number">3</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br>POST <span class="hljs-keyword">/blogs/</span><span class="hljs-title class_">_search</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-string">&quot;function_score&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-string">&quot;random_score&quot;</span>: <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-string">&quot;seed&quot;</span>: <span class="hljs-number">911119</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h1 id="4-12-è‡ªåŠ¨è¡¥å…¨ä¸åŸºäºä¸Šä¸‹æ–‡çš„æç¤º-md"><a href="#4-12-è‡ªåŠ¨è¡¥å…¨ä¸åŸºäºä¸Šä¸‹æ–‡çš„æç¤º-md" class="headerlink" title="4.12-è‡ªåŠ¨è¡¥å…¨ä¸åŸºäºä¸Šä¸‹æ–‡çš„æç¤º.md"></a>4.12-è‡ªåŠ¨è¡¥å…¨ä¸åŸºäºä¸Šä¸‹æ–‡çš„æç¤º.md</h1><h1 id="è‡ªåŠ¨è¡¥å…¨ä¸åŸºäºä¸Šä¸‹æ–‡çš„æç¤º"><a href="#è‡ªåŠ¨è¡¥å…¨ä¸åŸºäºä¸Šä¸‹æ–‡çš„æç¤º" class="headerlink" title="è‡ªåŠ¨è¡¥å…¨ä¸åŸºäºä¸Šä¸‹æ–‡çš„æç¤º"></a>è‡ªåŠ¨è¡¥å…¨ä¸åŸºäºä¸Šä¸‹æ–‡çš„æç¤º</h1><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs fsharp">DELETE articles<br>PUT <span class="hljs-keyword">articles</span><br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span><span class="hljs-operator">:</span> &#123;<br>    <span class="hljs-string">&quot;properties&quot;</span><span class="hljs-operator">:</span> &#123;<br>      <span class="hljs-string">&quot;title_completion&quot;</span><span class="hljs-operator">:</span>&#123;<br>        <span class="hljs-string">&quot;type&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;completion&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST articles<span class="hljs-operator">/</span><span class="hljs-keyword">_bulk</span><br>&#123; <span class="hljs-string">&quot;index&quot;</span> <span class="hljs-operator">:</span> &#123; &#125; &#125;<br>&#123; <span class="hljs-string">&quot;title_completion&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;lucene is very cool&quot;</span>&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> <span class="hljs-operator">:</span> &#123; &#125; &#125;<br>&#123; <span class="hljs-string">&quot;title_completion&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;Elasticsearch builds on top of lucene&quot;</span>&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> <span class="hljs-operator">:</span> &#123; &#125; &#125;<br>&#123; <span class="hljs-string">&quot;title_completion&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;Elasticsearch rocks&quot;</span>&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> <span class="hljs-operator">:</span> &#123; &#125; &#125;<br>&#123; <span class="hljs-string">&quot;title_completion&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;elastic is the company behind ELK stack&quot;</span>&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> <span class="hljs-operator">:</span> &#123; &#125; &#125;<br>&#123; <span class="hljs-string">&quot;title_completion&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;Elk stack rocks&quot;</span>&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> <span class="hljs-operator">:</span> &#123;&#125; &#125;<br><br><br>POST articles<span class="hljs-operator">/</span>_search<span class="hljs-operator">?</span><span class="hljs-keyword">pretty</span><br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span><span class="hljs-operator">:</span> 0,<br>  <span class="hljs-string">&quot;suggest&quot;</span><span class="hljs-operator">:</span> &#123;<br>    <span class="hljs-string">&quot;article-suggester&quot;</span><span class="hljs-operator">:</span> &#123;<br>      <span class="hljs-string">&quot;prefix&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;elk &quot;</span>,<br>      <span class="hljs-string">&quot;completion&quot;</span><span class="hljs-operator">:</span> &#123;<br>        <span class="hljs-string">&quot;field&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;title_completion&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br>DELETE comments<br>PUT comments<br>PUT comments<span class="hljs-operator">/</span><span class="hljs-keyword">_mapping</span><br>&#123;<br>  <span class="hljs-string">&quot;properties&quot;</span><span class="hljs-operator">:</span> &#123;<br>    <span class="hljs-string">&quot;comment_autocomplete&quot;</span><span class="hljs-operator">:</span>&#123;<br>      <span class="hljs-string">&quot;type&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;completion&quot;</span>,<br>      <span class="hljs-string">&quot;contexts&quot;</span><span class="hljs-operator">:</span>[&#123;<br>        <span class="hljs-string">&quot;type&quot;</span><span class="hljs-operator">:</span><span class="hljs-string">&quot;category&quot;</span>,<br>        <span class="hljs-string">&quot;name&quot;</span><span class="hljs-operator">:</span><span class="hljs-string">&quot;comment_category&quot;</span><br>      &#125;]<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST comments<span class="hljs-operator">/</span><span class="hljs-keyword">_doc</span><br>&#123;<br>  <span class="hljs-string">&quot;comment&quot;</span><span class="hljs-operator">:</span><span class="hljs-string">&quot;I love the star war movies&quot;</span>,<br>  <span class="hljs-string">&quot;comment_autocomplete&quot;</span><span class="hljs-operator">:</span>&#123;<br>    <span class="hljs-string">&quot;input&quot;</span><span class="hljs-operator">:</span>[<span class="hljs-string">&quot;star wars&quot;</span>],<br>    <span class="hljs-string">&quot;contexts&quot;</span><span class="hljs-operator">:</span>&#123;<br>      <span class="hljs-string">&quot;comment_category&quot;</span><span class="hljs-operator">:</span><span class="hljs-string">&quot;movies&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br>POST comments<span class="hljs-operator">/</span><span class="hljs-keyword">_doc</span><br>&#123;<br>  <span class="hljs-string">&quot;comment&quot;</span><span class="hljs-operator">:</span><span class="hljs-string">&quot;Where can I find a Starbucks&quot;</span>,<br>  <span class="hljs-string">&quot;comment_autocomplete&quot;</span><span class="hljs-operator">:</span>&#123;<br>    <span class="hljs-string">&quot;input&quot;</span><span class="hljs-operator">:</span>[<span class="hljs-string">&quot;starbucks&quot;</span>],<br>    <span class="hljs-string">&quot;contexts&quot;</span><span class="hljs-operator">:</span>&#123;<br>      <span class="hljs-string">&quot;comment_category&quot;</span><span class="hljs-operator">:</span><span class="hljs-string">&quot;coffee&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><br>POST comments<span class="hljs-operator">/</span><span class="hljs-keyword">_search</span><br>&#123;<br>  <span class="hljs-string">&quot;suggest&quot;</span><span class="hljs-operator">:</span> &#123;<br>    <span class="hljs-string">&quot;MY_SUGGESTION&quot;</span><span class="hljs-operator">:</span> &#123;<br>      <span class="hljs-string">&quot;prefix&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;sta&quot;</span>,<br>      <span class="hljs-string">&quot;completion&quot;</span><span class="hljs-operator">:</span>&#123;<br>        <span class="hljs-string">&quot;field&quot;</span><span class="hljs-operator">:</span><span class="hljs-string">&quot;comment_autocomplete&quot;</span>,<br>        <span class="hljs-string">&quot;contexts&quot;</span><span class="hljs-operator">:</span>&#123;<br>          <span class="hljs-string">&quot;comment_category&quot;</span><span class="hljs-operator">:</span><span class="hljs-string">&quot;coffee&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="4-13-è·¨é›†ç¾¤æœç´¢-md"><a href="#4-13-è·¨é›†ç¾¤æœç´¢-md" class="headerlink" title="4.13-è·¨é›†ç¾¤æœç´¢.md"></a>4.13-è·¨é›†ç¾¤æœç´¢.md</h1><h1 id="è·¨é›†ç¾¤æœç´¢"><a href="#è·¨é›†ç¾¤æœç´¢" class="headerlink" title="è·¨é›†ç¾¤æœç´¢"></a>è·¨é›†ç¾¤æœç´¢</h1><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">//å¯åŠ¨<span class="hljs-number">3</span>ä¸ªé›†ç¾¤<br><br>bin/elasticsearch -E node.<span class="hljs-attr">name=</span>cluster0node -E cluster.<span class="hljs-attr">name=</span>cluster0 -E path.<span class="hljs-attr">data=</span>cluster0_data -E discovery.<span class="hljs-attr">type=</span>single-<span class="hljs-keyword">node</span> <span class="hljs-title">-E</span> http.<span class="hljs-attr">port=</span><span class="hljs-number">9200</span> -E transport.<span class="hljs-attr">port=</span><span class="hljs-number">9300</span><br>bin/elasticsearch -E node.<span class="hljs-attr">name=</span>cluster1node -E cluster.<span class="hljs-attr">name=</span>cluster1 -E path.<span class="hljs-attr">data=</span>cluster1_data -E discovery.<span class="hljs-attr">type=</span>single-<span class="hljs-keyword">node</span> <span class="hljs-title">-E</span> http.<span class="hljs-attr">port=</span><span class="hljs-number">9201</span> -E transport.<span class="hljs-attr">port=</span><span class="hljs-number">9301</span><br>bin/elasticsearch -E node.<span class="hljs-attr">name=</span>cluster2node -E cluster.<span class="hljs-attr">name=</span>cluster2 -E path.<span class="hljs-attr">data=</span>cluster2_data -E discovery.<span class="hljs-attr">type=</span>single-<span class="hljs-keyword">node</span> <span class="hljs-title">-E</span> http.<span class="hljs-attr">port=</span><span class="hljs-number">9202</span> -E transport.<span class="hljs-attr">port=</span><span class="hljs-number">9302</span><br><br><br>//åœ¨æ¯ä¸ªé›†ç¾¤ä¸Šè®¾ç½®åŠ¨æ€çš„è®¾ç½®<br>PUT _cluster/settings<br>&#123;<br>  <span class="hljs-string">&quot;persistent&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;cluster&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;remote&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;cluster0&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;seeds&quot;</span>: [<br>            <span class="hljs-string">&quot;127.0.0.1:9300&quot;</span><br>          ],<br>          <span class="hljs-string">&quot;transport.ping_schedule&quot;</span>: <span class="hljs-string">&quot;30s&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;cluster1&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;seeds&quot;</span>: [<br>            <span class="hljs-string">&quot;127.0.0.1:9301&quot;</span><br>          ],<br>          <span class="hljs-string">&quot;transport.compress&quot;</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-string">&quot;skip_unavailable&quot;</span>: <span class="hljs-literal">true</span><br>        &#125;,<br>        <span class="hljs-string">&quot;cluster2&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;seeds&quot;</span>: [<br>            <span class="hljs-string">&quot;127.0.0.1:9302&quot;</span><br>          ]<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">#cURL</span><br>curl -XPUT <span class="hljs-string">&quot;http://localhost:9200/_cluster/settings&quot;</span> -H &#x27;Content-<span class="hljs-keyword">Type</span>: application/json&#x27; -d&#x27;<br>&#123;<span class="hljs-string">&quot;persistent&quot;</span>:&#123;<span class="hljs-string">&quot;cluster&quot;</span>:&#123;<span class="hljs-string">&quot;remote&quot;</span>:&#123;<span class="hljs-string">&quot;cluster0&quot;</span>:&#123;<span class="hljs-string">&quot;seeds&quot;</span>:[<span class="hljs-string">&quot;127.0.0.1:9300&quot;</span>],<span class="hljs-string">&quot;transport.ping_schedule&quot;</span>:<span class="hljs-string">&quot;30s&quot;</span>&#125;,<span class="hljs-string">&quot;cluster1&quot;</span>:&#123;<span class="hljs-string">&quot;seeds&quot;</span>:[<span class="hljs-string">&quot;127.0.0.1:9301&quot;</span>],<span class="hljs-string">&quot;transport.compress&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;skip_unavailable&quot;</span>:<span class="hljs-literal">true</span>&#125;,<span class="hljs-string">&quot;cluster2&quot;</span>:&#123;<span class="hljs-string">&quot;seeds&quot;</span>:[<span class="hljs-string">&quot;127.0.0.1:9302&quot;</span>]&#125;&#125;&#125;&#125;&#125;&#x27;<br><br>curl -XPUT <span class="hljs-string">&quot;http://localhost:9201/_cluster/settings&quot;</span> -H &#x27;Content-<span class="hljs-keyword">Type</span>: application/json&#x27; -d&#x27;<br>&#123;<span class="hljs-string">&quot;persistent&quot;</span>:&#123;<span class="hljs-string">&quot;cluster&quot;</span>:&#123;<span class="hljs-string">&quot;remote&quot;</span>:&#123;<span class="hljs-string">&quot;cluster0&quot;</span>:&#123;<span class="hljs-string">&quot;seeds&quot;</span>:[<span class="hljs-string">&quot;127.0.0.1:9300&quot;</span>],<span class="hljs-string">&quot;transport.ping_schedule&quot;</span>:<span class="hljs-string">&quot;30s&quot;</span>&#125;,<span class="hljs-string">&quot;cluster1&quot;</span>:&#123;<span class="hljs-string">&quot;seeds&quot;</span>:[<span class="hljs-string">&quot;127.0.0.1:9301&quot;</span>],<span class="hljs-string">&quot;transport.compress&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;skip_unavailable&quot;</span>:<span class="hljs-literal">true</span>&#125;,<span class="hljs-string">&quot;cluster2&quot;</span>:&#123;<span class="hljs-string">&quot;seeds&quot;</span>:[<span class="hljs-string">&quot;127.0.0.1:9302&quot;</span>]&#125;&#125;&#125;&#125;&#125;&#x27;<br><br>curl -XPUT <span class="hljs-string">&quot;http://localhost:9202/_cluster/settings&quot;</span> -H &#x27;Content-<span class="hljs-keyword">Type</span>: application/json&#x27; -d&#x27;<br>&#123;<span class="hljs-string">&quot;persistent&quot;</span>:&#123;<span class="hljs-string">&quot;cluster&quot;</span>:&#123;<span class="hljs-string">&quot;remote&quot;</span>:&#123;<span class="hljs-string">&quot;cluster0&quot;</span>:&#123;<span class="hljs-string">&quot;seeds&quot;</span>:[<span class="hljs-string">&quot;127.0.0.1:9300&quot;</span>],<span class="hljs-string">&quot;transport.ping_schedule&quot;</span>:<span class="hljs-string">&quot;30s&quot;</span>&#125;,<span class="hljs-string">&quot;cluster1&quot;</span>:&#123;<span class="hljs-string">&quot;seeds&quot;</span>:[<span class="hljs-string">&quot;127.0.0.1:9301&quot;</span>],<span class="hljs-string">&quot;transport.compress&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;skip_unavailable&quot;</span>:<span class="hljs-literal">true</span>&#125;,<span class="hljs-string">&quot;cluster2&quot;</span>:&#123;<span class="hljs-string">&quot;seeds&quot;</span>:[<span class="hljs-string">&quot;127.0.0.1:9302&quot;</span>]&#125;&#125;&#125;&#125;&#125;&#x27;<br><br><br><span class="hljs-comment">#åˆ›å»ºæµ‹è¯•æ•°æ®</span><br>curl -XPOST <span class="hljs-string">&quot;http://localhost:9200/users/_doc&quot;</span> -H &#x27;Content-<span class="hljs-keyword">Type</span>: application/json&#x27; -d&#x27;<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;user1&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">10</span>&#125;&#x27;<br><br>curl -XPOST <span class="hljs-string">&quot;http://localhost:9201/users/_doc&quot;</span> -H &#x27;Content-<span class="hljs-keyword">Type</span>: application/json&#x27; -d&#x27;<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;user2&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">20</span>&#125;&#x27;<br><br>curl -XPOST <span class="hljs-string">&quot;http://localhost:9202/users/_doc&quot;</span> -H &#x27;Content-<span class="hljs-keyword">Type</span>: application/json&#x27; -d&#x27;<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;user3&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">30</span>&#125;&#x27;<br><br><br><span class="hljs-comment">#æŸ¥è¯¢</span><br>GET /users,cluster1:users,cluster2:users/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;range&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;age&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;gte&quot;</span>: <span class="hljs-number">20</span>,<br>        <span class="hljs-string">&quot;lte&quot;</span>: <span class="hljs-number">40</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="4-2-ç»“æ„åŒ–æœç´¢-md"><a href="#4-2-ç»“æ„åŒ–æœç´¢-md" class="headerlink" title="4.2-ç»“æ„åŒ–æœç´¢.md"></a>4.2-ç»“æ„åŒ–æœç´¢.md</h1><h1 id="ç»“æ„åŒ–æœç´¢"><a href="#ç»“æ„åŒ–æœç´¢" class="headerlink" title="ç»“æ„åŒ–æœç´¢"></a>ç»“æ„åŒ–æœç´¢</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment">#ç»“æ„åŒ–æœç´¢ï¼Œç²¾ç¡®åŒ¹é…</span><br>DELETE products<br>POST /products/_bulk<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 1 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;price&quot;</span> : 10,<span class="hljs-string">&quot;avaliable&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;date&quot;</span>:<span class="hljs-string">&quot;2018-01-01&quot;</span>, <span class="hljs-string">&quot;productID&quot;</span> : <span class="hljs-string">&quot;XHDK-A-1293-#fJ3&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 2 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;price&quot;</span> : 20,<span class="hljs-string">&quot;avaliable&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;date&quot;</span>:<span class="hljs-string">&quot;2019-01-01&quot;</span>, <span class="hljs-string">&quot;productID&quot;</span> : <span class="hljs-string">&quot;KDKE-B-9947-#kL5&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 3 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;price&quot;</span> : 30,<span class="hljs-string">&quot;avaliable&quot;</span>:<span class="hljs-literal">true</span>, <span class="hljs-string">&quot;productID&quot;</span> : <span class="hljs-string">&quot;JODL-X-1937-#pV7&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 4 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;price&quot;</span> : 30,<span class="hljs-string">&quot;avaliable&quot;</span>:<span class="hljs-literal">false</span>, <span class="hljs-string">&quot;productID&quot;</span> : <span class="hljs-string">&quot;QQPX-R-3956-#aD8&quot;</span> &#125;<br><br>GET products/_mapping<br><br><br><br><span class="hljs-comment">#å¯¹å¸ƒå°”å€¼ match æŸ¥è¯¢ï¼Œæœ‰ç®—åˆ†</span><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;explain&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;avaliable&quot;</span>: <span class="hljs-literal">true</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br><span class="hljs-comment">#å¯¹å¸ƒå°”å€¼ï¼Œé€šè¿‡constant score è½¬æˆ filteringï¼Œæ²¡æœ‰ç®—åˆ†</span><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;explain&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;constant_score&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;avaliable&quot;</span>: <span class="hljs-literal">true</span><br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#æ•°å­—ç±»å‹ Term</span><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;explain&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;price&quot;</span>: 30<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">#æ•°å­—ç±»å‹ terms</span><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;constant_score&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;price&quot;</span>: [<br>            <span class="hljs-string">&quot;20&quot;</span>,<br>            <span class="hljs-string">&quot;30&quot;</span><br>          ]<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">#æ•°å­— Range æŸ¥è¯¢</span><br>GET products/_search<br>&#123;<br>    <span class="hljs-string">&quot;query&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;constant_score&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;filter&quot;</span> : &#123;<br>                <span class="hljs-string">&quot;range&quot;</span> : &#123;<br>                    <span class="hljs-string">&quot;price&quot;</span> : &#123;<br>                        <span class="hljs-string">&quot;gte&quot;</span> : 20,<br>                        <span class="hljs-string">&quot;lte&quot;</span>  : 30<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment"># æ—¥æœŸ range</span><br>POST products/_search<br>&#123;<br>    <span class="hljs-string">&quot;query&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;constant_score&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;filter&quot;</span> : &#123;<br>                <span class="hljs-string">&quot;range&quot;</span> : &#123;<br>                    <span class="hljs-string">&quot;date&quot;</span> : &#123;<br>                      <span class="hljs-string">&quot;gte&quot;</span> : <span class="hljs-string">&quot;now-1y&quot;</span><br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><br><br><span class="hljs-comment">#existsæŸ¥è¯¢</span><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;constant_score&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;exists&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;date&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">#å¤„ç†å¤šå€¼å­—æ®µ</span><br>POST /movies/_bulk<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 1 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;title&quot;</span> : <span class="hljs-string">&quot;Father of the Bridge Part II&quot;</span>,<span class="hljs-string">&quot;year&quot;</span>:1995, <span class="hljs-string">&quot;genre&quot;</span>:<span class="hljs-string">&quot;Comedy&quot;</span>&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 2 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;title&quot;</span> : <span class="hljs-string">&quot;Dave&quot;</span>,<span class="hljs-string">&quot;year&quot;</span>:1993,<span class="hljs-string">&quot;genre&quot;</span>:[<span class="hljs-string">&quot;Comedy&quot;</span>,<span class="hljs-string">&quot;Romance&quot;</span>] &#125;<br><br><br><span class="hljs-comment">#å¤„ç†å¤šå€¼å­—æ®µï¼Œterm æŸ¥è¯¢æ˜¯åŒ…å«ï¼Œè€Œä¸æ˜¯ç­‰äº</span><br>POST movies/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;constant_score&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;genre.keyword&quot;</span>: <span class="hljs-string">&quot;Comedy&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#å­—ç¬¦ç±»å‹ terms</span><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;constant_score&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;productID.keyword&quot;</span>: [<br>            <span class="hljs-string">&quot;QQPX-R-3956-#aD8&quot;</span>,<br>            <span class="hljs-string">&quot;JODL-X-1937-#pV7&quot;</span><br>          ]<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;explain&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;price&quot;</span>: 30<br>    &#125;<br>  &#125;<br>&#125;<br><br><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;explain&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;date&quot;</span>: <span class="hljs-string">&quot;2019-01-01&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;explain&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;date&quot;</span>: <span class="hljs-string">&quot;2019-01-01&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;explain&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;constant_score&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;productID.keyword&quot;</span>: <span class="hljs-string">&quot;XHDK-A-1293-#fJ3&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;explain&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;productID.keyword&quot;</span>: <span class="hljs-string">&quot;XHDK-A-1293-#fJ3&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">#å¯¹å¸ƒå°”æ•°å€¼</span><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;constant_score&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;avaliable&quot;</span>: <span class="hljs-string">&quot;false&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;avaliable&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;false&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;explain&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;price&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;20&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;explain&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;price&quot;</span>: <span class="hljs-string">&quot;20&quot;</span><br>    &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br>POST products/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;constant_score&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;must_not&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;exists&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;date&quot;</span><br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><h1 id="4-3-æœç´¢çš„ç›¸å…³æ€§ç®—åˆ†-md"><a href="#4-3-æœç´¢çš„ç›¸å…³æ€§ç®—åˆ†-md" class="headerlink" title="4.3-æœç´¢çš„ç›¸å…³æ€§ç®—åˆ†.md"></a>4.3-æœç´¢çš„ç›¸å…³æ€§ç®—åˆ†.md</h1><h1 id="æœç´¢çš„ç›¸å…³æ€§ç®—åˆ†"><a href="#æœç´¢çš„ç›¸å…³æ€§ç®—åˆ†" class="headerlink" title="æœç´¢çš„ç›¸å…³æ€§ç®—åˆ†"></a>æœç´¢çš„ç›¸å…³æ€§ç®—åˆ†</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs css"><br><br>PUT testscore<br>&#123;<br>  &quot;settings&quot;: &#123;<br>    &quot;number_of_shards&quot;: <span class="hljs-number">1</span><br>  &#125;,<br>  &quot;mappings&quot;: &#123;<br>    &quot;properties&quot;: &#123;<br>      &quot;<span class="hljs-attribute">content</span>&quot;: &#123;<br>        &quot;type&quot;: <span class="hljs-string">&quot;text&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br>PUT testscore/_bulk<br>&#123; &quot;index&quot;: &#123; &quot;_id&quot;: <span class="hljs-number">1</span> &#125;&#125;<br>&#123; &quot;<span class="hljs-attribute">content</span>&quot;:<span class="hljs-string">&quot;we use Elasticsearch to power the search&quot;</span> &#125;<br>&#123; &quot;index&quot;: &#123; &quot;_id&quot;: <span class="hljs-number">2</span> &#125;&#125;<br>&#123; &quot;<span class="hljs-attribute">content</span>&quot;:<span class="hljs-string">&quot;we like elasticsearch&quot;</span> &#125;<br>&#123; &quot;index&quot;: &#123; &quot;_id&quot;: <span class="hljs-number">3</span> &#125;&#125;<br>&#123; &quot;<span class="hljs-attribute">content</span>&quot;:<span class="hljs-string">&quot;The scoring of documents is caculated by the scoring formula&quot;</span> &#125;<br>&#123; &quot;index&quot;: &#123; &quot;_id&quot;: <span class="hljs-number">4</span> &#125;&#125;<br>&#123; &quot;<span class="hljs-attribute">content</span>&quot;:<span class="hljs-string">&quot;you know, for search&quot;</span> &#125;<br><br><br><br>POST /testscore/_search<br>&#123;<br>  //&quot;explain&quot;: true,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    &quot;match&quot;: &#123;<br>      &quot;<span class="hljs-attribute">content</span>&quot;:<span class="hljs-string">&quot;you&quot;</span><br>      //<span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;elasticsearch&quot;</span><br>      //<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;the&quot;</span><br>      //<span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;the elasticsearch&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br>POST testscore/_search<br>&#123;<br>    &quot;query&quot;: &#123;<br>        &quot;boosting&quot; : &#123;<br>            &quot;positive&quot; : &#123;<br>                &quot;term&quot; : &#123;<br>                    &quot;<span class="hljs-attribute">content</span>&quot; : <span class="hljs-string">&quot;elasticsearch&quot;</span><br>                &#125;<br>            &#125;,<br>            &quot;negative&quot; : &#123;<br>                 &quot;term&quot; : &#123;<br>                     &quot;<span class="hljs-attribute">content</span>&quot; : <span class="hljs-string">&quot;like&quot;</span><br>                &#125;<br>            &#125;,<br>            &quot;negative_boost&quot; : <span class="hljs-number">0.2</span><br>        &#125;<br>    &#125;<br>&#125;<br><br><br>POST tmdb/_search<br>&#123;<br>  &quot;_source&quot;: [<span class="hljs-string">&quot;title&quot;</span>,<span class="hljs-string">&quot;overview&quot;</span>],<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    &quot;more_like_this&quot;: &#123;<br>      &quot;fields&quot;: [<br>        <span class="hljs-string">&quot;title^10&quot;</span>,<span class="hljs-string">&quot;overview&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;like&quot;</span>: [&#123;&quot;_id&quot;:<span class="hljs-string">&quot;14191&quot;</span>&#125;],<br>      &quot;min_term_freq&quot;: <span class="hljs-number">1</span>,<br>      <span class="hljs-string">&quot;max_query_terms&quot;</span>: <span class="hljs-number">12</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br></code></pre></td></tr></table></figure><h1 id="4-4-Query-Filteringå®ç°å¤šå­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢-md"><a href="#4-4-Query-Filteringå®ç°å¤šå­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢-md" class="headerlink" title="4.4-Query&amp;Filteringå®ç°å¤šå­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢.md"></a>4.4-Query&amp;Filteringå®ç°å¤šå­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢.md</h1><h1 id="Query-Filtering-ä¸å¤šå­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢"><a href="#Query-Filtering-ä¸å¤šå­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢" class="headerlink" title="Query &amp; Filtering ä¸å¤šå­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢"></a>Query &amp; Filtering ä¸å¤šå­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST /products/_bulk<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 1 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;price&quot;</span> : 10,<span class="hljs-string">&quot;avaliable&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;date&quot;</span>:<span class="hljs-string">&quot;2018-01-01&quot;</span>, <span class="hljs-string">&quot;productID&quot;</span> : <span class="hljs-string">&quot;XHDK-A-1293-#fJ3&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 2 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;price&quot;</span> : 20,<span class="hljs-string">&quot;avaliable&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;date&quot;</span>:<span class="hljs-string">&quot;2019-01-01&quot;</span>, <span class="hljs-string">&quot;productID&quot;</span> : <span class="hljs-string">&quot;KDKE-B-9947-#kL5&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 3 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;price&quot;</span> : 30,<span class="hljs-string">&quot;avaliable&quot;</span>:<span class="hljs-literal">true</span>, <span class="hljs-string">&quot;productID&quot;</span> : <span class="hljs-string">&quot;JODL-X-1937-#pV7&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 4 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;price&quot;</span> : 30,<span class="hljs-string">&quot;avaliable&quot;</span>:<span class="hljs-literal">false</span>, <span class="hljs-string">&quot;productID&quot;</span> : <span class="hljs-string">&quot;QQPX-R-3956-#aD8&quot;</span> &#125;<br><br><br><br><span class="hljs-comment">#åŸºæœ¬è¯­æ³•</span><br>POST /products/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span> : &#123;<br>      <span class="hljs-string">&quot;must&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;term&quot;</span> : &#123; <span class="hljs-string">&quot;price&quot;</span> : <span class="hljs-string">&quot;30&quot;</span> &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;term&quot;</span> : &#123; <span class="hljs-string">&quot;avaliable&quot;</span> : <span class="hljs-string">&quot;true&quot;</span> &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;must_not&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;range&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;price&quot;</span> : &#123; <span class="hljs-string">&quot;lte&quot;</span> : 10 &#125;<br>        &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;should&quot;</span> : [<br>        &#123; <span class="hljs-string">&quot;term&quot;</span> : &#123; <span class="hljs-string">&quot;productID.keyword&quot;</span> : <span class="hljs-string">&quot;JODL-X-1937-#pV7&quot;</span> &#125; &#125;,<br>        &#123; <span class="hljs-string">&quot;term&quot;</span> : &#123; <span class="hljs-string">&quot;productID.keyword&quot;</span> : <span class="hljs-string">&quot;XHDK-A-1293-#fJ3&quot;</span> &#125; &#125;<br>      ],<br>      <span class="hljs-string">&quot;minimum_should_match&quot;</span> :1<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">#æ”¹å˜æ•°æ®æ¨¡å‹ï¼Œå¢åŠ å­—æ®µã€‚è§£å†³æ•°ç»„åŒ…å«è€Œä¸æ˜¯ç²¾ç¡®åŒ¹é…çš„é—®é¢˜</span><br>POST /newmovies/_bulk<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 1 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;title&quot;</span> : <span class="hljs-string">&quot;Father of the Bridge Part II&quot;</span>,<span class="hljs-string">&quot;year&quot;</span>:1995, <span class="hljs-string">&quot;genre&quot;</span>:<span class="hljs-string">&quot;Comedy&quot;</span>,<span class="hljs-string">&quot;genre_count&quot;</span>:1 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 2 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;title&quot;</span> : <span class="hljs-string">&quot;Dave&quot;</span>,<span class="hljs-string">&quot;year&quot;</span>:1993,<span class="hljs-string">&quot;genre&quot;</span>:[<span class="hljs-string">&quot;Comedy&quot;</span>,<span class="hljs-string">&quot;Romance&quot;</span>],<span class="hljs-string">&quot;genre_count&quot;</span>:2 &#125;<br><br><span class="hljs-comment">#mustï¼Œæœ‰ç®—åˆ†</span><br>POST /newmovies/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [<br>        &#123;<span class="hljs-string">&quot;term&quot;</span>: &#123;<span class="hljs-string">&quot;genre.keyword&quot;</span>: &#123;<span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;Comedy&quot;</span>&#125;&#125;&#125;,<br>        &#123;<span class="hljs-string">&quot;term&quot;</span>: &#123;<span class="hljs-string">&quot;genre_count&quot;</span>: &#123;<span class="hljs-string">&quot;value&quot;</span>: 1&#125;&#125;&#125;<br><br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">#Filterã€‚ä¸å‚ä¸ç®—åˆ†ï¼Œç»“æœçš„scoreæ˜¯0</span><br>POST /newmovies/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;filter&quot;</span>: [<br>        &#123;<span class="hljs-string">&quot;term&quot;</span>: &#123;<span class="hljs-string">&quot;genre.keyword&quot;</span>: &#123;<span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;Comedy&quot;</span>&#125;&#125;&#125;,<br>        &#123;<span class="hljs-string">&quot;term&quot;</span>: &#123;<span class="hljs-string">&quot;genre_count&quot;</span>: &#123;<span class="hljs-string">&quot;value&quot;</span>: 1&#125;&#125;&#125;<br>        ]<br><br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#Filtering Context</span><br>POST _search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span> : &#123;<br><br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;term&quot;</span> : &#123; <span class="hljs-string">&quot;avaliable&quot;</span> : <span class="hljs-string">&quot;true&quot;</span> &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;must_not&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;range&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;price&quot;</span> : &#123; <span class="hljs-string">&quot;lte&quot;</span> : 10 &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#Query Context</span><br>POST /products/_bulk<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 1 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;price&quot;</span> : 10,<span class="hljs-string">&quot;avaliable&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;date&quot;</span>:<span class="hljs-string">&quot;2018-01-01&quot;</span>, <span class="hljs-string">&quot;productID&quot;</span> : <span class="hljs-string">&quot;XHDK-A-1293-#fJ3&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 2 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;price&quot;</span> : 20,<span class="hljs-string">&quot;avaliable&quot;</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">&quot;date&quot;</span>:<span class="hljs-string">&quot;2019-01-01&quot;</span>, <span class="hljs-string">&quot;productID&quot;</span> : <span class="hljs-string">&quot;KDKE-B-9947-#kL5&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 3 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;price&quot;</span> : 30,<span class="hljs-string">&quot;avaliable&quot;</span>:<span class="hljs-literal">true</span>, <span class="hljs-string">&quot;productID&quot;</span> : <span class="hljs-string">&quot;JODL-X-1937-#pV7&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 4 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;price&quot;</span> : 30,<span class="hljs-string">&quot;avaliable&quot;</span>:<span class="hljs-literal">false</span>, <span class="hljs-string">&quot;productID&quot;</span> : <span class="hljs-string">&quot;QQPX-R-3956-#aD8&quot;</span> &#125;<br><br><br>POST /products/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;should&quot;</span>: [<br>        &#123;<br>          <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;productID.keyword&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;JODL-X-1937-#pV7&quot;</span>&#125;&#125;<br>        &#125;,<br>        &#123;<span class="hljs-string">&quot;term&quot;</span>: &#123;<span class="hljs-string">&quot;avaliable&quot;</span>: &#123;<span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-literal">true</span>&#125;&#125;<br>        &#125;<br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#åµŒå¥—ï¼Œå®ç°äº† should not é€»è¾‘</span><br>POST /products/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;price&quot;</span>: <span class="hljs-string">&quot;30&quot;</span><br>        &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;should&quot;</span>: [<br>        &#123;<br>          <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;must_not&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;avaliable&quot;</span>: <span class="hljs-string">&quot;false&quot;</span><br>              &#125;<br>            &#125;<br>          &#125;<br>        &#125;<br>      ],<br>      <span class="hljs-string">&quot;minimum_should_match&quot;</span>: 1<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#Controll the Precision</span><br>POST _search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span> : &#123;<br>      <span class="hljs-string">&quot;must&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;term&quot;</span> : &#123; <span class="hljs-string">&quot;price&quot;</span> : <span class="hljs-string">&quot;30&quot;</span> &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;term&quot;</span> : &#123; <span class="hljs-string">&quot;avaliable&quot;</span> : <span class="hljs-string">&quot;true&quot;</span> &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;must_not&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;range&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;price&quot;</span> : &#123; <span class="hljs-string">&quot;lte&quot;</span> : 10 &#125;<br>        &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;should&quot;</span> : [<br>        &#123; <span class="hljs-string">&quot;term&quot;</span> : &#123; <span class="hljs-string">&quot;productID.keyword&quot;</span> : <span class="hljs-string">&quot;JODL-X-1937-#pV7&quot;</span> &#125; &#125;,<br>        &#123; <span class="hljs-string">&quot;term&quot;</span> : &#123; <span class="hljs-string">&quot;productID.keyword&quot;</span> : <span class="hljs-string">&quot;XHDK-A-1293-#fJ3&quot;</span> &#125; &#125;<br>      ],<br>      <span class="hljs-string">&quot;minimum_should_match&quot;</span> :2<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br>POST /animals/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;should&quot;</span>: [<br>        &#123; <span class="hljs-string">&quot;term&quot;</span>: &#123; <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;brown&quot;</span> &#125;&#125;,<br>        &#123; <span class="hljs-string">&quot;term&quot;</span>: &#123; <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;red&quot;</span> &#125;&#125;,<br>        &#123; <span class="hljs-string">&quot;term&quot;</span>: &#123; <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;quick&quot;</span>   &#125;&#125;,<br>        &#123; <span class="hljs-string">&quot;term&quot;</span>: &#123; <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;dog&quot;</span>   &#125;&#125;<br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST /animals/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;should&quot;</span>: [<br>        &#123; <span class="hljs-string">&quot;term&quot;</span>: &#123; <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;quick&quot;</span> &#125;&#125;,<br>        &#123; <span class="hljs-string">&quot;term&quot;</span>: &#123; <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;dog&quot;</span>   &#125;&#125;,<br>        &#123;<br>          <span class="hljs-string">&quot;bool&quot;</span>:&#123;<br>            <span class="hljs-string">&quot;should&quot;</span>:[<br>               &#123; <span class="hljs-string">&quot;term&quot;</span>: &#123; <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;brown&quot;</span> &#125;&#125;,<br>                 &#123; <span class="hljs-string">&quot;term&quot;</span>: &#123; <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;brown&quot;</span> &#125;&#125;,<br>            ]<br>          &#125;<br><br>        &#125;<br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br><br><br>DELETE blogs<br>POST /blogs/_bulk<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 1 &#125;&#125;<br>&#123;<span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;Apple iPad&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;Apple iPad,Apple iPad&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 2 &#125;&#125;<br>&#123;<span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;Apple iPad,Apple iPad&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;Apple iPad&quot;</span> &#125;<br><br><br>POST blogs/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;should&quot;</span>: [<br>        &#123;<span class="hljs-string">&quot;match&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;title&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;apple,ipad&quot;</span>,<br>            <span class="hljs-string">&quot;boost&quot;</span>: 1.1<br>          &#125;<br>        &#125;&#125;,<br><br>        &#123;<span class="hljs-string">&quot;match&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;content&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;apple,ipad&quot;</span>,<br>            <span class="hljs-string">&quot;boost&quot;</span>:<br>          &#125;<br>        &#125;&#125;<br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br><br>DELETE news<br>POST /news/_bulk<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 1 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;Apple Mac&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 2 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;Apple iPad&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 3 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;Apple employee like Apple Pie and Apple Juice&quot;</span> &#125;<br><br><br>POST news/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;match&quot;</span>:&#123;<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;apple&quot;</span>&#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST news/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;match&quot;</span>:&#123;<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;apple&quot;</span>&#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;must_not&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;match&quot;</span>:&#123;<span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;pie&quot;</span>&#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST news/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;boosting&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;positive&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;apple&quot;</span><br>        &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;negative&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;pie&quot;</span><br>        &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;negative_boost&quot;</span>: 0.5<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="4-5-å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢-DisMaxQuery-md"><a href="#4-5-å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢-DisMaxQuery-md" class="headerlink" title="4.5-å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢-DisMaxQuery.md"></a>4.5-å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢-DisMaxQuery.md</h1><h1 id="å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢ï¼šDis-Max-Query"><a href="#å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢ï¼šDis-Max-Query" class="headerlink" title="å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢ï¼šDis Max Query"></a>å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢ï¼šDis Max Query</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>PUT /blogs/_doc/1<br>&#123;<br>    <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;Quick brown rabbits&quot;</span>,<br>    <span class="hljs-string">&quot;body&quot;</span>:  <span class="hljs-string">&quot;Brown rabbits are commonly seen.&quot;</span><br>&#125;<br><br>PUT /blogs/_doc/2<br>&#123;<br>    <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;Keeping pets healthy&quot;</span>,<br>    <span class="hljs-string">&quot;body&quot;</span>:  <span class="hljs-string">&quot;My quick brown fox eats rabbits on a regular basis.&quot;</span><br>&#125;<br><br>POST /blogs/_search<br>&#123;<br>    <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;should&quot;</span>: [<br>                &#123; <span class="hljs-string">&quot;match&quot;</span>: &#123; <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;Brown fox&quot;</span> &#125;&#125;,<br>                &#123; <span class="hljs-string">&quot;match&quot;</span>: &#123; <span class="hljs-string">&quot;body&quot;</span>:  <span class="hljs-string">&quot;Brown fox&quot;</span> &#125;&#125;<br>            ]<br>        &#125;<br>    &#125;<br>&#125;<br><br>POST blogs/_search<br>&#123;<br>    <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;dis_max&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;queries&quot;</span>: [<br>                &#123; <span class="hljs-string">&quot;match&quot;</span>: &#123; <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;Quick pets&quot;</span> &#125;&#125;,<br>                &#123; <span class="hljs-string">&quot;match&quot;</span>: &#123; <span class="hljs-string">&quot;body&quot;</span>:  <span class="hljs-string">&quot;Quick pets&quot;</span> &#125;&#125;<br>            ]<br>        &#125;<br>    &#125;<br>&#125;<br><br><br>POST blogs/_search<br>&#123;<br>    <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;dis_max&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;queries&quot;</span>: [<br>                &#123; <span class="hljs-string">&quot;match&quot;</span>: &#123; <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;Quick pets&quot;</span> &#125;&#125;,<br>                &#123; <span class="hljs-string">&quot;match&quot;</span>: &#123; <span class="hljs-string">&quot;body&quot;</span>:  <span class="hljs-string">&quot;Quick pets&quot;</span> &#125;&#125;<br>            ],<br>            <span class="hljs-string">&quot;tie_breaker&quot;</span>: 0.2<br>        &#125;<br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><h1 id="4-6-å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢-Multi-Match-md"><a href="#4-6-å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢-Multi-Match-md" class="headerlink" title="4.6-å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢-Multi-Match.md"></a>4.6-å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢-Multi-Match.md</h1><h1 id="å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢ï¼šMulti-Match"><a href="#å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢ï¼šMulti-Match" class="headerlink" title="å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢ï¼šMulti Match"></a>å•å­—ç¬¦ä¸²å¤šå­—æ®µæŸ¥è¯¢ï¼šMulti Match</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST blogs/_search<br>&#123;<br>    <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;dis_max&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;queries&quot;</span>: [<br>                &#123; <span class="hljs-string">&quot;match&quot;</span>: &#123; <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;Quick pets&quot;</span> &#125;&#125;,<br>                &#123; <span class="hljs-string">&quot;match&quot;</span>: &#123; <span class="hljs-string">&quot;body&quot;</span>:  <span class="hljs-string">&quot;Quick pets&quot;</span> &#125;&#125;<br>            ],<br>            <span class="hljs-string">&quot;tie_breaker&quot;</span>: 0.2<br>        &#125;<br>    &#125;<br>&#125;<br><br>POST blogs/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;multi_match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;best_fields&quot;</span>,<br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;Quick pets&quot;</span>,<br>      <span class="hljs-string">&quot;fields&quot;</span>: [<span class="hljs-string">&quot;title&quot;</span>,<span class="hljs-string">&quot;body&quot;</span>],<br>      <span class="hljs-string">&quot;tie_breaker&quot;</span>: 0.2,<br>      <span class="hljs-string">&quot;minimum_should_match&quot;</span>: <span class="hljs-string">&quot;20%&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br>POST books/_search<br>&#123;<br>    <span class="hljs-string">&quot;multi_match&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;query&quot;</span>:  <span class="hljs-string">&quot;Quick brown fox&quot;</span>,<br>        <span class="hljs-string">&quot;fields&quot;</span>: <span class="hljs-string">&quot;*_title&quot;</span><br>    &#125;<br>&#125;<br><br><br>POST books/_search<br>&#123;<br>    <span class="hljs-string">&quot;multi_match&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;query&quot;</span>:  <span class="hljs-string">&quot;Quick brown fox&quot;</span>,<br>        <span class="hljs-string">&quot;fields&quot;</span>: [ <span class="hljs-string">&quot;*_title&quot;</span>, <span class="hljs-string">&quot;chapter_title^2&quot;</span> ]<br>    &#125;<br>&#125;<br><br><br><br>DELETE /titles<br>PUT /titles<br>&#123;<br>    <span class="hljs-string">&quot;settings&quot;</span>: &#123; <span class="hljs-string">&quot;number_of_shards&quot;</span>: 1 &#125;,<br>    <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;my_type&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;title&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;type&quot;</span>:     <span class="hljs-string">&quot;string&quot;</span>,<br>                    <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;english&quot;</span>,<br>                    <span class="hljs-string">&quot;fields&quot;</span>: &#123;<br>                        <span class="hljs-string">&quot;std&quot;</span>:   &#123;<br>                            <span class="hljs-string">&quot;type&quot;</span>:     <span class="hljs-string">&quot;string&quot;</span>,<br>                            <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;standard&quot;</span><br>                        &#125;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br>PUT /titles<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>        <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;english&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST titles/_bulk<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 1 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;My dog barks&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 2 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;I see a lot of barking dogs on the road &quot;</span> &#125;<br><br><br>GET titles/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;barking dogs&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br>DELETE /titles<br>PUT /titles<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>        <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;english&quot;</span>,<br>        <span class="hljs-string">&quot;fields&quot;</span>: &#123;<span class="hljs-string">&quot;std&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;standard&quot;</span>&#125;&#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST titles/_bulk<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 1 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;My dog barks&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span>: &#123; <span class="hljs-string">&quot;_id&quot;</span>: 2 &#125;&#125;<br>&#123; <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;I see a lot of barking dogs on the road &quot;</span> &#125;<br><br>GET /titles/_search<br>&#123;<br>   <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;multi_match&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;query&quot;</span>:  <span class="hljs-string">&quot;barking dogs&quot;</span>,<br>            <span class="hljs-string">&quot;type&quot;</span>:   <span class="hljs-string">&quot;most_fields&quot;</span>,<br>            <span class="hljs-string">&quot;fields&quot;</span>: [ <span class="hljs-string">&quot;title&quot;</span>, <span class="hljs-string">&quot;title.std&quot;</span> ]<br>        &#125;<br>    &#125;<br>&#125;<br><br>GET /titles/_search<br>&#123;<br>   <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;multi_match&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;query&quot;</span>:  <span class="hljs-string">&quot;barking dogs&quot;</span>,<br>            <span class="hljs-string">&quot;type&quot;</span>:   <span class="hljs-string">&quot;most_fields&quot;</span>,<br>            <span class="hljs-string">&quot;fields&quot;</span>: [ <span class="hljs-string">&quot;title^10&quot;</span>, <span class="hljs-string">&quot;title.std&quot;</span> ]<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="4-7-å¤šè¯­è¨€åŠä¸­æ–‡åˆ†è¯ä¸æ£€ç´¢-md"><a href="#4-7-å¤šè¯­è¨€åŠä¸­æ–‡åˆ†è¯ä¸æ£€ç´¢-md" class="headerlink" title="4.7-å¤šè¯­è¨€åŠä¸­æ–‡åˆ†è¯ä¸æ£€ç´¢.md"></a>4.7-å¤šè¯­è¨€åŠä¸­æ–‡åˆ†è¯ä¸æ£€ç´¢.md</h1><h1 id="å¤šè¯­è¨€åŠä¸­æ–‡åˆ†è¯ä¸æ£€ç´¢"><a href="#å¤šè¯­è¨€åŠä¸­æ–‡åˆ†è¯ä¸æ£€ç´¢" class="headerlink" title="å¤šè¯­è¨€åŠä¸­æ–‡åˆ†è¯ä¸æ£€ç´¢"></a>å¤šè¯­è¨€åŠä¸­æ–‡åˆ†è¯ä¸æ£€ç´¢</h1><ul><li><p>æ¥åˆ°æ¨è¿‡æ›¾ç»ç”Ÿæ´»è¿‡çš„åœ°æ–¹ï¼Œå°é¾™å¥³åŠ¨æƒ…åœ°è¯´ï¼šâ€œæˆ‘ä¹Ÿæƒ³è¿‡è¿‡è¿‡å„¿è¿‡è¿‡çš„ç”Ÿæ´»ã€‚â€</p></li><li><p>ä½ ä¹Ÿæƒ³çŠ¯èŒƒèŒƒç®çªçŠ¯è¿‡çš„é”™å—</p></li><li><p>æ ¡é•¿è¯´è¡£æœä¸Šé™¤äº†æ ¡å¾½åˆ«åˆ«åˆ«çš„</p></li><li><p>è¿™å‡ å¤©å¤©å¤©å¤©æ°”ä¸å¥½</p></li><li><p>æˆ‘èƒŒæœ‰ç‚¹é©¼ï¼Œéº»éº»è¯´â€œä½ çš„èƒŒå¾—èƒŒèƒŒèƒŒèƒŒä½³</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#stop word</span><br><br>DELETE my_index<br>PUT /my_index/_doc/1<br>&#123; <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;I&#x27;m happy for this fox&quot;</span> &#125;<br><br>PUT /my_index/_doc/2<br>&#123; <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;I&#x27;m not happy about my fox problem&quot;</span> &#125;<br><br><br>POST my_index/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;not happy fox&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#è™½ç„¶é€šè¿‡ä½¿ç”¨ english ï¼ˆè‹±è¯­ï¼‰åˆ†æå™¨ï¼Œä½¿å¾—åŒ¹é…è§„åˆ™æ›´åŠ å®½æ¾ï¼Œæˆ‘ä»¬ä¹Ÿå› æ­¤æé«˜äº†å¬å›ç‡ï¼Œä½†å´é™ä½äº†ç²¾å‡†åŒ¹é…æ–‡æ¡£çš„èƒ½åŠ›ã€‚ä¸ºäº†è·å¾—ä¸¤æ–¹é¢çš„ä¼˜åŠ¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨multifieldsï¼ˆå¤šå­—æ®µï¼‰å¯¹ title å­—æ®µå»ºç«‹ä¸¤æ¬¡ç´¢å¼•ï¼š ä¸€æ¬¡ä½¿ç”¨ `english`ï¼ˆè‹±è¯­ï¼‰åˆ†æå™¨ï¼Œå¦ä¸€æ¬¡ä½¿ç”¨ `standard`ï¼ˆæ ‡å‡†ï¼‰åˆ†æå™¨:</span><br><br>DELETE my_index<br><br>PUT /my_index<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;blog&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;title&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,<br>          <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;english&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>PUT /my_index<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;blog&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;title&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,<br>          <span class="hljs-string">&quot;fields&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;english&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;type&quot;</span>:     <span class="hljs-string">&quot;string&quot;</span>,<br>              <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;english&quot;</span><br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br>PUT /my_index/blog/1<br>&#123; <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;I&#x27;m happy for this fox&quot;</span> &#125;<br><br>PUT /my_index/blog/2<br>&#123; <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;I&#x27;m not happy about my fox problem&quot;</span> &#125;<br><br>GET /_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;multi_match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;type&quot;</span>:     <span class="hljs-string">&quot;most_fields&quot;</span>,<br>      <span class="hljs-string">&quot;query&quot;</span>:    <span class="hljs-string">&quot;not happy foxes&quot;</span>,<br>      <span class="hljs-string">&quot;fields&quot;</span>: [ <span class="hljs-string">&quot;title&quot;</span>, <span class="hljs-string">&quot;title.english&quot;</span> ]<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#å®‰è£…æ’ä»¶</span><br>./elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.1.0/elasticsearch-analysis-ik-7.1.0.zip<br><span class="hljs-comment">#å®‰è£…æ’ä»¶</span><br>bin/elasticsearch install https://github.com/KennFalcon/elasticsearch-analysis-hanlp/releases/download/v7.1.0/elasticsearch-analysis-hanlp-7.1.0.zip<br><br><br><br><br><span class="hljs-comment">#ik_max_word</span><br><span class="hljs-comment">#ik_smart</span><br><span class="hljs-comment">#hanlp: hanlpé»˜è®¤åˆ†è¯</span><br><span class="hljs-comment">#hanlp_standard: æ ‡å‡†åˆ†è¯</span><br><span class="hljs-comment">#hanlp_index: ç´¢å¼•åˆ†è¯</span><br><span class="hljs-comment">#hanlp_nlp: NLPåˆ†è¯</span><br><span class="hljs-comment">#hanlp_n_short: N-æœ€çŸ­è·¯åˆ†è¯</span><br><span class="hljs-comment">#hanlp_dijkstra: æœ€çŸ­è·¯åˆ†è¯</span><br><span class="hljs-comment">#hanlp_crf: CRFåˆ†è¯ï¼ˆåœ¨hanlp 1.6.6å·²å¼€å§‹åºŸå¼ƒï¼‰</span><br><span class="hljs-comment">#hanlp_speed: æé€Ÿè¯å…¸åˆ†è¯</span><br><br>POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;hanlp_standard&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: [<span class="hljs-string">&quot;å‰‘æ¡¥åˆ†æå…¬å¸å¤šä½é«˜ç®¡å¯¹å§åº•è®°è€…è¯´ï¼Œä»–ä»¬ç¡®ä¿äº†å”çº³å¾·Â·ç‰¹æœ—æ™®åœ¨æ€»ç»Ÿå¤§é€‰ä¸­è·èƒœ&quot;</span>]<br><br>&#125;     <br><br><span class="hljs-comment">#Pinyin</span><br>PUT /artists/<br>&#123;<br>    <span class="hljs-string">&quot;settings&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;analysis&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;analyzer&quot;</span> : &#123;<br>                <span class="hljs-string">&quot;user_name_analyzer&quot;</span> : &#123;<br>                    <span class="hljs-string">&quot;tokenizer&quot;</span> : <span class="hljs-string">&quot;whitespace&quot;</span>,<br>                    <span class="hljs-string">&quot;filter&quot;</span> : <span class="hljs-string">&quot;pinyin_first_letter_and_full_pinyin_filter&quot;</span><br>                &#125;<br>            &#125;,<br>            <span class="hljs-string">&quot;filter&quot;</span> : &#123;<br>                <span class="hljs-string">&quot;pinyin_first_letter_and_full_pinyin_filter&quot;</span> : &#123;<br>                    <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;pinyin&quot;</span>,<br>                    <span class="hljs-string">&quot;keep_first_letter&quot;</span> : <span class="hljs-literal">true</span>,<br>                    <span class="hljs-string">&quot;keep_full_pinyin&quot;</span> : <span class="hljs-literal">false</span>,<br>                    <span class="hljs-string">&quot;keep_none_chinese&quot;</span> : <span class="hljs-literal">true</span>,<br>                    <span class="hljs-string">&quot;keep_original&quot;</span> : <span class="hljs-literal">false</span>,<br>                    <span class="hljs-string">&quot;limit_first_letter_length&quot;</span> : 16,<br>                    <span class="hljs-string">&quot;lowercase&quot;</span> : <span class="hljs-literal">true</span>,<br>                    <span class="hljs-string">&quot;trim_whitespace&quot;</span> : <span class="hljs-literal">true</span>,<br>                    <span class="hljs-string">&quot;keep_none_chinese_in_first_letter&quot;</span> : <span class="hljs-literal">true</span><br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><br>GET /artists/_analyze<br>&#123;<br>  <span class="hljs-string">&quot;text&quot;</span>: [<span class="hljs-string">&quot;åˆ˜å¾·å å¼ å­¦å‹ éƒ­å¯ŒåŸ é»æ˜ å››å¤§å¤©ç‹&quot;</span>],<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;user_name_analyzer&quot;</span><br>&#125;<br><br><br></code></pre></td></tr></table></figure><h2 id="ç›¸å…³èµ„æº"><a href="#ç›¸å…³èµ„æº" class="headerlink" title="ç›¸å…³èµ„æº"></a>ç›¸å…³èµ„æº</h2><ul><li><p>Elasticsearch IKåˆ†è¯æ’ä»¶ <a href="https://github.com/medcl/elasticsearch-analysis-ik/releases">https://github.com/medcl/elasticsearch-analysis-ik/releases</a></p></li><li><p>Elasticsearch hanlp åˆ†è¯æ’ä»¶ <a href="https://github.com/KennFalcon/elasticsearch-analysis-hanlp">https://github.com/KennFalcon/elasticsearch-analysis-hanlp</a></p></li><li><p>åˆ†è¯ç®—æ³•ç»¼è¿° <a href="https://zhuanlan.zhihu.com/p/50444885">https://zhuanlan.zhihu.com/p/50444885</a></p></li></ul><h3 id="ä¸€äº›åˆ†è¯å·¥å…·ï¼Œä¾›å‚è€ƒï¼š"><a href="#ä¸€äº›åˆ†è¯å·¥å…·ï¼Œä¾›å‚è€ƒï¼š" class="headerlink" title="ä¸€äº›åˆ†è¯å·¥å…·ï¼Œä¾›å‚è€ƒï¼š"></a>ä¸€äº›åˆ†è¯å·¥å…·ï¼Œä¾›å‚è€ƒï¼š</h3><ul><li>ä¸­ç§‘é™¢è®¡ç®—æ‰€NLPIR <a href="http://ictclas.nlpir.org/nlpir/">http://ictclas.nlpir.org/nlpir/</a></li><li>ansjåˆ†è¯å™¨ <a href="https://github.com/NLPchina/ansj_seg">https://github.com/NLPchina/ansj_seg</a></li><li>å“ˆå·¥å¤§çš„LTP <a href="https://github.com/HIT-SCIR/ltp">https://github.com/HIT-SCIR/ltp</a></li><li>æ¸…åå¤§å­¦THULAC <a href="https://github.com/thunlp/THULAC">https://github.com/thunlp/THULAC</a></li><li>æ–¯å¦ç¦åˆ†è¯å™¨ <a href="https://nlp.stanford.edu/software/segmenter.shtml">https://nlp.stanford.edu/software/segmenter.shtml</a></li><li>Hanlpåˆ†è¯å™¨ <a href="https://github.com/hankcs/HanLP">https://github.com/hankcs/HanLP</a></li><li>ç»“å·´åˆ†è¯ <a href="https://github.com/yanyiwu/cppjieba">https://github.com/yanyiwu/cppjieba</a></li><li>KCWSåˆ†è¯å™¨(å­—åµŒå…¥+Bi-LSTM+CRF) <a href="https://github.com/koth/kcws">https://github.com/koth/kcws</a></li><li>ZPar <a href="https://github.com/frcchang/zpar/releases">https://github.com/frcchang/zpar/releases</a></li><li>IKAnalyzer <a href="https://github.com/wks/ik-analyzer">https://github.com/wks/ik-analyzer</a></li></ul><h1 id="4-8-SpaceJamä¸€ä¸ªå…¨æ–‡æœç´¢çš„å®ä¾‹-md"><a href="#4-8-SpaceJamä¸€ä¸ªå…¨æ–‡æœç´¢çš„å®ä¾‹-md" class="headerlink" title="4.8-SpaceJamä¸€ä¸ªå…¨æ–‡æœç´¢çš„å®ä¾‹.md"></a>4.8-SpaceJamä¸€ä¸ªå…¨æ–‡æœç´¢çš„å®ä¾‹.md</h1><h1 id="Space-Jamï¼Œä¸€æ¬¡å…¨æ–‡æœç´¢çš„å®ä¾‹"><a href="#Space-Jamï¼Œä¸€æ¬¡å…¨æ–‡æœç´¢çš„å®ä¾‹" class="headerlink" title="Space Jamï¼Œä¸€æ¬¡å…¨æ–‡æœç´¢çš„å®ä¾‹"></a>Space Jamï¼Œä¸€æ¬¡å…¨æ–‡æœç´¢çš„å®ä¾‹</h1><h2 id="ç¯å¢ƒè¦æ±‚"><a href="#ç¯å¢ƒè¦æ±‚" class="headerlink" title="ç¯å¢ƒè¦æ±‚"></a>ç¯å¢ƒè¦æ±‚</h2><ul><li>Python 2.7.15</li><li>å¯ä»¥ä½¿ç”¨pyenvç®¡ç†å¤šä¸ªpythonç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰</li></ul><h2 id="è¿›å…¥-tmdb-searchç›®å½•"><a href="#è¿›å…¥-tmdb-searchç›®å½•" class="headerlink" title="è¿›å…¥ tmdb-searchç›®å½•"></a>è¿›å…¥ tmdb-searchç›®å½•</h2><p>Run<br>pip install -r requirements.txt<br>Run python .&#x2F;ingest_tmdb_from_file.py</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs prolog"><span class="hljs-symbol">POST</span> tmdb/<span class="hljs-symbol">_search</span><br>&#123;<br><span class="hljs-string">&quot;_source&quot;</span>: [<span class="hljs-string">&quot;title&quot;</span>,<span class="hljs-string">&quot;overview&quot;</span>],<br> <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>   <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br> &#125;<br>&#125;<br><br><span class="hljs-symbol">POST</span> tmdb/<span class="hljs-symbol">_search</span><br>&#123;<br>  <span class="hljs-string">&quot;_source&quot;</span>: [<span class="hljs-string">&quot;title&quot;</span>,<span class="hljs-string">&quot;overview&quot;</span>],<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;multi_match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;basketball with cartoon aliens&quot;</span>,<br>      <span class="hljs-string">&quot;fields&quot;</span>: [<span class="hljs-string">&quot;title&quot;</span>,<span class="hljs-string">&quot;overview&quot;</span>]<br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;highlight&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;fields&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;overview&quot;</span> : &#123; <span class="hljs-string">&quot;pre_tags&quot;</span> : [<span class="hljs-string">&quot;\\033[0;32;40m&quot;</span>], <span class="hljs-string">&quot;post_tags&quot;</span> : [<span class="hljs-string">&quot;\\033[0m&quot;</span>] &#125;,<br>            <span class="hljs-string">&quot;title&quot;</span> : &#123; <span class="hljs-string">&quot;pre_tags&quot;</span> : [<span class="hljs-string">&quot;\\033[0;32;40m&quot;</span>], <span class="hljs-string">&quot;post_tags&quot;</span> : [<span class="hljs-string">&quot;\\033[0m&quot;</span>] &#125;<br><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç›¸å…³"><a href="#ç›¸å…³" class="headerlink" title="ç›¸å…³"></a>ç›¸å…³</h2><ul><li>Windows å®‰è£… pyenv <a href="https://github.com/pyenv-win/pyenv-win">https://github.com/pyenv-win/pyenv-win</a></li><li>Mac å®‰è£…pyenv <a href="https://segmentfault.com/a/1190000017403221">https://segmentfault.com/a/1190000017403221</a></li><li>Linux å®‰è£… pyenv <a href="https://blog.csdn.net/GX_1_11_real/article/details/80237064">https://blog.csdn.net/GX_1_11_real/article/details/80237064</a></li><li>Python.org <a href="https://www.python.org/">https://www.python.org/</a></li></ul><h1 id="4-9-ä½¿ç”¨SearchTemplateå’ŒIndexAliasè¿›è¡ŒæŸ¥è¯¢-md"><a href="#4-9-ä½¿ç”¨SearchTemplateå’ŒIndexAliasè¿›è¡ŒæŸ¥è¯¢-md" class="headerlink" title="4.9-ä½¿ç”¨SearchTemplateå’ŒIndexAliasè¿›è¡ŒæŸ¥è¯¢.md"></a>4.9-ä½¿ç”¨SearchTemplateå’ŒIndexAliasè¿›è¡ŒæŸ¥è¯¢.md</h1><h1 id="ä½¿ç”¨-Search-Template-å’Œ-Index-Alias-æŸ¥è¯¢"><a href="#ä½¿ç”¨-Search-Template-å’Œ-Index-Alias-æŸ¥è¯¢" class="headerlink" title="ä½¿ç”¨ Search Template å’Œ Index Alias æŸ¥è¯¢"></a>ä½¿ç”¨ Search Template å’Œ Index Alias æŸ¥è¯¢</h1><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs sqf">POST <span class="hljs-variable">_scripts</span>/tmdb<br>&#123;<br>  <span class="hljs-string">&quot;script&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;lang&quot;</span>: <span class="hljs-string">&quot;mustache&quot;</span>,<br>    <span class="hljs-string">&quot;source&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;_source&quot;</span>: [<br>        <span class="hljs-string">&quot;title&quot;</span>,<span class="hljs-string">&quot;overview&quot;</span><br>      ],<br>      <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">20</span>,<br>      <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;multi_match&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;&#123;&#123;q&#125;&#125;&quot;</span>,<br>          <span class="hljs-string">&quot;fields&quot;</span>: [<span class="hljs-string">&quot;title&quot;</span>,<span class="hljs-string">&quot;overview&quot;</span>]<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br>DELETE <span class="hljs-variable">_scripts</span>/tmdb<br><br><span class="hljs-built_in">GET</span> <span class="hljs-variable">_scripts</span>/tmdb<br><br>POST tmdb/<span class="hljs-variable">_search</span>/template<br>&#123;<br>    <span class="hljs-string">&quot;id&quot;</span>:<span class="hljs-string">&quot;tmdb&quot;</span>,<br>    <span class="hljs-string">&quot;params&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;q&quot;</span>: <span class="hljs-string">&quot;basketball with cartoon aliens&quot;</span><br>    &#125;<br>&#125;<br><br><br>PUT movies-<span class="hljs-number">2019</span>/<span class="hljs-variable">_doc</span>/<span class="hljs-number">1</span><br>&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;the matrix&quot;</span>,<br>  <span class="hljs-string">&quot;rating&quot;</span>:<span class="hljs-number">5</span><br>&#125;<br><br>PUT movies-<span class="hljs-number">2019</span>/<span class="hljs-variable">_doc</span>/<span class="hljs-number">2</span><br>&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;Speed&quot;</span>,<br>  <span class="hljs-string">&quot;rating&quot;</span>:<span class="hljs-number">3</span><br>&#125;<br><br>POST <span class="hljs-variable">_aliases</span><br>&#123;<br>  <span class="hljs-string">&quot;actions&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;add&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-string">&quot;movies-2019&quot;</span>,<br>        <span class="hljs-string">&quot;alias&quot;</span>: <span class="hljs-string">&quot;movies-latest&quot;</span><br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br><br>POST movies-latest/<span class="hljs-variable">_search</span><br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br><br>POST <span class="hljs-variable">_aliases</span><br>&#123;<br>  <span class="hljs-string">&quot;actions&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;add&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-string">&quot;movies-2019&quot;</span>,<br>        <span class="hljs-string">&quot;alias&quot;</span>: <span class="hljs-string">&quot;movies-lastest-highrate&quot;</span>,<br>        <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;range&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;rating&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;gte&quot;</span>: <span class="hljs-number">4</span><br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br><br>POST movies-lastest-highrate/<span class="hljs-variable">_search</span><br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br><br><br><br></code></pre></td></tr></table></figure><h1 id="5-1-é›†ç¾¤åˆ†å¸ƒå¼æ¨¡å‹åŠé€‰ä¸»ä¸è„‘è£‚é—®é¢˜-md"><a href="#5-1-é›†ç¾¤åˆ†å¸ƒå¼æ¨¡å‹åŠé€‰ä¸»ä¸è„‘è£‚é—®é¢˜-md" class="headerlink" title="5.1-é›†ç¾¤åˆ†å¸ƒå¼æ¨¡å‹åŠé€‰ä¸»ä¸è„‘è£‚é—®é¢˜.md"></a>5.1-é›†ç¾¤åˆ†å¸ƒå¼æ¨¡å‹åŠé€‰ä¸»ä¸è„‘è£‚é—®é¢˜.md</h1><h1 id="é›†ç¾¤åˆ†å¸ƒå¼æ¨¡å‹åŠé€‰ä¸»ä¸è„‘è£‚é—®é¢˜"><a href="#é›†ç¾¤åˆ†å¸ƒå¼æ¨¡å‹åŠé€‰ä¸»ä¸è„‘è£‚é—®é¢˜" class="headerlink" title="é›†ç¾¤åˆ†å¸ƒå¼æ¨¡å‹åŠé€‰ä¸»ä¸è„‘è£‚é—®é¢˜"></a>é›†ç¾¤åˆ†å¸ƒå¼æ¨¡å‹åŠé€‰ä¸»ä¸è„‘è£‚é—®é¢˜</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">bin/elasticsearch -E node.<span class="hljs-attribute">name</span>=node1 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node1_data<br>bin/elasticsearch -E node.<span class="hljs-attribute">name</span>=node2 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node2_data<br>bin/elasticsearch -E node.<span class="hljs-attribute">name</span>=node3 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node3_data<br><br></code></pre></td></tr></table></figure><h1 id="5-2-åˆ†ç‰‡ä¸é›†ç¾¤çš„æ•…éšœè½¬ç§»-md"><a href="#5-2-åˆ†ç‰‡ä¸é›†ç¾¤çš„æ•…éšœè½¬ç§»-md" class="headerlink" title="5.2-åˆ†ç‰‡ä¸é›†ç¾¤çš„æ•…éšœè½¬ç§».md"></a>5.2-åˆ†ç‰‡ä¸é›†ç¾¤çš„æ•…éšœè½¬ç§».md</h1><h1 id="åˆ†ç‰‡ä¸é›†ç¾¤çš„æ•…éšœè½¬ç§»"><a href="#åˆ†ç‰‡ä¸é›†ç¾¤çš„æ•…éšœè½¬ç§»" class="headerlink" title="åˆ†ç‰‡ä¸é›†ç¾¤çš„æ•…éšœè½¬ç§»"></a>åˆ†ç‰‡ä¸é›†ç¾¤çš„æ•…éšœè½¬ç§»</h1><h1 id="5-3-æ–‡æ¡£åˆ†å¸ƒå¼å­˜å‚¨-md"><a href="#5-3-æ–‡æ¡£åˆ†å¸ƒå¼å­˜å‚¨-md" class="headerlink" title="5.3-æ–‡æ¡£åˆ†å¸ƒå¼å­˜å‚¨.md"></a>5.3-æ–‡æ¡£åˆ†å¸ƒå¼å­˜å‚¨.md</h1><h1 id="æ–‡æ¡£åˆ†å¸ƒå¼å­˜å‚¨"><a href="#æ–‡æ¡£åˆ†å¸ƒå¼å­˜å‚¨" class="headerlink" title="æ–‡æ¡£åˆ†å¸ƒå¼å­˜å‚¨"></a>æ–‡æ¡£åˆ†å¸ƒå¼å­˜å‚¨</h1><h1 id="5-4-åˆ†ç‰‡åŠå…¶ç”Ÿå‘½å‘¨æœŸ-md"><a href="#5-4-åˆ†ç‰‡åŠå…¶ç”Ÿå‘½å‘¨æœŸ-md" class="headerlink" title="5.4-åˆ†ç‰‡åŠå…¶ç”Ÿå‘½å‘¨æœŸ.md"></a>5.4-åˆ†ç‰‡åŠå…¶ç”Ÿå‘½å‘¨æœŸ.md</h1><h1 id="åˆ†ç‰‡åŠå…¶ç”Ÿå‘½å‘¨æœŸ"><a href="#åˆ†ç‰‡åŠå…¶ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="åˆ†ç‰‡åŠå…¶ç”Ÿå‘½å‘¨æœŸ"></a>åˆ†ç‰‡åŠå…¶ç”Ÿå‘½å‘¨æœŸ</h1><h1 id="5-5-å‰–æåˆ†å¸ƒå¼æŸ¥è¯¢åŠç›¸å…³æ€§è¯„åˆ†-md"><a href="#5-5-å‰–æåˆ†å¸ƒå¼æŸ¥è¯¢åŠç›¸å…³æ€§è¯„åˆ†-md" class="headerlink" title="5.5-å‰–æåˆ†å¸ƒå¼æŸ¥è¯¢åŠç›¸å…³æ€§è¯„åˆ†.md"></a>5.5-å‰–æåˆ†å¸ƒå¼æŸ¥è¯¢åŠç›¸å…³æ€§è¯„åˆ†.md</h1><h1 id="å‰–æåˆ†å¸ƒå¼æŸ¥è¯¢åŠç›¸å…³æ€§è¯„åˆ†"><a href="#å‰–æåˆ†å¸ƒå¼æŸ¥è¯¢åŠç›¸å…³æ€§è¯„åˆ†" class="headerlink" title="å‰–æåˆ†å¸ƒå¼æŸ¥è¯¢åŠç›¸å…³æ€§è¯„åˆ†"></a>å‰–æåˆ†å¸ƒå¼æŸ¥è¯¢åŠç›¸å…³æ€§è¯„åˆ†</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs routeros">DELETE message<br>PUT message<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>: 20<br>  &#125;<br>&#125;<br><br><span class="hljs-built_in">GET</span> message<br><br>POST message/_doc?<span class="hljs-attribute">routing</span>=1<br>&#123;<br>  <span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;good&quot;</span><br>&#125;<br><br>POST message/_doc?<span class="hljs-attribute">routing</span>=2<br>&#123;<br>  <span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;good morning&quot;</span><br>&#125;<br><br>POST message/_doc?<span class="hljs-attribute">routing</span>=3<br>&#123;<br>  <span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;good morning everyone&quot;</span><br>&#125;<br><br>POST message/_search<br>&#123;<br>  <span class="hljs-string">&quot;explain&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br><br><br>POST message/_search<br>&#123;<br>  <span class="hljs-string">&quot;explain&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;content&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;good&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br>POST message/_search?<span class="hljs-attribute">search_type</span>=dfs_query_then_fetch<br>&#123;<br><br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;content&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;good&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="5-6-æ’åºåŠDocValues-Fielddata-md"><a href="#5-6-æ’åºåŠDocValues-Fielddata-md" class="headerlink" title="5.6-æ’åºåŠDocValues&amp;Fielddata.md"></a>5.6-æ’åºåŠDocValues&amp;Fielddata.md</h1><h1 id="æ’åºåŠDoc-Values-Fielddata"><a href="#æ’åºåŠDoc-Values-Fielddata" class="headerlink" title="æ’åºåŠDoc Values &amp; Fielddata"></a>æ’åºåŠDoc Values &amp; Fielddata</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#å•å­—æ®µæ’åº</span><br>POST /kibana_sample_data_ecommerce/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 5,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;<br><br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;sort&quot;</span>: [<br>    &#123;<span class="hljs-string">&quot;order_date&quot;</span>: &#123;<span class="hljs-string">&quot;order&quot;</span>: <span class="hljs-string">&quot;desc&quot;</span>&#125;&#125;<br>  ]<br>&#125;<br><br><span class="hljs-comment">#å¤šå­—æ®µæ’åº</span><br>POST /kibana_sample_data_ecommerce/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 5,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;<br><br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;sort&quot;</span>: [<br>    &#123;<span class="hljs-string">&quot;order_date&quot;</span>: &#123;<span class="hljs-string">&quot;order&quot;</span>: <span class="hljs-string">&quot;desc&quot;</span>&#125;&#125;,<br>    &#123;<span class="hljs-string">&quot;_doc&quot;</span>:&#123;<span class="hljs-string">&quot;order&quot;</span>: <span class="hljs-string">&quot;asc&quot;</span>&#125;&#125;,<br>    &#123;<span class="hljs-string">&quot;_score&quot;</span>:&#123; <span class="hljs-string">&quot;order&quot;</span>: <span class="hljs-string">&quot;desc&quot;</span>&#125;&#125;<br>  ]<br>&#125;<br><br>GET kibana_sample_data_ecommerce/_mapping<br><br><span class="hljs-comment">#å¯¹ text å­—æ®µè¿›è¡Œæ’åºã€‚é»˜è®¤ä¼šæŠ¥é”™ï¼Œéœ€æ‰“å¼€fielddata</span><br>POST /kibana_sample_data_ecommerce/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 5,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;<br><br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;sort&quot;</span>: [<br>    &#123;<span class="hljs-string">&quot;customer_full_name&quot;</span>: &#123;<span class="hljs-string">&quot;order&quot;</span>: <span class="hljs-string">&quot;desc&quot;</span>&#125;&#125;<br>  ]<br>&#125;<br><br><span class="hljs-comment">#æ‰“å¼€ textçš„ fielddata</span><br>PUT kibana_sample_data_ecommerce/_mapping<br>&#123;<br>  <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;customer_full_name&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span>,<br>          <span class="hljs-string">&quot;fielddata&quot;</span>: <span class="hljs-literal">true</span>,<br>          <span class="hljs-string">&quot;fields&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;keyword&quot;</span> : &#123;<br>              <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span>,<br>              <span class="hljs-string">&quot;ignore_above&quot;</span> : 256<br>            &#125;<br>          &#125;<br>        &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">#å…³é—­ keywordçš„ doc values</span><br>PUT test_keyword<br>PUT test_keyword/_mapping<br>&#123;<br>  <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;user_name&quot;</span>:&#123;<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span>,<br>      <span class="hljs-string">&quot;doc_values&quot;</span>:<span class="hljs-literal">false</span><br>    &#125;<br>  &#125;<br>&#125;<br><br>DELETE test_keyword<br><br>PUT test_text<br>PUT test_text/_mapping<br>&#123;<br>  <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;intro&quot;</span>:&#123;<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>      <span class="hljs-string">&quot;doc_values&quot;</span>:<span class="hljs-literal">true</span><br>    &#125;<br>  &#125;<br>&#125;<br><br>DELETE test_text<br><br><br>DELETE temp_users<br>PUT temp_users<br>PUT temp_users/_mapping<br>&#123;<br>  <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;name&quot;</span>:&#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<span class="hljs-string">&quot;fielddata&quot;</span>: <span class="hljs-literal">true</span>&#125;,<br>    <span class="hljs-string">&quot;desc&quot;</span>:&#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<span class="hljs-string">&quot;fielddata&quot;</span>: <span class="hljs-literal">true</span>&#125;<br>  &#125;<br>&#125;<br><br>Post temp_users/_doc<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;Jack&quot;</span>,<span class="hljs-string">&quot;desc&quot;</span>:<span class="hljs-string">&quot;Jack is a good boy!&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:10&#125;<br><br><span class="hljs-comment">#æ‰“å¼€fielddata åï¼ŒæŸ¥çœ‹ docvalue_fieldsæ•°æ®</span><br>POST  temp_users/_search<br>&#123;<br>  <span class="hljs-string">&quot;docvalue_fields&quot;</span>: [<br>    <span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;desc&quot;</span><br>    ]<br>&#125;<br><br><span class="hljs-comment">#æŸ¥çœ‹æ•´å‹å­—æ®µçš„docvalues</span><br>POST  temp_users/_search<br>&#123;<br>  <span class="hljs-string">&quot;docvalue_fields&quot;</span>: [<br>    <span class="hljs-string">&quot;age&quot;</span><br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="5-7-åˆ†é¡µä¸éå†-FromSize-SearchAfter-ScrollAPI-md"><a href="#5-7-åˆ†é¡µä¸éå†-FromSize-SearchAfter-ScrollAPI-md" class="headerlink" title="5.7-åˆ†é¡µä¸éå†-FromSize&amp;SearchAfter&amp;ScrollAPI.md"></a>5.7-åˆ†é¡µä¸éå†-FromSize&amp;SearchAfter&amp;ScrollAPI.md</h1><h1 id="åˆ†é¡µä¸éå†-From-Size-Search-after-Scroll-API"><a href="#åˆ†é¡µä¸éå†-From-Size-Search-after-Scroll-API" class="headerlink" title="åˆ†é¡µä¸éå† - From, Size, Search_after &amp; Scroll API"></a>åˆ†é¡µä¸éå† - From, Size, Search_after &amp; Scroll API</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>POST tmdb/_search<br>&#123;<br>  <span class="hljs-string">&quot;from&quot;</span>: 10000,<br>  <span class="hljs-string">&quot;size&quot;</span>: 1,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;<br><br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">#Scroll API</span><br>DELETE <span class="hljs-built_in">users</span><br><br>POST <span class="hljs-built_in">users</span>/_doc<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;user1&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:10&#125;<br><br>POST <span class="hljs-built_in">users</span>/_doc<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;user2&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:11&#125;<br><br><br>POST <span class="hljs-built_in">users</span>/_doc<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;user2&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:12&#125;<br><br>POST <span class="hljs-built_in">users</span>/_doc<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;user2&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:13&#125;<br><br>POST <span class="hljs-built_in">users</span>/_count<br><br>POST <span class="hljs-built_in">users</span>/_search<br>&#123;<br>    <span class="hljs-string">&quot;size&quot;</span>: 1,<br>    <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;sort&quot;</span>: [<br>        &#123;<span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-string">&quot;desc&quot;</span>&#125; ,<br>        &#123;<span class="hljs-string">&quot;_id&quot;</span>: <span class="hljs-string">&quot;asc&quot;</span>&#125;    <br>    ]<br>&#125;<br><br>POST <span class="hljs-built_in">users</span>/_search<br>&#123;<br>    <span class="hljs-string">&quot;size&quot;</span>: 1,<br>    <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;search_after&quot;</span>:<br>        [<br>          10,<br>          <span class="hljs-string">&quot;ZQ0vYGsBrR8X3IP75QqX&quot;</span>],<br>    <span class="hljs-string">&quot;sort&quot;</span>: [<br>        &#123;<span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-string">&quot;desc&quot;</span>&#125; ,<br>        &#123;<span class="hljs-string">&quot;_id&quot;</span>: <span class="hljs-string">&quot;asc&quot;</span>&#125;    <br>    ]<br>&#125;<br><br><br><span class="hljs-comment">#Scroll API</span><br>DELETE <span class="hljs-built_in">users</span><br>POST <span class="hljs-built_in">users</span>/_doc<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;user1&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:10&#125;<br><br>POST <span class="hljs-built_in">users</span>/_doc<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;user2&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:20&#125;<br><br>POST <span class="hljs-built_in">users</span>/_doc<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;user3&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:30&#125;<br><br>POST <span class="hljs-built_in">users</span>/_doc<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;user4&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:40&#125;<br><br>POST /users/_search?scroll=5m<br>&#123;<br>    <span class="hljs-string">&quot;size&quot;</span>: 1,<br>    <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;match_all&quot;</span> : &#123;<br>        &#125;<br>    &#125;<br>&#125;<br><br><br>POST <span class="hljs-built_in">users</span>/_doc<br>&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;user5&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:50&#125;<br>POST /_search/scroll<br>&#123;<br>    <span class="hljs-string">&quot;scroll&quot;</span> : <span class="hljs-string">&quot;1m&quot;</span>,<br>    <span class="hljs-string">&quot;scroll_id&quot;</span> : <span class="hljs-string">&quot;DXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAAWAWbWdoQXR2d3ZUd2kzSThwVTh4bVE0QQ==&quot;</span><br>&#125;<br><br><br></code></pre></td></tr></table></figure><h1 id="5-8-å¤„ç†å¹¶å‘è¯»å†™-md"><a href="#5-8-å¤„ç†å¹¶å‘è¯»å†™-md" class="headerlink" title="5.8-å¤„ç†å¹¶å‘è¯»å†™.md"></a>5.8-å¤„ç†å¹¶å‘è¯»å†™.md</h1><h1 id="å¤„ç†å¹¶å‘è¯»å†™æ“ä½œ"><a href="#å¤„ç†å¹¶å‘è¯»å†™æ“ä½œ" class="headerlink" title="å¤„ç†å¹¶å‘è¯»å†™æ“ä½œ"></a>å¤„ç†å¹¶å‘è¯»å†™æ“ä½œ</h1><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs sas"><br><span class="hljs-keyword">DELETE</span> products<br><span class="hljs-keyword">PUT</span> products<br><br><span class="hljs-keyword">PUT</span> products/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;iphone&quot;</span>,<br>  <span class="hljs-string">&quot;count&quot;</span>:100<br>&#125;<br><br><br><br>GET products/_doc/1<br><br><span class="hljs-keyword">PUT</span> products/_doc/1?if_seq_no=1<span class="hljs-variable">&amp;if_primary_term</span>=1<br>&#123;<br>  <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;iphone&quot;</span>,<br>  <span class="hljs-string">&quot;count&quot;</span>:100<br>&#125;<br><br><br><br><span class="hljs-keyword">PUT</span> products/_doc/1?version=30000<span class="hljs-variable">&amp;version_type</span>=external<br>&#123;<br>  <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;iphone&quot;</span>,<br>  <span class="hljs-string">&quot;count&quot;</span>:100<br>&#125;<br><br><br><br></code></pre></td></tr></table></figure><h1 id="6-1-Bucket-Metricèšåˆåˆ†æåŠåµŒå¥—èšåˆ-md"><a href="#6-1-Bucket-Metricèšåˆåˆ†æåŠåµŒå¥—èšåˆ-md" class="headerlink" title="6.1-Bucket&amp;Metricèšåˆåˆ†æåŠåµŒå¥—èšåˆ.md"></a>6.1-Bucket&amp;Metricèšåˆåˆ†æåŠåµŒå¥—èšåˆ.md</h1><h1 id="Bucket-Metric-Aggregation"><a href="#Bucket-Metric-Aggregation" class="headerlink" title="Bucket &amp; Metric Aggregation"></a>Bucket &amp; Metric Aggregation</h1><h2 id="demos"><a href="#demos" class="headerlink" title="demos"></a>demos</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE /employees<br>PUT /employees/<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span> : &#123;<br>      <span class="hljs-string">&quot;properties&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;age&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;integer&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;gender&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;job&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span>,<br>          <span class="hljs-string">&quot;fields&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;keyword&quot;</span> : &#123;<br>              <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span>,<br>              <span class="hljs-string">&quot;ignore_above&quot;</span> : 50<br>            &#125;<br>          &#125;<br>        &#125;,<br>        <span class="hljs-string">&quot;name&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;salary&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;integer&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>&#125;<br><br>PUT /employees/_bulk<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;1&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Emma&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:32,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Product Manager&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:35000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;2&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Underwood&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:41,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Dev Manager&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 50000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;3&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Tran&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:25,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Web Designer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:18000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;4&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Rivera&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:26,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Web Designer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 22000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;5&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Rose&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:25,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;QA&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:18000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;6&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Lucy&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:31,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;QA&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 25000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;7&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Byrd&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:27,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;QA&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:20000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;8&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Foster&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:27,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 20000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;9&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Gregory&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:32,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:22000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;10&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Bryant&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:20,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 9000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;11&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Jenny&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:36,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:38000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;12&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Mcdonald&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:31,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 32000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;13&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Jonthna&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:30,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:30000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;14&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Marshall&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:32,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Javascript Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 25000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;15&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;King&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:33,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:28000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;16&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Mccarthy&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:21,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Javascript Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 16000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;17&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Goodwin&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:25,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Javascript Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 16000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;18&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Catherine&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:29,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Javascript Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 20000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;19&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Boone&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:30,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;DBA&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 30000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;20&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Kathy&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:29,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;DBA&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 20000&#125;<br><br><span class="hljs-comment"># Metric èšåˆï¼Œæ‰¾åˆ°æœ€ä½çš„å·¥èµ„</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;min_salary&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;min&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;salary&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># Metric èšåˆï¼Œæ‰¾åˆ°æœ€é«˜çš„å·¥èµ„</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;max_salary&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;max&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;salary&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># å¤šä¸ª Metric èšåˆï¼Œæ‰¾åˆ°æœ€ä½æœ€é«˜å’Œå¹³å‡å·¥èµ„</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;max_salary&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;max&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;salary&quot;</span><br>      &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;min_salary&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;min&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;salary&quot;</span><br>      &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;avg_salary&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;avg&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;salary&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># ä¸€ä¸ªèšåˆï¼Œè¾“å‡ºå¤šå€¼</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;stats_salary&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;stats&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;salary&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br><br><span class="hljs-comment"># å¯¹keword è¿›è¡Œèšåˆ</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;job.keyword&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># å¯¹ Text å­—æ®µè¿›è¡Œ terms èšåˆæŸ¥è¯¢ï¼Œå¤±è´¥</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;job&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># å¯¹ Text å­—æ®µæ‰“å¼€ fielddataï¼Œæ”¯æŒterms aggregation</span><br>PUT employees/_mapping<br>&#123;<br>  <span class="hljs-string">&quot;properties&quot;</span> : &#123;<br>    <span class="hljs-string">&quot;job&quot;</span>:&#123;<br>       <span class="hljs-string">&quot;type&quot;</span>:     <span class="hljs-string">&quot;text&quot;</span>,<br>       <span class="hljs-string">&quot;fielddata&quot;</span>: <span class="hljs-literal">true</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># å¯¹ Text å­—æ®µè¿›è¡Œ terms åˆ†è¯ã€‚åˆ†è¯åçš„terms</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;job&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;job.keyword&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># å¯¹job.keyword å’Œ job è¿›è¡Œ terms èšåˆï¼Œåˆ†æ¡¶çš„æ€»æ•°å¹¶ä¸ä¸€æ ·</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;cardinate&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;cardinality&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;job&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># å¯¹ æ€§åˆ«çš„ keyword è¿›è¡Œèšåˆ</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;gender&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;gender&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#æŒ‡å®š bucket çš„ size</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;ages_5&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;age&quot;</span>,<br>        <span class="hljs-string">&quot;size&quot;</span>:3<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br><span class="hljs-comment"># æŒ‡å®šsizeï¼Œä¸åŒå·¥ç§ä¸­ï¼Œå¹´çºªæœ€å¤§çš„3ä¸ªå‘˜å·¥çš„å…·ä½“ä¿¡æ¯</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;job.keyword&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;old_employee&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;top_hits&quot;</span>:&#123;<br>            <span class="hljs-string">&quot;size&quot;</span>:3,<br>            <span class="hljs-string">&quot;sort&quot;</span>:[<br>              &#123;<br>                <span class="hljs-string">&quot;age&quot;</span>:&#123;<br>                  <span class="hljs-string">&quot;order&quot;</span>:<span class="hljs-string">&quot;desc&quot;</span><br>                &#125;<br>              &#125;<br>            ]<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br><span class="hljs-comment">#Salary Ranges åˆ†æ¡¶ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰ key</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;salary_range&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;range&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;salary&quot;</span>,<br>        <span class="hljs-string">&quot;ranges&quot;</span>:[<br>          &#123;<br>            <span class="hljs-string">&quot;to&quot;</span>:10000<br>          &#125;,<br>          &#123;<br>            <span class="hljs-string">&quot;from&quot;</span>:10000,<br>            <span class="hljs-string">&quot;to&quot;</span>:20000<br>          &#125;,<br>          &#123;<br>            <span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;&gt;20000&quot;</span>,<br>            <span class="hljs-string">&quot;from&quot;</span>:20000<br>          &#125;<br>        ]<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#Salary Histogram,å·¥èµ„0åˆ°10ä¸‡ï¼Œä»¥ 5000ä¸€ä¸ªåŒºé—´è¿›è¡Œåˆ†æ¡¶</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;salary_histrogram&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;histogram&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;salary&quot;</span>,<br>        <span class="hljs-string">&quot;interval&quot;</span>:5000,<br>        <span class="hljs-string">&quot;extended_bounds&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;min&quot;</span>:0,<br>          <span class="hljs-string">&quot;max&quot;</span>:100000<br><br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># åµŒå¥—èšåˆ1ï¼ŒæŒ‰ç…§å·¥ä½œç±»å‹åˆ†æ¡¶ï¼Œå¹¶ç»Ÿè®¡å·¥èµ„ä¿¡æ¯</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;Job_salary_stats&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;job.keyword&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;salary&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;stats&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;salary&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># å¤šæ¬¡åµŒå¥—ã€‚æ ¹æ®å·¥ä½œç±»å‹åˆ†æ¡¶ï¼Œç„¶åæŒ‰ç…§æ€§åˆ«åˆ†æ¡¶ï¼Œè®¡ç®—å·¥èµ„çš„ç»Ÿè®¡ä¿¡æ¯</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;Job_gender_stats&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;job.keyword&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;gender_stats&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;gender&quot;</span><br>          &#125;,<br>          <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;salary_stats&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;stats&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;salary&quot;</span><br>              &#125;<br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="6-2-Pipelineèšåˆåˆ†æ-md"><a href="#6-2-Pipelineèšåˆåˆ†æ-md" class="headerlink" title="6.2-Pipelineèšåˆåˆ†æ.md"></a>6.2-Pipelineèšåˆåˆ†æ.md</h1><h1 id="Pipeline-èšåˆåˆ†æ"><a href="#Pipeline-èšåˆåˆ†æ" class="headerlink" title="Pipeline èšåˆåˆ†æ"></a>Pipeline èšåˆåˆ†æ</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE employees<br>PUT /employees/_bulk<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;1&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Emma&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:32,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Product Manager&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:35000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;2&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Underwood&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:41,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Dev Manager&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 50000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;3&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Tran&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:25,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Web Designer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:18000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;4&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Rivera&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:26,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Web Designer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 22000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;5&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Rose&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:25,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;QA&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:18000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;6&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Lucy&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:31,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;QA&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 25000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;7&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Byrd&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:27,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;QA&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:20000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;8&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Foster&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:27,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 20000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;9&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Gregory&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:32,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:22000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;10&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Bryant&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:20,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 9000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;11&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Jenny&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:36,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:38000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;12&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Mcdonald&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:31,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 32000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;13&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Jonthna&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:30,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:30000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;14&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Marshall&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:32,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Javascript Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 25000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;15&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;King&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:33,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:28000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;16&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Mccarthy&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:21,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Javascript Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 16000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;17&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Goodwin&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:25,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Javascript Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 16000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;18&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Catherine&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:29,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Javascript Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 20000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;19&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Boone&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:30,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;DBA&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 30000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;20&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Kathy&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:29,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;DBA&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 20000&#125;<br><br><br><br><span class="hljs-comment"># å¹³å‡å·¥èµ„æœ€ä½çš„å·¥ä½œç±»å‹</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;job.keyword&quot;</span>,<br>        <span class="hljs-string">&quot;size&quot;</span>: 10<br>      &#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;avg_salary&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;avg&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;salary&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;min_salary_by_job&quot;</span>:&#123;<br>      <span class="hljs-string">&quot;min_bucket&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;buckets_path&quot;</span>: <span class="hljs-string">&quot;jobs&gt;avg_salary&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># å¹³å‡å·¥èµ„æœ€é«˜çš„å·¥ä½œç±»å‹</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;job.keyword&quot;</span>,<br>        <span class="hljs-string">&quot;size&quot;</span>: 10<br>      &#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;avg_salary&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;avg&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;salary&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;max_salary_by_job&quot;</span>:&#123;<br>      <span class="hljs-string">&quot;max_bucket&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;buckets_path&quot;</span>: <span class="hljs-string">&quot;jobs&gt;avg_salary&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># å¹³å‡å·¥èµ„çš„å¹³å‡å·¥èµ„</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;job.keyword&quot;</span>,<br>        <span class="hljs-string">&quot;size&quot;</span>: 10<br>      &#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;avg_salary&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;avg&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;salary&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;avg_salary_by_job&quot;</span>:&#123;<br>      <span class="hljs-string">&quot;avg_bucket&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;buckets_path&quot;</span>: <span class="hljs-string">&quot;jobs&gt;avg_salary&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># å¹³å‡å·¥èµ„çš„ç»Ÿè®¡åˆ†æ</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;job.keyword&quot;</span>,<br>        <span class="hljs-string">&quot;size&quot;</span>: 10<br>      &#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;avg_salary&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;avg&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;salary&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;stats_salary_by_job&quot;</span>:&#123;<br>      <span class="hljs-string">&quot;stats_bucket&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;buckets_path&quot;</span>: <span class="hljs-string">&quot;jobs&gt;avg_salary&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># å¹³å‡å·¥èµ„çš„ç™¾åˆ†ä½æ•°</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;job.keyword&quot;</span>,<br>        <span class="hljs-string">&quot;size&quot;</span>: 10<br>      &#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;avg_salary&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;avg&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;salary&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;percentiles_salary_by_job&quot;</span>:&#123;<br>      <span class="hljs-string">&quot;percentiles_bucket&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;buckets_path&quot;</span>: <span class="hljs-string">&quot;jobs&gt;avg_salary&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br><span class="hljs-comment">#æŒ‰ç…§å¹´é¾„å¯¹å¹³å‡å·¥èµ„æ±‚å¯¼</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;age&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;histogram&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;age&quot;</span>,<br>        <span class="hljs-string">&quot;min_doc_count&quot;</span>: 1,<br>        <span class="hljs-string">&quot;interval&quot;</span>: 1<br>      &#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;avg_salary&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;avg&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;salary&quot;</span><br>          &#125;<br>        &#125;,<br>        <span class="hljs-string">&quot;derivative_avg_salary&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;derivative&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;buckets_path&quot;</span>: <span class="hljs-string">&quot;avg_salary&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#Cumulative_sum</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;age&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;histogram&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;age&quot;</span>,<br>        <span class="hljs-string">&quot;min_doc_count&quot;</span>: 1,<br>        <span class="hljs-string">&quot;interval&quot;</span>: 1<br>      &#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;avg_salary&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;avg&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;salary&quot;</span><br>          &#125;<br>        &#125;,<br>        <span class="hljs-string">&quot;cumulative_salary&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;cumulative_sum&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;buckets_path&quot;</span>: <span class="hljs-string">&quot;avg_salary&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">#Moving Function</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;age&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;histogram&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;age&quot;</span>,<br>        <span class="hljs-string">&quot;min_doc_count&quot;</span>: 1,<br>        <span class="hljs-string">&quot;interval&quot;</span>: 1<br>      &#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;avg_salary&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;avg&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;salary&quot;</span><br>          &#125;<br>        &#125;,<br>        <span class="hljs-string">&quot;moving_avg_salary&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;moving_fn&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;buckets_path&quot;</span>: <span class="hljs-string">&quot;avg_salary&quot;</span>,<br>            <span class="hljs-string">&quot;window&quot;</span>:10,<br>            <span class="hljs-string">&quot;script&quot;</span>: <span class="hljs-string">&quot;MovingFunctions.min(values)&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="6-3-ä½œç”¨èŒƒå›´ä¸æ’åº-md"><a href="#6-3-ä½œç”¨èŒƒå›´ä¸æ’åº-md" class="headerlink" title="6.3-ä½œç”¨èŒƒå›´ä¸æ’åº.md"></a>6.3-ä½œç”¨èŒƒå›´ä¸æ’åº.md</h1><h1 id="ä½œç”¨èŒƒå›´ä¸æ’åº"><a href="#ä½œç”¨èŒƒå›´ä¸æ’åº" class="headerlink" title="ä½œç”¨èŒƒå›´ä¸æ’åº"></a>ä½œç”¨èŒƒå›´ä¸æ’åº</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE /employees<br>PUT /employees/<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span> : &#123;<br>      <span class="hljs-string">&quot;properties&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;age&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;integer&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;gender&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;job&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span>,<br>          <span class="hljs-string">&quot;fields&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;keyword&quot;</span> : &#123;<br>              <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span>,<br>              <span class="hljs-string">&quot;ignore_above&quot;</span> : 50<br>            &#125;<br>          &#125;<br>        &#125;,<br>        <span class="hljs-string">&quot;name&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;salary&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;integer&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>&#125;<br><br>PUT /employees/_bulk<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;1&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Emma&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:32,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Product Manager&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:35000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;2&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Underwood&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:41,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Dev Manager&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 50000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;3&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Tran&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:25,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Web Designer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:18000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;4&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Rivera&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:26,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Web Designer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 22000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;5&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Rose&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:25,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;QA&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:18000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;6&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Lucy&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:31,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;QA&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 25000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;7&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Byrd&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:27,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;QA&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:20000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;8&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Foster&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:27,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 20000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;9&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Gregory&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:32,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:22000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;10&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Bryant&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:20,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 9000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;11&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Jenny&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:36,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:38000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;12&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Mcdonald&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:31,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 32000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;13&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Jonthna&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:30,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:30000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;14&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Marshall&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:32,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Javascript Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 25000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;15&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;King&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:33,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Java Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>:28000 &#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;16&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Mccarthy&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:21,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Javascript Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 16000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;17&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Goodwin&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:25,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Javascript Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 16000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;18&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Catherine&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:29,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;Javascript Programmer&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 20000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;19&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Boone&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:30,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;DBA&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;male&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 30000&#125;<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123;  <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;20&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;Kathy&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:29,<span class="hljs-string">&quot;job&quot;</span>:<span class="hljs-string">&quot;DBA&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;female&quot;</span>,<span class="hljs-string">&quot;salary&quot;</span>: 20000&#125;<br><br><br><br><span class="hljs-comment"># Query</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;range&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;age&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;gte&quot;</span>: 20<br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;job.keyword&quot;</span><br>        <br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#Filter</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;older_person&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;filter&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;range&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;age&quot;</span>:&#123;<br>            <span class="hljs-string">&quot;from&quot;</span>:35<br>          &#125;<br>        &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>:&#123;<br>         <span class="hljs-string">&quot;jobs&quot;</span>:&#123;<br>           <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;job.keyword&quot;</span><br>      &#125;<br>      &#125;<br>    &#125;&#125;,<br>    <span class="hljs-string">&quot;all_jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;job.keyword&quot;</span><br>        <br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br><span class="hljs-comment">#Post field. ä¸€æ¡è¯­å¥ï¼Œæ‰¾å‡ºæ‰€æœ‰çš„jobç±»å‹ã€‚è¿˜èƒ½æ‰¾åˆ°èšåˆåç¬¦åˆæ¡ä»¶çš„ç»“æœ</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;job.keyword&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;post_filter&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;job.keyword&quot;</span>: <span class="hljs-string">&quot;Dev Manager&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#global</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;range&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;age&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;gte&quot;</span>: 40<br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;job.keyword&quot;</span><br>        <br>      &#125;<br>    &#125;,<br>    <br>    <span class="hljs-string">&quot;all&quot;</span>:&#123;<br>      <span class="hljs-string">&quot;global&quot;</span>:&#123;&#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;salary_avg&quot;</span>:&#123;<br>          <span class="hljs-string">&quot;avg&quot;</span>:&#123;<br>            <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;salary&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#æ’åº order</span><br><span class="hljs-comment">#count and key</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;range&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;age&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;gte&quot;</span>: 20<br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;job.keyword&quot;</span>,<br>        <span class="hljs-string">&quot;order&quot;</span>:[<br>          &#123;<span class="hljs-string">&quot;_count&quot;</span>:<span class="hljs-string">&quot;asc&quot;</span>&#125;,<br>          &#123;<span class="hljs-string">&quot;_key&quot;</span>:<span class="hljs-string">&quot;desc&quot;</span>&#125;<br>          ]<br>        <br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#æ’åº order</span><br><span class="hljs-comment">#count and key</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;job.keyword&quot;</span>,<br>        <span class="hljs-string">&quot;order&quot;</span>:[  &#123;<br>            <span class="hljs-string">&quot;avg_salary&quot;</span>:<span class="hljs-string">&quot;desc&quot;</span><br>          &#125;]<br>        <br>        <br>      &#125;,<br>    <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;avg_salary&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;avg&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;salary&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#æ’åº order</span><br><span class="hljs-comment">#count and key</span><br>POST employees/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;jobs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;job.keyword&quot;</span>,<br>        <span class="hljs-string">&quot;order&quot;</span>:[  &#123;<br>            <span class="hljs-string">&quot;stats_salary.min&quot;</span>:<span class="hljs-string">&quot;desc&quot;</span><br>          &#125;]<br>        <br>        <br>      &#125;,<br>    <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;stats_salary&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;stats&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;salary&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="6-4-èšåˆåˆ†æçš„åŸç†åŠç²¾å‡†åº¦é—®é¢˜-md"><a href="#6-4-èšåˆåˆ†æçš„åŸç†åŠç²¾å‡†åº¦é—®é¢˜-md" class="headerlink" title="6.4-èšåˆåˆ†æçš„åŸç†åŠç²¾å‡†åº¦é—®é¢˜.md"></a>6.4-èšåˆåˆ†æçš„åŸç†åŠç²¾å‡†åº¦é—®é¢˜.md</h1><h1 id="èšåˆåˆ†æçš„åŸç†åŠç²¾å‡†åº¦é—®é¢˜"><a href="#èšåˆåˆ†æçš„åŸç†åŠç²¾å‡†åº¦é—®é¢˜" class="headerlink" title="èšåˆåˆ†æçš„åŸç†åŠç²¾å‡†åº¦é—®é¢˜"></a>èšåˆåˆ†æçš„åŸç†åŠç²¾å‡†åº¦é—®é¢˜</h1><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><code class="hljs sqf">DELETE my_flights<br>PUT my_flights<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>: <span class="hljs-number">20</span><br>  &#125;,<br>  <span class="hljs-string">&quot;mappings&quot;</span> : &#123;<br>      <span class="hljs-string">&quot;properties&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;AvgTicketPrice&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;float&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;Cancelled&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;boolean&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;Carrier&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;Dest&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;DestAirportID&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;DestCityName&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;DestCountry&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;DestLocation&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;geo_point&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;DestRegion&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;DestWeather&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;DistanceKilometers&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;float&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;DistanceMiles&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;float&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;FlightDelay&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;boolean&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;FlightDelayMin&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;integer&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;FlightDelayType&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;FlightNum&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;FlightTimeHour&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;FlightTimeMin&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;float&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;Origin&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;OriginAirportID&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;OriginCityName&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;OriginCountry&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;OriginLocation&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;geo_point&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;OriginRegion&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;OriginWeather&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;dayOfWeek&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;integer&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;timestamp&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;date&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>&#125;<br><br><br>POST <span class="hljs-variable">_reindex</span><br>&#123;<br>  <span class="hljs-string">&quot;source&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-string">&quot;kibana_sample_data_flights&quot;</span><br>  &#125;,<br>  <span class="hljs-string">&quot;dest&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-string">&quot;my_flights&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-built_in">GET</span> kibana_sample_data_flights/<span class="hljs-variable">_count</span><br><span class="hljs-built_in">GET</span> my_flights/<span class="hljs-variable">_count</span><br><br><span class="hljs-built_in">get</span> kibana_sample_data_flights/<span class="hljs-variable">_search</span><br><br><br><span class="hljs-built_in">GET</span> kibana_sample_data_flights/<span class="hljs-variable">_search</span><br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;weather&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;OriginWeather&quot;</span>,<br>        <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-number">5</span>,<br>        <span class="hljs-string">&quot;show_term_doc_count_error&quot;</span>:<span class="hljs-literal">true</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-built_in">GET</span> my_flights/<span class="hljs-variable">_search</span><br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;weather&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>:<span class="hljs-string">&quot;OriginWeather&quot;</span>,<br>        <span class="hljs-string">&quot;size&quot;</span>:<span class="hljs-number">1</span>,<br>        <span class="hljs-string">&quot;shard_size&quot;</span>:<span class="hljs-number">1</span>,<br>        <span class="hljs-string">&quot;show_term_doc_count_error&quot;</span>:<span class="hljs-literal">true</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="7-1-å¯¹è±¡åŠ-Nested-å¯¹è±¡-md"><a href="#7-1-å¯¹è±¡åŠ-Nested-å¯¹è±¡-md" class="headerlink" title="7.1-å¯¹è±¡åŠ Nested å¯¹è±¡.md"></a>7.1-å¯¹è±¡åŠ Nested å¯¹è±¡.md</h1><h1 id="å¯¹è±¡åŠNestedå¯¹è±¡"><a href="#å¯¹è±¡åŠNestedå¯¹è±¡" class="headerlink" title="å¯¹è±¡åŠNestedå¯¹è±¡"></a>å¯¹è±¡åŠNestedå¯¹è±¡</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE blog<br><span class="hljs-comment"># è®¾ç½®blogçš„ Mapping</span><br>PUT /blog<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;content&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;time&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;date&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;user&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;city&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span><br>          &#125;,<br>          <span class="hljs-string">&quot;userid&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;long&quot;</span><br>          &#125;,<br>          <span class="hljs-string">&quot;username&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># æ’å…¥ä¸€æ¡ Blog ä¿¡æ¯</span><br>PUT blog/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;I like Elasticsearch&quot;</span>,<br>  <span class="hljs-string">&quot;time&quot;</span>:<span class="hljs-string">&quot;2019-01-01T00:00:00&quot;</span>,<br>  <span class="hljs-string">&quot;user&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;userid&quot;</span>:1,<br>    <span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;Jack&quot;</span>,<br>    <span class="hljs-string">&quot;city&quot;</span>:<span class="hljs-string">&quot;Shanghai&quot;</span><br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># æŸ¥è¯¢ Blog ä¿¡æ¯</span><br>POST blog/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [<br>        &#123;<span class="hljs-string">&quot;match&quot;</span>: &#123;<span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;Elasticsearch&quot;</span>&#125;&#125;,<br>        &#123;<span class="hljs-string">&quot;match&quot;</span>: &#123;<span class="hljs-string">&quot;user.username&quot;</span>: <span class="hljs-string">&quot;Jack&quot;</span>&#125;&#125;<br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br><br><br>DELETE my_movies<br><br><span class="hljs-comment"># ç”µå½±çš„Mappingä¿¡æ¯</span><br>PUT my_movies<br>&#123;<br>      <span class="hljs-string">&quot;mappings&quot;</span> : &#123;<br>      <span class="hljs-string">&quot;properties&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;actors&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;properties&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;first_name&quot;</span> : &#123;<br>              <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;last_name&quot;</span> : &#123;<br>              <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span><br>            &#125;<br>          &#125;<br>        &#125;,<br>        <span class="hljs-string">&quot;title&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span>,<br>          <span class="hljs-string">&quot;fields&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;keyword&quot;</span> : &#123;<br>              <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span>,<br>              <span class="hljs-string">&quot;ignore_above&quot;</span> : 256<br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment"># å†™å…¥ä¸€æ¡ç”µå½±ä¿¡æ¯</span><br>POST my_movies/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;Speed&quot;</span>,<br>  <span class="hljs-string">&quot;actors&quot;</span>:[<br>    &#123;<br>      <span class="hljs-string">&quot;first_name&quot;</span>:<span class="hljs-string">&quot;Keanu&quot;</span>,<br>      <span class="hljs-string">&quot;last_name&quot;</span>:<span class="hljs-string">&quot;Reeves&quot;</span><br>    &#125;,<br><br>    &#123;<br>      <span class="hljs-string">&quot;first_name&quot;</span>:<span class="hljs-string">&quot;Dennis&quot;</span>,<br>      <span class="hljs-string">&quot;last_name&quot;</span>:<span class="hljs-string">&quot;Hopper&quot;</span><br>    &#125;<br><br>  ]<br>&#125;<br><br><span class="hljs-comment"># æŸ¥è¯¢ç”µå½±ä¿¡æ¯</span><br>POST my_movies/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [<br>        &#123;<span class="hljs-string">&quot;match&quot;</span>: &#123;<span class="hljs-string">&quot;actors.first_name&quot;</span>: <span class="hljs-string">&quot;Keanu&quot;</span>&#125;&#125;,<br>        &#123;<span class="hljs-string">&quot;match&quot;</span>: &#123;<span class="hljs-string">&quot;actors.last_name&quot;</span>: <span class="hljs-string">&quot;Hopper&quot;</span>&#125;&#125;<br>      ]<br>    &#125;<br>  &#125;<br><br>&#125;<br><br>DELETE my_movies<br><span class="hljs-comment"># åˆ›å»º Nested å¯¹è±¡ Mapping</span><br>PUT my_movies<br>&#123;<br>      <span class="hljs-string">&quot;mappings&quot;</span> : &#123;<br>      <span class="hljs-string">&quot;properties&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;actors&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;nested&quot;</span>,<br>          <span class="hljs-string">&quot;properties&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;first_name&quot;</span> : &#123;<span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span>&#125;,<br>            <span class="hljs-string">&quot;last_name&quot;</span> : &#123;<span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span>&#125;<br>          &#125;&#125;,<br>        <span class="hljs-string">&quot;title&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span>,<br>          <span class="hljs-string">&quot;fields&quot;</span> : &#123;<span class="hljs-string">&quot;keyword&quot;</span>:&#123;<span class="hljs-string">&quot;type&quot;</span>:<span class="hljs-string">&quot;keyword&quot;</span>,<span class="hljs-string">&quot;ignore_above&quot;</span>:256&#125;&#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>&#125;<br><br><br>POST my_movies/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;Speed&quot;</span>,<br>  <span class="hljs-string">&quot;actors&quot;</span>:[<br>    &#123;<br>      <span class="hljs-string">&quot;first_name&quot;</span>:<span class="hljs-string">&quot;Keanu&quot;</span>,<br>      <span class="hljs-string">&quot;last_name&quot;</span>:<span class="hljs-string">&quot;Reeves&quot;</span><br>    &#125;,<br><br>    &#123;<br>      <span class="hljs-string">&quot;first_name&quot;</span>:<span class="hljs-string">&quot;Dennis&quot;</span>,<br>      <span class="hljs-string">&quot;last_name&quot;</span>:<span class="hljs-string">&quot;Hopper&quot;</span><br>    &#125;<br><br>  ]<br>&#125;<br><br><span class="hljs-comment"># Nested æŸ¥è¯¢</span><br>POST my_movies/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [<br>        &#123;<span class="hljs-string">&quot;match&quot;</span>: &#123;<span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;Speed&quot;</span>&#125;&#125;,<br>        &#123;<br>          <span class="hljs-string">&quot;nested&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;actors&quot;</span>,<br>            <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;must&quot;</span>: [<br>                  &#123;<span class="hljs-string">&quot;match&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;actors.first_name&quot;</span>: <span class="hljs-string">&quot;Keanu&quot;</span><br>                  &#125;&#125;,<br><br>                  &#123;<span class="hljs-string">&quot;match&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;actors.last_name&quot;</span>: <span class="hljs-string">&quot;Hopper&quot;</span><br>                  &#125;&#125;<br>                ]<br>              &#125;<br>            &#125;<br>          &#125;<br>        &#125;<br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># Nested Aggregation</span><br>POST my_movies/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;actors&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;nested&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;actors&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;actor_name&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;actors.first_name&quot;</span>,<br>            <span class="hljs-string">&quot;size&quot;</span>: 10<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># æ™®é€š aggregationä¸å·¥ä½œ</span><br>POST my_movies/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;NAME&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;actors.first_name&quot;</span>,<br>        <span class="hljs-string">&quot;size&quot;</span>: 10<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="7-2-æ–‡æ¡£çš„çˆ¶å­å…³ç³»-md"><a href="#7-2-æ–‡æ¡£çš„çˆ¶å­å…³ç³»-md" class="headerlink" title="7.2-æ–‡æ¡£çš„çˆ¶å­å…³ç³».md"></a>7.2-æ–‡æ¡£çš„çˆ¶å­å…³ç³».md</h1><h1 id="æ–‡æ¡£çš„çˆ¶å­å…³ç³»"><a href="#æ–‡æ¡£çš„çˆ¶å­å…³ç³»" class="headerlink" title="æ–‡æ¡£çš„çˆ¶å­å…³ç³»"></a>æ–‡æ¡£çš„çˆ¶å­å…³ç³»</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><code class="hljs routeros">DELETE my_blogs<br><br><span class="hljs-comment"># è®¾å®š Parent/Child Mapping</span><br>PUT my_blogs<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>: 2<br>  &#125;,<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;blog_comments_relation&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;join&quot;</span>,<br>        <span class="hljs-string">&quot;relations&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;blog&quot;</span>: <span class="hljs-string">&quot;comment&quot;</span><br>        &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;content&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;title&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#ç´¢å¼•çˆ¶æ–‡æ¡£</span><br>PUT my_blogs/_doc/blog1<br>&#123;<br>  <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;Learning Elasticsearch&quot;</span>,<br>  <span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;learning ELK @ geektime&quot;</span>,<br>  <span class="hljs-string">&quot;blog_comments_relation&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;blog&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment">#ç´¢å¼•çˆ¶æ–‡æ¡£</span><br>PUT my_blogs/_doc/blog2<br>&#123;<br>  <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;Learning Hadoop&quot;</span>,<br>  <span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;learning Hadoop&quot;</span>,<br>    <span class="hljs-string">&quot;blog_comments_relation&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;blog&quot;</span><br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#ç´¢å¼•å­æ–‡æ¡£</span><br>PUT my_blogs/_doc/comment1?<span class="hljs-attribute">routing</span>=blog1<br>&#123;<br>  <span class="hljs-string">&quot;comment&quot;</span>:<span class="hljs-string">&quot;I am learning ELK&quot;</span>,<br>  <span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;Jack&quot;</span>,<br>  <span class="hljs-string">&quot;blog_comments_relation&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;comment&quot;</span>,<br>    <span class="hljs-string">&quot;parent&quot;</span>:<span class="hljs-string">&quot;blog1&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment">#ç´¢å¼•å­æ–‡æ¡£</span><br>PUT my_blogs/_doc/comment2?<span class="hljs-attribute">routing</span>=blog2<br>&#123;<br>  <span class="hljs-string">&quot;comment&quot;</span>:<span class="hljs-string">&quot;I like Hadoop!!!!!&quot;</span>,<br>  <span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;Jack&quot;</span>,<br>  <span class="hljs-string">&quot;blog_comments_relation&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;comment&quot;</span>,<br>    <span class="hljs-string">&quot;parent&quot;</span>:<span class="hljs-string">&quot;blog2&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment">#ç´¢å¼•å­æ–‡æ¡£</span><br>PUT my_blogs/_doc/comment3?<span class="hljs-attribute">routing</span>=blog2<br>&#123;<br>  <span class="hljs-string">&quot;comment&quot;</span>:<span class="hljs-string">&quot;Hello Hadoop&quot;</span>,<br>  <span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;Bob&quot;</span>,<br>  <span class="hljs-string">&quot;blog_comments_relation&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;comment&quot;</span>,<br>    <span class="hljs-string">&quot;parent&quot;</span>:<span class="hljs-string">&quot;blog2&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£</span><br>POST my_blogs/_search<br>&#123;<br><br>&#125;<br><br><br><span class="hljs-comment">#æ ¹æ®çˆ¶æ–‡æ¡£IDæŸ¥çœ‹</span><br><span class="hljs-built_in">GET</span> my_blogs/_doc/blog2<br><br><span class="hljs-comment"># Parent Id æŸ¥è¯¢</span><br>POST my_blogs/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;parent_id&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;comment&quot;</span>,<br>      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">&quot;blog2&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment"># Has Child æŸ¥è¯¢,è¿”å›çˆ¶æ–‡æ¡£</span><br>POST my_blogs/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;has_child&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;comment&quot;</span>,<br>      <span class="hljs-string">&quot;query&quot;</span> : &#123;<br>                <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;username&quot;</span> : <span class="hljs-string">&quot;Jack&quot;</span><br>                &#125;<br>            &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># Has Parent æŸ¥è¯¢ï¼Œè¿”å›ç›¸å…³çš„å­æ–‡æ¡£</span><br>POST my_blogs/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;has_parent&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;parent_type&quot;</span>: <span class="hljs-string">&quot;blog&quot;</span>,<br>      <span class="hljs-string">&quot;query&quot;</span> : &#123;<br>                <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;title&quot;</span> : <span class="hljs-string">&quot;Learning Hadoop&quot;</span><br>                &#125;<br>            &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br><span class="hljs-comment">#é€šè¿‡ID ï¼Œè®¿é—®å­æ–‡æ¡£</span><br><span class="hljs-built_in">GET</span> my_blogs/_doc/comment3<br><span class="hljs-comment">#é€šè¿‡IDå’Œrouting ï¼Œè®¿é—®å­æ–‡æ¡£</span><br><span class="hljs-built_in">GET</span> my_blogs/_doc/comment3?<span class="hljs-attribute">routing</span>=blog2<br><br><span class="hljs-comment">#æ›´æ–°å­æ–‡æ¡£</span><br>PUT my_blogs/_doc/comment3?<span class="hljs-attribute">routing</span>=blog2<br>&#123;<br>    <span class="hljs-string">&quot;comment&quot;</span>: <span class="hljs-string">&quot;Hello Hadoop??&quot;</span>,<br>    <span class="hljs-string">&quot;blog_comments_relation&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;comment&quot;</span>,<br>      <span class="hljs-string">&quot;parent&quot;</span>: <span class="hljs-string">&quot;blog2&quot;</span><br>    &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><h1 id="7-5-Elasticsearchæ•°æ®å»ºæ¨¡å®ä¾‹-md"><a href="#7-5-Elasticsearchæ•°æ®å»ºæ¨¡å®ä¾‹-md" class="headerlink" title="7.5-Elasticsearchæ•°æ®å»ºæ¨¡å®ä¾‹.md"></a>7.5-Elasticsearchæ•°æ®å»ºæ¨¡å®ä¾‹.md</h1><h1 id="Elasticsearch-æ•°æ®å»ºæ¨¡å®ä¾‹"><a href="#Elasticsearch-æ•°æ®å»ºæ¨¡å®ä¾‹" class="headerlink" title="Elasticsearch æ•°æ®å»ºæ¨¡å®ä¾‹"></a>Elasticsearch æ•°æ®å»ºæ¨¡å®ä¾‹</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">###### Data Modeling Example</span><br><br><span class="hljs-comment"># Index ä¸€æœ¬ä¹¦çš„ä¿¡æ¯</span><br>PUT books/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;Mastering ElasticSearch 5.0&quot;</span>,<br>  <span class="hljs-string">&quot;description&quot;</span>:<span class="hljs-string">&quot;Master the searching, indexing, and aggregation features in ElasticSearch Improve usersâ€™ search experience with Elasticsearchâ€™s functionalities and develop your own Elasticsearch plugins&quot;</span>,<br>  <span class="hljs-string">&quot;author&quot;</span>:<span class="hljs-string">&quot;Bharvi Dixit&quot;</span>,<br>  <span class="hljs-string">&quot;public_date&quot;</span>:<span class="hljs-string">&quot;2017&quot;</span>,<br>  <span class="hljs-string">&quot;cover_url&quot;</span>:<span class="hljs-string">&quot;https://images-na.ssl-images-amazon.com/images/I/51OeaMFxcML.jpg&quot;</span><br>&#125;<br><br><br><br><span class="hljs-comment">#æŸ¥è¯¢è‡ªåŠ¨åˆ›å»ºçš„Mapping</span><br>GET books/_mapping<br><br>DELETE books<br><br><span class="hljs-comment">#ä¼˜åŒ–å­—æ®µç±»å‹</span><br>PUT books<br>&#123;<br>      <span class="hljs-string">&quot;mappings&quot;</span> : &#123;<br>      <span class="hljs-string">&quot;properties&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;author&quot;</span> : &#123;<span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span>&#125;,<br>        <span class="hljs-string">&quot;cover_url&quot;</span> : &#123;<span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span>,<span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-literal">false</span>&#125;,<br>        <span class="hljs-string">&quot;description&quot;</span> : &#123;<span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span>&#125;,<br>        <span class="hljs-string">&quot;public_date&quot;</span> : &#123;<span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;date&quot;</span>&#125;,<br>        <span class="hljs-string">&quot;title&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span>,<br>          <span class="hljs-string">&quot;fields&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;keyword&quot;</span> : &#123;<br>              <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span>,<br>              <span class="hljs-string">&quot;ignore_above&quot;</span> : 100<br>            &#125;<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">#Cover URL index è®¾ç½®æˆfalseï¼Œæ— æ³•å¯¹è¯¥å­—æ®µè¿›è¡Œæœç´¢</span><br>POST books/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;cover_url&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;https://images-na.ssl-images-amazon.com/images/I/51OeaMFxcML.jpg&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">#Cover URL index è®¾ç½®æˆfalseï¼Œä¾ç„¶æ”¯æŒèšåˆåˆ†æ</span><br>POST books/_search<br>&#123;<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;cover&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;cover_url&quot;</span>,<br>        <span class="hljs-string">&quot;size&quot;</span>: 10<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br>DELETE books<br><span class="hljs-comment">#æ–°å¢ Contentå­—æ®µã€‚æ•°æ®é‡å¾ˆå¤§ã€‚é€‰æ‹©å°†Source å…³é—­</span><br>PUT books<br>&#123;<br>      <span class="hljs-string">&quot;mappings&quot;</span> : &#123;<br>      <span class="hljs-string">&quot;_source&quot;</span>: &#123;<span class="hljs-string">&quot;enabled&quot;</span>: <span class="hljs-literal">false</span>&#125;,<br>      <span class="hljs-string">&quot;properties&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;author&quot;</span> : &#123;<span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span>,<span class="hljs-string">&quot;store&quot;</span>: <span class="hljs-literal">true</span>&#125;,<br>        <span class="hljs-string">&quot;cover_url&quot;</span> : &#123;<span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span>,<span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-literal">false</span>,<span class="hljs-string">&quot;store&quot;</span>: <span class="hljs-literal">true</span>&#125;,<br>        <span class="hljs-string">&quot;description&quot;</span> : &#123;<span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span>,<span class="hljs-string">&quot;store&quot;</span>: <span class="hljs-literal">true</span>&#125;,<br>         <span class="hljs-string">&quot;content&quot;</span> : &#123;<span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span>,<span class="hljs-string">&quot;store&quot;</span>: <span class="hljs-literal">true</span>&#125;,<br>        <span class="hljs-string">&quot;public_date&quot;</span> : &#123;<span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;date&quot;</span>,<span class="hljs-string">&quot;store&quot;</span>: <span class="hljs-literal">true</span>&#125;,<br>        <span class="hljs-string">&quot;title&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span>,<br>          <span class="hljs-string">&quot;fields&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;keyword&quot;</span> : &#123;<br>              <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span>,<br>              <span class="hljs-string">&quot;ignore_above&quot;</span> : 100<br>            &#125;<br>          &#125;,<br>          <span class="hljs-string">&quot;store&quot;</span>: <span class="hljs-literal">true</span><br>        &#125;<br>      &#125;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment"># Index ä¸€æœ¬ä¹¦çš„ä¿¡æ¯,åŒ…å«Content</span><br>PUT books/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;title&quot;</span>:<span class="hljs-string">&quot;Mastering ElasticSearch 5.0&quot;</span>,<br>  <span class="hljs-string">&quot;description&quot;</span>:<span class="hljs-string">&quot;Master the searching, indexing, and aggregation features in ElasticSearch Improve usersâ€™ search experience with Elasticsearchâ€™s functionalities and develop your own Elasticsearch plugins&quot;</span>,<br>  <span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;The content of the book......Indexing data, aggregation, searching.    something else. something in the way............&quot;</span>,<br>  <span class="hljs-string">&quot;author&quot;</span>:<span class="hljs-string">&quot;Bharvi Dixit&quot;</span>,<br>  <span class="hljs-string">&quot;public_date&quot;</span>:<span class="hljs-string">&quot;2017&quot;</span>,<br>  <span class="hljs-string">&quot;cover_url&quot;</span>:<span class="hljs-string">&quot;https://images-na.ssl-images-amazon.com/images/I/51OeaMFxcML.jpg&quot;</span><br>&#125;<br><br><span class="hljs-comment">#æŸ¥è¯¢ç»“æœä¸­ï¼ŒSourceä¸åŒ…å«æ•°æ®</span><br>POST books/_search<br>&#123;&#125;<br><br><span class="hljs-comment">#æœç´¢ï¼Œé€šè¿‡store å­—æ®µæ˜¾ç¤ºæ•°æ®ï¼ŒåŒæ—¶é«˜äº®æ˜¾ç¤º conentçš„å†…å®¹</span><br>POST books/_search<br>&#123;<br>  <span class="hljs-string">&quot;stored_fields&quot;</span>: [<span class="hljs-string">&quot;title&quot;</span>,<span class="hljs-string">&quot;author&quot;</span>,<span class="hljs-string">&quot;public_date&quot;</span>],<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;searching&quot;</span><br>    &#125;<br>  &#125;,<br><br>  <span class="hljs-string">&quot;highlight&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;fields&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;content&quot;</span>:&#123;&#125;<br>    &#125;<br>  &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="7-6-Elasticsearch-æ•°æ®å»ºæ¨¡æœ€ä½³å®è·µ-md"><a href="#7-6-Elasticsearch-æ•°æ®å»ºæ¨¡æœ€ä½³å®è·µ-md" class="headerlink" title="7.6-Elasticsearch æ•°æ®å»ºæ¨¡æœ€ä½³å®è·µ.md"></a>7.6-Elasticsearch æ•°æ®å»ºæ¨¡æœ€ä½³å®è·µ.md</h1><h1 id="Elasticsearch-æ•°æ®å»ºæ¨¡æœ€ä½³å®è·µ"><a href="#Elasticsearch-æ•°æ®å»ºæ¨¡æœ€ä½³å®è·µ" class="headerlink" title="Elasticsearch æ•°æ®å»ºæ¨¡æœ€ä½³å®è·µ"></a>Elasticsearch æ•°æ®å»ºæ¨¡æœ€ä½³å®è·µ</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-comment">###### Cookie Service</span><br><br><span class="hljs-comment">##ç´¢å¼•æ•°æ®ï¼Œdynamic mapping ä¼šä¸æ–­åŠ å…¥æ–°å¢å­—æ®µ</span><br>PUT cookie_service/_doc/1<br>&#123;<br> <span class="hljs-string">&quot;url&quot;</span>:<span class="hljs-string">&quot;www.google.com&quot;</span>,<br> <span class="hljs-string">&quot;cookies&quot;</span>:&#123;<br>   <span class="hljs-string">&quot;username&quot;</span>:<span class="hljs-string">&quot;tom&quot;</span>,<br>   <span class="hljs-string">&quot;age&quot;</span>:32<br> &#125;<br>&#125;<br><br>PUT cookie_service/_doc/2<br>&#123;<br> <span class="hljs-string">&quot;url&quot;</span>:<span class="hljs-string">&quot;www.amazon.com&quot;</span>,<br> <span class="hljs-string">&quot;cookies&quot;</span>:&#123;<br>   <span class="hljs-string">&quot;login&quot;</span>:<span class="hljs-string">&quot;2019-01-01&quot;</span>,<br>   <span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;xyz@abc.com&quot;</span><br> &#125;<br>&#125;<br><br><br>DELETE cookie_service<br><span class="hljs-comment">#ä½¿ç”¨ Nested å¯¹è±¡ï¼Œå¢åŠ key/value</span><br>PUT cookie_service<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;cookies&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;nested&quot;</span>,<br>        <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;name&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span><br>          &#125;,<br>          <span class="hljs-string">&quot;dateValue&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;date&quot;</span><br>          &#125;,<br>          <span class="hljs-string">&quot;keywordValue&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span><br>          &#125;,<br>          <span class="hljs-string">&quot;IntValue&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;integer&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;,<br>      <span class="hljs-string">&quot;url&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>        <span class="hljs-string">&quot;fields&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;keyword&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span>,<br>            <span class="hljs-string">&quot;ignore_above&quot;</span>: 256<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">##å†™å…¥æ•°æ®ï¼Œä½¿ç”¨keyå’Œåˆé€‚ç±»å‹çš„valueå­—æ®µ</span><br>PUT cookie_service/_doc/1<br>&#123;<br> <span class="hljs-string">&quot;url&quot;</span>:<span class="hljs-string">&quot;www.google.com&quot;</span>,<br> <span class="hljs-string">&quot;cookies&quot;</span>:[<br>    &#123;<br>      <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;username&quot;</span>,<br>      <span class="hljs-string">&quot;keywordValue&quot;</span>:<span class="hljs-string">&quot;tom&quot;</span><br>    &#125;,<br>    &#123;<br>       <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;age&quot;</span>,<br>      <span class="hljs-string">&quot;intValue&quot;</span>:32<br><br>    &#125;<br><br>   ]<br> &#125;<br><br><br>PUT cookie_service/_doc/2<br>&#123;<br> <span class="hljs-string">&quot;url&quot;</span>:<span class="hljs-string">&quot;www.amazon.com&quot;</span>,<br> <span class="hljs-string">&quot;cookies&quot;</span>:[<br>    &#123;<br>      <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;login&quot;</span>,<br>      <span class="hljs-string">&quot;dateValue&quot;</span>:<span class="hljs-string">&quot;2019-01-01&quot;</span><br>    &#125;,<br>    &#123;<br>       <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;email&quot;</span>,<br>      <span class="hljs-string">&quot;IntValue&quot;</span>:32<br><br>    &#125;<br><br>   ]<br> &#125;<br><br><br><span class="hljs-comment"># Nested æŸ¥è¯¢ï¼Œé€šè¿‡boolæŸ¥è¯¢è¿›è¡Œè¿‡æ»¤</span><br>POST cookie_service/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;nested&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;cookies&quot;</span>,<br>      <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;filter&quot;</span>: [<br>            &#123;<br>            <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>              <span class="hljs-string">&quot;cookies.name&quot;</span>: <span class="hljs-string">&quot;age&quot;</span><br>            &#125;&#125;,<br>            &#123;<br>              <span class="hljs-string">&quot;range&quot;</span>:&#123;<br>                <span class="hljs-string">&quot;cookies.intValue&quot;</span>:&#123;<br>                  <span class="hljs-string">&quot;gte&quot;</span>:30<br>                &#125;<br>              &#125;<br>            &#125;<br>          ]<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br><span class="hljs-comment"># åœ¨Mappingä¸­åŠ å…¥å…ƒä¿¡æ¯ï¼Œä¾¿äºç®¡ç†</span><br>PUT softwares/<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;_meta&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;software_version_mapping&quot;</span>: <span class="hljs-string">&quot;1.0&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br>GET softwares/_mapping<br>PUT softwares/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;software_version&quot;</span>:<span class="hljs-string">&quot;7.1.0&quot;</span><br>&#125;<br><br>DELETE softwares<br><span class="hljs-comment"># ä¼˜åŒ–,ä½¿ç”¨inner object</span><br>PUT softwares/<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;_meta&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;software_version_mapping&quot;</span>: <span class="hljs-string">&quot;1.1&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;version&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;display_name&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span><br>          &#125;,<br>          <span class="hljs-string">&quot;hot_fix&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;byte&quot;</span><br>          &#125;,<br>          <span class="hljs-string">&quot;marjor&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;byte&quot;</span><br>          &#125;,<br>          <span class="hljs-string">&quot;minor&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;byte&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment">#é€šè¿‡ Inner Object å†™å…¥å¤šä¸ªæ–‡æ¡£</span><br>PUT softwares/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;version&quot;</span>:&#123;<br>  <span class="hljs-string">&quot;display_name&quot;</span>:<span class="hljs-string">&quot;7.1.0&quot;</span>,<br>  <span class="hljs-string">&quot;marjor&quot;</span>:7,<br>  <span class="hljs-string">&quot;minor&quot;</span>:1,<br>  <span class="hljs-string">&quot;hot_fix&quot;</span>:0  <br>  &#125;<br><br>&#125;<br><br>PUT softwares/_doc/2<br>&#123;<br>  <span class="hljs-string">&quot;version&quot;</span>:&#123;<br>  <span class="hljs-string">&quot;display_name&quot;</span>:<span class="hljs-string">&quot;7.2.0&quot;</span>,<br>  <span class="hljs-string">&quot;marjor&quot;</span>:7,<br>  <span class="hljs-string">&quot;minor&quot;</span>:2,<br>  <span class="hljs-string">&quot;hot_fix&quot;</span>:0  <br>  &#125;<br>&#125;<br><br>PUT softwares/_doc/3<br>&#123;<br>  <span class="hljs-string">&quot;version&quot;</span>:&#123;<br>  <span class="hljs-string">&quot;display_name&quot;</span>:<span class="hljs-string">&quot;7.2.1&quot;</span>,<br>  <span class="hljs-string">&quot;marjor&quot;</span>:7,<br>  <span class="hljs-string">&quot;minor&quot;</span>:2,<br>  <span class="hljs-string">&quot;hot_fix&quot;</span>:1  <br>  &#125;<br>&#125;<br><br><br><span class="hljs-comment"># é€šè¿‡ bool æŸ¥è¯¢ï¼Œ</span><br>POST softwares/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;filter&quot;</span>: [<br>        &#123;<br>          <span class="hljs-string">&quot;match&quot;</span>:&#123;<br>            <span class="hljs-string">&quot;version.marjor&quot;</span>:7<br>          &#125;<br>        &#125;,<br>        &#123;<br>          <span class="hljs-string">&quot;match&quot;</span>:&#123;<br>            <span class="hljs-string">&quot;version.minor&quot;</span>:2<br>          &#125;<br>        &#125;<br><br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br><br><br><br><br><span class="hljs-comment"># Not Null è§£å†³èšåˆçš„é—®é¢˜</span><br>DELETE ratings<br>PUT ratings<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;rating&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;float&quot;</span>,<br>          <span class="hljs-string">&quot;null_value&quot;</span>: 1.0<br>        &#125;<br>      &#125;<br>    &#125;<br>&#125;<br><br><br>PUT ratings/_doc/1<br>&#123;<br> <span class="hljs-string">&quot;rating&quot;</span>:5<br>&#125;<br>PUT ratings/_doc/2<br>&#123;<br> <span class="hljs-string">&quot;rating&quot;</span>:null<br>&#125;<br><br><br>POST ratings/_search<br>POST ratings/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;avg&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;avg&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;rating&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>POST ratings/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;rating&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;value&quot;</span>: 1<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="7-7-ç¬¬äºŒéƒ¨åˆ†æ€»ç»“ä¸æµ‹éªŒ-md"><a href="#7-7-ç¬¬äºŒéƒ¨åˆ†æ€»ç»“ä¸æµ‹éªŒ-md" class="headerlink" title="7.7-ç¬¬äºŒéƒ¨åˆ†æ€»ç»“ä¸æµ‹éªŒ.md"></a>7.7-ç¬¬äºŒéƒ¨åˆ†æ€»ç»“ä¸æµ‹éªŒ.md</h1><h1 id="ç¬¬äºŒéƒ¨åˆ†æ€»ç»“ä¸æµ‹éªŒ"><a href="#ç¬¬äºŒéƒ¨åˆ†æ€»ç»“ä¸æµ‹éªŒ" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†æ€»ç»“ä¸æµ‹éªŒ"></a>ç¬¬äºŒéƒ¨åˆ†æ€»ç»“ä¸æµ‹éªŒ</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE <span class="hljs-built_in">test</span><br>PUT <span class="hljs-built_in">test</span>/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;content&quot;</span>:<span class="hljs-string">&quot;Hello World&quot;</span><br>&#125;<br><br>POST <span class="hljs-built_in">test</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;Hello World&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br>POST <span class="hljs-built_in">test</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;hello world&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br>POST <span class="hljs-built_in">test</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;content.keyword&quot;</span>: <span class="hljs-string">&quot;Hello World&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br>POST <span class="hljs-built_in">test</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;content.keyword&quot;</span>: <span class="hljs-string">&quot;hello world&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br>POST <span class="hljs-built_in">test</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;Hello World&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br>POST <span class="hljs-built_in">test</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;hello world&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br>POST <span class="hljs-built_in">test</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;content.keyword&quot;</span>: <span class="hljs-string">&quot;Hello World&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br><br><br></code></pre></td></tr></table></figure><h1 id="8-1-é›†ç¾¤èº«ä»½è®¤è¯ä¸ç”¨æˆ·é‰´æƒ-md"><a href="#8-1-é›†ç¾¤èº«ä»½è®¤è¯ä¸ç”¨æˆ·é‰´æƒ-md" class="headerlink" title="8.1-é›†ç¾¤èº«ä»½è®¤è¯ä¸ç”¨æˆ·é‰´æƒ.md"></a>8.1-é›†ç¾¤èº«ä»½è®¤è¯ä¸ç”¨æˆ·é‰´æƒ.md</h1><h1 id="é›†ç¾¤èº«ä»½è®¤è¯ä¸ç”¨æˆ·é‰´æƒ"><a href="#é›†ç¾¤èº«ä»½è®¤è¯ä¸ç”¨æˆ·é‰´æƒ" class="headerlink" title="é›†ç¾¤èº«ä»½è®¤è¯ä¸ç”¨æˆ·é‰´æƒ"></a>é›†ç¾¤èº«ä»½è®¤è¯ä¸ç”¨æˆ·é‰´æƒ</h1><ul><li>å¦‚ä½•ä¸ºé›†ç¾¤å¯ç”¨X-Pack Security</li><li>å¦‚ä½•ä¸ºå†…ç½®ç”¨æˆ·è®¾ç½®å¯†ç </li><li>è®¾ç½® Kibanaä¸ElasticSearché€šä¿¡é‰´æƒ</li><li>ä½¿ç”¨å®‰å…¨APIåˆ›å»ºå¯¹ç‰¹å®šç´¢å¼•å…·æœ‰æœ‰é™è®¿é—®æƒé™çš„ç”¨æˆ·</li></ul><p>This tutorial involves a single node cluster, but if you had multiple nodes, you would enable Elasticsearch security features on every node in the cluster and configure Transport Layer Security (TLS) for internode-communication, which is beyond the scope of this tutorial. By enabling single-node discovery, we are postponing the configuration of TLS. For example, add the following setting:</p><p>discovery.type: single-node</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment">#å¯åŠ¨å•èŠ‚ç‚¹</span><br>bin/elasticsearch -E node.<span class="hljs-attribute">name</span>=node0 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node0_data -E http.<span class="hljs-attribute">port</span>=9200 -E xpack.security.<span class="hljs-attribute">enabled</span>=<span class="hljs-literal">true</span><br><br><span class="hljs-comment">#ä½¿ç”¨Curlè®¿é—®ESï¼Œæˆ–è€…æµè§ˆå™¨è®¿é—® â€œlocalhost:9200/_cat/nodes?prettyâ€ã€‚è¿”å›401é”™è¯¯</span><br>curl <span class="hljs-string">&#x27;localhost:9200/_cat/nodes?pretty&#x27;</span><br><br><span class="hljs-comment">#è¿è¡Œå¯†ç è®¾å®šçš„å‘½ä»¤ï¼Œè®¾ç½®ESå†…ç½®ç”¨æˆ·åŠå…¶åˆå§‹å¯†ç ã€‚</span><br>bin/elasticsearch-setup-passwords interactive<br><br>curl -u elastic <span class="hljs-string">&#x27;localhost:9200/_cat/nodes?pretty&#x27;</span><br><br><br><span class="hljs-comment"># ä¿®æ”¹ kibana.yml</span><br>elasticsearch.username: <span class="hljs-string">&quot;kibana&quot;</span><br>elasticsearch.password: <span class="hljs-string">&quot;changeme&quot;</span><br><br><span class="hljs-comment">#å¯åŠ¨ã€‚ä½¿ç”¨ç”¨æˆ·åï¼Œelasticï¼Œå¯†ç elastic</span><br>./bin/kibana<br><br><br>POST orders/_bulk<br>&#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>&#123;<span class="hljs-string">&quot;product&quot;</span> : <span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;price&quot;</span> : 18,<span class="hljs-string">&quot;payment&quot;</span> : <span class="hljs-string">&quot;master&quot;</span>,<span class="hljs-string">&quot;card&quot;</span> : <span class="hljs-string">&quot;9876543210123456&quot;</span>,<span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;jack&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>&#123;<span class="hljs-string">&quot;product&quot;</span> : <span class="hljs-string">&quot;2&quot;</span>,<span class="hljs-string">&quot;price&quot;</span> : 99,<span class="hljs-string">&quot;payment&quot;</span> : <span class="hljs-string">&quot;visa&quot;</span>,<span class="hljs-string">&quot;card&quot;</span> : <span class="hljs-string">&quot;1234567890123456&quot;</span>,<span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;bob&quot;</span>&#125;<br><br><br><span class="hljs-comment">#create a new role named read_only_orders, that satisfies the following criteria:</span><br><span class="hljs-comment">#The role has no cluster privileges</span><br><span class="hljs-comment">#The role only has access to indices that match the pattern sales_record</span><br><span class="hljs-comment">#The index privileges are read, and view_index_metadata</span><br><br><br><span class="hljs-comment">#create sales_user that satisfies the following criteria:</span><br><span class="hljs-comment"># Use your own email address</span><br><span class="hljs-comment"># Assign the user to two roles: read_only_orders and kibana_user</span><br><br><br><span class="hljs-comment">#éªŒè¯è¯»æƒé™,å¯ä»¥æ‰§è¡Œ</span><br>POST orders/_search<br>&#123;&#125;<br><br><span class="hljs-comment">#éªŒè¯å†™æƒé™,æŠ¥é”™</span><br>POST orders/_bulk<br>&#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>&#123;<span class="hljs-string">&quot;product&quot;</span> : <span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;price&quot;</span> : 18,<span class="hljs-string">&quot;payment&quot;</span> : <span class="hljs-string">&quot;master&quot;</span>,<span class="hljs-string">&quot;card&quot;</span> : <span class="hljs-string">&quot;9876543210123456&quot;</span>,<span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;jack&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;index&quot;</span>:&#123;&#125;&#125;<br>&#123;<span class="hljs-string">&quot;product&quot;</span> : <span class="hljs-string">&quot;2&quot;</span>,<span class="hljs-string">&quot;price&quot;</span> : 99,<span class="hljs-string">&quot;payment&quot;</span> : <span class="hljs-string">&quot;visa&quot;</span>,<span class="hljs-string">&quot;card&quot;</span> : <span class="hljs-string">&quot;1234567890123456&quot;</span>,<span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;bob&quot;</span>&#125;<br><br><br></code></pre></td></tr></table></figure><h1 id="8-2-é›†ç¾¤å†…éƒ¨å®‰å…¨é€šä¿¡-md"><a href="#8-2-é›†ç¾¤å†…éƒ¨å®‰å…¨é€šä¿¡-md" class="headerlink" title="8.2-é›†ç¾¤å†…éƒ¨å®‰å…¨é€šä¿¡.md"></a>8.2-é›†ç¾¤å†…éƒ¨å®‰å…¨é€šä¿¡.md</h1><h1 id="-3"><a href="#-3" class="headerlink" title=""></a></h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># ç”Ÿæˆè¯ä¹¦</span><br><span class="hljs-comment"># ä¸ºæ‚¨çš„Elasticearché›†ç¾¤åˆ›å»ºä¸€ä¸ªè¯ä¹¦é¢å‘æœºæ„ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨elasticsearch-certutil caå‘½ä»¤ï¼š</span><br>bin/elasticsearch-certutil ca<br><br><span class="hljs-comment">#ä¸ºç¾¤é›†ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆè¯ä¹¦å’Œç§é’¥ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨elasticsearch-certutil cert å‘½ä»¤ï¼š</span><br>bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12<br><br><span class="hljs-comment">#å°†è¯ä¹¦æ‹·è´åˆ° config/certsç›®å½•ä¸‹</span><br>elastic-certificates.p12<br><br><br>bin/elasticsearch -E node.<span class="hljs-attribute">name</span>=node0 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node0_data -E http.<span class="hljs-attribute">port</span>=9200 -E xpack.security.<span class="hljs-attribute">enabled</span>=<span class="hljs-literal">true</span> -E xpack.security.transport.ssl.<span class="hljs-attribute">enabled</span>=<span class="hljs-literal">true</span> -E xpack.security.transport.ssl.<span class="hljs-attribute">verification_mode</span>=certificate -E xpack.security.transport.ssl.keystore.<span class="hljs-attribute">path</span>=certs/elastic-certificates.p12 -E xpack.security.transport.ssl.truststore.<span class="hljs-attribute">path</span>=certs/elastic-certificates.p12<br><br>bin/elasticsearch -E node.<span class="hljs-attribute">name</span>=node1 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node1_data -E http.<span class="hljs-attribute">port</span>=9201 -E xpack.security.<span class="hljs-attribute">enabled</span>=<span class="hljs-literal">true</span> -E xpack.security.transport.ssl.<span class="hljs-attribute">enabled</span>=<span class="hljs-literal">true</span> -E xpack.security.transport.ssl.<span class="hljs-attribute">verification_mode</span>=certificate -E xpack.security.transport.ssl.keystore.<span class="hljs-attribute">path</span>=certs/elastic-certificates.p12 -E xpack.security.transport.ssl.truststore.<span class="hljs-attribute">path</span>=certs/elastic-certificates.p12<br><br><br><span class="hljs-comment">#ä¸æä¾›è¯ä¹¦çš„èŠ‚ç‚¹ï¼Œæ— æ³•åŠ å…¥</span><br>bin/elasticsearch -E node.<span class="hljs-attribute">name</span>=node2 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node2_data -E http.<span class="hljs-attribute">port</span>=9202 -E xpack.security.<span class="hljs-attribute">enabled</span>=<span class="hljs-literal">true</span> -E xpack.security.transport.ssl.<span class="hljs-attribute">enabled</span>=<span class="hljs-literal">true</span> -E xpack.security.transport.ssl.<span class="hljs-attribute">verification_mode</span>=certificate<br><br><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># elasticsearch.yml é…ç½®</span></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">xpack.security.transport.ssl.enabled: <span class="hljs-literal">true</span></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">xpack.security.transport.ssl.verification_mode: certificate</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">xpack.security.transport.ssl.keystore.path: certs/elastic-certificates.p12</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">xpack.security.transport.ssl.truststore.path: certs/elastic-certificates.p12</span><br><br><br></code></pre></td></tr></table></figure><h1 id="8-3-é›†ç¾¤ä¸å¤–éƒ¨é—´çš„å®‰å…¨é€šä¿¡-md"><a href="#8-3-é›†ç¾¤ä¸å¤–éƒ¨é—´çš„å®‰å…¨é€šä¿¡-md" class="headerlink" title="8.3-é›†ç¾¤ä¸å¤–éƒ¨é—´çš„å®‰å…¨é€šä¿¡.md"></a>8.3-é›†ç¾¤ä¸å¤–éƒ¨é—´çš„å®‰å…¨é€šä¿¡.md</h1><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">xpack<span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.http</span><span class="hljs-selector-class">.ssl</span><span class="hljs-selector-class">.enabled</span>: true<br>xpack<span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.http</span><span class="hljs-selector-class">.ssl</span><span class="hljs-selector-class">.keystore</span><span class="hljs-selector-class">.path</span>: certs/elastic-certificates<span class="hljs-selector-class">.p12</span><br>xpack<span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.http</span><span class="hljs-selector-class">.ssl</span><span class="hljs-selector-class">.truststore</span><span class="hljs-selector-class">.path</span>: certs/elastic-certificates<span class="hljs-selector-class">.p12</span><br><br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br><br><span class="hljs-comment"># ES å¯ç”¨ https</span><br>bin/elasticsearch -E node.<span class="hljs-attribute">name</span>=node0 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node0_data -E http.<span class="hljs-attribute">port</span>=9200 -E xpack.security.<span class="hljs-attribute">enabled</span>=<span class="hljs-literal">true</span> -E xpack.security.transport.ssl.<span class="hljs-attribute">enabled</span>=<span class="hljs-literal">true</span> -E xpack.security.transport.ssl.<span class="hljs-attribute">verification_mode</span>=certificate -E xpack.security.transport.ssl.keystore.<span class="hljs-attribute">path</span>=certs/elastic-certificates.p12 -E xpack.security.http.ssl.<span class="hljs-attribute">enabled</span>=<span class="hljs-literal">true</span> -E xpack.security.http.ssl.keystore.<span class="hljs-attribute">path</span>=certs/elastic-certificates.p12 -E xpack.security.http.ssl.truststore.<span class="hljs-attribute">path</span>=certs/elastic-certificates.p12<br><br></code></pre></td></tr></table></figure><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-meta">#Kibana è¿æ¥ ES https</span><br><br><br><br><span class="hljs-meta"># ä¸ºkibanaç”Ÿæˆpem</span><br>openssl pkcs12 -<span class="hljs-keyword">in</span> elastic-certificates.p12 -cacerts -nokeys -<span class="hljs-keyword">out</span> elastic-ca.pem<br><br><br><span class="hljs-symbol">elasticsearch.hosts:</span> [<span class="hljs-string">&quot;https://localhost:9200&quot;</span>]<br><span class="hljs-symbol">elasticsearch.ssl.certificateAuthorities:</span> [ <span class="hljs-string">&quot;/Users/yiruan/geektime/kibana-7.1.0/config/certs/elastic-ca.pem&quot;</span> ]<br><span class="hljs-symbol">elasticsearch.ssl.verificationMode:</span> certificate<br><br><br><br><span class="hljs-meta"># ä¸º Kibna é…ç½® HTTPS</span><br><span class="hljs-meta"># ç”Ÿæˆåè§£å‹ï¼ŒåŒ…å«äº†instance.crt å’Œ instance.key</span><br>bin/elasticsearch-certutil ca --pem<br><br><span class="hljs-symbol">server.ssl.enabled:</span> true<br><span class="hljs-symbol">server.ssl.certificate:</span> config/certs/instance.crt<br><span class="hljs-symbol">server.ssl.key:</span> config/certs/instance.key<br><br><br></code></pre></td></tr></table></figure><h1 id="9-1-å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼-md-1"><a href="#9-1-å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼-md-1" class="headerlink" title="9.1-å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼.md"></a>9.1-å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼.md</h1><h1 id="å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼-1"><a href="#å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼-1" class="headerlink" title="å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼"></a>å¸¸è§çš„é›†ç¾¤éƒ¨ç½²æ–¹å¼</h1><h1 id="9-2-Hot-Warmæ¶æ„ä¸ShardFiltering-md-1"><a href="#9-2-Hot-Warmæ¶æ„ä¸ShardFiltering-md-1" class="headerlink" title="9.2-Hot&amp;Warmæ¶æ„ä¸ShardFiltering.md"></a>9.2-Hot&amp;Warmæ¶æ„ä¸ShardFiltering.md</h1><h1 id="Hot-Warm-æ¶æ„ä¸-Shard-Filtering-1"><a href="#Hot-Warm-æ¶æ„ä¸-Shard-Filtering-1" class="headerlink" title="Hot &amp; Warm æ¶æ„ä¸ Shard Filtering"></a>Hot &amp; Warm æ¶æ„ä¸ Shard Filtering</h1><h2 id="è¯¾ç¨‹ä»£ç -1"><a href="#è¯¾ç¨‹ä»£ç -1" class="headerlink" title="è¯¾ç¨‹ä»£ç "></a>è¯¾ç¨‹ä»£ç </h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># æ ‡è®°ä¸€ä¸ª Hot èŠ‚ç‚¹</span><br>bin/elasticsearch  -E node.<span class="hljs-attribute">name</span>=hotnode -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=hot_data -E node.attr.<span class="hljs-attribute">my_node_type</span>=hot<br><br><span class="hljs-comment"># æ ‡è®°ä¸€ä¸ª warm èŠ‚ç‚¹</span><br>bin/elasticsearch  -E node.<span class="hljs-attribute">name</span>=warmnode -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=warm_data -E node.attr.<span class="hljs-attribute">my_node_type</span>=warm<br><br><span class="hljs-comment"># æŸ¥çœ‹èŠ‚ç‚¹</span><br><span class="hljs-built_in">GET</span> /_cat/nodeattrs?v<br><br><span class="hljs-comment"># é…ç½®åˆ° HotèŠ‚ç‚¹</span><br>PUT logs-2019-06-27<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>:2,<br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span>:0,<br>    <span class="hljs-string">&quot;index.routing.allocation.require.my_node_type&quot;</span>:<span class="hljs-string">&quot;hot&quot;</span><br>  &#125;<br>&#125;<br><br><br><br>PUT my_index1/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;value&quot;</span><br>&#125;<br><br><br><br><span class="hljs-built_in">GET</span> _cat/shards?v<br><br><br><span class="hljs-comment"># é…ç½®åˆ° warm èŠ‚ç‚¹</span><br>PUT PUT logs-2019-06-27/_settings<br>&#123;  <br>  <span class="hljs-string">&quot;index.routing.allocation.require.my_node_type&quot;</span>:<span class="hljs-string">&quot;warm&quot;</span><br>&#125;<br><br><br><span class="hljs-comment"># æ ‡è®°ä¸€ä¸ª rack 1</span><br>bin/elasticsearch  -E node.<span class="hljs-attribute">name</span>=node1 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node1_data -E node.attr.<span class="hljs-attribute">my_rack_id</span>=rack1<br><br><span class="hljs-comment"># æ ‡è®°ä¸€ä¸ª rack 2</span><br>bin/elasticsearch  -E node.<span class="hljs-attribute">name</span>=node2 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node2_data -E node.attr.<span class="hljs-attribute">my_rack_id</span>=rack2<br><br>PUT _cluster<span class="hljs-built_in">/settings</span><br><span class="hljs-built_in"></span>&#123;<br>  <span class="hljs-string">&quot;persistent&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;cluster.routing.allocation.awareness.attributes&quot;</span>: <span class="hljs-string">&quot;my_rack_id&quot;</span><br>  &#125;<br>&#125;<br><br>PUT my_index1<br>&#123;<br>  <span class="hljs-string">&quot;settings&quot;</span>:&#123;<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>:2,<br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span>:1<br>  &#125;<br>&#125;<br><br>PUT my_index1/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;key&quot;</span>:<span class="hljs-string">&quot;value&quot;</span><br>&#125;<br><br><br><span class="hljs-built_in">GET</span> _cat/shards?v<br>DELETE my_index1/_doc/1<br><br><br><br><span class="hljs-comment"># Fore awareness</span><br><span class="hljs-comment"># æ ‡è®°ä¸€ä¸ª rack 1</span><br>bin/elasticsearch  -E node.<span class="hljs-attribute">name</span>=node1 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node1_data -E node.attr.<span class="hljs-attribute">my_rack_id</span>=rack1<br><br><span class="hljs-comment"># æ ‡è®°ä¸€ä¸ª rack 2</span><br>bin/elasticsearch  -E node.<span class="hljs-attribute">name</span>=node2 -E cluster.<span class="hljs-attribute">name</span>=geektime -E path.<span class="hljs-attribute">data</span>=node2_data -E node.attr.<span class="hljs-attribute">my_rack_id</span>=rack1<br><br><br>PUT _cluster<span class="hljs-built_in">/settings</span><br><span class="hljs-built_in"></span>&#123;<br>  <span class="hljs-string">&quot;persistent&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;cluster.routing.allocation.awareness.attributes&quot;</span>: <span class="hljs-string">&quot;my_rack_id&quot;</span>,<br>    <span class="hljs-string">&quot;cluster.routing.allocation.awareness.force.my_rack_id.values&quot;</span>: <span class="hljs-string">&quot;rack1,rack2&quot;</span><br>  &#125;<br>&#125;<br><span class="hljs-built_in">GET</span> _cluster<span class="hljs-built_in">/settings</span><br><span class="hljs-built_in"></span><br><span class="hljs-comment"># é›†ç¾¤é»„è‰²</span><br><span class="hljs-built_in">GET</span> _cluster<span class="hljs-built_in">/health</span><br><span class="hljs-built_in"></span><br><span class="hljs-comment"># å‰¯æœ¬æ— æ³•åˆ†é…</span><br><span class="hljs-built_in">GET</span> _cat/shards?v<br><br><br><span class="hljs-built_in">GET</span> _cluster/allocation/explain?pretty<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>elasticsearch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>eså¸¸ç”¨å‘½ä»¤</title>
    <link href="/elasticsearch/es%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/elasticsearch/es%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<p>ä»¥ä¸‹æ˜¯ Elasticsearch (ES) å¸¸ç”¨å‘½ä»¤çš„æ€»ç»“å’Œç¬”è®°ï¼š</p><h3 id="1-æŸ¥çœ‹ç´¢å¼•ç›¸å…³ä¿¡æ¯"><a href="#1-æŸ¥çœ‹ç´¢å¼•ç›¸å…³ä¿¡æ¯" class="headerlink" title="1. æŸ¥çœ‹ç´¢å¼•ç›¸å…³ä¿¡æ¯"></a>1. æŸ¥çœ‹ç´¢å¼•ç›¸å…³ä¿¡æ¯</h3><ul><li><p><strong>æŸ¥çœ‹æŒ‡å®šç´¢å¼•çš„æ˜ å°„ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET kibana_sample_data_ecommerce<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹æŒ‡å®šç´¢å¼•çš„æ–‡æ¡£æ€»æ•°</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET kibana_sample_data_ecommerce/_count<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹å‰10æ¡æ–‡æ¡£</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST kibana_sample_data_ecommerce/_search<br>&#123;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="2-æŸ¥çœ‹ç´¢å¼•çŠ¶æ€ä¸ä¿¡æ¯"><a href="#2-æŸ¥çœ‹ç´¢å¼•çŠ¶æ€ä¸ä¿¡æ¯" class="headerlink" title="2. æŸ¥çœ‹ç´¢å¼•çŠ¶æ€ä¸ä¿¡æ¯"></a>2. æŸ¥çœ‹ç´¢å¼•çŠ¶æ€ä¸ä¿¡æ¯</h3><ul><li><p><strong>æŸ¥çœ‹ç´¢å¼•ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cat/indices/kibana*?v&amp;s=index<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹çŠ¶æ€ä¸ºç»¿çš„ç´¢å¼•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cat/indices?v&amp;health=green<br></code></pre></td></tr></table></figure></li><li><p><strong>æŒ‰æ–‡æ¡£ä¸ªæ•°æ’åºæŸ¥çœ‹ç´¢å¼•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cat/indices?v&amp;s=docs.count:desc<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹å…·ä½“çš„ç´¢å¼•å­—æ®µï¼ˆå¥åº·ã€ä¸»åˆ†ç‰‡ã€å¤åˆ¶åˆ†ç‰‡ã€æ–‡æ¡£æ•°ç­‰ï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cat/indices/kibana*?pri&amp;v&amp;h=health,index,pri,rep,docs.count,mt<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹æ¯ä¸ªç´¢å¼•ä½¿ç”¨çš„å†…å­˜é‡</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cat/indices?v&amp;h=i,tm&amp;s=tm:desc<br></code></pre></td></tr></table></figure></li></ul><h3 id="3-æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯"><a href="#3-æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯" class="headerlink" title="3. æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯"></a>3. æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯</h3><ul><li><p><strong>æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _cat/nodes?v<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹ç‰¹å®šèŠ‚ç‚¹ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_nodes/es7_01,es7_02<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯å¹¶æ˜¾ç¤ºç‰¹å®šå­—æ®µ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cat/nodes?v&amp;h=<span class="hljs-built_in">id</span>,ip,port,v,m<br></code></pre></td></tr></table></figure></li></ul><h3 id="4-æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶å†µ"><a href="#4-æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶å†µ" class="headerlink" title="4. æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶å†µ"></a>4. æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶å†µ</h3><ul><li><p><strong>æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶å†µ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _cluster/health<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶å†µï¼Œå¹¶æŒ‰åˆ†ç‰‡çº§åˆ«æ˜¾ç¤º</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _cluster/health?level=shards<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹ç‰¹å®šç´¢å¼•çš„é›†ç¾¤å¥åº·çŠ¶å†µ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cluster/health/kibana_sample_data_ecommerce,kibana_sample_data_flights<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹ç‰¹å®šç´¢å¼•çš„é›†ç¾¤å¥åº·çŠ¶å†µï¼Œå¹¶æŒ‰åˆ†ç‰‡çº§åˆ«æ˜¾ç¤º</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cluster/health/kibana_sample_data_flights?level=shards<br></code></pre></td></tr></table></figure></li></ul><h3 id="5-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"><a href="#5-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€" class="headerlink" title="5. æŸ¥çœ‹é›†ç¾¤çŠ¶æ€"></a>5. æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</h3><ul><li><strong>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cluster/state<br></code></pre></td></tr></table></figure></li></ul><h3 id="6-æŸ¥çœ‹é›†ç¾¤è®¾ç½®"><a href="#6-æŸ¥çœ‹é›†ç¾¤è®¾ç½®" class="headerlink" title="6. æŸ¥çœ‹é›†ç¾¤è®¾ç½®"></a>6. æŸ¥çœ‹é›†ç¾¤è®¾ç½®</h3><ul><li><p><strong>æŸ¥çœ‹é›†ç¾¤è®¾ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cluster/settings<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹é›†ç¾¤è®¾ç½®ï¼ŒåŒ…æ‹¬é»˜è®¤è®¾ç½®</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cluster/settings?include_defaults=<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="7-æŸ¥çœ‹åˆ†ç‰‡ä¿¡æ¯"><a href="#7-æŸ¥çœ‹åˆ†ç‰‡ä¿¡æ¯" class="headerlink" title="7. æŸ¥çœ‹åˆ†ç‰‡ä¿¡æ¯"></a>7. æŸ¥çœ‹åˆ†ç‰‡ä¿¡æ¯</h3><ul><li><p><strong>æŸ¥çœ‹é›†ç¾¤çš„æ‰€æœ‰åˆ†ç‰‡ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cat/shards<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹ç‰¹å®šçš„åˆ†ç‰‡ä¿¡æ¯ï¼ˆåŒ…æ‹¬çŠ¶æ€ã€ä¸»åˆ†ç‰‡&#x2F;å‰¯æœ¬åˆ†ç‰‡ç­‰ï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_cat/shards?h=index,shard,prirep,state,unassigned.reason<br></code></pre></td></tr></table></figure></li></ul><h3 id="1-åˆ›å»ºæ–‡æ¡£"><a href="#1-åˆ›å»ºæ–‡æ¡£" class="headerlink" title="1. åˆ›å»ºæ–‡æ¡£"></a>1. åˆ›å»ºæ–‡æ¡£</h3><ul><li><p><strong>è‡ªåŠ¨ç”Ÿæˆ <code>_id</code> åˆ›å»ºæ–‡æ¡£</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST <span class="hljs-built_in">users</span>/_doc<br>&#123;<br>  <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Mike&quot;</span>,<br>  <span class="hljs-string">&quot;post_date&quot;</span> : <span class="hljs-string">&quot;2019-04-15T14:12:12&quot;</span>,<br>  <span class="hljs-string">&quot;message&quot;</span> : <span class="hljs-string">&quot;trying out Kibana&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>æŒ‡å®š ID åˆ›å»ºæ–‡æ¡£ï¼ˆå¦‚æœ ID å·²å­˜åœ¨åˆ™æŠ¥é”™ï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT <span class="hljs-built_in">users</span>/_doc/1?op_type=create<br>&#123;<br>  <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Jack&quot;</span>,<br>  <span class="hljs-string">&quot;post_date&quot;</span> : <span class="hljs-string">&quot;2019-05-15T14:12:12&quot;</span>,<br>  <span class="hljs-string">&quot;message&quot;</span> : <span class="hljs-string">&quot;trying out Elasticsearch&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>æŒ‡å®š ID åˆ›å»ºæ–‡æ¡£ï¼ˆå¦‚æœ ID å·²å­˜åœ¨åˆ™æŠ¥é”™ï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT <span class="hljs-built_in">users</span>/_create/1<br>&#123;<br>  <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Jack&quot;</span>,<br>  <span class="hljs-string">&quot;post_date&quot;</span> : <span class="hljs-string">&quot;2019-05-15T14:12:12&quot;</span>,<br>  <span class="hljs-string">&quot;message&quot;</span> : <span class="hljs-string">&quot;trying out Elasticsearch&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="2-æ ¹æ®-ID-è·å–æ–‡æ¡£"><a href="#2-æ ¹æ®-ID-è·å–æ–‡æ¡£" class="headerlink" title="2. æ ¹æ® ID è·å–æ–‡æ¡£"></a>2. æ ¹æ® ID è·å–æ–‡æ¡£</h3><ul><li><strong>è·å–æŒ‡å®š ID çš„æ–‡æ¡£</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET <span class="hljs-built_in">users</span>/_doc/1<br></code></pre></td></tr></table></figure></li></ul><h3 id="3-æ›´æ–°æ–‡æ¡£"><a href="#3-æ›´æ–°æ–‡æ¡£" class="headerlink" title="3. æ›´æ–°æ–‡æ¡£"></a>3. æ›´æ–°æ–‡æ¡£</h3><ul><li><p><strong>æ›´æ–°æŒ‡å®š ID çš„æ–‡æ¡£ï¼ˆå…ˆåˆ é™¤å†å†™å…¥ï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT <span class="hljs-built_in">users</span>/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;user&quot;</span> : <span class="hljs-string">&quot;Mike&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>åœ¨åŸæ–‡æ¡£ä¸Šå¢åŠ å­—æ®µ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST <span class="hljs-built_in">users</span>/_update/1/<br>&#123;<br>  <span class="hljs-string">&quot;doc&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;post_date&quot;</span> : <span class="hljs-string">&quot;2019-05-15T14:12:12&quot;</span>,<br>    <span class="hljs-string">&quot;message&quot;</span> : <span class="hljs-string">&quot;trying out Elasticsearch&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="4-åˆ é™¤æ–‡æ¡£"><a href="#4-åˆ é™¤æ–‡æ¡£" class="headerlink" title="4. åˆ é™¤æ–‡æ¡£"></a>4. åˆ é™¤æ–‡æ¡£</h3><ul><li><strong>æ ¹æ® ID åˆ é™¤æ–‡æ¡£</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE <span class="hljs-built_in">users</span>/_doc/1<br></code></pre></td></tr></table></figure></li></ul><h3 id="5-æ‰¹é‡æ“ä½œ-Bulk-API"><a href="#5-æ‰¹é‡æ“ä½œ-Bulk-API" class="headerlink" title="5. æ‰¹é‡æ“ä½œ (Bulk API)"></a>5. æ‰¹é‡æ“ä½œ (Bulk API)</h3><ul><li><strong>æ‰§è¡Œæ‰¹é‡æ“ä½œ</strong><br>ç¬¬ä¸€æ¬¡æ‰§è¡Œæ‰¹é‡æ“ä½œï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _bulk<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123; <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;1&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;field1&quot;</span> : <span class="hljs-string">&quot;value1&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;delete&quot;</span> : &#123; <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;2&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;create&quot;</span> : &#123; <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;test2&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;3&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;field1&quot;</span> : <span class="hljs-string">&quot;value3&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;update&quot;</span> : &#123;<span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;test&quot;</span>&#125; &#125;<br>&#123; <span class="hljs-string">&quot;doc&quot;</span> : &#123;<span class="hljs-string">&quot;field2&quot;</span> : <span class="hljs-string">&quot;value2&quot;</span>&#125; &#125;<br></code></pre></td></tr></table></figure>ç¬¬äºŒæ¬¡æ‰§è¡Œæ‰¹é‡æ“ä½œï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _bulk<br>&#123; <span class="hljs-string">&quot;index&quot;</span> : &#123; <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;1&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;field1&quot;</span> : <span class="hljs-string">&quot;value1&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;delete&quot;</span> : &#123; <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;2&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;create&quot;</span> : &#123; <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;test2&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;3&quot;</span> &#125; &#125;<br>&#123; <span class="hljs-string">&quot;field1&quot;</span> : <span class="hljs-string">&quot;value3&quot;</span> &#125;<br>&#123; <span class="hljs-string">&quot;update&quot;</span> : &#123;<span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;test&quot;</span>&#125; &#125;<br>&#123; <span class="hljs-string">&quot;doc&quot;</span> : &#123;<span class="hljs-string">&quot;field2&quot;</span> : <span class="hljs-string">&quot;value2&quot;</span>&#125; &#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="6-å¤šæ–‡æ¡£è·å–-MGET"><a href="#6-å¤šæ–‡æ¡£è·å–-MGET" class="headerlink" title="6. å¤šæ–‡æ¡£è·å– (MGET)"></a>6. å¤šæ–‡æ¡£è·å– (MGET)</h3><ul><li><p><strong>è·å–å¤šä¸ªæ–‡æ¡£</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_mget<br>&#123;<br>  <span class="hljs-string">&quot;docs&quot;</span> : [<br>    &#123; <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;1&quot;</span> &#125;,<br>    &#123; <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;2&quot;</span> &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>URIä¸­æŒ‡å®šç´¢å¼•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /test/_mget<br>&#123;<br>  <span class="hljs-string">&quot;docs&quot;</span> : [<br>    &#123; <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;1&quot;</span> &#125;,<br>    &#123; <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;2&quot;</span> &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨ <code>_source</code> å‚æ•°æŒ‡å®šè¿”å›çš„å­—æ®µ</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_mget<br>&#123;<br>  <span class="hljs-string">&quot;docs&quot;</span> : [<br>    &#123; <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-string">&quot;_source&quot;</span> : <span class="hljs-literal">false</span> &#125;,<br>    &#123; <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;_source&quot;</span> : [<span class="hljs-string">&quot;field3&quot;</span>, <span class="hljs-string">&quot;field4&quot;</span>] &#125;,<br>    &#123; <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;test&quot;</span>, <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;3&quot;</span>, <span class="hljs-string">&quot;_source&quot;</span> : &#123; <span class="hljs-string">&quot;include&quot;</span>: [<span class="hljs-string">&quot;user&quot;</span>], <span class="hljs-string">&quot;exclude&quot;</span>: [<span class="hljs-string">&quot;user.location&quot;</span>] &#125; &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="7-å¤šæŸ¥è¯¢æ“ä½œ-MSEARCH"><a href="#7-å¤šæŸ¥è¯¢æ“ä½œ-MSEARCH" class="headerlink" title="7. å¤šæŸ¥è¯¢æ“ä½œ (MSEARCH)"></a>7. å¤šæŸ¥è¯¢æ“ä½œ (MSEARCH)</h3><ul><li><strong>æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST kibana_sample_data_ecommerce/_msearch<br>&#123;&#125;<br>&#123;<span class="hljs-string">&quot;query&quot;</span> : &#123;<span class="hljs-string">&quot;match_all&quot;</span> : &#123;&#125;&#125;,<span class="hljs-string">&quot;size&quot;</span>:1&#125;<br>&#123;<span class="hljs-string">&quot;index&quot;</span> : <span class="hljs-string">&quot;kibana_sample_data_flights&quot;</span>&#125;<br>&#123;<span class="hljs-string">&quot;query&quot;</span> : &#123;<span class="hljs-string">&quot;match_all&quot;</span> : &#123;&#125;&#125;,<span class="hljs-string">&quot;size&quot;</span>:2&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="8-æ¸…é™¤æµ‹è¯•æ•°æ®"><a href="#8-æ¸…é™¤æµ‹è¯•æ•°æ®" class="headerlink" title="8. æ¸…é™¤æµ‹è¯•æ•°æ®"></a>8. æ¸…é™¤æµ‹è¯•æ•°æ®</h3><ul><li><strong>åˆ é™¤ç´¢å¼•ï¼ˆæ¸…é™¤æ•°æ®ï¼‰</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE <span class="hljs-built_in">users</span><br>DELETE <span class="hljs-built_in">test</span><br>DELETE test2<br></code></pre></td></tr></table></figure></li></ul><p>[3.4-å€’æ’ç´¢å¼•å…¥é—¨]</p><p>Elasticsearch çš„ <code>_analyze</code> APIï¼Œå®ƒç”¨äºåˆ†ææ–‡æœ¬ï¼ŒæŸ¥çœ‹åœ¨ç‰¹å®šåˆ†æå™¨ä¸‹ï¼Œæ–‡æœ¬æ˜¯å¦‚ä½•è¢«åˆ†è¯å’Œå¤„ç†çš„ã€‚ä¸‹é¢æ˜¯æ¯ä¸ªè¯·æ±‚çš„è¯´æ˜ï¼š</p><h3 id="1-åˆ†æ-â€œMastering-Elasticsearchâ€"><a href="#1-åˆ†æ-â€œMastering-Elasticsearchâ€" class="headerlink" title="1. åˆ†æ â€œMastering Elasticsearchâ€"></a>1. <strong>åˆ†æ â€œMastering Elasticsearchâ€</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;standard&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;Mastering Elasticsearch&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>åˆ†æå™¨</strong>ï¼šä½¿ç”¨é»˜è®¤çš„ <code>standard</code> åˆ†æå™¨ã€‚</li><li><strong>æ–‡æœ¬</strong>ï¼š<code>&quot;Mastering Elasticsearch&quot;</code>ã€‚</li><li><strong>é¢„æœŸæ•ˆæœ</strong>ï¼š<code>standard</code> åˆ†æå™¨ä¼šå°†è¿™æ®µæ–‡æœ¬åˆ†å‰²æˆå•è¯ï¼Œé€šå¸¸ä¼šæ ¹æ®ç©ºæ ¼å’Œæ ‡ç‚¹ç¬¦å·è¿›è¡Œåˆ†è¯ã€‚</li></ul><h3 id="2-åˆ†æ-â€œElasticsearch-Serverâ€"><a href="#2-åˆ†æ-â€œElasticsearch-Serverâ€" class="headerlink" title="2. åˆ†æ â€œElasticsearch Serverâ€"></a>2. <strong>åˆ†æ â€œElasticsearch Serverâ€</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;standard&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;Elasticsearch Server&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>åˆ†æå™¨</strong>ï¼šåŒæ ·ä½¿ç”¨ <code>standard</code> åˆ†æå™¨ã€‚</li><li><strong>æ–‡æœ¬</strong>ï¼š<code>&quot;Elasticsearch Server&quot;</code>ã€‚</li><li><strong>é¢„æœŸæ•ˆæœ</strong>ï¼šåˆ†æå™¨ä¼šåˆ†å‰²æ–‡æœ¬ä¸ºå•è¯ï¼Œå¯èƒ½ä¼šå¾—åˆ°ç±»ä¼¼äº <code>[&quot;elasticsearch&quot;, &quot;server&quot;]</code> çš„åˆ†è¯ç»“æœã€‚</li></ul><h3 id="3-åˆ†æ-â€œElasticsearch-Essentialsâ€"><a href="#3-åˆ†æ-â€œElasticsearch-Essentialsâ€" class="headerlink" title="3. åˆ†æ â€œElasticsearch Essentialsâ€"></a>3. <strong>åˆ†æ â€œElasticsearch Essentialsâ€</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;standard&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;Elasticsearch Essentials&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>åˆ†æå™¨</strong>ï¼šç»§ç»­ä½¿ç”¨ <code>standard</code> åˆ†æå™¨ã€‚</li><li><strong>æ–‡æœ¬</strong>ï¼š<code>&quot;Elasticsearch Essentials&quot;</code>ã€‚</li><li><strong>é¢„æœŸæ•ˆæœ</strong>ï¼šåˆ†æå™¨ä¼šå°†æ–‡æœ¬åˆ†å‰²æˆ <code>[&quot;elasticsearch&quot;, &quot;essentials&quot;]</code>ã€‚</li></ul><h3 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><p>æ¯ä¸ªè¯·æ±‚çš„ç»“æœå°†æ˜¾ç¤ºç”± <code>standard</code> åˆ†æå™¨ç”Ÿæˆçš„åˆ†è¯ç»“æœã€‚é€šå¸¸ï¼Œ<code>standard</code> åˆ†æå™¨ä¼šå»é™¤å¤§éƒ¨åˆ†æ ‡ç‚¹ç¬¦å·å¹¶å°†æ–‡æœ¬è½¬æ¢ä¸ºå°å†™ã€‚åˆ†è¯çš„å…·ä½“ç»“æœå¦‚ä¸‹ï¼š</p><ul><li><code>&quot;Mastering Elasticsearch&quot;</code> -&gt; <code>[&quot;mastering&quot;, &quot;elasticsearch&quot;]</code></li><li><code>&quot;Elasticsearch Server&quot;</code> -&gt; <code>[&quot;elasticsearch&quot;, &quot;server&quot;]</code></li><li><code>&quot;Elasticsearch Essentials&quot;</code> -&gt; <code>[&quot;elasticsearch&quot;, &quot;essentials&quot;]</code></li></ul><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ä¸åŒçš„åˆ†æå™¨ï¼ˆAnalyzerï¼‰å¯¹æ–‡æœ¬è¿›è¡Œåˆ†è¯åˆ†æçš„ç¤ºä¾‹ï¼š</p><h3 id="1-Standard-Analyzer"><a href="#1-Standard-Analyzer" class="headerlink" title="1. Standard Analyzer"></a>1. <strong>Standard Analyzer</strong></h3><p>æ ‡å‡†åˆ†æå™¨ä¼šæ ¹æ®ç©ºæ ¼ã€æ ‡ç‚¹ç¬¦å·ç­‰è¿›è¡Œåˆ†è¯ï¼Œå¹¶å°†æ‰€æœ‰æ–‡æœ¬è½¬æ¢ä¸ºå°å†™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;standard&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;</span><br>&#125;<br><br>&#123;<br>  <span class="hljs-string">&quot;tokens&quot;</span> : [<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;2&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 0,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 1,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;&lt;NUM&gt;&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 0<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;running&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 2,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 9,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;&lt;ALPHANUM&gt;&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 1<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;quick&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 10,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 15,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;&lt;ALPHANUM&gt;&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 2<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;brown&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 16,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 21,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;&lt;ALPHANUM&gt;&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 3<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;foxes&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 22,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 27,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;&lt;ALPHANUM&gt;&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 4<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;leap&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 28,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 32,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;&lt;ALPHANUM&gt;&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 5<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;over&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 33,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 37,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;&lt;ALPHANUM&gt;&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 6<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;lazy&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 38,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 42,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;&lt;ALPHANUM&gt;&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 7<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;dogs&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 43,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 47,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;&lt;ALPHANUM&gt;&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 8<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;in&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 48,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 50,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;&lt;ALPHANUM&gt;&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 9<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;the&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 51,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 54,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;&lt;ALPHANUM&gt;&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 10<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;summer&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 55,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 61,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;&lt;ALPHANUM&gt;&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 11<br>    &#125;,<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : <span class="hljs-string">&quot;evening&quot;</span>,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 62,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 69,<br>      <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;&lt;ALPHANUM&gt;&quot;</span>,<br>      <span class="hljs-string">&quot;position&quot;</span> : 12<br>    &#125;<br>  ]<br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li><strong>åˆ†è¯ç»“æœ</strong>ï¼š<code>[&quot;2&quot;, &quot;running&quot;, &quot;quick&quot;, &quot;brown&quot;, &quot;foxes&quot;, &quot;leap&quot;, &quot;over&quot;, &quot;lazy&quot;, &quot;dogs&quot;, &quot;in&quot;, &quot;the&quot;, &quot;summer&quot;, &quot;evening&quot;]</code></li></ul><h3 id="2-Simple-Analyzer"><a href="#2-Simple-Analyzer" class="headerlink" title="2. Simple Analyzer"></a>2. <strong>Simple Analyzer</strong></h3><p>ç®€å•åˆ†æå™¨æŒ‰éå­—æ¯å­—ç¬¦åˆ‡åˆ†ï¼Œç¬¦å·ä¼šè¢«è¿‡æ»¤ï¼Œæ–‡æœ¬ä¼šè½¬æ¢ä¸ºå°å†™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;simple&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>åˆ†è¯ç»“æœ</strong>ï¼š<code>[&quot;2&quot;, &quot;running&quot;, &quot;quick&quot;, &quot;brown&quot;, &quot;foxes&quot;, &quot;leap&quot;, &quot;over&quot;, &quot;lazy&quot;, &quot;dogs&quot;, &quot;in&quot;, &quot;the&quot;, &quot;summer&quot;, &quot;evening&quot;]</code></li></ul><h3 id="3-Stop-Analyzer"><a href="#3-Stop-Analyzer" class="headerlink" title="3. Stop Analyzer"></a>3. <strong>Stop Analyzer</strong></h3><p>åœç”¨è¯åˆ†æå™¨ä¼šå°†æ–‡æœ¬è½¬æ¢ä¸ºå°å†™ï¼Œå¹¶è¿‡æ»¤æ‰å¸¸è§çš„åœç”¨è¯ï¼ˆå¦‚ â€œtheâ€, â€œaâ€, â€œisâ€ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;stop&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>åˆ†è¯ç»“æœ</strong>ï¼š<code>[&quot;2&quot;, &quot;running&quot;, &quot;quick&quot;, &quot;brown&quot;, &quot;foxes&quot;, &quot;leap&quot;, &quot;lazy&quot;, &quot;dogs&quot;, &quot;summer&quot;, &quot;evening&quot;]</code></li></ul><h3 id="4-Whitespace-Analyzer"><a href="#4-Whitespace-Analyzer" class="headerlink" title="4. Whitespace Analyzer"></a>4. <strong>Whitespace Analyzer</strong></h3><p>ç©ºæ ¼åˆ†æå™¨ä¼šæŒ‰ç©ºæ ¼åˆ‡åˆ†æ–‡æœ¬ï¼Œå¹¶ä¸”ä¸ä¼šè½¬æ¢ä¸ºå°å†™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;whitespace&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>åˆ†è¯ç»“æœ</strong>ï¼š<code>[&quot;2&quot;, &quot;running&quot;, &quot;Quick&quot;, &quot;brown-foxes&quot;, &quot;leap&quot;, &quot;over&quot;, &quot;lazy&quot;, &quot;dogs&quot;, &quot;in&quot;, &quot;the&quot;, &quot;summer&quot;, &quot;evening.&quot;]</code></li></ul><h3 id="5-Keyword-Analyzer"><a href="#5-Keyword-Analyzer" class="headerlink" title="5. Keyword Analyzer"></a>5. <strong>Keyword Analyzer</strong></h3><p>å…³é”®å­—åˆ†æå™¨ä¸è¿›è¡Œåˆ†è¯ï¼Œç›´æ¥è¿”å›åŸå§‹æ–‡æœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>åˆ†è¯ç»“æœ</strong>ï¼š<code>[&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;]</code></li></ul><h3 id="6-Pattern-Analyzer"><a href="#6-Pattern-Analyzer" class="headerlink" title="6. Pattern Analyzer"></a>6. <strong>Pattern Analyzer</strong></h3><p>æ¨¡å¼åˆ†æå™¨ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œåˆ†è¯ï¼Œé»˜è®¤ä½¿ç”¨ <code>\W+</code>ï¼ˆéå­—æ¯å­—ç¬¦ï¼‰ä½œä¸ºåˆ†éš”ç¬¦ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;pattern&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>åˆ†è¯ç»“æœ</strong>ï¼š<code>[&quot;2&quot;, &quot;running&quot;, &quot;Quick&quot;, &quot;brown&quot;, &quot;foxes&quot;, &quot;leap&quot;, &quot;over&quot;, &quot;lazy&quot;, &quot;dogs&quot;, &quot;in&quot;, &quot;the&quot;, &quot;summer&quot;, &quot;evening&quot;]</code></li></ul><h3 id="7-English-Analyzer"><a href="#7-English-Analyzer" class="headerlink" title="7. English Analyzer"></a>7. <strong>English Analyzer</strong></h3><p>è‹±è¯­åˆ†æå™¨é’ˆå¯¹è‹±è¯­è¯­è¨€è¿›è¡Œåˆ†è¯ï¼Œå»é™¤åœç”¨è¯ç­‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;english&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;2 running Quick brown-foxes leap over lazy dogs in the summer evening.&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>åˆ†è¯ç»“æœ</strong>ï¼š<code>[&quot;2&quot;, &quot;running&quot;, &quot;quick&quot;, &quot;brown&quot;, &quot;foxes&quot;, &quot;leap&quot;, &quot;lazy&quot;, &quot;dogs&quot;, &quot;summer&quot;, &quot;evening&quot;]</code></li></ul><h3 id="8-ICU-Analyzer-for-Chinese-Text"><a href="#8-ICU-Analyzer-for-Chinese-Text" class="headerlink" title="8. ICU Analyzer for Chinese Text"></a>8. <strong>ICU Analyzer for Chinese Text</strong></h3><p>ä½¿ç”¨ <code>icu_analyzer</code> æ¥å¤„ç†ä¸­æ–‡æ–‡æœ¬ï¼Œé€‚ç”¨äºå¤šè¯­è¨€ç¯å¢ƒä¸­çš„åˆ†è¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;icu_analyzer&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;ä»–è¯´çš„ç¡®å®åœ¨ç†&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>åˆ†è¯ç»“æœ</strong>ï¼š<code>[&quot;ä»–è¯´&quot;, &quot;çš„&quot;, &quot;ç¡®å®&quot;, &quot;åœ¨ç†&quot;]</code></li></ul><h3 id="9-Standard-Analyzer-for-Chinese-Text"><a href="#9-Standard-Analyzer-for-Chinese-Text" class="headerlink" title="9. Standard Analyzer for Chinese Text"></a>9. <strong>Standard Analyzer for Chinese Text</strong></h3><p>ä½¿ç”¨æ ‡å‡†åˆ†æå™¨å¤„ç†ä¸­æ–‡æ–‡æœ¬ï¼Œé€šå¸¸å¤„ç†ä¸­æ–‡æ—¶å¯èƒ½ä¸ä¼šåƒä¸­æ–‡ä¸“ç”¨åˆ†æå™¨é‚£æ ·ç²¾ç¡®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;standard&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;ä»–è¯´çš„ç¡®å®åœ¨ç†&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>åˆ†è¯ç»“æœ</strong>ï¼š<code>[&quot;ä»–è¯´&quot;, &quot;çš„&quot;, &quot;ç¡®å®&quot;, &quot;åœ¨ç†&quot;]</code></li></ul><h3 id="10-ICU-Analyzer-for-Another-Chinese-Sentence"><a href="#10-ICU-Analyzer-for-Another-Chinese-Sentence" class="headerlink" title="10. ICU Analyzer for Another Chinese Sentence"></a>10. <strong>ICU Analyzer for Another Chinese Sentence</strong></h3><p>å¤„ç†å¦ä¸€ä¸ªä¸­æ–‡å¥å­ <code>&quot;è¿™ä¸ªè‹¹æœä¸å¤§å¥½åƒ&quot;</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;icu_analyzer&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;è¿™ä¸ªè‹¹æœä¸å¤§å¥½åƒ&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>åˆ†è¯ç»“æœ</strong>ï¼š<code>[&quot;è¿™ä¸ª&quot;, &quot;è‹¹æœ&quot;, &quot;ä¸å¤§&quot;, &quot;å¥½åƒ&quot;]</code></li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ¯ç§åˆ†æå™¨å…·æœ‰ä¸åŒçš„åˆ†è¯è¡Œä¸ºï¼š</p><ul><li><strong>Standard</strong>ï¼šæ ¹æ®ç©ºæ ¼å’Œæ ‡ç‚¹ç¬¦å·åˆ†è¯å¹¶å°å†™åŒ–ã€‚</li><li><strong>Simple</strong>ï¼šè¿‡æ»¤éå­—æ¯å­—ç¬¦å¹¶å°å†™åŒ–ã€‚</li><li><strong>Stop</strong>ï¼šå»é™¤åœç”¨è¯å¹¶å°å†™åŒ–ã€‚</li><li><strong>Whitespace</strong>ï¼šä»…æŒ‰ç©ºæ ¼åˆ†è¯ï¼Œä¸è¿›è¡Œå¤§å°å†™è½¬æ¢ã€‚</li><li><strong>Keyword</strong>ï¼šä¸è¿›è¡Œåˆ†è¯ï¼Œè¿”å›æ•´ä¸ªæ–‡æœ¬ã€‚</li><li><strong>Pattern</strong>ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åˆ†è¯ï¼Œé»˜è®¤ <code>\W+</code> åˆ†å‰²ã€‚</li><li><strong>English</strong>ï¼šä¸ºè‹±è¯­æ–‡æœ¬è®¾è®¡çš„åˆ†æå™¨ï¼Œå»é™¤åœç”¨è¯ã€‚</li><li><strong>ICU Analyzer</strong>ï¼šé€‚åˆå¤šè¯­è¨€çš„åˆ†è¯ï¼Œç‰¹åˆ«é€‚ç”¨äºä¸­æ–‡ç­‰éæ‹‰ä¸å­—æ¯è¯­è¨€ã€‚</li></ul><p>è¿™äº›åˆ†æå™¨å¯ä»¥æ ¹æ®ä¸åŒçš„è¯­è¨€å’Œéœ€æ±‚æ¥ä¼˜åŒ–ç´¢å¼•å’Œæœç´¢ã€‚</p><p>ä»¥ä¸‹æ˜¯æ‚¨æä¾›çš„ä¸€äº› Elasticsearch æŸ¥è¯¢ç¤ºä¾‹ï¼Œæ¶µç›–äº†åŸºæœ¬æŸ¥è¯¢ã€å¸¦æœ‰åˆ†æçš„æŸ¥è¯¢ã€å¸ƒå°”æŸ¥è¯¢ã€èŒƒå›´æŸ¥è¯¢ã€é€šé…ç¬¦æŸ¥è¯¢ã€æ¨¡ç³ŠæŸ¥è¯¢ç­‰æ“ä½œã€‚ä¸‹é¢æ˜¯æ¯ç§æŸ¥è¯¢çš„è¯¦ç»†è§£é‡Šå’Œç”¨æ³•ï¼š</p><h3 id="1-åŸºæœ¬æŸ¥è¯¢"><a href="#1-åŸºæœ¬æŸ¥è¯¢" class="headerlink" title="1. åŸºæœ¬æŸ¥è¯¢"></a>1. <strong>åŸºæœ¬æŸ¥è¯¢</strong></h3><p>æŸ¥è¯¢ <code>movies</code> ç´¢å¼•ä¸­æ ‡é¢˜ä¸º <code>2012</code> çš„ç”µå½±ï¼Œå¹¶æ ¹æ® <code>year</code> å­—æ®µé™åºæ’åºï¼Œè¿”å›å‰ 10 æ¡ç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search?q=2012&amp;<span class="hljs-built_in">df</span>=title&amp;<span class="hljs-built_in">sort</span>=year:desc&amp;from=0&amp;size=10&amp;<span class="hljs-built_in">timeout</span>=1s<br></code></pre></td></tr></table></figure><ul><li>**<code>q=2012</code>**ï¼šæŸ¥è¯¢å†…å®¹ä¸º <code>2012</code>ã€‚</li><li>**<code>df=title</code>**ï¼šæŒ‡å®šæŸ¥è¯¢å­—æ®µä¸º <code>title</code>ã€‚</li><li>**<code>sort=year:desc</code>**ï¼šæŒ‰ <code>year</code> å­—æ®µé™åºæ’åºã€‚</li><li>**<code>from=0&amp;size=10</code>**ï¼šåˆ†é¡µï¼Œè¿”å›å‰ 10 æ¡æ•°æ®ã€‚</li><li>**<code>timeout=1s</code>**ï¼šæŸ¥è¯¢è¶…æ—¶é™åˆ¶ä¸º 1 ç§’ã€‚</li></ul><h3 id="2-å¸¦-Profile-çš„æŸ¥è¯¢"><a href="#2-å¸¦-Profile-çš„æŸ¥è¯¢" class="headerlink" title="2. å¸¦ Profile çš„æŸ¥è¯¢"></a>2. <strong>å¸¦ Profile çš„æŸ¥è¯¢</strong></h3><p>å¯ç”¨ <code>profile</code> å¯ä»¥å¸®åŠ©åˆ†ææŸ¥è¯¢æ€§èƒ½ï¼ŒæŸ¥çœ‹æŸ¥è¯¢çš„æ¯ä¸ªé˜¶æ®µçš„æ—¶é—´ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search?q=2012&amp;<span class="hljs-built_in">df</span>=title<br>&#123;<br><span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>&quot;profile&quot;: &quot;true&quot;</code>**ï¼šå¯ç”¨æŸ¥è¯¢æ€§èƒ½åˆ†æã€‚</li></ul><h3 id="3-æ³›æŸ¥è¯¢ï¼Œå¯¹æ‰€æœ‰å­—æ®µè¿›è¡ŒæŸ¥è¯¢"><a href="#3-æ³›æŸ¥è¯¢ï¼Œå¯¹æ‰€æœ‰å­—æ®µè¿›è¡ŒæŸ¥è¯¢" class="headerlink" title="3. æ³›æŸ¥è¯¢ï¼Œå¯¹æ‰€æœ‰å­—æ®µè¿›è¡ŒæŸ¥è¯¢"></a>3. <strong>æ³›æŸ¥è¯¢ï¼Œå¯¹æ‰€æœ‰å­—æ®µè¿›è¡ŒæŸ¥è¯¢</strong></h3><p>ä½¿ç”¨ <code>_all</code> å­—æ®µè¿›è¡Œæ³›æŸ¥è¯¢ï¼ŒæŸ¥è¯¢æ‰€æœ‰å­—æ®µã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search?q=2012<br>&#123;<br><span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>q=2012</code>**ï¼šæŸ¥è¯¢æ‰€æœ‰å­—æ®µä¸­åŒ…å« <code>2012</code> çš„æ•°æ®ã€‚</li></ul><h3 id="4-æŒ‡å®šå­—æ®µæŸ¥è¯¢"><a href="#4-æŒ‡å®šå­—æ®µæŸ¥è¯¢" class="headerlink" title="4. æŒ‡å®šå­—æ®µæŸ¥è¯¢"></a>4. <strong>æŒ‡å®šå­—æ®µæŸ¥è¯¢</strong></h3><p>æŸ¥è¯¢ <code>title</code> å­—æ®µä¸­åŒ…å« <code>2012</code> çš„è®°å½•ï¼Œå¹¶æŒ‰ç…§ <code>year</code> å­—æ®µé™åºæ’åºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search?q=title:2012&amp;<span class="hljs-built_in">sort</span>=year:desc&amp;from=0&amp;size=10&amp;<span class="hljs-built_in">timeout</span>=1s<br>&#123;<br><span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>q=title:2012</code>**ï¼šæŒ‡å®šæŸ¥è¯¢å­—æ®µä¸º <code>title</code>ï¼ŒæŸ¥è¯¢å†…å®¹ä¸º <code>2012</code>ã€‚</li></ul><h3 id="5-æŸ¥æ‰¾ç¾ä¸½å¿ƒçµ"><a href="#5-æŸ¥æ‰¾ç¾ä¸½å¿ƒçµ" class="headerlink" title="5. æŸ¥æ‰¾ç¾ä¸½å¿ƒçµ"></a>5. <strong>æŸ¥æ‰¾ç¾ä¸½å¿ƒçµ</strong></h3><p>æŸ¥è¯¢ <code>title</code> å­—æ®µåŒ…å« <code>&quot;Beautiful Mind&quot;</code> çš„è®°å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search?q=title:Beautiful Mind<br>&#123;<br><span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-æ³›æŸ¥è¯¢"><a href="#6-æ³›æŸ¥è¯¢" class="headerlink" title="6. æ³›æŸ¥è¯¢"></a>6. <strong>æ³›æŸ¥è¯¢</strong></h3><p>æŸ¥è¯¢ <code>title</code> å­—æ®µåŒ…å« <code>2012</code> çš„è®°å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search?q=title:2012<br>&#123;<br><span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="7-Phrase-æŸ¥è¯¢ï¼ˆçŸ­è¯­æŸ¥è¯¢ï¼‰"><a href="#7-Phrase-æŸ¥è¯¢ï¼ˆçŸ­è¯­æŸ¥è¯¢ï¼‰" class="headerlink" title="7. Phrase æŸ¥è¯¢ï¼ˆçŸ­è¯­æŸ¥è¯¢ï¼‰"></a>7. <strong>Phrase æŸ¥è¯¢ï¼ˆçŸ­è¯­æŸ¥è¯¢ï¼‰</strong></h3><p>æŸ¥è¯¢ <code>title</code> å­—æ®µç²¾ç¡®åŒ¹é… <code>&quot;Beautiful Mind&quot;</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search?q=title:<span class="hljs-string">&quot;Beautiful Mind&quot;</span><br>&#123;<br><span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨å¼•å·è¡¨ç¤ºç²¾ç¡®çŸ­è¯­åŒ¹é…ï¼Œè¦æ±‚å­—æ®µå†…å®¹å¿…é¡»å®Œå…¨åŒ¹é…çŸ­è¯­ <code>&quot;Beautiful Mind&quot;</code>ã€‚</li></ul><h3 id="8-åˆ†ç»„æŸ¥è¯¢ï¼ˆä½¿ç”¨æ‹¬å·ï¼‰"><a href="#8-åˆ†ç»„æŸ¥è¯¢ï¼ˆä½¿ç”¨æ‹¬å·ï¼‰" class="headerlink" title="8. åˆ†ç»„æŸ¥è¯¢ï¼ˆä½¿ç”¨æ‹¬å·ï¼‰"></a>8. <strong>åˆ†ç»„æŸ¥è¯¢ï¼ˆä½¿ç”¨æ‹¬å·ï¼‰</strong></h3><p>æŸ¥è¯¢ <code>title</code> å­—æ®µä¸­åŒ…å« <code>Beautiful Mind</code> çš„è®°å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search?q=title:(Beautiful Mind)<br>&#123;<br><span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨æ‹¬å·å¯ä»¥è¿›è¡Œåˆ†ç»„æŸ¥è¯¢ï¼Œç±»ä¼¼é€»è¾‘ä¸Šçš„æ‹¬å·ä¼˜å…ˆçº§ã€‚</li></ul><h3 id="9-å¸ƒå°”æ“ä½œç¬¦æŸ¥è¯¢"><a href="#9-å¸ƒå°”æ“ä½œç¬¦æŸ¥è¯¢" class="headerlink" title="9. å¸ƒå°”æ“ä½œç¬¦æŸ¥è¯¢"></a>9. <strong>å¸ƒå°”æ“ä½œç¬¦æŸ¥è¯¢</strong></h3><ul><li><strong>AND æŸ¥è¯¢ï¼š</strong><br>æŸ¥è¯¢ <code>title</code> å­—æ®µåŒæ—¶åŒ…å« <code>Beautiful</code> å’Œ <code>Mind</code> çš„è®°å½•ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search?q=title:(Beautiful AND Mind)<br>&#123;<br><span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><strong>NOT æŸ¥è¯¢ï¼š</strong><br>æŸ¥è¯¢ <code>title</code> å­—æ®µåŒ…å« <code>Beautiful</code> ä½†ä¸åŒ…å« <code>Mind</code> çš„è®°å½•ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search?q=title:(Beautiful NOT Mind)<br>&#123;<br><span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><strong>OR æŸ¥è¯¢ï¼š</strong><br>æŸ¥è¯¢ <code>title</code> å­—æ®µåŒ…å« <code>Beautiful</code> æˆ– <code>Mind</code> çš„è®°å½•ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search?q=title:(Beautiful %2BMind)<br>&#123;<br><span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="10-èŒƒå›´æŸ¥è¯¢"><a href="#10-èŒƒå›´æŸ¥è¯¢" class="headerlink" title="10. èŒƒå›´æŸ¥è¯¢"></a>10. <strong>èŒƒå›´æŸ¥è¯¢</strong></h3><p>æŸ¥è¯¢ <code>title</code> å­—æ®µåŒ…å« <code>beautiful</code> ä¸” <code>year</code> åœ¨ 2002 åˆ° 2018 å¹´ä¹‹é—´çš„è®°å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search?q=title:beautiful AND year:[2002 TO 2018%7D<br>&#123;<br><span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>year:[2002 TO 2018]</code>**ï¼šæŒ‡å®š <code>year</code> å­—æ®µçš„èŒƒå›´æŸ¥è¯¢ã€‚</li></ul><h3 id="11-é€šé…ç¬¦æŸ¥è¯¢"><a href="#11-é€šé…ç¬¦æŸ¥è¯¢" class="headerlink" title="11. é€šé…ç¬¦æŸ¥è¯¢"></a>11. <strong>é€šé…ç¬¦æŸ¥è¯¢</strong></h3><p>æŸ¥è¯¢ <code>title</code> å­—æ®µä»¥ <code>b</code> å¼€å¤´çš„æ‰€æœ‰è®°å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search?q=title:b*<br>&#123;<br><span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>b*</code>**ï¼šä½¿ç”¨é€šé…ç¬¦æŸ¥è¯¢ä»¥ <code>b</code> å¼€å¤´çš„å­—ç¬¦ä¸²ã€‚</li></ul><h3 id="12-æ¨¡ç³ŠæŸ¥è¯¢-è¿‘ä¼¼åº¦åŒ¹é…"><a href="#12-æ¨¡ç³ŠæŸ¥è¯¢-è¿‘ä¼¼åº¦åŒ¹é…" class="headerlink" title="12. æ¨¡ç³ŠæŸ¥è¯¢ &amp; è¿‘ä¼¼åº¦åŒ¹é…"></a>12. <strong>æ¨¡ç³ŠæŸ¥è¯¢ &amp; è¿‘ä¼¼åº¦åŒ¹é…</strong></h3><ul><li><strong>æ¨¡ç³ŠåŒ¹é…</strong>ï¼šæŸ¥è¯¢ <code>title</code> å­—æ®µä¸­çš„è¯è¯­ <code>beautifl</code>ï¼Œå…è®¸æœ‰ 1 ä¸ªå­—ç¬¦çš„é”™è¯¯ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search?q=title:beautifl~1<br>&#123;<br><span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><strong>è¿‘ä¼¼åº¦åŒ¹é…</strong>ï¼šæŸ¥è¯¢ <code>title</code> å­—æ®µä¸­çš„çŸ­è¯­ <code>&quot;Lord Rings&quot;</code>ï¼Œå…è®¸ 2 ä¸ªå­—ç¬¦çš„è¯¯å·®ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search?q=title:<span class="hljs-string">&quot;Lord Rings&quot;</span>~2<br>&#123;<br><span class="hljs-string">&quot;profile&quot;</span>:<span class="hljs-string">&quot;true&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™äº›æŸ¥è¯¢å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Elasticsearch æä¾›çš„å¼ºå¤§æŸ¥è¯¢èƒ½åŠ›æ¥æ ¹æ®ä¸åŒçš„éœ€æ±‚ç­›é€‰å’Œæœç´¢æ•°æ®ã€‚å¸¸è§çš„æŸ¥è¯¢ç±»å‹åŒ…æ‹¬ï¼š</p><ul><li><strong>åŸºæœ¬æŸ¥è¯¢</strong>ï¼šç”¨äºæŸ¥æ‰¾å•ä¸€è¯æ±‡ã€‚</li><li><strong>å¸ƒå°”æŸ¥è¯¢</strong>ï¼šç»„åˆå¤šä¸ªæŸ¥è¯¢æ¡ä»¶ã€‚</li><li><strong>èŒƒå›´æŸ¥è¯¢</strong>ï¼šæŸ¥æ‰¾ç‰¹å®šèŒƒå›´å†…çš„è®°å½•ã€‚</li><li><strong>é€šé…ç¬¦æŸ¥è¯¢</strong>ï¼šæ¨¡ç³ŠåŒ¹é…ã€‚</li><li><strong>çŸ­è¯­æŸ¥è¯¢</strong>ï¼šç²¾ç¡®åŒ¹é…æ•´ä¸ªçŸ­è¯­ã€‚</li></ul><p>åŒæ—¶ï¼Œ<code>profile</code> å‚æ•°å¯ä»¥å¸®åŠ©åˆ†ææŸ¥è¯¢æ€§èƒ½ï¼Œä¼˜åŒ–æŸ¥è¯¢å“åº”ã€‚</p><p>3.8-RequestBodyä¸QueryDSLç®€ä»‹</p><p>ä»¥ä¸‹æ˜¯æ‚¨æä¾›çš„ Elasticsearch æŸ¥è¯¢æ“ä½œï¼ŒåŒ…æ‹¬åˆ†é¡µã€æ—¥æœŸæ’åºã€æºè¿‡æ»¤ã€è„šæœ¬å­—æ®µã€ä»¥åŠä¸åŒçš„æŸ¥è¯¢ç±»å‹ï¼ˆå¦‚ <code>match</code>ã€<code>match_phrase</code>ï¼‰ã€‚è¿™äº›æ“ä½œå±•ç¤ºäº†å¦‚ä½•åœ¨ Elasticsearch ä¸­è¿›è¡Œæ›´ç²¾ç»†çš„æŸ¥è¯¢å’Œæ•°æ®å¤„ç†ã€‚</p><h3 id="1-å¿½ç•¥ä¸å­˜åœ¨çš„ç´¢å¼•ï¼ˆignore-unavailable-trueï¼‰"><a href="#1-å¿½ç•¥ä¸å­˜åœ¨çš„ç´¢å¼•ï¼ˆignore-unavailable-trueï¼‰" class="headerlink" title="1. å¿½ç•¥ä¸å­˜åœ¨çš„ç´¢å¼•ï¼ˆignore_unavailable=trueï¼‰"></a>1. <strong>å¿½ç•¥ä¸å­˜åœ¨çš„ç´¢å¼•ï¼ˆ<code>ignore_unavailable=true</code>ï¼‰</strong></h3><p>åœ¨æŸ¥è¯¢æ—¶ï¼Œå¦‚æœè®¿é—®çš„ç´¢å¼•ä¸å­˜åœ¨ï¼Œä½¿ç”¨ <code>ignore_unavailable=true</code> å¯ä»¥é¿å…æŠ¥é”™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST /movies,404_idx/_search?ignore_unavailable=<span class="hljs-literal">true</span><br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>ignore_unavailable=true</code>**ï¼šåœ¨è®¿é—®ä¸å­˜åœ¨çš„ç´¢å¼•æ—¶ï¼Œå¿½ç•¥é”™è¯¯ã€‚</li></ul><h3 id="2-åˆ†é¡µæŸ¥è¯¢"><a href="#2-åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="2. åˆ†é¡µæŸ¥è¯¢"></a>2. <strong>åˆ†é¡µæŸ¥è¯¢</strong></h3><p>æŸ¥è¯¢ <code>kibana_sample_data_ecommerce</code> ç´¢å¼•å¹¶åˆ†é¡µè¿”å›æ•°æ®ï¼ˆä»ç¬¬ 10 æ¡å¼€å§‹ï¼Œè¿”å› 20 æ¡è®°å½•ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST /kibana_sample_data_ecommerce/_search<br>&#123;<br>  <span class="hljs-string">&quot;from&quot;</span>: 10,<br>  <span class="hljs-string">&quot;size&quot;</span>: 20,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong><code>from=10</code></strong> å’Œ **<code>size=20</code>**ï¼šåˆ†é¡µï¼Œè·³è¿‡å‰ 10 æ¡ï¼Œè¿”å›æ¥ä¸‹æ¥çš„ 20 æ¡ã€‚</li></ul><h3 id="3-æ—¥æœŸæ’åº"><a href="#3-æ—¥æœŸæ’åº" class="headerlink" title="3. æ—¥æœŸæ’åº"></a>3. <strong>æ—¥æœŸæ’åº</strong></h3><p>æŒ‰ <code>order_date</code> å­—æ®µé™åºæ’åºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST kibana_sample_data_ecommerce/_search<br>&#123;<br>  <span class="hljs-string">&quot;sort&quot;</span>: [&#123;<span class="hljs-string">&quot;order_date&quot;</span>: <span class="hljs-string">&quot;desc&quot;</span>&#125;],<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>sort</code>**ï¼šæŒ‰ç…§ <code>order_date</code> å­—æ®µé™åºæ’åºã€‚</li></ul><h3 id="4-æºè¿‡æ»¤"><a href="#4-æºè¿‡æ»¤" class="headerlink" title="4. æºè¿‡æ»¤"></a>4. <strong>æºè¿‡æ»¤</strong></h3><p>åªè¿”å›æ–‡æ¡£ä¸­çš„ <code>order_date</code> å­—æ®µï¼Œä¸è¿”å›å…¶ä»–å­—æ®µï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST kibana_sample_data_ecommerce/_search<br>&#123;<br>  <span class="hljs-string">&quot;_source&quot;</span>: [<span class="hljs-string">&quot;order_date&quot;</span>],<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>_source</code>**ï¼šæŒ‡å®šåªè¿”å› <code>order_date</code> å­—æ®µçš„æ•°æ®ã€‚</li></ul><h3 id="5-è„šæœ¬å­—æ®µ"><a href="#5-è„šæœ¬å­—æ®µ" class="headerlink" title="5. è„šæœ¬å­—æ®µ"></a>5. <strong>è„šæœ¬å­—æ®µ</strong></h3><p>ä½¿ç”¨è„šæœ¬å­—æ®µè®¡ç®—æ–°çš„å­—æ®µï¼ˆä¾‹å¦‚ï¼Œæ‹¼æ¥ <code>order_date</code> å’Œ <code>&quot;hello&quot;</code>ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET kibana_sample_data_ecommerce/_search<br>&#123;<br>  <span class="hljs-string">&quot;script_fields&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;new_field&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;script&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;lang&quot;</span>: <span class="hljs-string">&quot;painless&quot;</span>,<br>        <span class="hljs-string">&quot;source&quot;</span>: <span class="hljs-string">&quot;doc[&#x27;order_date&#x27;].value+&#x27;hello&#x27;&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>script_fields</code>**ï¼šä½¿ç”¨ <code>painless</code> è„šæœ¬åˆ›å»ºæ–°çš„å­—æ®µ <code>new_field</code>ï¼Œå°† <code>order_date</code> å­—æ®µä¸å­—ç¬¦ä¸² <code>&quot;hello&quot;</code> æ‹¼æ¥ã€‚</li></ul><h3 id="6-match-æŸ¥è¯¢"><a href="#6-match-æŸ¥è¯¢" class="headerlink" title="6. match æŸ¥è¯¢"></a>6. <strong><code>match</code> æŸ¥è¯¢</strong></h3><p>æŸ¥è¯¢ <code>movies</code> ç´¢å¼•ä¸­ <code>title</code> å­—æ®µåŒ…å« <code>&quot;last christmas&quot;</code> çš„è®°å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST movies/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;last christmas&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>match</code>**ï¼šè¿›è¡Œæ ‡å‡†çš„å…¨æ–‡åŒ¹é…æŸ¥è¯¢ã€‚</li></ul><h3 id="7-match-æŸ¥è¯¢å¹¶ä½¿ç”¨-AND-æ“ä½œç¬¦"><a href="#7-match-æŸ¥è¯¢å¹¶ä½¿ç”¨-AND-æ“ä½œç¬¦" class="headerlink" title="7. match æŸ¥è¯¢å¹¶ä½¿ç”¨ AND æ“ä½œç¬¦"></a>7. <strong><code>match</code> æŸ¥è¯¢å¹¶ä½¿ç”¨ AND æ“ä½œç¬¦</strong></h3><p>æŸ¥è¯¢ <code>title</code> åŒ…å« <code>&quot;last christmas&quot;</code> ä¸”ä¸¤ä¸ªè¯éƒ½å¿…é¡»å‡ºç°çš„è®°å½•ï¼ˆä½¿ç”¨ AND æ“ä½œç¬¦ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST movies/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;last christmas&quot;</span>,<br>        <span class="hljs-string">&quot;operator&quot;</span>: <span class="hljs-string">&quot;and&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>operator: &quot;and&quot;</code>**ï¼šä¸¤ä¸ªè¯å¿…é¡»åŒæ—¶å‡ºç°åœ¨å­—æ®µä¸­ã€‚</li></ul><h3 id="8-match-phrase-æŸ¥è¯¢ï¼ˆçŸ­è¯­åŒ¹é…ï¼‰"><a href="#8-match-phrase-æŸ¥è¯¢ï¼ˆçŸ­è¯­åŒ¹é…ï¼‰" class="headerlink" title="8. match_phrase æŸ¥è¯¢ï¼ˆçŸ­è¯­åŒ¹é…ï¼‰"></a>8. <strong><code>match_phrase</code> æŸ¥è¯¢ï¼ˆçŸ­è¯­åŒ¹é…ï¼‰</strong></h3><p>æŸ¥è¯¢ <code>title</code> å­—æ®µç²¾ç¡®åŒ¹é… <code>&quot;one love&quot;</code> ä½œä¸ºä¸€ä¸ªçŸ­è¯­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST movies/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_phrase&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;one love&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>match_phrase</code>**ï¼šç²¾ç¡®åŒ¹é…æ•´ä¸ªçŸ­è¯­ï¼Œå¿…é¡»æŒ‰ç…§æŒ‡å®šçš„é¡ºåºã€‚</li></ul><h3 id="9-match-phrase-æŸ¥è¯¢å¹¶ä½¿ç”¨-slop"><a href="#9-match-phrase-æŸ¥è¯¢å¹¶ä½¿ç”¨-slop" class="headerlink" title="9. match_phrase æŸ¥è¯¢å¹¶ä½¿ç”¨ slop"></a>9. <strong><code>match_phrase</code> æŸ¥è¯¢å¹¶ä½¿ç”¨ <code>slop</code></strong></h3><p>æŸ¥è¯¢ <code>title</code> å­—æ®µä¸­çš„çŸ­è¯­ <code>&quot;one love&quot;</code>ï¼Œå¹¶å…è®¸ 1 ä¸ªè¯è¯­çš„åç§»ï¼ˆå³è¯è¯­å¯ä»¥æœ‰ä¸€å®šçš„é¡ºåºå˜åŒ–ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST movies/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_phrase&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;title&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;one love&quot;</span>,<br>        <span class="hljs-string">&quot;slop&quot;</span>: 1<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>slop: 1</code>**ï¼šå…è®¸æœ€å¤š 1 ä¸ªè¯è¯­çš„é¡ºåºåç§»ï¼ˆä¾‹å¦‚ï¼Œ<code>love one</code> ä¹Ÿå¯ä»¥åŒ¹é…ï¼‰ã€‚</li></ul><h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™äº›æŸ¥è¯¢å±•ç¤ºäº† Elasticsearch ä¸­å¸¸ç”¨çš„æŸ¥è¯¢ç±»å‹ï¼š</p><ul><li><strong>åˆ†é¡µæŸ¥è¯¢</strong>ï¼šä½¿ç”¨ <code>from</code> å’Œ <code>size</code> æ¥å®ç°åˆ†é¡µã€‚</li><li><strong>æ—¥æœŸæ’åº</strong>ï¼šä½¿ç”¨ <code>sort</code> æ¥å¯¹ç»“æœè¿›è¡Œæ’åºã€‚</li><li><strong>æºè¿‡æ»¤</strong>ï¼šé€šè¿‡ <code>_source</code> é™åˆ¶è¿”å›çš„å­—æ®µã€‚</li><li><strong>è„šæœ¬å­—æ®µ</strong>ï¼šä½¿ç”¨ <code>painless</code> è„šæœ¬æ¥è®¡ç®—æ–°å­—æ®µã€‚</li><li><strong>å¸ƒå°”æ“ä½œç¬¦</strong>ï¼šé€šè¿‡ <code>operator</code> æ¥å®šä¹‰ <code>match</code> æŸ¥è¯¢çš„é€»è¾‘ã€‚</li><li><strong>çŸ­è¯­åŒ¹é…å’Œåç§»</strong>ï¼šé€šè¿‡ <code>match_phrase</code> å’Œ <code>slop</code> æ¥è¿›è¡Œæ›´çµæ´»çš„æŸ¥è¯¢ã€‚</li></ul><p>è¿™äº›æŸ¥è¯¢å¯ä»¥å¸®åŠ©ä½ åœ¨ Elasticsearch ä¸­å®ç°å¤æ‚çš„æœç´¢éœ€æ±‚ã€‚</p><p>[3.9-QueryString&amp;SimpleQueryStringæŸ¥è¯¢]</p><p>ä»¥ä¸‹æ˜¯æ‚¨æä¾›çš„ Elasticsearch æŸ¥è¯¢æ“ä½œï¼Œæ¶‰åŠåˆ° <code>query_string</code> å’Œ <code>simple_query_string</code> æŸ¥è¯¢çš„ä½¿ç”¨ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡ä¸åŒçš„å­—æ®µå’Œæ“ä½œç¬¦æ‰§è¡Œå¤æ‚æŸ¥è¯¢ã€‚è¿™é‡Œçš„æŸ¥è¯¢åŒ…æ‹¬å¸ƒå°”æ“ä½œç¬¦ã€å­—æ®µåŒ¹é…ã€ä»¥åŠæŒ‡å®šé»˜è®¤æ“ä½œç¬¦ç­‰ã€‚</p><h3 id="1-å‘ç´¢å¼•æ·»åŠ æ–‡æ¡£"><a href="#1-å‘ç´¢å¼•æ·»åŠ æ–‡æ¡£" class="headerlink" title="1. å‘ç´¢å¼•æ·»åŠ æ–‡æ¡£"></a>1. <strong>å‘ç´¢å¼•æ·»åŠ æ–‡æ¡£</strong></h3><p>é¦–å…ˆï¼Œå‘ <code>users</code> ç´¢å¼•æ·»åŠ ä¸¤ä¸ªç”¨æˆ·æ–‡æ¡£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT /users/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Ruan Yiming&quot;</span>,<br>  <span class="hljs-string">&quot;about&quot;</span>: <span class="hljs-string">&quot;java, golang, node, swift, elasticsearch&quot;</span><br>&#125;<br><br>PUT /users/_doc/2<br>&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Li Yiming&quot;</span>,<br>  <span class="hljs-string">&quot;about&quot;</span>: <span class="hljs-string">&quot;Hadoop&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-query-string-æŸ¥è¯¢ï¼šæŸ¥è¯¢åç§°ä¸­åŒ…å«-â€œRuanâ€-å’Œ-â€œYimingâ€-çš„æ–‡æ¡£"><a href="#2-query-string-æŸ¥è¯¢ï¼šæŸ¥è¯¢åç§°ä¸­åŒ…å«-â€œRuanâ€-å’Œ-â€œYimingâ€-çš„æ–‡æ¡£" class="headerlink" title="2. query_string æŸ¥è¯¢ï¼šæŸ¥è¯¢åç§°ä¸­åŒ…å« â€œRuanâ€ å’Œ â€œYimingâ€ çš„æ–‡æ¡£"></a>2. <strong><code>query_string</code> æŸ¥è¯¢ï¼šæŸ¥è¯¢åç§°ä¸­åŒ…å« â€œRuanâ€ å’Œ â€œYimingâ€ çš„æ–‡æ¡£</strong></h3><p>ä½¿ç”¨ <code>query_string</code> æŸ¥è¯¢ï¼ŒæŒ‡å®šé»˜è®¤å­—æ®µä¸º <code>name</code>ï¼ŒæŸ¥è¯¢æ¡ä»¶ä¸º <code>&quot;Ruan AND Yiming&quot;</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST <span class="hljs-built_in">users</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;query_string&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;default_field&quot;</span>: <span class="hljs-string">&quot;name&quot;</span>,<br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;Ruan AND Yiming&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>query_string</code>**ï¼šç”¨äºæ‰§è¡Œå¤æ‚çš„æŸ¥è¯¢ï¼Œå¯ä»¥ä½¿ç”¨é€»è¾‘æ“ä½œç¬¦ï¼ˆå¦‚ ANDã€ORï¼‰ã€‚</li></ul><h3 id="3-query-string-æŸ¥è¯¢ï¼šå¤šä¸ªå­—æ®µå’Œå¤æ‚æŸ¥è¯¢"><a href="#3-query-string-æŸ¥è¯¢ï¼šå¤šä¸ªå­—æ®µå’Œå¤æ‚æŸ¥è¯¢" class="headerlink" title="3. query_string æŸ¥è¯¢ï¼šå¤šä¸ªå­—æ®µå’Œå¤æ‚æŸ¥è¯¢"></a>3. <strong><code>query_string</code> æŸ¥è¯¢ï¼šå¤šä¸ªå­—æ®µå’Œå¤æ‚æŸ¥è¯¢</strong></h3><p>æŸ¥è¯¢åç§°æˆ–ç®€ä»‹å­—æ®µåŒ…å« <code>&quot;Ruan AND Yiming&quot;</code> æˆ– <code>&quot;Java AND Elasticsearch&quot;</code> çš„æ–‡æ¡£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST <span class="hljs-built_in">users</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;query_string&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;fields&quot;</span>: [<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;about&quot;</span>],<br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;(Ruan AND Yiming) OR (Java AND Elasticsearch)&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>fields</code>**ï¼šå¯ä»¥æŒ‡å®šå¤šä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ã€‚</li><li>**<code>query</code>**ï¼šåŒ…å«å¸ƒå°”æ“ä½œç¬¦ï¼ˆå¦‚ ANDã€ORï¼‰ã€‚</li></ul><h3 id="4-simple-query-string-æŸ¥è¯¢ï¼ˆé»˜è®¤æ“ä½œç¬¦ä¸º-ORï¼‰"><a href="#4-simple-query-string-æŸ¥è¯¢ï¼ˆé»˜è®¤æ“ä½œç¬¦ä¸º-ORï¼‰" class="headerlink" title="4. simple_query_string æŸ¥è¯¢ï¼ˆé»˜è®¤æ“ä½œç¬¦ä¸º ORï¼‰"></a>4. <strong><code>simple_query_string</code> æŸ¥è¯¢ï¼ˆé»˜è®¤æ“ä½œç¬¦ä¸º ORï¼‰</strong></h3><p>æ‰§è¡Œä¸€ä¸ªç®€å•æŸ¥è¯¢ï¼Œé»˜è®¤æ“ä½œç¬¦ä¸º <code>OR</code>ï¼ŒæŸ¥è¯¢ <code>name</code> å­—æ®µä¸­åŒ…å« <code>&quot;Ruan&quot;</code> æˆ– <code>&quot;Yiming&quot;</code> çš„æ–‡æ¡£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST <span class="hljs-built_in">users</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;simple_query_string&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;Ruan AND Yiming&quot;</span>,<br>      <span class="hljs-string">&quot;fields&quot;</span>: [<span class="hljs-string">&quot;name&quot;</span>]<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>simple_query_string</code>**ï¼šé€‚ç”¨äºè¾ƒç®€å•çš„æŸ¥è¯¢ï¼Œé¿å…äº†å¤æ‚çš„æŸ¥è¯¢è¯­æ³•ã€‚</li></ul><h3 id="5-simple-query-string-æŸ¥è¯¢ï¼ˆé»˜è®¤æ“ä½œç¬¦ä¸º-ANDï¼‰"><a href="#5-simple-query-string-æŸ¥è¯¢ï¼ˆé»˜è®¤æ“ä½œç¬¦ä¸º-ANDï¼‰" class="headerlink" title="5. simple_query_string æŸ¥è¯¢ï¼ˆé»˜è®¤æ“ä½œç¬¦ä¸º ANDï¼‰"></a>5. <strong><code>simple_query_string</code> æŸ¥è¯¢ï¼ˆé»˜è®¤æ“ä½œç¬¦ä¸º ANDï¼‰</strong></h3><p>æŸ¥è¯¢ <code>name</code> å­—æ®µä¸­åŒ…å« <code>&quot;Ruan&quot;</code> ä¸” <code>&quot;Yiming&quot;</code> çš„æ–‡æ¡£ï¼Œä½¿ç”¨ <code>AND</code> ä½œä¸ºé»˜è®¤æ“ä½œç¬¦ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST <span class="hljs-built_in">users</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;simple_query_string&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;Ruan Yiming&quot;</span>,<br>      <span class="hljs-string">&quot;fields&quot;</span>: [<span class="hljs-string">&quot;name&quot;</span>],<br>      <span class="hljs-string">&quot;default_operator&quot;</span>: <span class="hljs-string">&quot;AND&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>default_operator</code>**ï¼šè®¾ç½®é»˜è®¤æ“ä½œç¬¦ï¼ˆ<code>AND</code> æˆ– <code>OR</code>ï¼‰ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code>AND</code> ç”¨äºè¦æ±‚ <code>&quot;Ruan&quot;</code> å’Œ <code>&quot;Yiming&quot;</code> å¿…é¡»åŒæ—¶å‡ºç°åœ¨ <code>name</code> å­—æ®µä¸­ã€‚</li></ul><h3 id="6-query-string-æŸ¥è¯¢ï¼šæŸ¥è¯¢ç”µå½±æ ‡é¢˜åŒ…å«-â€œBeautifulâ€-å’Œ-â€œMindâ€"><a href="#6-query-string-æŸ¥è¯¢ï¼šæŸ¥è¯¢ç”µå½±æ ‡é¢˜åŒ…å«-â€œBeautifulâ€-å’Œ-â€œMindâ€" class="headerlink" title="6. query_string æŸ¥è¯¢ï¼šæŸ¥è¯¢ç”µå½±æ ‡é¢˜åŒ…å« â€œBeautifulâ€ å’Œ â€œMindâ€"></a>6. <strong><code>query_string</code> æŸ¥è¯¢ï¼šæŸ¥è¯¢ç”µå½±æ ‡é¢˜åŒ…å« â€œBeautifulâ€ å’Œ â€œMindâ€</strong></h3><p>æ‰§è¡Œ <code>query_string</code> æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ç”µå½±æ ‡é¢˜ä¸­åŒ…å« <code>&quot;Beautiful&quot;</code> å’Œ <code>&quot;Mind&quot;</code> çš„æ–‡æ¡£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;query_string&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;default_field&quot;</span>: <span class="hljs-string">&quot;title&quot;</span>,<br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;Beautiful AND Mind&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>query_string</code>**ï¼šæ‰§è¡Œå¤æ‚æŸ¥è¯¢ï¼Œå¯ä»¥ä½¿ç”¨å¸ƒå°”æ“ä½œç¬¦ï¼ˆå¦‚ <code>AND</code>ï¼‰ã€‚</li></ul><h3 id="7-query-string-æŸ¥è¯¢ï¼šå¤šä¸ªå­—æ®µæŸ¥è¯¢"><a href="#7-query-string-æŸ¥è¯¢ï¼šå¤šä¸ªå­—æ®µæŸ¥è¯¢" class="headerlink" title="7. query_string æŸ¥è¯¢ï¼šå¤šä¸ªå­—æ®µæŸ¥è¯¢"></a>7. <strong><code>query_string</code> æŸ¥è¯¢ï¼šå¤šä¸ªå­—æ®µæŸ¥è¯¢</strong></h3><p>æŸ¥è¯¢ç”µå½±çš„ <code>title</code> æˆ– <code>year</code> å­—æ®µåŒ…å« <code>&quot;2012&quot;</code> çš„æ–‡æ¡£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;query_string&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;fields&quot;</span>: [<span class="hljs-string">&quot;title&quot;</span>, <span class="hljs-string">&quot;year&quot;</span>],<br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;2012&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>**<code>fields</code>**ï¼šæŒ‡å®šå¤šä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™é‡ŒåŒæ—¶æŸ¥è¯¢ <code>title</code> å’Œ <code>year</code> å­—æ®µã€‚</li></ul><h3 id="8-simple-query-string-æŸ¥è¯¢ï¼šä½¿ç”¨-è¿›è¡ŒçŸ­è¯­åŒ¹é…"><a href="#8-simple-query-string-æŸ¥è¯¢ï¼šä½¿ç”¨-è¿›è¡ŒçŸ­è¯­åŒ¹é…" class="headerlink" title="8. simple_query_string æŸ¥è¯¢ï¼šä½¿ç”¨ + è¿›è¡ŒçŸ­è¯­åŒ¹é…"></a>8. <strong><code>simple_query_string</code> æŸ¥è¯¢ï¼šä½¿ç”¨ <code>+</code> è¿›è¡ŒçŸ­è¯­åŒ¹é…</strong></h3><p>æŸ¥è¯¢ç”µå½±æ ‡é¢˜ä¸­åŒ…å« <code>&quot;Beautiful&quot;</code> å’Œ <code>&quot;mind&quot;</code> çš„æ–‡æ¡£ï¼Œä½¿ç”¨ <code>+</code> ç¡®ä¿ä¸¤ä¸ªè¯éƒ½å‡ºç°åœ¨æŸ¥è¯¢ä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /movies/_search<br>&#123;<br>  <span class="hljs-string">&quot;profile&quot;</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;simple_query_string&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;Beautiful +mind&quot;</span>,<br>      <span class="hljs-string">&quot;fields&quot;</span>: [<span class="hljs-string">&quot;title&quot;</span>]<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong><code>+</code> æ“ä½œç¬¦</strong>ï¼šç”¨äºå¼ºåˆ¶è¦æ±‚æŸä¸ªè¯å‡ºç°åœ¨æŸ¥è¯¢ç»“æœä¸­ã€‚</li></ul><hr><h3 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™äº›æŸ¥è¯¢å±•ç¤ºäº†å¦‚ä½•åœ¨ Elasticsearch ä¸­ä½¿ç”¨ä¸åŒç±»å‹çš„æŸ¥è¯¢ï¼š</p><ul><li><strong><code>query_string</code></strong> æŸ¥è¯¢ï¼šç”¨äºæ‰§è¡Œå¤æ‚çš„æŸ¥è¯¢ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªå­—æ®µã€å¸ƒå°”æ“ä½œç¬¦ï¼ˆANDã€ORã€NOTï¼‰ä»¥åŠé€šé…ç¬¦ç­‰ã€‚</li><li><strong><code>simple_query_string</code></strong> æŸ¥è¯¢ï¼šæ¯” <code>query_string</code> æ›´ç®€å•ï¼Œé€‚ç”¨äºä¸éœ€è¦å¤æ‚è¯­æ³•çš„æŸ¥è¯¢ï¼Œå¹¶ä¸”æ”¯æŒé»˜è®¤æ“ä½œç¬¦çš„é…ç½®ã€‚</li><li><strong>å­—æ®µæŸ¥è¯¢</strong>ï¼šå¯ä»¥é’ˆå¯¹å¤šä¸ªå­—æ®µåŒæ—¶æŸ¥è¯¢ï¼ŒæŒ‡å®šå¤šä¸ªå­—æ®µä½¿ç”¨ <code>fields</code> å‚æ•°ã€‚</li><li><strong>å¸ƒå°”æ“ä½œç¬¦</strong>ï¼šå¦‚ <code>AND</code>ã€<code>OR</code>ã€<code>NOT</code>ï¼Œæ§åˆ¶æŸ¥è¯¢çš„é€»è¾‘ã€‚</li></ul><p>è¿™äº›æŸ¥è¯¢æ–¹å¼éå¸¸é€‚åˆå¤„ç†å¤æ‚çš„æ£€ç´¢éœ€æ±‚ã€‚</p><p>[3.10-DynamicMappingå’Œå¸¸è§å­—æ®µç±»å‹]</p><p>æ‚¨çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ Elasticsearch ä¸­ç®¡ç†æ˜ å°„ï¼ˆMappingï¼‰ä»¥åŠå¦‚ä½•å¤„ç†åŠ¨æ€å­—æ®µå’Œæ˜ å°„æ›´æ–°ã€‚ä»¥ä¸‹æ˜¯æ€»ç»“å’Œè§£é‡Šï¼š</p><h3 id="æ˜ å°„å’Œå­—æ®µå®šä¹‰"><a href="#æ˜ å°„å’Œå­—æ®µå®šä¹‰" class="headerlink" title="æ˜ å°„å’Œå­—æ®µå®šä¹‰"></a><strong>æ˜ å°„å’Œå­—æ®µå®šä¹‰</strong></h3><p>æ˜ å°„åœ¨ Elasticsearch ä¸­ç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ç»“æ„å®šä¹‰ï¼Œä¸»è¦ç”¨äºï¼š</p><ul><li><strong>å®šä¹‰å­—æ®µçš„åç§°</strong>ï¼šæŒ‡å®šæ–‡æ¡£ä¸­çš„å­—æ®µåã€‚</li><li><strong>å®šä¹‰å­—æ®µçš„ç±»å‹</strong>ï¼šæ¯”å¦‚æ–‡æœ¬ï¼ˆ<code>text</code>ï¼‰ã€å…³é”®å­—ï¼ˆ<code>keyword</code>ï¼‰ã€æ—¥æœŸï¼ˆ<code>date</code>ï¼‰ç­‰ã€‚</li><li><strong>å®šä¹‰å€’æ’ç´¢å¼•ç›¸å…³é…ç½®</strong>ï¼šæ¯”å¦‚æ˜¯å¦éœ€è¦ç´¢å¼•å­—æ®µï¼Œä»¥åŠå­—æ®µçš„ <code>Analyzer</code> é…ç½®ã€‚</li></ul><h3 id="åŠ¨æ€æ˜ å°„ï¼ˆDynamic-Mappingï¼‰"><a href="#åŠ¨æ€æ˜ å°„ï¼ˆDynamic-Mappingï¼‰" class="headerlink" title="åŠ¨æ€æ˜ å°„ï¼ˆDynamic Mappingï¼‰"></a><strong>åŠ¨æ€æ˜ å°„ï¼ˆDynamic Mappingï¼‰</strong></h3><p>åŠ¨æ€æ˜ å°„å…è®¸ Elasticsearch æ ¹æ®æ–°æ–‡æ¡£è‡ªåŠ¨æ¨æ–­å­—æ®µçš„ç±»å‹ã€‚å¯ä»¥é€šè¿‡ <code>dynamic</code> å±æ€§æ¥é…ç½®åŠ¨æ€è¡Œä¸ºï¼š</p><ul><li>**<code>true</code>**ï¼ˆé»˜è®¤ï¼‰ï¼šå…è®¸æ–°å­—æ®µè‡ªåŠ¨è¢«ç´¢å¼•å’Œæ˜ å°„ã€‚</li><li>**<code>false</code>**ï¼šç¦æ­¢è‡ªåŠ¨åˆ›å»ºæ–°å­—æ®µï¼Œä½†å·²å­˜åœ¨å­—æ®µå¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚</li><li>**<code>strict</code>**ï¼šç¦æ­¢ä»»ä½•æ–°çš„å­—æ®µã€‚å¦‚æœæ–‡æ¡£åŒ…å«æœªå®šä¹‰çš„å­—æ®µï¼Œå°†å¯¼è‡´é”™è¯¯ã€‚</li></ul><h3 id="æ“ä½œæ¼”ç¤º"><a href="#æ“ä½œæ¼”ç¤º" class="headerlink" title="æ“ä½œæ¼”ç¤º"></a><strong>æ“ä½œæ¼”ç¤º</strong></h3><ol><li><p><strong>å†™å…¥æ–‡æ¡£å¹¶æŸ¥çœ‹æ˜ å°„</strong></p><ul><li>å‘ <code>mapping_test</code> ç´¢å¼•ä¸­æ·»åŠ ä¸€ä¸ªæ–‡æ¡£ï¼ŒæŸ¥çœ‹æ˜ å°„ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT mapping_test/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;firstName&quot;</span>: <span class="hljs-string">&quot;Chan&quot;</span>,<br>  <span class="hljs-string">&quot;lastName&quot;</span>: <span class="hljs-string">&quot;Jackie&quot;</span>,<br>  <span class="hljs-string">&quot;loginDate&quot;</span>: <span class="hljs-string">&quot;2018-07-24T10:29:48.103Z&quot;</span><br>&#125;<br><br>GET mapping_test/_mapping<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>åŠ¨æ€æ˜ å°„ï¼šæ¨æ–­å­—æ®µç±»å‹</strong></p><ul><li>æ–°å­—æ®µ <code>uid</code>, <code>isVip</code>, <code>age</code> ç­‰è¢«è‡ªåŠ¨æ¨æ–­å¹¶åŠ å…¥æ˜ å°„ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT mapping_test/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;uid&quot;</span>: <span class="hljs-string">&quot;123&quot;</span>,<br>  <span class="hljs-string">&quot;isVip&quot;</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-string">&quot;isAdmin&quot;</span>: <span class="hljs-string">&quot;true&quot;</span>,<br>  <span class="hljs-string">&quot;age&quot;</span>: 19,<br>  <span class="hljs-string">&quot;height&quot;</span>: 180<br>&#125;<br><br>GET mapping_test/_mapping<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>æ–°å¢å­—æ®µï¼ˆé»˜è®¤åŠ¨æ€ï¼‰</strong></p><ul><li>å¦‚æœåŠ¨æ€æ˜ å°„ä¸º <code>true</code>ï¼ˆé»˜è®¤ï¼‰ï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ æ–°çš„å­—æ®µï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT dynamic_mapping_test/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;newField&quot;</span>: <span class="hljs-string">&quot;someValue&quot;</span><br>&#125;<br><br>POST dynamic_mapping_test/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;newField&quot;</span>: <span class="hljs-string">&quot;someValue&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>ä¿®æ”¹åŠ¨æ€è®¾ç½®ä¸º <code>false</code></strong></p><ul><li>ä¿®æ”¹ <code>dynamic</code> è®¾ç½®ä¸º <code>false</code>ï¼Œç¦æ­¢è‡ªåŠ¨æ¨æ–­æ–°å­—æ®µï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT dynamic_mapping_test/_mapping<br>&#123;<br>  <span class="hljs-string">&quot;dynamic&quot;</span>: <span class="hljs-literal">false</span><br>&#125;<br><br>PUT dynamic_mapping_test/_doc/10<br>&#123;<br>  <span class="hljs-string">&quot;anotherField&quot;</span>: <span class="hljs-string">&quot;someValue&quot;</span><br>&#125;<br><br>POST dynamic_mapping_test/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;anotherField&quot;</span>: <span class="hljs-string">&quot;someValue&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code>anotherField</code> å°†ä¸ä¼šè¢«ç´¢å¼•æˆ–æœç´¢ï¼Œå› ä¸ºåŠ¨æ€æ˜ å°„å·²è®¾ç½®ä¸º <code>false</code>ã€‚</p></li><li><p><strong>ä¿®æ”¹ä¸º <code>strict</code> æ¨¡å¼</strong></p><ul><li>å¦‚æœå°† <code>dynamic</code> è®¾ç½®ä¸º <code>strict</code>ï¼Œä»»ä½•æ–°çš„å­—æ®µéƒ½ä¼šå¯¼è‡´é”™è¯¯ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT dynamic_mapping_test/_mapping<br>&#123;<br>  <span class="hljs-string">&quot;dynamic&quot;</span>: <span class="hljs-string">&quot;strict&quot;</span><br>&#125;<br><br>PUT dynamic_mapping_test/_doc/12<br>&#123;<br>  <span class="hljs-string">&quot;lastField&quot;</span>: <span class="hljs-string">&quot;value&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>æ­¤æ—¶ï¼Œå†™å…¥æ–°å­—æ®µ <code>lastField</code> ä¼šå¯¼è‡´é”™è¯¯ï¼ŒHTTP è¿”å› <code>400</code> é”™è¯¯ç ã€‚</li></ul></li><li><p><strong>åˆ é™¤ç´¢å¼•</strong></p><ul><li>åˆ é™¤ç´¢å¼•ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE dynamic_mapping_test<br></code></pre></td></tr></table></figure></li></ul></li></ol><h3 id="æ€»ç»“-4"><a href="#æ€»ç»“-4" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h3><ul><li><strong>åŠ¨æ€æ˜ å°„ï¼ˆDynamic Mappingï¼‰</strong>ï¼šå…è®¸ Elasticsearch è‡ªåŠ¨æ¨æ–­å¹¶æ·»åŠ æ–°çš„å­—æ®µï¼Œæ–¹ä¾¿å¿«é€Ÿå¤„ç†æœªçŸ¥æ•°æ®ã€‚</li><li><strong><code>dynamic</code> é…ç½®</strong>ï¼šæ§åˆ¶æ˜¯å¦å…è®¸ Elasticsearch è‡ªåŠ¨æ˜ å°„æ–°å­—æ®µï¼š<ul><li><code>true</code>ï¼šé»˜è®¤å…è®¸åŠ¨æ€å­—æ®µï¼›</li><li><code>false</code>ï¼šç¦æ­¢è‡ªåŠ¨æ˜ å°„æ–°å­—æ®µï¼›</li><li><code>strict</code>ï¼šç¦æ­¢æ‰€æœ‰æœªçŸ¥å­—æ®µï¼Œå¦‚æœæœ‰æœªå®šä¹‰å­—æ®µåˆ™ä¼šæŠ¥é”™ã€‚</li></ul></li><li><strong>æ›´æ”¹æ˜ å°„</strong>ï¼šæ˜ å°„ä¸€æ—¦å»ºç«‹åä¸èƒ½ç›´æ¥ä¿®æ”¹å­—æ®µç±»å‹ï¼Œè¦ä¿®æ”¹å­—æ®µé…ç½®æˆ–æ·»åŠ æ–°å­—æ®µéœ€è¦ä½¿ç”¨ <code>reindex</code> æ“ä½œã€‚</li></ul><p>è¿™äº›æ“ä½œæœ‰åŠ©äºç®¡ç†ç´¢å¼•å’Œå­—æ®µçš„ç”Ÿå‘½å‘¨æœŸï¼Œç¡®ä¿æ•°æ®èƒ½å¤Ÿæ ¹æ®ä¸šåŠ¡éœ€æ±‚çµæ´»é€‚åº”ã€‚</p><p>æ‚¨çš„ç¤ºä¾‹å±•ç¤ºäº† Elasticsearch ä¸­æ˜¾å¼è®¾ç½®æ˜ å°„ï¼ˆMappingï¼‰çš„ä¸€äº›å¸¸è§æ“ä½œå’Œå‚æ•°ã€‚ä»¥ä¸‹æ˜¯å„ä¸ªè®¾ç½®é¡¹çš„è¯¦ç»†ä»‹ç»å’Œä½¿ç”¨æ¡ˆä¾‹ã€‚</p><h3 id="1-index-false-è®¾ç½®"><a href="#1-index-false-è®¾ç½®" class="headerlink" title="1. index: false è®¾ç½®"></a><strong>1. <code>index: false</code> è®¾ç½®</strong></h3><p>é€šè¿‡è®¾ç½®å­—æ®µçš„ <code>index: false</code>ï¼Œå¯ä»¥é˜»æ­¢æŸäº›å­—æ®µè¢«ç´¢å¼•ã€‚è¿™æ ·å¯ä»¥é¿å…è¯¥å­—æ®µå‚ä¸å€’æ’ç´¢å¼•ï¼Œä¹Ÿä¸ä¼šè¿›è¡Œæœç´¢ã€‚</p><p><strong>ç¤ºä¾‹</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE <span class="hljs-built_in">users</span><br>PUT <span class="hljs-built_in">users</span><br>&#123;<br>    <span class="hljs-string">&quot;mappings&quot;</span> : &#123;<br>      <span class="hljs-string">&quot;properties&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;firstName&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;lastName&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;mobile&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span>,<br>          <span class="hljs-string">&quot;index&quot;</span>: <span class="hljs-literal">false</span>  <span class="hljs-comment"># ç¦æ­¢ç´¢å¼•è¯¥å­—æ®µ</span><br>        &#125;<br>      &#125;<br>    &#125;<br>&#125;<br><br>PUT <span class="hljs-built_in">users</span>/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;firstName&quot;</span>: <span class="hljs-string">&quot;Ruan&quot;</span>,<br>  <span class="hljs-string">&quot;lastName&quot;</span>: <span class="hljs-string">&quot;Yiming&quot;</span>,<br>  <span class="hljs-string">&quot;mobile&quot;</span>: <span class="hljs-string">&quot;12345678&quot;</span><br>&#125;<br><br>POST /users/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;mobile&quot;</span>: <span class="hljs-string">&quot;12345678&quot;</span>  <span class="hljs-comment"># æœç´¢æ—¶ä¸ä¼šå‘½ä¸­mobileå­—æ®µ</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>mobile</code> å­—æ®µè¢«è®¾ç½®ä¸º <code>index: false</code>ï¼Œå› æ­¤æ— æ³•ç”¨äºæœç´¢æŸ¥è¯¢ã€‚</p><h3 id="2-null-value-è®¾ç½®"><a href="#2-null-value-è®¾ç½®" class="headerlink" title="2. null_value è®¾ç½®"></a><strong>2. <code>null_value</code> è®¾ç½®</strong></h3><p>é€šè¿‡è®¾ç½® <code>null_value</code>ï¼Œå¯ä»¥åœ¨æ–‡æ¡£ä¸­å­˜å‚¨ <code>null</code> å€¼ï¼Œå¹¶ç”¨æŒ‡å®šçš„æ›¿ä»£å€¼æ›¿æ¢ <code>null</code>ã€‚è¿™å¯¹äºæŸ¥è¯¢æ—¶éœ€è¦å¤„ç† <code>null</code> æ•°æ®ç‰¹åˆ«æœ‰ç”¨ã€‚</p><p><strong>ç¤ºä¾‹</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE <span class="hljs-built_in">users</span><br>PUT <span class="hljs-built_in">users</span><br>&#123;<br>    <span class="hljs-string">&quot;mappings&quot;</span> : &#123;<br>      <span class="hljs-string">&quot;properties&quot;</span> : &#123;<br>        <span class="hljs-string">&quot;firstName&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;lastName&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;mobile&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span>,<br>          <span class="hljs-string">&quot;null_value&quot;</span>: <span class="hljs-string">&quot;NULL&quot;</span>  <span class="hljs-comment"># nullå€¼æ›¿ä»£ä¸º&quot;NULL&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>&#125;<br><br>PUT <span class="hljs-built_in">users</span>/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;firstName&quot;</span>: <span class="hljs-string">&quot;Ruan&quot;</span>,<br>  <span class="hljs-string">&quot;lastName&quot;</span>: <span class="hljs-string">&quot;Yiming&quot;</span>,<br>  <span class="hljs-string">&quot;mobile&quot;</span>: null  <span class="hljs-comment"># å®é™…å€¼æ˜¯null</span><br>&#125;<br><br>PUT <span class="hljs-built_in">users</span>/_doc/2<br>&#123;<br>  <span class="hljs-string">&quot;firstName&quot;</span>: <span class="hljs-string">&quot;Ruan2&quot;</span>,<br>  <span class="hljs-string">&quot;lastName&quot;</span>: <span class="hljs-string">&quot;Yiming2&quot;</span>  <span class="hljs-comment"># æ²¡æœ‰mobileå­—æ®µ</span><br>&#125;<br><br>GET <span class="hljs-built_in">users</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;mobile&quot;</span>: <span class="hljs-string">&quot;NULL&quot;</span>  <span class="hljs-comment"># æœç´¢æ—¶ä¼šåŒ¹é…åˆ°nullå€¼å­—æ®µ</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¤è®¾ç½®å¯ä»¥ç¡®ä¿æŸ¥è¯¢æ—¶ç”¨ <code>NULL</code> ä»£æ›¿å­˜å‚¨çš„ <code>null</code> å€¼ã€‚</p><h3 id="3-copy-to-è®¾ç½®"><a href="#3-copy-to-è®¾ç½®" class="headerlink" title="3. copy_to è®¾ç½®"></a><strong>3. <code>copy_to</code> è®¾ç½®</strong></h3><p><code>copy_to</code> å¯ä»¥å°†å¤šä¸ªå­—æ®µçš„å†…å®¹å¤åˆ¶åˆ°å¦ä¸€ä¸ªå­—æ®µï¼Œæ–¹ä¾¿è¿›è¡Œè”åˆæŸ¥è¯¢æˆ–ç´¢å¼•ã€‚</p><p><strong>ç¤ºä¾‹</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE <span class="hljs-built_in">users</span><br>PUT <span class="hljs-built_in">users</span><br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;firstName&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>        <span class="hljs-string">&quot;copy_to&quot;</span>: <span class="hljs-string">&quot;fullName&quot;</span>  <span class="hljs-comment"># å°†firstNameå¤åˆ¶åˆ°fullNameå­—æ®µ</span><br>      &#125;,<br>      <span class="hljs-string">&quot;lastName&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>        <span class="hljs-string">&quot;copy_to&quot;</span>: <span class="hljs-string">&quot;fullName&quot;</span>  <span class="hljs-comment"># å°†lastNameå¤åˆ¶åˆ°fullNameå­—æ®µ</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br>PUT <span class="hljs-built_in">users</span>/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;firstName&quot;</span>: <span class="hljs-string">&quot;Ruan&quot;</span>,<br>  <span class="hljs-string">&quot;lastName&quot;</span>: <span class="hljs-string">&quot;Yiming&quot;</span><br>&#125;<br><br>GET <span class="hljs-built_in">users</span>/_search?q=fullName:(Ruan Yiming)<br><br>POST <span class="hljs-built_in">users</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;fullName&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;Ruan Yiming&quot;</span>,<br>        <span class="hljs-string">&quot;operator&quot;</span>: <span class="hljs-string">&quot;and&quot;</span>  <span class="hljs-comment"># è”åˆæŸ¥è¯¢fullNameå­—æ®µ</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œ<code>firstName</code> å’Œ <code>lastName</code> å­—æ®µçš„å†…å®¹ä¼šè¢«å¤åˆ¶åˆ° <code>fullName</code> å­—æ®µï¼Œä»è€Œä½¿å¾—æŸ¥è¯¢å˜å¾—æ›´åŠ æ–¹ä¾¿ã€‚</p><h3 id="4-æ•°ç»„ç±»å‹å¤„ç†"><a href="#4-æ•°ç»„ç±»å‹å¤„ç†" class="headerlink" title="4. æ•°ç»„ç±»å‹å¤„ç†"></a><strong>4. æ•°ç»„ç±»å‹å¤„ç†</strong></h3><p>Elasticsearch æ”¯æŒæ•°ç»„å­—æ®µã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ä¼šè¢«è§†ä¸ºä¸€ä¸ªå•ç‹¬çš„å€¼ï¼Œè¿™å¯¹äºå¤šå€¼å­—æ®µéå¸¸æœ‰ç”¨ã€‚</p><p><strong>ç¤ºä¾‹</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT <span class="hljs-built_in">users</span>/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;onebird&quot;</span>,<br>  <span class="hljs-string">&quot;interests&quot;</span>: <span class="hljs-string">&quot;reading&quot;</span>  <span class="hljs-comment"># å­—æ®µä¸ºå•ä¸€å€¼</span><br>&#125;<br><br>PUT <span class="hljs-built_in">users</span>/_doc/2<br>&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;twobirds&quot;</span>,<br>  <span class="hljs-string">&quot;interests&quot;</span>: [<span class="hljs-string">&quot;reading&quot;</span>, <span class="hljs-string">&quot;music&quot;</span>]  <span class="hljs-comment"># å­—æ®µä¸ºæ•°ç»„</span><br>&#125;<br><br>POST <span class="hljs-built_in">users</span>/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br><br>GET <span class="hljs-built_in">users</span>/_mapping<br></code></pre></td></tr></table></figure><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code>interests</code> å­—æ®µæ—¢å¯ä»¥æ˜¯å•ä¸ªå€¼ä¹Ÿå¯ä»¥æ˜¯æ•°ç»„ï¼ŒElasticsearch ä¼šå°†æ¯ä¸ªæ•°ç»„å…ƒç´ è§†ä¸ºç‹¬ç«‹çš„å€¼è¿›è¡Œç´¢å¼•ã€‚</p><hr><h3 id="æ€»ç»“å¸¸è§çš„-Mapping-å‚æ•°"><a href="#æ€»ç»“å¸¸è§çš„-Mapping-å‚æ•°" class="headerlink" title="æ€»ç»“å¸¸è§çš„ Mapping å‚æ•°"></a><strong>æ€»ç»“å¸¸è§çš„ Mapping å‚æ•°</strong></h3><ul><li><strong><code>type</code></strong>: å­—æ®µçš„æ•°æ®ç±»å‹ï¼Œå¦‚ <code>text</code>, <code>keyword</code>, <code>date</code> ç­‰ã€‚</li><li><strong><code>index</code></strong>: æ§åˆ¶æ˜¯å¦ç´¢å¼•è¯¥å­—æ®µï¼Œ<code>false</code> è¡¨ç¤ºä¸ç´¢å¼•ï¼Œé»˜è®¤ä¸º <code>true</code>ã€‚</li><li><strong><code>null_value</code></strong>: æ§åˆ¶ <code>null</code> å€¼çš„æ›¿ä»£å€¼ã€‚å¯ä»¥è®¾ç½®ä¸ºä»»ä½•æ›¿ä»£å€¼ï¼Œå¦‚ <code>&quot;NULL&quot;</code>ã€‚</li><li><strong><code>copy_to</code></strong>: å°†å¤šä¸ªå­—æ®µçš„å†…å®¹å¤åˆ¶åˆ°ä¸€ä¸ªç›®æ ‡å­—æ®µä¸­ï¼Œä¾¿äºè”åˆæŸ¥è¯¢ã€‚</li><li><strong><code>dynamic</code></strong>: æ§åˆ¶åŠ¨æ€æ˜ å°„ï¼Œ<code>true</code> è¡¨ç¤ºå…è®¸è‡ªåŠ¨æ¨æ–­æ–°å­—æ®µï¼Œ<code>false</code> è¡¨ç¤ºç¦æ­¢æ–°å­—æ®µè‡ªåŠ¨æ˜ å°„ï¼Œ<code>strict</code> åˆ™è¡¨ç¤ºä¸¥æ ¼æ¨¡å¼ä¸‹ä¸å…è®¸ä»»ä½•æ–°å­—æ®µã€‚</li></ul><p>é€šè¿‡è¿™äº›æ˜ å°„è®¾ç½®ï¼Œå¯ä»¥æ›´å¥½åœ°æ§åˆ¶æ•°æ®å¦‚ä½•å­˜å‚¨å’Œç´¢å¼•ï¼Œä»¥åŠå¦‚ä½•åœ¨æŸ¥è¯¢æ—¶å¤„ç†å’Œä¼˜åŒ–å­—æ®µã€‚</p><p>æ‚¨çš„ç¤ºä¾‹å±•ç¤ºäº† Elasticsearch ä¸­å…³äºå¤šå­—æ®µç‰¹æ€§ä»¥åŠè‡ªå®šä¹‰åˆ†æå™¨ï¼ˆAnalyzerï¼‰çš„é…ç½®ã€‚ä»¥ä¸‹æ˜¯å¯¹å„ä¸ªåˆ†æå™¨å’Œç›¸å…³é…ç½®çš„è¯¦ç»†è§£é‡Šã€‚</p><h3 id="1-è‡ªå®šä¹‰-Analyzer-å’Œ-Char-Filter"><a href="#1-è‡ªå®šä¹‰-Analyzer-å’Œ-Char-Filter" class="headerlink" title="1. è‡ªå®šä¹‰ Analyzer å’Œ Char Filter"></a><strong>1. è‡ªå®šä¹‰ Analyzer å’Œ Char Filter</strong></h3><p>Elasticsearch æä¾›äº†çµæ´»çš„æœºåˆ¶æ¥é…ç½®åˆ†è¯å™¨ï¼ˆTokenizerï¼‰å’Œå­—ç¬¦è¿‡æ»¤å™¨ï¼ˆChar Filterï¼‰ã€‚è¿™äº›é…ç½®ç”¨äºåœ¨ç´¢å¼•å’Œæœç´¢è¿‡ç¨‹ä¸­æ§åˆ¶æ–‡æœ¬çš„å¤„ç†æ–¹å¼ã€‚</p><h4 id="è‡ªå®šä¹‰-Tokenizer-å’Œ-Char-Filter-ç¤ºä¾‹"><a href="#è‡ªå®šä¹‰-Tokenizer-å’Œ-Char-Filter-ç¤ºä¾‹" class="headerlink" title="è‡ªå®šä¹‰ Tokenizer å’Œ Char Filter ç¤ºä¾‹"></a><strong>è‡ªå®šä¹‰ Tokenizer å’Œ Char Filter ç¤ºä¾‹</strong></h4><ul><li><strong>Keyword Tokenizer</strong>: <code>keyword</code> tokenizer å°†æ•´ä¸ªæ–‡æœ¬å½“ä½œä¸€ä¸ªå•ç‹¬çš„ token è¿›è¡Œå¤„ç†ã€‚</li><li><strong>HTML Strip Char Filter</strong>: <code>html_strip</code> char filter ç”¨äºä»æ–‡æœ¬ä¸­å»é™¤ HTML æ ‡ç­¾ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;tokenizer&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span>,  <span class="hljs-comment"># ä½¿ç”¨å…³é”®è¯åˆ†è¯å™¨</span><br>  <span class="hljs-string">&quot;char_filter&quot;</span>: [<span class="hljs-string">&quot;html_strip&quot;</span>],  <span class="hljs-comment"># ä½¿ç”¨html_stripå­—ç¬¦è¿‡æ»¤å™¨</span><br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;&lt;b&gt;hello world&lt;/b&gt;&quot;</span>  <span class="hljs-comment"># è¾“å…¥å¸¦æœ‰HTMLæ ‡ç­¾çš„æ–‡æœ¬</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºå°†ä¼šæ˜¯ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hello world&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;word&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>æ­¤é…ç½®ç§»é™¤äº†æ–‡æœ¬ä¸­çš„ <code>&lt;b&gt;&lt;/b&gt;</code> HTML æ ‡ç­¾ï¼Œåªä¿ç•™äº†çº¯æ–‡æœ¬ â€œhello worldâ€ã€‚</p><h4 id="Path-Hierarchy-Tokenizer"><a href="#Path-Hierarchy-Tokenizer" class="headerlink" title="Path Hierarchy Tokenizer"></a><strong>Path Hierarchy Tokenizer</strong></h4><p><code>path_hierarchy</code> tokenizer ç”¨äºå¤„ç†æ–‡ä»¶è·¯å¾„ç­‰å±‚çº§ç»“æ„çš„æ•°æ®ï¼Œå°†è·¯å¾„æŒ‰åˆ†éš”ç¬¦ï¼ˆå¦‚ <code>/</code>ï¼‰åˆ‡å‰²ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;tokenizer&quot;</span>: <span class="hljs-string">&quot;path_hierarchy&quot;</span>,  <span class="hljs-comment"># ä½¿ç”¨è·¯å¾„å±‚çº§åˆ†è¯å™¨</span><br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;/user/ymruan/a/b/c/d/e&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºä¼šå°†è·¯å¾„æŒ‰ <code>/</code> åˆ‡åˆ†ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/user/ymruan/a/b/c/d/e&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">21</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;word&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/user/ymruan/a/b/c/d&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;word&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    ...<br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="2-Char-Filter-æ›¿æ¢ç¬¦å·"><a href="#2-Char-Filter-æ›¿æ¢ç¬¦å·" class="headerlink" title="2. Char Filter æ›¿æ¢ç¬¦å·"></a><strong>2. Char Filter æ›¿æ¢ç¬¦å·</strong></h3><p>å­—ç¬¦è¿‡æ»¤å™¨å¯ä»¥ç”¨äºæ›¿æ¢æ–‡æœ¬ä¸­çš„ç‰¹å®šç¬¦å·æˆ–å­—ç¬¦ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>mapping</code> ç±»å‹çš„ <code>char_filter</code>ï¼Œå¯ä»¥æ›¿æ¢æ–‡æœ¬ä¸­çš„å­—ç¬¦ï¼ˆå¦‚å°† <code>-</code> æ›¿æ¢ä¸º <code>_</code>ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;tokenizer&quot;</span>: <span class="hljs-string">&quot;standard&quot;</span>,  <span class="hljs-comment"># ä½¿ç”¨æ ‡å‡†åˆ†è¯å™¨</span><br>  <span class="hljs-string">&quot;char_filter&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;mapping&quot;</span>,  <span class="hljs-comment"># ä½¿ç”¨å­—ç¬¦æ˜ å°„è¿‡æ»¤å™¨</span><br>      <span class="hljs-string">&quot;mappings&quot;</span>: [<span class="hljs-string">&quot;- =&gt; _&quot;</span>]<br>    &#125;<br>  ],<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;123-456, I-test! test-990 650-555-1234&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¤é…ç½®å°†æ–‡æœ¬ä¸­çš„ <code>-</code> æ›¿æ¢ä¸º <code>_</code>ï¼Œè¾“å‡ºå°†æ˜¯ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;123_456&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">7</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;word&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    ...<br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="3-Char-Filter-æ›¿æ¢è¡¨æƒ…ç¬¦å·"><a href="#3-Char-Filter-æ›¿æ¢è¡¨æƒ…ç¬¦å·" class="headerlink" title="3. Char Filter æ›¿æ¢è¡¨æƒ…ç¬¦å·"></a><strong>3. Char Filter æ›¿æ¢è¡¨æƒ…ç¬¦å·</strong></h3><p>ä½ è¿˜å¯ä»¥ä½¿ç”¨å­—ç¬¦è¿‡æ»¤å™¨å°†è¡¨æƒ…ç¬¦å·æ›¿æ¢ä¸ºç‰¹å®šçš„æ–‡æœ¬ï¼ˆå¦‚å°† <code>:)</code> æ›¿æ¢ä¸º <code>happy</code>ï¼Œ<code>:(</code> æ›¿æ¢ä¸º <code>sad</code>ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;tokenizer&quot;</span>: <span class="hljs-string">&quot;standard&quot;</span>,<br>  <span class="hljs-string">&quot;char_filter&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;mapping&quot;</span>,<br>      <span class="hljs-string">&quot;mappings&quot;</span>: [<span class="hljs-string">&quot;:) =&gt; happy&quot;</span>, <span class="hljs-string">&quot;:( =&gt; sad&quot;</span>]<br>    &#125;<br>  ],<br>  <span class="hljs-string">&quot;text&quot;</span>: [<span class="hljs-string">&quot;I am felling :)&quot;</span>, <span class="hljs-string">&quot;Feeling :( today&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;I&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;word&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;am&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;word&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;felling&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;word&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;happy&quot;</span><span class="hljs-punctuation">,</span>  # æ›¿æ¢è¡¨æƒ…ç¬¦å·<span class="hljs-punctuation">:</span>) ä¸º happy<br>      <span class="hljs-attr">&quot;start_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">13</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">18</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;word&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="4-ä½¿ç”¨-Stop-å’Œ-Snowball-è¿‡æ»¤å™¨"><a href="#4-ä½¿ç”¨-Stop-å’Œ-Snowball-è¿‡æ»¤å™¨" class="headerlink" title="4. ä½¿ç”¨ Stop å’Œ Snowball è¿‡æ»¤å™¨"></a><strong>4. ä½¿ç”¨ Stop å’Œ Snowball è¿‡æ»¤å™¨</strong></h3><p>ä½¿ç”¨ <code>stop</code> è¿‡æ»¤å™¨æ¥åˆ é™¤å¸¸è§çš„åœç”¨è¯ï¼Œä½¿ç”¨ <code>snowball</code> è¿‡æ»¤å™¨è¿›è¡Œè¯å¹²æå–ï¼ˆå¦‚å°† â€œplayingâ€ è½¬æ¢ä¸º â€œplayâ€ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET _analyze<br>&#123;<br>  <span class="hljs-string">&quot;tokenizer&quot;</span>: <span class="hljs-string">&quot;whitespace&quot;</span>,  <span class="hljs-comment"># ä½¿ç”¨ç©ºæ ¼åˆ†è¯å™¨</span><br>  <span class="hljs-string">&quot;filter&quot;</span>: [<span class="hljs-string">&quot;stop&quot;</span>, <span class="hljs-string">&quot;snowball&quot;</span>],  <span class="hljs-comment"># ä½¿ç”¨åœç”¨è¯å’Œè¯å¹²æå–</span><br>  <span class="hljs-string">&quot;text&quot;</span>: [<span class="hljs-string">&quot;The girls in China are playing this game!&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;girl&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">9</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;word&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;china&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">19</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;word&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    ...<br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="5-æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢"><a href="#5-æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢" class="headerlink" title="5. æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢"></a><strong>5. æ­£åˆ™è¡¨è¾¾å¼æ›¿æ¢</strong></h3><p>é€šè¿‡ <code>pattern_replace</code> å­—ç¬¦è¿‡æ»¤å™¨ï¼Œæ‚¨å¯ä»¥æ ¹æ®æ­£åˆ™è¡¨è¾¾å¼æ¥æ›¿æ¢æ–‡æœ¬ä¸­çš„ç‰¹å®šéƒ¨åˆ†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">POST _analyze<br>&#123;<br>  <span class="hljs-string">&quot;tokenizer&quot;</span>: <span class="hljs-string">&quot;standard&quot;</span>,<br>  <span class="hljs-string">&quot;char_filter&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;pattern_replace&quot;</span>,<br>      <span class="hljs-string">&quot;pattern&quot;</span>: <span class="hljs-string">&quot;http://(.*)&quot;</span>,<br>      <span class="hljs-string">&quot;replacement&quot;</span>: <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span><br>    &#125;<br>  ],<br>  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;http://www.elastic.co&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¤é…ç½®å°† <code>http://</code> æ›¿æ¢ä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œç»“æœä¸ºï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;tokens&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;www.elastic.co&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;start_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">7</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;end_offset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">23</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;word&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a><strong>æ€»ç»“ï¼š</strong></h3><ul><li><strong>Tokenizer</strong>: è´Ÿè´£å°†è¾“å…¥æ–‡æœ¬åˆ‡å‰²æˆè¯æ¡ï¼ˆtokenï¼‰ã€‚å¦‚ <code>keyword</code>, <code>standard</code>, <code>path_hierarchy</code>ã€‚</li><li><strong>Char Filter</strong>: å¤„ç†æ–‡æœ¬ä¸­çš„å­—ç¬¦æ›¿æ¢ã€å»é™¤ç‰¹æ®Šç¬¦å·æˆ–HTMLæ ‡ç­¾ç­‰ï¼Œå¦‚ <code>html_strip</code>, <code>mapping</code>, <code>pattern_replace</code>ã€‚</li><li><strong>Filter</strong>: ç”¨äºæ–‡æœ¬å¤„ç†ï¼Œå¦‚å»é™¤åœç”¨è¯ï¼ˆ<code>stop</code>ï¼‰æˆ–è¯å¹²æå–ï¼ˆ<code>snowball</code>ï¼‰ã€‚</li></ul><p>è¿™äº›å·¥å…·çš„ç»„åˆå…è®¸æ‚¨çµæ´»åœ°å¤„ç†å’Œåˆ†ææ–‡æœ¬æ•°æ®ï¼Œå¹¶é’ˆå¯¹ç‰¹å®šçš„ä¸šåŠ¡éœ€æ±‚ä¼˜åŒ–ç´¢å¼•å’Œæœç´¢è¡Œä¸ºã€‚</p><p>åœ¨ Elasticsearch ä¸­ï¼Œ<strong>Index Templates</strong> å’Œ <strong>Dynamic Templates</strong> æ˜¯ä¸¤ç§å¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºæ§åˆ¶å¦‚ä½•å®šä¹‰å’Œç®¡ç†ç´¢å¼•çš„æ˜ å°„å’Œè®¾ç½®ã€‚ä»¥ä¸‹æ˜¯è¿™ä¸¤è€…çš„è¯¦ç»†è§£é‡Šå’Œç¤ºä¾‹ã€‚</p><h3 id="1-Index-Templates-ç´¢å¼•æ¨¡æ¿"><a href="#1-Index-Templates-ç´¢å¼•æ¨¡æ¿" class="headerlink" title="1. Index Templates (ç´¢å¼•æ¨¡æ¿)"></a><strong>1. Index Templates (ç´¢å¼•æ¨¡æ¿)</strong></h3><p><strong>Index Templates</strong> æ˜¯ä¸€ç§é…ç½®æ¨¡æ¿ï¼Œç”¨äºä¸ºåŒ¹é…ç‰¹å®šæ¨¡å¼çš„ç´¢å¼•è‡ªåŠ¨é…ç½®è®¾ç½®ã€æ˜ å°„å’Œå…¶ä»–é…ç½®ã€‚å½“åˆ›å»ºä¸€ä¸ªæ–°ç´¢å¼•æ—¶ï¼Œå¦‚æœè¯¥ç´¢å¼•åŒ¹é…æ¨¡æ¿ä¸­çš„ <code>index_patterns</code> é…ç½®ï¼Œæ¨¡æ¿ä¸­çš„è®¾ç½®ã€æ˜ å°„å’Œå…¶ä»–é…ç½®å°±ä¼šè‡ªåŠ¨åº”ç”¨åˆ°æ–°ç´¢å¼•ä¸Šã€‚</p><h4 id="åˆ›å»ºé»˜è®¤æ¨¡æ¿"><a href="#åˆ›å»ºé»˜è®¤æ¨¡æ¿" class="headerlink" title="åˆ›å»ºé»˜è®¤æ¨¡æ¿"></a><strong>åˆ›å»ºé»˜è®¤æ¨¡æ¿</strong></h4><p>ä¸‹é¢æ˜¯åˆ›å»ºä¸€ä¸ªé»˜è®¤æ¨¡æ¿çš„ç¤ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT _template/template_default<br>&#123;<br>  <span class="hljs-string">&quot;index_patterns&quot;</span>: [<span class="hljs-string">&quot;*&quot;</span>],  <span class="hljs-comment"># åŒ¹é…æ‰€æœ‰ç´¢å¼•</span><br>  <span class="hljs-string">&quot;order&quot;</span>: 0,<br>  <span class="hljs-string">&quot;version&quot;</span>: 1,<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>: 1,<br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span>: 1<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¼šä¸ºæ‰€æœ‰ç´¢å¼•è®¾ç½®ä¸€ä¸ªæ¨¡æ¿ï¼Œå…¶ä¸­åŒ…å«åˆ†ç‰‡æ•°é‡ä¸º1ã€å‰¯æœ¬æ•°é‡ä¸º1ã€‚</p><h4 id="ä¸ºç‰¹å®šæ¨¡å¼åˆ›å»ºæ¨¡æ¿"><a href="#ä¸ºç‰¹å®šæ¨¡å¼åˆ›å»ºæ¨¡æ¿" class="headerlink" title="ä¸ºç‰¹å®šæ¨¡å¼åˆ›å»ºæ¨¡æ¿"></a><strong>ä¸ºç‰¹å®šæ¨¡å¼åˆ›å»ºæ¨¡æ¿</strong></h4><p>å¦ä¸€ä¸ªä¾‹å­æ˜¯ä¸º <code>test*</code> å¼€å¤´çš„ç´¢å¼•åˆ›å»ºæ¨¡æ¿ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT /_template/template_test<br>&#123;<br>  <span class="hljs-string">&quot;index_patterns&quot;</span>: [<span class="hljs-string">&quot;test*&quot;</span>],  <span class="hljs-comment"># åŒ¹é…æ‰€æœ‰ä»¥testå¼€å¤´çš„ç´¢å¼•</span><br>  <span class="hljs-string">&quot;order&quot;</span>: 1,<br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>: 1,<br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span>: 2<br>  &#125;,<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;date_detection&quot;</span>: <span class="hljs-literal">false</span>,  <span class="hljs-comment"># ç¦æ­¢è‡ªåŠ¨æ£€æµ‹æ—¥æœŸå­—æ®µ</span><br>    <span class="hljs-string">&quot;numeric_detection&quot;</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment"># è‡ªåŠ¨æ£€æµ‹æ•°å­—å­—æ®µ</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æ¨¡æ¿"><a href="#æŸ¥çœ‹æ¨¡æ¿" class="headerlink" title="æŸ¥çœ‹æ¨¡æ¿"></a><strong>æŸ¥çœ‹æ¨¡æ¿</strong></h4><p>ä½ å¯ä»¥æŸ¥çœ‹å·²å®šä¹‰çš„æ¨¡æ¿ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET /_template/template_default<br>GET /_template/temp*  <span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰æ¨¡æ¿</span><br></code></pre></td></tr></table></figure><h4 id="åˆ é™¤æ¨¡æ¿"><a href="#åˆ é™¤æ¨¡æ¿" class="headerlink" title="åˆ é™¤æ¨¡æ¿"></a><strong>åˆ é™¤æ¨¡æ¿</strong></h4><p>åˆ é™¤æ¨¡æ¿çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE /_template/template_default<br>DELETE /_template/template_test<br></code></pre></td></tr></table></figure><hr><h3 id="2-Dynamic-Templates-åŠ¨æ€æ¨¡æ¿"><a href="#2-Dynamic-Templates-åŠ¨æ€æ¨¡æ¿" class="headerlink" title="2. Dynamic Templates (åŠ¨æ€æ¨¡æ¿)"></a><strong>2. Dynamic Templates (åŠ¨æ€æ¨¡æ¿)</strong></h3><p><strong>Dynamic Templates</strong> ç”¨äºåœ¨åˆ›å»ºç´¢å¼•æ—¶è‡ªåŠ¨åŒ¹é…å­—æ®µç±»å‹å’Œåç§°ï¼Œæ ¹æ®è¿™äº›åŠ¨æ€æ¨¡æ¿æ¥ç”Ÿæˆå­—æ®µçš„æ˜ å°„è§„åˆ™ã€‚å¯ä»¥æ ¹æ®å­—æ®µçš„ç±»å‹ï¼ˆä¾‹å¦‚å­—ç¬¦ä¸²ã€æ•°å­—ï¼‰å’Œå­—æ®µåç§°ï¼ˆä¾‹å¦‚ä»¥æŸäº›å­—ç¬¦å¼€å¤´çš„å­—æ®µï¼‰æ¥å®šä¹‰æ˜ å°„ã€‚</p><h4 id="è‡ªåŠ¨æ˜ å°„æ•°å­—å­—ç¬¦ä¸²å’Œæ—¥æœŸå­—ç¬¦ä¸²"><a href="#è‡ªåŠ¨æ˜ å°„æ•°å­—å­—ç¬¦ä¸²å’Œæ—¥æœŸå­—ç¬¦ä¸²" class="headerlink" title="è‡ªåŠ¨æ˜ å°„æ•°å­—å­—ç¬¦ä¸²å’Œæ—¥æœŸå­—ç¬¦ä¸²"></a><strong>è‡ªåŠ¨æ˜ å°„æ•°å­—å­—ç¬¦ä¸²å’Œæ—¥æœŸå­—ç¬¦ä¸²</strong></h4><p>ä¾‹å¦‚ï¼Œæ•°å­—å­—ç¬¦ä¸²ä¼šè¢«æ˜ å°„ä¸º <code>text</code> ç±»å‹ï¼Œæ—¥æœŸå­—ç¬¦ä¸²ä¼šè¢«æ˜ å°„ä¸ºæ—¥æœŸç±»å‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT ttemplate/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;someNumber&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,        <span class="hljs-comment"># å­—ç¬¦ä¸²æ•°å­—</span><br>  <span class="hljs-string">&quot;someDate&quot;</span>: <span class="hljs-string">&quot;2019/01/01&quot;</span>  <span class="hljs-comment"># å­—ç¬¦ä¸²æ—¥æœŸ</span><br>&#125;<br>GET ttemplate/_mapping<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>someNumber</code> ä¼šè¢«æ˜ å°„æˆ <code>text</code> ç±»å‹ï¼Œè€Œ <code>someDate</code> ä¼šè¢«æ˜ å°„æˆ <code>date</code> ç±»å‹ã€‚</p><h4 id="å®šä¹‰åŠ¨æ€æ¨¡æ¿æ˜ å°„è§„åˆ™"><a href="#å®šä¹‰åŠ¨æ€æ¨¡æ¿æ˜ å°„è§„åˆ™" class="headerlink" title="å®šä¹‰åŠ¨æ€æ¨¡æ¿æ˜ å°„è§„åˆ™"></a><strong>å®šä¹‰åŠ¨æ€æ¨¡æ¿æ˜ å°„è§„åˆ™</strong></h4><p>ä½¿ç”¨ <code>dynamic_templates</code> å¯ä»¥æ ¹æ®å­—æ®µç±»å‹å’Œåç§°å®šä¹‰æ˜ å°„ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹åŠ¨æ€æ¨¡æ¿å°†ä»¥ <code>is*</code> å¼€å¤´çš„å­—ç¬¦ä¸²å­—æ®µæ˜ å°„ä¸º <code>boolean</code> ç±»å‹ï¼Œå…¶ä»–å­—ç¬¦ä¸²å­—æ®µæ˜ å°„ä¸º <code>keyword</code> ç±»å‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">DELETE my_index<br><br>PUT my_index<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;dynamic_templates&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;strings_as_boolean&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;match_mapping_type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,   <span class="hljs-comment"># åŒ¹é…æ‰€æœ‰å­—ç¬¦ä¸²ç±»å‹</span><br>          <span class="hljs-string">&quot;match&quot;</span>: <span class="hljs-string">&quot;is*&quot;</span>,  <span class="hljs-comment"># å­—æ®µåç§°ä»¥iså¼€å¤´</span><br>          <span class="hljs-string">&quot;mapping&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;boolean&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;,<br>      &#123;<br>        <span class="hljs-string">&quot;strings_as_keywords&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;match_mapping_type&quot;</span>: <span class="hljs-string">&quot;string&quot;</span>,   <span class="hljs-comment"># åŒ¹é…æ‰€æœ‰å­—ç¬¦ä¸²ç±»å‹</span><br>          <span class="hljs-string">&quot;mapping&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>isVIP</code> å­—æ®µä¼šè¢«æ˜ å°„ä¸º <code>boolean</code> ç±»å‹ï¼Œè€Œå…¶ä»–å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µåˆ™ä¼šè¢«æ˜ å°„ä¸º <code>keyword</code> ç±»å‹ã€‚</p><h4 id="ç»“åˆè·¯å¾„åŒ¹é…"><a href="#ç»“åˆè·¯å¾„åŒ¹é…" class="headerlink" title="ç»“åˆè·¯å¾„åŒ¹é…"></a><strong>ç»“åˆè·¯å¾„åŒ¹é…</strong></h4><p>åŠ¨æ€æ¨¡æ¿ä¸ä»…å¯ä»¥åŸºäºå­—æ®µåç§°ï¼Œè¿˜å¯ä»¥åŸºäºå­—æ®µçš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ¨¡æ¿ä¼šå°† <code>name.*</code> è·¯å¾„ä¸‹çš„æ‰€æœ‰å­—æ®µæ˜ å°„ä¸º <code>text</code> ç±»å‹ï¼Œå¹¶å°†è¿™äº›å­—æ®µå¤åˆ¶åˆ° <code>full_name</code> å­—æ®µä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT my_index<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;dynamic_templates&quot;</span>: [<br>      &#123;<br>        <span class="hljs-string">&quot;full_name&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;path_match&quot;</span>: <span class="hljs-string">&quot;name.*&quot;</span>,  <span class="hljs-comment"># åŒ¹é…nameä¸‹çš„æ‰€æœ‰å­—æ®µ</span><br>          <span class="hljs-string">&quot;path_unmatch&quot;</span>: <span class="hljs-string">&quot;*.middle&quot;</span>,  <span class="hljs-comment"># æ’é™¤middleå­—æ®µ</span><br>          <span class="hljs-string">&quot;mapping&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>            <span class="hljs-string">&quot;copy_to&quot;</span>: <span class="hljs-string">&quot;full_name&quot;</span>  <span class="hljs-comment"># å°†å€¼å¤åˆ¶åˆ°full_nameå­—æ®µ</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œæ’å…¥ä»¥ä¸‹æ•°æ®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT my_index/_doc/1<br>&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;first&quot;</span>: <span class="hljs-string">&quot;John&quot;</span>,<br>    <span class="hljs-string">&quot;middle&quot;</span>: <span class="hljs-string">&quot;Winston&quot;</span>,<br>    <span class="hljs-string">&quot;last&quot;</span>: <span class="hljs-string">&quot;Lennon&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>first</code> å’Œ <code>last</code> å­—æ®µå°†è¢«æ˜ å°„ä¸º <code>text</code> ç±»å‹ï¼Œå¹¶ä¸”å®ƒä»¬çš„å†…å®¹ä¼šè¢«å¤åˆ¶åˆ° <code>full_name</code> å­—æ®µä¸­ã€‚</p><h4 id="æœç´¢å­—æ®µ"><a href="#æœç´¢å­—æ®µ" class="headerlink" title="æœç´¢å­—æ®µ"></a><strong>æœç´¢å­—æ®µ</strong></h4><p>å¯ä»¥é€šè¿‡ <code>full_name</code> å­—æ®µæ¥æœç´¢ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET my_index/_search?q=full_name:John<br></code></pre></td></tr></table></figure><hr><h3 id="æ€»ç»“ï¼š-1"><a href="#æ€»ç»“ï¼š-1" class="headerlink" title="æ€»ç»“ï¼š"></a><strong>æ€»ç»“ï¼š</strong></h3><ul><li><strong>Index Templates</strong> æ˜¯ä¸ºåŒ¹é…ç‰¹å®šç´¢å¼•æ¨¡å¼ï¼ˆ<code>index_patterns</code>ï¼‰çš„æ‰€æœ‰ç´¢å¼•è‡ªåŠ¨é…ç½®è®¾ç½®å’Œæ˜ å°„çš„æ¨¡æ¿ã€‚</li><li><strong>Dynamic Templates</strong> ç”¨äºæ ¹æ®å­—æ®µç±»å‹å’Œå­—æ®µåç§°è‡ªåŠ¨æ˜ å°„ç´¢å¼•å­—æ®µã€‚ä½ å¯ä»¥æ ¹æ®å­—æ®µç±»å‹ï¼ˆå¦‚ <code>string</code>ï¼‰æˆ–å­—æ®µè·¯å¾„ï¼ˆå¦‚ <code>name.*</code>ï¼‰æ¥å®šä¹‰æ˜ å°„è§„åˆ™ã€‚</li></ul><p>è¿™äº›é…ç½®ä½¿å¾—ç´¢å¼•çš„åˆ›å»ºå’Œç®¡ç†æ›´åŠ çµæ´»ï¼Œå¯ä»¥æ ¹æ®å®é™…æ•°æ®è‡ªåŠ¨æ¨æ–­å’Œè°ƒæ•´æ˜ å°„ï¼Œä»è€Œæé«˜äº† Elasticsearch çš„å¯ç”¨æ€§å’Œæ•ˆç‡ã€‚</p><p>Elasticsearch æä¾›äº†å¼ºå¤§çš„ <strong>èšåˆ</strong> åŠŸèƒ½ï¼Œç”¨äºå¯¹æ•°æ®è¿›è¡Œæ±‡æ€»å’Œåˆ†æã€‚èšåˆæ˜¯ Elasticsearch æœç´¢çš„ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼Œå…è®¸ä½ é€šè¿‡å¤šç§æ–¹å¼å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ã€ç»Ÿè®¡ã€æ±‚æœ€å¤§&#x2F;æœ€å°å€¼ã€è®¡ç®—å¹³å‡å€¼ç­‰æ“ä½œã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„èšåˆåˆ†ææ“ä½œå’Œç¤ºä¾‹ï¼š</p><h3 id="1-åŸºæœ¬çš„èšåˆåˆ†æï¼šæŒ‰ç›®çš„åœ°åˆ†æ¡¶ç»Ÿè®¡"><a href="#1-åŸºæœ¬çš„èšåˆåˆ†æï¼šæŒ‰ç›®çš„åœ°åˆ†æ¡¶ç»Ÿè®¡" class="headerlink" title="1. åŸºæœ¬çš„èšåˆåˆ†æï¼šæŒ‰ç›®çš„åœ°åˆ†æ¡¶ç»Ÿè®¡"></a><strong>1. åŸºæœ¬çš„èšåˆåˆ†æï¼šæŒ‰ç›®çš„åœ°åˆ†æ¡¶ç»Ÿè®¡</strong></h3><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æŒ‰èˆªç­çš„ç›®çš„åœ°ï¼ˆ<code>DestCountry</code>ï¼‰è¿›è¡Œåˆ†æ¡¶ç»Ÿè®¡ï¼ŒæŸ¥çœ‹æ¯ä¸ªç›®çš„åœ°çš„èˆªç­æ•°é‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET kibana_sample_data_flights/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,  <span class="hljs-comment"># ä¸è¿”å›å®é™…çš„æ–‡æ¡£æ•°æ®ï¼Œåªè¿”å›èšåˆç»“æœ</span><br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;flight_dest&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;DestCountry&quot;</span>  <span class="hljs-comment"># æŒ‰ç›®çš„åœ°å›½å®¶åˆ†æ¡¶</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªèšåˆæŸ¥è¯¢ä¸­ï¼Œ<code>terms</code> èšåˆç”¨äºå¯¹ <code>DestCountry</code> å­—æ®µçš„å€¼è¿›è¡Œåˆ†æ¡¶ï¼Œè¿”å›æ¯ä¸ªç›®çš„åœ°å›½å®¶çš„èˆªç­æ•°é‡ã€‚</p><h3 id="2-å¢åŠ æ›´å¤šç»Ÿè®¡ï¼šå¹³å‡ã€æœ€å¤§ã€æœ€å°ä»·æ ¼"><a href="#2-å¢åŠ æ›´å¤šç»Ÿè®¡ï¼šå¹³å‡ã€æœ€å¤§ã€æœ€å°ä»·æ ¼" class="headerlink" title="2. å¢åŠ æ›´å¤šç»Ÿè®¡ï¼šå¹³å‡ã€æœ€å¤§ã€æœ€å°ä»·æ ¼"></a><strong>2. å¢åŠ æ›´å¤šç»Ÿè®¡ï¼šå¹³å‡ã€æœ€å¤§ã€æœ€å°ä»·æ ¼</strong></h3><p>ä½ å¯ä»¥åœ¨åˆ†æ¡¶å†…éƒ¨æ·»åŠ æ›´å¤šèšåˆæ¥è·å–å…¶ä»–ç»Ÿè®¡ä¿¡æ¯ï¼Œå¦‚æ¯ä¸ªç›®çš„åœ°çš„å¹³å‡ç¥¨ä»·ã€æœ€é«˜ç¥¨ä»·å’Œæœ€ä½ç¥¨ä»·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET kibana_sample_data_flights/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;flight_dest&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;DestCountry&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;avg_price&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;avg&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;AvgTicketPrice&quot;</span>  <span class="hljs-comment"># è®¡ç®—å¹³å‡ç¥¨ä»·</span><br>          &#125;<br>        &#125;,<br>        <span class="hljs-string">&quot;max_price&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;max&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;AvgTicketPrice&quot;</span>  <span class="hljs-comment"># è®¡ç®—æœ€é«˜ç¥¨ä»·</span><br>          &#125;<br>        &#125;,<br>        <span class="hljs-string">&quot;min_price&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;min&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;AvgTicketPrice&quot;</span>  <span class="hljs-comment"># è®¡ç®—æœ€ä½ç¥¨ä»·</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæŸ¥è¯¢ä¸­ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªç›®çš„åœ°æ·»åŠ äº†ä¸‰ä¸ªèšåˆï¼š<code>avg_price</code>ã€<code>max_price</code> å’Œ <code>min_price</code>ï¼Œåˆ†åˆ«è®¡ç®—æ¯ä¸ªç›®çš„åœ°çš„å¹³å‡ç¥¨ä»·ã€æœ€å¤§ç¥¨ä»·å’Œæœ€å°ç¥¨ä»·ã€‚</p><h3 id="3-èšåˆä»·æ ¼ä¸å¤©æ°”ä¿¡æ¯ï¼šç»Ÿè®¡ä¸å¤šé‡èšåˆ"><a href="#3-èšåˆä»·æ ¼ä¸å¤©æ°”ä¿¡æ¯ï¼šç»Ÿè®¡ä¸å¤šé‡èšåˆ" class="headerlink" title="3. èšåˆä»·æ ¼ä¸å¤©æ°”ä¿¡æ¯ï¼šç»Ÿè®¡ä¸å¤šé‡èšåˆ"></a><strong>3. èšåˆä»·æ ¼ä¸å¤©æ°”ä¿¡æ¯ï¼šç»Ÿè®¡ä¸å¤šé‡èšåˆ</strong></h3><p>å¦‚æœä½ è¿˜æƒ³ç»“åˆå¤©æ°”ä¿¡æ¯ï¼ˆå¦‚ <code>DestWeather</code> å­—æ®µï¼‰ä¸èˆªç­ä»·æ ¼ç»Ÿè®¡ä¸€èµ·è¿›è¡Œèšåˆï¼Œå¯ä»¥ä½¿ç”¨åµŒå¥—èšåˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET kibana_sample_data_flights/_search<br>&#123;<br>  <span class="hljs-string">&quot;size&quot;</span>: 0,<br>  <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;flight_dest&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;DestCountry&quot;</span><br>      &#125;,<br>      <span class="hljs-string">&quot;aggs&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;stats_price&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;stats&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;AvgTicketPrice&quot;</span>  <span class="hljs-comment"># è®¡ç®—ç¥¨ä»·çš„å¤šé¡¹ç»Ÿè®¡ä¿¡æ¯</span><br>          &#125;<br>        &#125;,<br>        <span class="hljs-string">&quot;weather&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;terms&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;field&quot;</span>: <span class="hljs-string">&quot;DestWeather&quot;</span>,  <span class="hljs-comment"># æŒ‰å¤©æ°”ç±»å‹åˆ†æ¡¶</span><br>            <span class="hljs-string">&quot;size&quot;</span>: 5  <span class="hljs-comment"># åªè¿”å›å‰5ä¸ªå¤©æ°”ç±»å‹</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸ä»…è®¡ç®—äº†æ¯ä¸ªç›®çš„åœ°çš„ç¥¨ä»·ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¦‚å¹³å‡ç¥¨ä»·ã€æœ€å¤§ç¥¨ä»·ç­‰ï¼‰ï¼Œè¿˜å°†å¤©æ°”ä¿¡æ¯ä½œä¸ºå¦ä¸€ä¸ª <code>terms</code> èšåˆï¼Œæ˜¾ç¤ºæ¯ä¸ªç›®çš„åœ°çš„å¤©æ°”ç±»å‹ï¼Œå¹¶é™åˆ¶è¿”å›çš„å¤©æ°”ç±»å‹æ•°é‡ä¸º 5 ä¸ªã€‚</p><hr><h3 id="å¸¸è§çš„èšåˆç±»å‹ï¼š"><a href="#å¸¸è§çš„èšåˆç±»å‹ï¼š" class="headerlink" title="å¸¸è§çš„èšåˆç±»å‹ï¼š"></a><strong>å¸¸è§çš„èšåˆç±»å‹ï¼š</strong></h3><ul><li><strong><code>terms</code> èšåˆ</strong>ï¼šå°†æ–‡æ¡£æŒ‰æŸä¸ªå­—æ®µçš„å€¼è¿›è¡Œåˆ†æ¡¶ï¼Œå¸¸ç”¨äºç»Ÿè®¡è¯é¢‘æˆ–å…¶ä»–åˆ†ç±»æ•°æ®ã€‚</li><li><strong><code>avg</code> èšåˆ</strong>ï¼šè®¡ç®—æŸä¸ªæ•°å€¼å­—æ®µçš„å¹³å‡å€¼ã€‚</li><li><strong><code>sum</code> èšåˆ</strong>ï¼šè®¡ç®—æŸä¸ªæ•°å€¼å­—æ®µçš„æ€»å’Œã€‚</li><li><strong><code>min</code> èšåˆ</strong>ï¼šè¿”å›æŸä¸ªæ•°å€¼å­—æ®µçš„æœ€å°å€¼ã€‚</li><li><strong><code>max</code> èšåˆ</strong>ï¼šè¿”å›æŸä¸ªæ•°å€¼å­—æ®µçš„æœ€å¤§å€¼ã€‚</li><li><strong><code>stats</code> èšåˆ</strong>ï¼šè¿”å›å­—æ®µçš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆåŒ…æ‹¬ï¼šæœ€å°å€¼ã€æœ€å¤§å€¼ã€å¹³å‡å€¼ã€æ€»å’Œå’Œæ–‡æ¡£æ•°é‡ï¼‰ã€‚</li><li><strong><code>date_histogram</code> èšåˆ</strong>ï¼šæŒ‰æ—¥æœŸè¿›è¡Œåˆ†æ¡¶ï¼Œé€‚ç”¨äºæ—¶é—´åºåˆ—æ•°æ®ã€‚</li><li><strong><code>histogram</code> èšåˆ</strong>ï¼šæŒ‰æ•°å€¼åŒºé—´è¿›è¡Œåˆ†æ¡¶ï¼Œå¸¸ç”¨äºæ•°å€¼æ•°æ®çš„ç»Ÿè®¡ã€‚</li></ul><hr><h3 id="ç›¸å…³é˜…è¯»ï¼š"><a href="#ç›¸å…³é˜…è¯»ï¼š" class="headerlink" title="ç›¸å…³é˜…è¯»ï¼š"></a><strong>ç›¸å…³é˜…è¯»ï¼š</strong></h3><ul><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.1/search-aggregations.html">Elasticsearch èšåˆæ–‡æ¡£</a> è¯¦ç»†ä»‹ç»äº†å„ç§èšåˆçš„ä½¿ç”¨æ–¹å¼å’Œç¤ºä¾‹ã€‚</li></ul><p>èšåˆåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œèƒ½å¸®åŠ©ä½ ä»æµ·é‡æ•°æ®ä¸­æå–æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œé€‚ç”¨äºå„ç§æ•°æ®åˆ†æåœºæ™¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>elasticsearch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å­¦ä¹ ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>logstachå®‰è£…å’Œå¯¼å…¥æ•°æ®</title>
    <link href="/elasticsearch/logstach%E5%AE%89%E8%A3%85%E5%92%8C%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE/"/>
    <url>/elasticsearch/logstach%E5%AE%89%E8%A3%85%E5%92%8C%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE/</url>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨<a href="../../resource/logstash.conf">logstash.conf</a></p><p>è¿è¡Œlogstash</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget https://artifacts.elastic.co/downloads/logstash/logstash-oss-7.1.0.tar.gz<br>tar -zxvf logstash-oss-7.1.0.tar.gz<br>cd logstash-oss-7.1.0<br>bin/logstash -f logstash.conf<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨Dockerå®¹å™¨ä¸­è¿è¡ŒElasticsearch,Kibanaå’ŒCerebro</title>
    <link href="/elasticsearch/%E5%9C%A8Docker%E5%AE%B9%E5%99%A8%E4%B8%AD%E8%BF%90%E8%A1%8CElasticsearch-Kibana%E5%92%8CCerebro/"/>
    <url>/elasticsearch/%E5%9C%A8Docker%E5%AE%B9%E5%99%A8%E4%B8%AD%E8%BF%90%E8%A1%8CElasticsearch-Kibana%E5%92%8CCerebro/</url>
    
    <content type="html"><![CDATA[<p>docker-compose.ymlå¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs shell">version: &#x27;2.2&#x27;<br>services:<br>  cerebro:<br>    image: lmenezes/cerebro:0.8.3<br>    container_name: cerebro<br>    ports:<br>      - &quot;9000:9000&quot;<br>    command:<br>      - -Dhosts.0.host=http://elasticsearch:9200<br>    networks:<br>      - es7net<br>  kibana:<br>    image: docker.elastic.co/kibana/kibana:7.1.0<br>    container_name: kibana7<br>    environment:<br>      - I18N_LOCALE=zh-CN<br>      - XPACK_GRAPH_ENABLED=true<br>      - TIMELION_ENABLED=true<br>      - XPACK_MONITORING_COLLECTION_ENABLED=&quot;true&quot;<br>    ports:<br>      - &quot;5601:5601&quot;<br>    networks:<br>      - es7net<br>  elasticsearch:<br>    image: docker.elastic.co/elasticsearch/elasticsearch:7.1.0<br>    container_name: es7_01<br>    environment:<br>      - cluster.name=geektime<br>      - node.name=es7_01<br>      - bootstrap.memory_lock=true<br>      - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;<br>      - discovery.seed_hosts=es7_01,es7_02<br>      - cluster.initial_master_nodes=es7_01,es7_02<br>    ulimits:<br>      memlock:<br>        soft: -1<br>        hard: -1<br>    volumes:<br>      - es7data1:/usr/share/elasticsearch/data<br>    ports:<br>      - 9200:9200<br>    networks:<br>      - es7net<br>  elasticsearch2:<br>    image: docker.elastic.co/elasticsearch/elasticsearch:7.1.0<br>    container_name: es7_02<br>    environment:<br>      - cluster.name=geektime<br>      - node.name=es7_02<br>      - bootstrap.memory_lock=true<br>      - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;<br>      - discovery.seed_hosts=es7_01,es7_02<br>      - cluster.initial_master_nodes=es7_01,es7_02<br>    ulimits:<br>      memlock:<br>        soft: -1<br>        hard: -1<br>    volumes:<br>      - es7data2:/usr/share/elasticsearch/data<br>    networks:<br>      - es7net<br><br>volumes:<br>  es7data1:<br>    driver: local<br>  es7data2:<br>    driver: local<br><br>networks:<br>  es7net:<br>    driver: bridge<br></code></pre></td></tr></table></figure><p>è¿™ä¸ª <code>docker-compose.yml</code> æ–‡ä»¶ç”¨äºé…ç½®å¹¶éƒ¨ç½²ä¸€ä¸ªåŒ…å« <strong>Elasticsearch</strong>ã€<strong>Kibana</strong> å’Œ <strong>Cerebro</strong> çš„é›†ç¾¤ç¯å¢ƒã€‚</p><h4 id="1-cerebro"><a href="#1-cerebro" class="headerlink" title="1. cerebro"></a>1. <strong>cerebro</strong></h4><ul><li><strong>image</strong>: ä½¿ç”¨ <code>lmenezes/cerebro:0.8.3</code> è¿™ä¸ªé•œåƒï¼ŒCerebro æ˜¯ä¸€ä¸ªå¼€æºçš„ Elasticsearch ç®¡ç†å·¥å…·ã€‚</li><li><strong>container_name</strong>: å°†å®¹å™¨å‘½åä¸º <code>cerebro</code>ã€‚</li><li><strong>ports</strong>: å°†ä¸»æœºçš„ 9000 ç«¯å£æ˜ å°„åˆ°å®¹å™¨å†…çš„ 9000 ç«¯å£ï¼Œå…è®¸é€šè¿‡æµè§ˆå™¨è®¿é—® Cerebro ç•Œé¢ã€‚</li><li><strong>command</strong>: å¯åŠ¨æ—¶è®¾ç½®å‚æ•°ï¼Œ<code>-Dhosts.0.host=http://elasticsearch:9200</code> æŒ‡å®š Cerebro è¿æ¥çš„ Elasticsearch åœ°å€ä¸º <code>elasticsearch:9200</code>ã€‚</li><li><strong>networks</strong>: é…ç½® <code>cerebro</code> æœåŠ¡è¿æ¥åˆ° <code>es7net</code> ç½‘ç»œã€‚</li></ul><h4 id="2-kibana"><a href="#2-kibana" class="headerlink" title="2. kibana"></a>2. <strong>kibana</strong></h4><ul><li><strong>image</strong>: ä½¿ç”¨ <code>docker.elastic.co/kibana/kibana:7.1.0</code> é•œåƒï¼Œè¿™æ˜¯ Elasticsearch å®˜æ–¹çš„ Kibana 7.1.0 ç‰ˆæœ¬ã€‚</li><li><strong>container_name</strong>: å®¹å™¨å‘½åä¸º <code>kibana7</code>ã€‚</li><li><strong>environment</strong>: è®¾ç½®äº†ä¸€äº› Kibana é…ç½®é¡¹ï¼š<ul><li><code>I18N_LOCALE=zh-CN</code>ï¼šè®¾ç½® Kibana ç•Œé¢è¯­è¨€ä¸ºä¸­æ–‡ã€‚</li><li><code>XPACK_GRAPH_ENABLED=true</code>ã€<code>TIMELION_ENABLED=true</code>ï¼šå¯ç”¨ä¸€äº›é«˜çº§åŠŸèƒ½ã€‚</li><li><code>XPACK_MONITORING_COLLECTION_ENABLED=&quot;true&quot;</code>ï¼šå¯ç”¨ç›‘æ§åŠŸèƒ½ã€‚</li></ul></li><li><strong>ports</strong>: æ˜ å°„ä¸»æœºçš„ 5601 ç«¯å£åˆ°å®¹å™¨çš„ 5601 ç«¯å£ï¼Œç”¨äºé€šè¿‡æµè§ˆå™¨è®¿é—® Kibana ç•Œé¢ã€‚</li><li><strong>networks</strong>: <code>kibana</code> æœåŠ¡è¿æ¥åˆ° <code>es7net</code> ç½‘ç»œã€‚</li></ul><h4 id="3-elasticsearch"><a href="#3-elasticsearch" class="headerlink" title="3. elasticsearch"></a>3. <strong>elasticsearch</strong></h4><ul><li><strong>image</strong>: ä½¿ç”¨ <code>docker.elastic.co/elasticsearch/elasticsearch:7.1.0</code> é•œåƒï¼Œè¿™æ˜¯ Elasticsearch 7.1.0 çš„å®˜æ–¹ç‰ˆæœ¬ã€‚</li><li><strong>container_name</strong>: å®¹å™¨å‘½åä¸º <code>es7_01</code>ã€‚</li><li><strong>environment</strong>: è®¾ç½® Elasticsearch çš„ç¯å¢ƒå˜é‡ï¼š<ul><li><code>cluster.name=geektime</code>ï¼šé›†ç¾¤åç§°ä¸º <code>geektime</code>ã€‚</li><li><code>node.name=es7_01</code>ï¼šèŠ‚ç‚¹åç§°ä¸º <code>es7_01</code>ã€‚</li><li><code>bootstrap.memory_lock=true</code>ï¼šå¯ç”¨å†…å­˜é”å®šï¼Œé˜²æ­¢è™šæ‹Ÿå†…å­˜äº¤æ¢ã€‚</li><li><code>ES_JAVA_OPTS=-Xms512m -Xmx512m</code>ï¼šè®¾ç½® JVM çš„åˆå§‹å†…å­˜å’Œæœ€å¤§å†…å­˜ä¸º 512MBã€‚</li><li><code>discovery.seed_hosts=es7_01,es7_02</code>ï¼šæŒ‡å®šé›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹ç”¨äºå‘ç°é›†ç¾¤æˆå‘˜ã€‚</li><li><code>cluster.initial_master_nodes=es7_01,es7_02</code>ï¼šè®¾ç½®åˆå§‹çš„ä¸»èŠ‚ç‚¹ï¼Œç”¨äºé›†ç¾¤åˆå§‹åŒ–ã€‚</li></ul></li><li><strong>ulimits</strong>: é…ç½®å®¹å™¨çš„å†…å­˜é”å®šï¼Œ<code>soft</code> å’Œ <code>hard</code> éƒ½è®¾ç½®ä¸º -1ï¼Œè¡¨ç¤ºæ²¡æœ‰é™åˆ¶ã€‚</li><li><strong>volumes</strong>: ä½¿ç”¨ <code>es7data1</code> æŒä¹…åŒ–æ•°æ®ã€‚</li><li><strong>ports</strong>: æ˜ å°„ä¸»æœºçš„ 9200 ç«¯å£åˆ°å®¹å™¨çš„ 9200 ç«¯å£ï¼Œå…è®¸é€šè¿‡ HTTP è®¿é—® Elasticsearchã€‚</li><li><strong>networks</strong>: <code>elasticsearch</code> æœåŠ¡è¿æ¥åˆ° <code>es7net</code> ç½‘ç»œã€‚</li></ul><h4 id="4-elasticsearch2"><a href="#4-elasticsearch2" class="headerlink" title="4. elasticsearch2"></a>4. <strong>elasticsearch2</strong></h4><ul><li><strong>image</strong>: ä½¿ç”¨ç›¸åŒçš„ <code>docker.elastic.co/elasticsearch/elasticsearch:7.1.0</code> é•œåƒã€‚</li><li><strong>container_name</strong>: å®¹å™¨å‘½åä¸º <code>es7_02</code>ã€‚</li><li><strong>environment</strong>: ä¸ <code>elasticsearch</code> é…ç½®ç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ <code>node.name</code> è®¾ç½®ä¸º <code>es7_02</code>ï¼Œè¿™æ˜¯å¦ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li><li><strong>ulimits</strong>: é…ç½®å†…å­˜é”å®šï¼Œå’Œ <code>es7_01</code> èŠ‚ç‚¹ä¸€è‡´ã€‚</li><li><strong>volumes</strong>: ä½¿ç”¨ <code>es7data2</code> æŒä¹…åŒ–æ•°æ®ã€‚</li><li><strong>networks</strong>: <code>elasticsearch2</code> æœåŠ¡è¿æ¥åˆ° <code>es7net</code> ç½‘ç»œã€‚</li></ul><h3 id="volumes"><a href="#volumes" class="headerlink" title="volumes"></a><code>volumes</code></h3><ul><li><strong>es7data1</strong> å’Œ <strong>es7data2</strong>ï¼šå®šä¹‰äº†ä¸¤ä¸ªæŒä¹…åŒ–æ•°æ®å·ï¼Œåˆ†åˆ«ç”¨äº Elasticsearch èŠ‚ç‚¹ <code>es7_01</code> å’Œ <code>es7_02</code> çš„æ•°æ®å­˜å‚¨ï¼Œä½¿ç”¨ <code>local</code> é©±åŠ¨ã€‚</li></ul><h3 id="networks"><a href="#networks" class="headerlink" title="networks"></a><code>networks</code></h3><ul><li><strong>es7net</strong>: å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>es7net</code> çš„ç½‘ç»œï¼Œæ‰€æœ‰çš„æœåŠ¡éƒ½å°†è¿æ¥åˆ°è¿™ä¸ªç½‘ç»œä¸Šã€‚ç½‘ç»œä½¿ç”¨ <code>bridge</code> é©±åŠ¨ï¼Œé€‚ç”¨äº Docker å®¹å™¨é—´çš„é€šä¿¡ã€‚</li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™ä¸ª <code>docker-compose.yml</code> æ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªå®Œæ•´çš„ Elasticsearch é›†ç¾¤ï¼ˆåŒ…å«ä¸¤ä¸ªèŠ‚ç‚¹ï¼‰ï¼ŒåŒæ—¶éƒ¨ç½²äº† Kibana å’Œ Cerebro æ¥è¿›è¡Œé›†ç¾¤ç®¡ç†å’Œå¯è§†åŒ–ã€‚é€šè¿‡å°†è¿™äº›æœåŠ¡è¿æ¥åˆ°ä¸€ä¸ªå…±äº«çš„ç½‘ç»œ <code>es7net</code>ï¼Œå®ƒä»¬èƒ½å¤Ÿç›¸äº’é€šä¿¡ã€‚æ•°æ®å· <code>es7data1</code> å’Œ <code>es7data2</code> ä¿è¯äº† Elasticsearch çš„æ•°æ®æŒä¹…æ€§ï¼Œå³ä½¿å®¹å™¨åœæ­¢æˆ–é‡å¯ï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>elasticsearch</category>
      
    </categories>
    
    
    <tags>
      
      <tag>dockeréƒ¨ç½²</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linux-é…ç½®å¼€æœºè‡ªå¯</title>
    <link href="/linux/linux-%E9%85%8D%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF/"/>
    <url>/linux/linux-%E9%85%8D%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF/</url>
    
    <content type="html"><![CDATA[<h3 id="æ–¹æ³•ä¸€ï¼š-ä½¿ç”¨-crontab-è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨"><a href="#æ–¹æ³•ä¸€ï¼š-ä½¿ç”¨-crontab-è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨" class="headerlink" title="æ–¹æ³•ä¸€ï¼š ä½¿ç”¨ crontab è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨"></a>æ–¹æ³•ä¸€ï¼š ä½¿ç”¨ <code>crontab</code> è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨</h3><ol><li><p><strong>ç¼–è¾‘å½“å‰ç”¨æˆ·çš„ <code>crontab</code> æ–‡ä»¶</strong><br>è¿è¡Œä»¥ä¸‹å‘½ä»¤ç¼–è¾‘ <code>crontab</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">crontab -e<br></code></pre></td></tr></table></figure></li><li><p><strong>æ·»åŠ å¼€æœºå¯åŠ¨ä»»åŠ¡</strong><br>åœ¨ <code>crontab</code> æ–‡ä»¶çš„æœ€åä¸€è¡Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œå°†å¯åŠ¨æ—¥å¿—è¾“å‡ºåˆ°log.txtä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">@reboot /usr/bin/java -jar /opt/mp/mp-web-1.0.0.jar &gt;&gt; /opt/mp/log.txt 2&gt;&amp;1 <br></code></pre></td></tr></table></figure></li><li><p><strong>éªŒè¯æ˜¯å¦è®¾ç½®æˆåŠŸ</strong><br>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å·²è®¾ç½®çš„ <code>crontab</code> ä»»åŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">crontab -l<br></code></pre></td></tr></table></figure></li></ol><h3 id="æ–¹æ³•äºŒï¼šä½¿ç”¨-systemd"><a href="#æ–¹æ³•äºŒï¼šä½¿ç”¨-systemd" class="headerlink" title="æ–¹æ³•äºŒï¼šä½¿ç”¨ systemd"></a>æ–¹æ³•äºŒï¼šä½¿ç”¨ <code>systemd</code></h3><p><code>systemd</code> æ˜¯ç°ä»£ Linux ç³»ç»Ÿç”¨æ¥å¯åŠ¨å’Œç®¡ç†æœåŠ¡çš„å·¥å…·ï¼Œé€šå¸¸åœ¨å¤§å¤šæ•°å‘è¡Œç‰ˆä¸­éƒ½é»˜è®¤å®‰è£…ã€‚</p><ol><li><p><strong>åˆ›å»ºä¸€ä¸ª systemd æœåŠ¡æ–‡ä»¶</strong><br>åœ¨ <code>/etc/systemd/system/</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>.service</code> æ–‡ä»¶ï¼Œä¾‹å¦‚ <code>openvpn-client.service</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo vi /etc/systemd/system/openvpn-client.service<br></code></pre></td></tr></table></figure></li><li><p><strong>ç¼–è¾‘æœåŠ¡æ–‡ä»¶</strong><br>åœ¨æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=OpenVPN client service<br><span class="hljs-attr">After</span>=network.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">Type</span>=simple<br><span class="hljs-attr">ExecStart</span>= /usr/sbin/openvpn --config /opt/openvpn/xxx.ovpn<br><span class="hljs-attr">Restart</span>=always<br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=multi-user.target<br></code></pre></td></tr></table></figure></li><li><p><strong>é‡æ–°åŠ è½½ <code>systemd</code> é…ç½®</strong>  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl daemon-reload<br></code></pre></td></tr></table></figure></li><li><p><strong>å¯åŠ¨æœåŠ¡</strong><br>å¯åŠ¨æœåŠ¡å¹¶éªŒè¯æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl start openvpn-client.service<br></code></pre></td></tr></table></figure></li><li><p><strong>è®¾ç½®å¼€æœºè‡ªå¯</strong><br>å¯åŠ¨åï¼Œè®¾ç½®æœåŠ¡å¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl <span class="hljs-built_in">enable</span> openvpn-client.service<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹æœåŠ¡çŠ¶æ€</strong><br>æŸ¥çœ‹æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl status openvpn-client.service<br></code></pre></td></tr></table></figure></li></ol><h3 id="æ–¹æ³•ä¸‰ï¼šä½¿ç”¨-rc-localï¼ˆé€‚ç”¨äºè¾ƒè€çš„-Linux-ç‰ˆæœ¬ï¼‰"><a href="#æ–¹æ³•ä¸‰ï¼šä½¿ç”¨-rc-localï¼ˆé€‚ç”¨äºè¾ƒè€çš„-Linux-ç‰ˆæœ¬ï¼‰" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ rc.localï¼ˆé€‚ç”¨äºè¾ƒè€çš„ Linux ç‰ˆæœ¬ï¼‰"></a>æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ <code>rc.local</code>ï¼ˆé€‚ç”¨äºè¾ƒè€çš„ Linux ç‰ˆæœ¬ï¼‰</h3><p><code>rc.local</code> æ˜¯ä¸€ä¸ªæ¯”è¾ƒä¼ ç»Ÿçš„æ–¹å¼ï¼Œåœ¨ä¸€äº›è¾ƒè€çš„ Linux ç³»ç»Ÿä¸­ä½¿ç”¨ã€‚</p><ol><li><p><strong>ç¼–è¾‘ <code>rc.local</code> æ–‡ä»¶</strong><br>æ‰“å¼€ <code>/etc/rc.local</code> æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo vi /etc/rc.local<br></code></pre></td></tr></table></figure></li><li><p><strong>åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å¯åŠ¨å‘½ä»¤</strong><br>åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ å¯åŠ¨ Java åº”ç”¨çš„å‘½ä»¤ï¼Œç¡®ä¿æ·»åŠ åœ¨ <code>exit 0</code> ä¹‹å‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/usr/bin/java -jar /path/to/your/project/your-app.jar &amp;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>&amp;</code> å°†åº”ç”¨ç¨‹åºæ”¾å…¥åå°è¿è¡Œã€‚</p></li><li><p><strong>ç¡®ä¿ <code>rc.local</code> å¯æ‰§è¡Œ</strong><br>å¦‚æœ <code>rc.local</code> æ–‡ä»¶æ²¡æœ‰å¯æ‰§è¡Œæƒé™ï¼Œéœ€è¦ä¿®æ”¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">chmod</span> +x /etc/rc.local<br></code></pre></td></tr></table></figure></li><li><p><strong>é‡å¯ç³»ç»Ÿ</strong><br>é‡å¯ç³»ç»Ÿåï¼ŒJava åº”ç”¨å°†ä¼šè‡ªåŠ¨å¯åŠ¨ã€‚</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€æœºè‡ªå¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nginxé…ç½®https</title>
    <link href="/linux/nginx%E9%85%8D%E7%BD%AEhttps/"/>
    <url>/linux/nginx%E9%85%8D%E7%BD%AEhttps/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">server &#123;<br>    listen 80;<br>    server_name xxx.beeflyx.cloud;<br><br>    # å¼ºåˆ¶ HTTP é‡å®šå‘åˆ° HTTPS<br>    return 301 https://$host$request_uri;<br>&#125;<br><br>server &#123;<br>    listen 443 ssl;<br>    server_name xxx.beeflyx.cloud;<br><br>    ssl_certificate /etc/nginx/conf.d/cert/xxx.beeflyx.cloud_bundle.crt;<br>    ssl_certificate_key /etc/nginx/conf.d/cert/xxx.beeflyx.cloud.key;<br><br>    location / &#123;<br>        proxy_pass http://127.0.0.1:3000;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linux-å¸¸ç”¨å‘½ä»¤</title>
    <link href="/linux/linux-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/linux/linux-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<p>linuxè‡ªå¯åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /etc/systemd/system/<br>vi openvpn-client.service<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[Unit]<br>Description=OpenVPN client service<br>After=network.target<br> <br>[Service]<br>Type=simple<br>ExecStart= /usr/sbin/openvpn --config /opt/openvpn/huawei-5600g.ovpn<br>Restart=always<br> <br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl daemon-reload<br>systemctl <span class="hljs-built_in">enable</span> openvpn-client.service<br></code></pre></td></tr></table></figure><p>æ·»åŠ jdkç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">ã€€ç¼–è¾‘/etc/profileæ–‡ä»¶ vim /etc/profile    &lt;&lt;---- é€šè¿‡è¿™ç§æ–¹å¼ï¼Œåœ¨å…³é—­xshellåï¼Œæ·»åŠ çš„ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆ<br><br>ã€€ã€€æ–‡ä»¶æœ«å°¾æ·»åŠ ï¼š<span class="hljs-built_in">export</span> PATH=<span class="hljs-string">&quot;/usr/local/nginx/sbin/:<span class="hljs-variable">$PATH</span>&quot;</span><br><br>ã€€ã€€<span class="hljs-built_in">source</span>  /etc/profile<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¸¸ç”¨å‘½ä»¤</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerå¸¸ç”¨å‘½ä»¤</title>
    <link href="/docker/docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/docker/docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<p>æ–°å»ºæ•°æ®åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d --restart=always  --name my-mysql -e MYSQL_ROOT_PASSWORD=<span class="hljs-string">&#x27;password&#x27;</span> -p 3306:3306 -e TZ=Asia/Shanghai  mysql:8.0.39<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>docker</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‘½ä»¤</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>mysql-æ•°æ®å¤‡ä»½è„šæœ¬</title>
    <link href="/mysql/mysql-%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC/"/>
    <url>/mysql/mysql-%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<p>å¤‡ä»½ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> mysql-container mysqldump -u root -p<span class="hljs-string">&#x27;password&#x27;</span> --all-databases &gt; /path/to/backup/all_databases_backup.sql<br></code></pre></td></tr></table></figure><p>è¿˜åŸï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker <span class="hljs-built_in">exec</span> -i my-mysql mysql  -u root -p<span class="hljs-string">&#x27;password&#x27;</span>    &lt; /opt/mysql_back/mydatabase_backup.sql  <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤‡ä»½</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¾ä¿¡é“å¸¦å®½ä¸º16kHz,ä¿¡å™ªæ¯”ä¸º30dB,åˆ™è¯¥ä¿¡é“çš„ä¿¡é“å®¹é‡å¤§çº¦ä¸º</title>
    <link href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%80%83%E8%AF%95/%E8%AE%BE%E4%BF%A1%E9%81%93%E5%B8%A6%E5%AE%BD%E4%B8%BA16kHz-%E4%BF%A1%E5%99%AA%E6%AF%94%E4%B8%BA30dB-%E5%88%99%E8%AF%A5%E4%BF%A1%E9%81%93%E7%9A%84%E4%BF%A1%E9%81%93%E5%AE%B9%E9%87%8F%E5%A4%A7%E7%BA%A6%E4%B8%BA/"/>
    <url>/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%80%83%E8%AF%95/%E8%AE%BE%E4%BF%A1%E9%81%93%E5%B8%A6%E5%AE%BD%E4%B8%BA16kHz-%E4%BF%A1%E5%99%AA%E6%AF%94%E4%B8%BA30dB-%E5%88%99%E8%AF%A5%E4%BF%A1%E9%81%93%E7%9A%84%E4%BF%A1%E9%81%93%E5%AE%B9%E9%87%8F%E5%A4%A7%E7%BA%A6%E4%B8%BA/</url>
    
    <content type="html"><![CDATA[<p>æ ¹æ®é¦™å†œä¿¡é“å®¹é‡å…¬å¼ï¼š</p><p>[<br>C &#x3D; B \log_2(1 + S&#x2F;N)<br>]</p><p>å…¶ä¸­ï¼š</p><ul><li>( C ) æ˜¯ä¿¡é“å®¹é‡ï¼ˆå•ä½ï¼šæ¯”ç‰¹æ¯ç§’ï¼Œbpsï¼‰ï¼Œ</li><li>( B ) æ˜¯ä¿¡é“å¸¦å®½ï¼ˆå•ä½ï¼šèµ«å…¹ï¼ŒHzï¼‰ï¼Œ</li><li>( S&#x2F;N ) æ˜¯ä¿¡å™ªæ¯”ï¼Œé€šå¸¸ä»¥çº¿æ€§å€¼è¡¨ç¤ºã€‚</li></ul><h3 id="å·²çŸ¥æ¡ä»¶ï¼š"><a href="#å·²çŸ¥æ¡ä»¶ï¼š" class="headerlink" title="å·²çŸ¥æ¡ä»¶ï¼š"></a>å·²çŸ¥æ¡ä»¶ï¼š</h3><ul><li>ä¿¡é“å¸¦å®½ ( B &#x3D; 16 , \text{kHz} &#x3D; 16,000 , \text{Hz} ),</li><li>ä¿¡å™ªæ¯” ( \text{S&#x2F;N} &#x3D; 30 , \text{dB} ).</li></ul><p>é¦–å…ˆï¼Œå°†ä¿¡å™ªæ¯”ä» dB è½¬æ¢ä¸ºçº¿æ€§å€¼ï¼š<br>[<br>S&#x2F;N &#x3D; 10^{30&#x2F;10} &#x3D; 10^3 &#x3D; 1000<br>]</p><p>å°†è¿™äº›å€¼ä»£å…¥é¦™å†œå…¬å¼ï¼š<br>[<br>C &#x3D; 16000 \log_2(1 + 1000)<br>]</p><p>è®¡ç®—å‡º ( \log_2(1001) )ï¼Œç„¶åå†ä¹˜ä»¥å¸¦å®½ ( B )ã€‚</p><p>æˆ‘ä»¬æ¥è®¡ç®—è¿™ä¸ªå€¼ã€‚</p><p>æ ¹æ®è®¡ç®—ç»“æœï¼Œä¿¡é“å®¹é‡å¤§çº¦ä¸º <strong>159,476 bps</strong>ï¼ˆæ¯”ç‰¹æ¯ç§’ï¼‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºè€ƒè¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è‡ªå­¦å…¬å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>openvpnä¸­ä½¿ç”¨client1è®¿é—®xxxåŸŸåæ—¶ï¼Œèµ°client2çš„ç½‘ç»œæµé‡æ¥è®¿é—®</title>
    <link href="/linux/openvpn%E4%B8%AD%E4%BD%BF%E7%94%A8client1%E8%AE%BF%E9%97%AExxx%E5%9F%9F%E5%90%8D%E6%97%B6%EF%BC%8C%E8%B5%B0client2%E7%9A%84%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E6%9D%A5%E8%AE%BF%E9%97%AE/"/>
    <url>/linux/openvpn%E4%B8%AD%E4%BD%BF%E7%94%A8client1%E8%AE%BF%E9%97%AExxx%E5%9F%9F%E5%90%8D%E6%97%B6%EF%BC%8C%E8%B5%B0client2%E7%9A%84%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E6%9D%A5%E8%AE%BF%E9%97%AE/</url>
    
    <content type="html"><![CDATA[<p>è¦è®©ä¸€ä¸ª OpenVPN å®¢æˆ·ç«¯ï¼ˆclient1ï¼‰é€šè¿‡å¦ä¸€ä¸ªå®¢æˆ·ç«¯ï¼ˆclient2ï¼‰çš„ç½‘ç»œæµé‡è®¿é—®ç‰¹å®šåŸŸåï¼ˆå¦‚ xxx åŸŸåï¼‰ï¼Œä½ å¯ä»¥é‡‡å–ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><p><strong>åœ¨ client2 ä¸Šè®¾ç½®è·¯ç”±</strong>ï¼š<br>ç¡®ä¿ client2 çš„ OpenVPN é…ç½®ä¸­å…è®¸å…¶ä»–å®¢æˆ·ç«¯é€šè¿‡å®ƒè¿›è¡Œè·¯ç”±ã€‚ä½ éœ€è¦åœ¨ server.conf ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">client-to-client<br></code></pre></td></tr></table></figure><p>è¿™å°†å…è®¸å®¢æˆ·ç«¯ä¹‹é—´çš„ç›´æ¥é€šä¿¡ã€‚</p></li><li><p><strong>åœ¨ client1 ä¸Šè®¾ç½®è·¯ç”±</strong>ï¼š<br>åœ¨ client1 çš„ OpenVPN é…ç½®æ–‡ä»¶ä¸­ï¼Œä½ éœ€è¦æ·»åŠ ä¸€æ¡é™æ€è·¯ç”±ï¼Œè®©å®ƒçš„æµé‡é€šè¿‡ client2ã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š</p><ul><li><p>åœ¨ client1 çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼ˆå‡è®¾ client2 çš„ IP æ˜¯ 10.8.0.2ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">route xxx 255.255.255.255 net_gateway<br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœ client2 çš„ IP ä¸æ˜¯ 10.8.0.2ï¼Œè¯·ç”¨å®é™…çš„ IP æ›¿æ¢ã€‚</p></li></ul></li><li><p><strong>ä½¿ç”¨ iptables æˆ–å…¶ä»–å·¥å…·è¿›è¡Œæµé‡è½¬å‘</strong>ï¼š<br>åœ¨ client2 ä¸Šï¼Œä½ å¯èƒ½éœ€è¦è®¾ç½® iptables è§„åˆ™ï¼Œä»¥ä¾¿å°†æ¥è‡ª client1 çš„æµé‡è½¬å‘åˆ°å¤–éƒ¨ç½‘ç»œã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„è§„åˆ™ç¤ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE<br></code></pre></td></tr></table></figure><p>ç¡®ä¿ <code>10.8.0.0/24</code> æ›¿æ¢ä¸ºä½ çš„ VPN å­ç½‘ã€‚</p></li><li><p><strong>ä¿®æ”¹ DNS è§£æ</strong>ï¼š<br>ä½ å¯èƒ½éœ€è¦åœ¨ client1 ä¸Šä¿®æ”¹ DNS è®¾ç½®ï¼Œç¡®ä¿å®ƒå¯ä»¥æ­£ç¡®è§£æ xxx åŸŸåã€‚ä½ å¯ä»¥åœ¨ OpenVPN é…ç½®ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">dhcp-option DNS 8.8.8.8<br></code></pre></td></tr></table></figure><p>æ›¿æ¢æˆä½ æƒ³ä½¿ç”¨çš„ DNS æœåŠ¡å™¨ã€‚</p></li><li><p><strong>æµ‹è¯•è¿æ¥</strong>ï¼š<br>é‡å¯ OpenVPN å®¢æˆ·ç«¯ï¼Œå¹¶æµ‹è¯• client1 æ˜¯å¦èƒ½å¤Ÿé€šè¿‡ client2 çš„ç½‘ç»œè®¿é—® xxx åŸŸåã€‚</p></li></ol><p>ç¡®ä¿åœ¨è¿›è¡Œè¿™äº›æ›´æ”¹æ—¶å¤‡ä»½ä½ çš„é…ç½®æ–‡ä»¶ï¼Œä»¥é˜²éœ€è¦æ¢å¤ã€‚å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹ OpenVPN çš„æ—¥å¿—ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>openvpn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>äº¿èµ›é€šç”µå­æ–‡æ¡£å®‰å…¨ç®¡ç†ç³»ç»ŸXStreamååºåˆ—åŒ–æ¼æ´ä»»æ„æ–‡ä»¶ä¸Šä¼ åˆ©ç”¨</title>
    <link href="/%E9%BB%91%E5%AE%A2/%E4%BA%BF%E8%B5%9B%E9%80%9A%E7%94%B5%E5%AD%90%E6%96%87%E6%A1%A3%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9FXStream%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%88%A9%E7%94%A8/"/>
    <url>/%E9%BB%91%E5%AE%A2/%E4%BA%BF%E8%B5%9B%E9%80%9A%E7%94%B5%E5%AD%90%E6%96%87%E6%A1%A3%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9FXStream%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%88%A9%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>ä¸€ã€äº§å“ç®€ä»‹<br>äº¿èµ›é€šç”µå­æ–‡æ¡£å®‰å…¨ç®¡ç†ç³»ç»Ÿï¼ˆç®€ç§°ï¼šCDGï¼‰æ˜¯ä¸€æ¬¾ç”µå­æ–‡æ¡£å®‰å…¨åŠ å¯†è½¯ä»¶ï¼Œè¯¥ç³»ç»Ÿåˆ©ç”¨é©±åŠ¨å±‚é€æ˜åŠ å¯†æŠ€æœ¯ï¼Œé€šè¿‡å¯¹ç”µå­æ–‡æ¡£çš„åŠ å¯†ä¿æŠ¤ï¼Œé˜²æ­¢å†…éƒ¨å‘˜å·¥æ³„å¯†å’Œå¤–éƒ¨äººå‘˜éæ³•çªƒå–ä¼ä¸šæ ¸å¿ƒé‡è¦æ•°æ®èµ„äº§ï¼Œå¯¹ç”µå­æ–‡æ¡£è¿›è¡Œå…¨ç”Ÿå‘½å‘¨æœŸé˜²æŠ¤ï¼Œç³»ç»Ÿå…·æœ‰é€æ˜åŠ å¯†ã€ä¸»åŠ¨åŠ å¯†ã€æ™ºèƒ½åŠ å¯†ç­‰å¤šç§åŠ å¯†æ–¹å¼ï¼Œç”¨æˆ·å¯æ ¹æ®éƒ¨é—¨æ¶‰å¯†ç¨‹åº¦çš„ä¸åŒï¼ˆå¦‚æ ¸å¿ƒéƒ¨é—¨å’Œæ™®é€šéƒ¨é—¨ï¼‰ï¼Œéƒ¨ç½²åŠ›åº¦è½»é‡ä¸ä¸€çš„æ¢¯åº¦å¼æ–‡æ¡£åŠ å¯†é˜²æŠ¤ï¼Œå®ç°æŠ€æœ¯ã€ç®¡ç†ã€å®¡è®¡è¿›è¡Œæœ‰æœºçš„ç»“åˆï¼Œåœ¨å†…éƒ¨æ„å»ºèµ·ç«‹ä½“åŒ–çš„æ•´ä½“ä¿¡æ¯é˜²æ³„éœ²ä½“ç³»ï¼Œä½¿å¾—æˆæœ¬ã€æ•ˆç‡å’Œå®‰å…¨ä¸‰è€…è¾¾åˆ°å¹³è¡¡ï¼Œå®ç°ç”µå­æ–‡æ¡£çš„æ•°æ®å®‰å…¨ã€‚<br>äºŒã€æ¼æ´æè¿°<br>äº¿èµ›é€šç”µå­æ–‡æ¡£å®‰å…¨ç®¡ç†ç³»ç»ŸUploadFileFromClientServiceForClientæ¥å£å¤„å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œæœªç»æˆæƒçš„æ”»å‡»è€…å¯é€šè¿‡æ­¤æ¼æ´ä¸Šä¼ æ¶æ„åé—¨æ–‡ä»¶ï¼Œä»è€Œè·å–æœåŠ¡å™¨æƒé™ã€‚<br>ä¸‰ã€å½±å“èŒƒå›´<br>æœªçŸ¥<br>å››ã€å¤ç°ç¯å¢ƒ<br>FOFAï¼šapp&#x3D;â€œäº¿èµ›é€š-ç”µå­æ–‡æ¡£å®‰å…¨ç®¡ç†ç³»ç»Ÿâ€<br>äº”ã€æ¼æ´å¤ç°<br>1.è®¿é—®å­˜åœ¨æ¼æ´ç½‘ç«™ï¼ŒæŠ“åŒ…<br>2.POC</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs angular2html">POST /CDGServer3/UploadFileFromClientServiceForClient?AFMALANMJCEOENIBDJMKFHBANGEPKHNOFJBMIFJPFNKFOKHJNMLCOIDDJGNEIPOLOKGAFAFJHDEJPHEPLFJHDGPBNELNFIICGFNGEOEFBKCDDCGJEPIKFHJFAOOHJEPNNCLFHDAFDNCGBAEELJFFHABJPDPIEEMIBOECDMDLEPBJGBGCGLEMBDFAGOGM HTTP/1.1<br>Host: IPï¼šport<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8<br>Accept-Encoding: gzip, deflate, br<br>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br>Sec-Fetch-Dest: document<br>Sec-Fetch-Mode: navigate<br>Sec-Fetch-Site: none<br>Sec-Fetch-User: ?1<br>Upgrade-Insecure-Requests: 1<br><br><br>ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹<br></code></pre></td></tr></table></figure><p>3.æµ‹è¯•ï¼Œä¸Šä¼ æˆåŠŸ<br>4.è®¿é—®ip:port&#x2F;tttT.jsp</p><p>åˆ©ç”¨æºç ï¼š<a href="https://github.com/candyadmin/CDGXStreamDeserRCE">https://github.com/candyadmin/CDGXStreamDeserRCE</a><br>æ•™ç¨‹ï¼š<br><a href="https://www.yuque.com/u34516370/hi2ux9/nibcqge2832vptra">https://www.yuque.com/u34516370/hi2ux9/nibcqge2832vptra</a><br><a href="https://blog.csdn.net/uuzeray/article/details/136690493">https://blog.csdn.net/uuzeray/article/details/136690493</a></p>]]></content>
    
    
    <categories>
      
      <category>é»‘å®¢</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ¼æ´</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>spring_state_machine</title>
    <link href="/spring-boot/spring-state-machine/"/>
    <url>/spring-boot/spring-state-machine/</url>
    
    <content type="html"><![CDATA[<p>Spring Statemachine æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†å¤æ‚çŠ¶æ€æœºçš„æ¡†æ¶ï¼Œèƒ½å¤Ÿå¸®åŠ©ä½ ç®¡ç†å’Œæ§åˆ¶çŠ¶æ€è½¬æ¢ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­ä½¿ç”¨ Spring Statemachine çš„åŸºæœ¬æ­¥éª¤ï¼š</p><h3 id="1-æ·»åŠ ä¾èµ–"><a href="#1-æ·»åŠ ä¾èµ–" class="headerlink" title="1. æ·»åŠ ä¾èµ–"></a>1. <strong>æ·»åŠ ä¾èµ–</strong></h3><p>é¦–å…ˆï¼Œåœ¨ä½ çš„ <code>pom.xml</code> æ–‡ä»¶ä¸­æ·»åŠ  Spring Statemachine ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.statemachine<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-statemachine-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- æˆ–è€…ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="2-å®šä¹‰çŠ¶æ€å’Œäº‹ä»¶"><a href="#2-å®šä¹‰çŠ¶æ€å’Œäº‹ä»¶" class="headerlink" title="2. å®šä¹‰çŠ¶æ€å’Œäº‹ä»¶"></a>2. <strong>å®šä¹‰çŠ¶æ€å’Œäº‹ä»¶</strong></h3><p>åœ¨ Spring Statemachine ä¸­ï¼Œä½ éœ€è¦å®šä¹‰çŠ¶æ€å’Œäº‹ä»¶ã€‚è¿™äº›é€šå¸¸æ˜¯æšä¸¾ç±»å‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">States</span> &#123;<br>    START,<br>    PROCESSING,<br>    FINISHED,<br>    ERROR<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">Events</span> &#123;<br>    BEGIN,<br>    COMPLETE,<br>    FAIL<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-é…ç½®çŠ¶æ€æœº"><a href="#3-é…ç½®çŠ¶æ€æœº" class="headerlink" title="3. é…ç½®çŠ¶æ€æœº"></a>3. <strong>é…ç½®çŠ¶æ€æœº</strong></h3><p>æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦é…ç½®çŠ¶æ€æœºçš„çŠ¶æ€å’Œäº‹ä»¶ã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªé…ç½®ç±»æ¥å®Œæˆè¿™ä¸€å·¥ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.statemachine.config.EnableStateMachine;<br><span class="hljs-keyword">import</span> org.springframework.statemachine.config.builders.StateMachineBuilder;<br><span class="hljs-keyword">import</span> org.springframework.statemachine.config.builders.StateMachineConfigurerAdapter;<br><span class="hljs-keyword">import</span> org.springframework.statemachine.config.builders.StateMachineStateConfigurer;<br><span class="hljs-keyword">import</span> org.springframework.statemachine.config.builders.StateMachineTransitionConfigurer;<br><span class="hljs-keyword">import</span> org.springframework.statemachine.config.builders.StateMachineStateConfigurer;<br><span class="hljs-keyword">import</span> org.springframework.statemachine.config.builders.StateMachineTransitionConfigurer;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableStateMachine</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StateMachineConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">StateMachineConfigurerAdapter</span>&lt;States, Events&gt; &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(StateMachineStateConfigurer&lt;States, Events&gt; states)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        states<br>            .withStates()<br>                .initial(States.START)<br>                .state(States.PROCESSING)<br>                .state(States.FINISHED)<br>                .state(States.ERROR);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(StateMachineTransitionConfigurer&lt;States, Events&gt; transitions)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        transitions<br>            .withExternal()<br>                .source(States.START).target(States.PROCESSING).event(Events.BEGIN)<br>            .and()<br>            .withExternal()<br>                .source(States.PROCESSING).target(States.FINISHED).event(Events.COMPLETE)<br>            .and()<br>            .withExternal()<br>                .source(States.PROCESSING).target(States.ERROR).event(Events.FAIL);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-ä½¿ç”¨çŠ¶æ€æœº"><a href="#4-ä½¿ç”¨çŠ¶æ€æœº" class="headerlink" title="4. ä½¿ç”¨çŠ¶æ€æœº"></a>4. <strong>ä½¿ç”¨çŠ¶æ€æœº</strong></h3><p>ä½ å¯ä»¥åœ¨ Spring ç»„ä»¶ä¸­æ³¨å…¥çŠ¶æ€æœºå¹¶ä½¿ç”¨å®ƒæ¥å¤„ç†çŠ¶æ€è½¬æ¢ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.statemachine.StateMachine;<br><span class="hljs-keyword">import</span> org.springframework.statemachine.config.StateMachineFactory;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StateMachineService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> StateMachine&lt;States, Events&gt; stateMachine;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startProcess</span><span class="hljs-params">()</span> &#123;<br>        stateMachine.sendEvent(Events.BEGIN);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">completeProcess</span><span class="hljs-params">()</span> &#123;<br>        stateMachine.sendEvent(Events.COMPLETE);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">failProcess</span><span class="hljs-params">()</span> &#123;<br>        stateMachine.sendEvent(Events.FAIL);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5-è¿è¡Œå’Œæµ‹è¯•"><a href="#5-è¿è¡Œå’Œæµ‹è¯•" class="headerlink" title="5. è¿è¡Œå’Œæµ‹è¯•"></a>5. <strong>è¿è¡Œå’Œæµ‹è¯•</strong></h3><p>ç¡®ä¿ä½ å·²ç»å¯åŠ¨äº† Spring Boot åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”åœ¨ä½ çš„æœåŠ¡ä¸­è°ƒç”¨çŠ¶æ€æœºçš„æ–¹æ³•æ¥è§¦å‘äº‹ä»¶å’ŒçŠ¶æ€è½¬æ¢ã€‚</p><h3 id="6-è¿›ä¸€æ­¥å®šåˆ¶"><a href="#6-è¿›ä¸€æ­¥å®šåˆ¶" class="headerlink" title="6. è¿›ä¸€æ­¥å®šåˆ¶"></a>6. <strong>è¿›ä¸€æ­¥å®šåˆ¶</strong></h3><p>Spring Statemachine æä¾›äº†å¾ˆå¤šé«˜çº§åŠŸèƒ½ï¼Œæ¯”å¦‚çŠ¶æ€æŒä¹…åŒ–ã€äº‹ä»¶ç›‘å¬å™¨ã€çŠ¶æ€æœºæŒä¹…åŒ–ç­‰ã€‚å¦‚æœä½ æœ‰æ›´å¤šå¤æ‚çš„éœ€æ±‚ï¼Œå¯ä»¥å‚è€ƒ <a href="https://docs.spring.io/spring-statemachine/docs/current/reference/html/">Spring Statemachine å®˜æ–¹æ–‡æ¡£</a> ä»¥è·å–è¯¦ç»†çš„é…ç½®ä¿¡æ¯å’Œç¤ºä¾‹ã€‚</p><p>è¿™äº›æ˜¯åŸºæœ¬çš„ä½¿ç”¨æ­¥éª¤ï¼Œä½ å¯ä»¥æ ¹æ®å®é™…éœ€è¦è¿›è¡Œæ›´å¤æ‚çš„é…ç½®å’Œå®šåˆ¶ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>spring-boot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çŠ¶æ€æœº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Application-toolkit-trace-cross-thread</title>
    <link href="/java/Application-toolkit-trace-cross-thread/"/>
    <url>/java/Application-toolkit-trace-cross-thread/</url>
    
    <content type="html"><![CDATA[<h1 id="Trace-Cross-Thread"><a href="#Trace-Cross-Thread" class="headerlink" title="Trace Cross Thread"></a>Trace Cross Thread</h1><p>These APIs provide ways to continuous tracing in the cross thread scenario with minimal code changes.<br>All following are sample codes only to demonstrate how to adopt cross thread cases easier.</p><ul><li>Case 1.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-meta">@TraceCrossThread</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCallable</span>&lt;String&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;String&gt; &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br>...<br>    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">1</span>);<br>    executorService.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCallable</span>());<br></code></pre></td></tr></table></figure></li><li>Case 2.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">1</span>);<br>executorService.submit(CallableWrapper.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Callable</span>&lt;String&gt;() &#123;<br>    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;));<br></code></pre></td></tr></table></figure>or<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">1</span>);<br>executorService.execute(RunnableWrapper.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>    <span class="hljs-meta">@Override</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//your code</span><br>    &#125;<br>&#125;));<br></code></pre></td></tr></table></figure></li><li>Case 3.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-meta">@TraceCrossThread</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySupplier</span>&lt;String&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Supplier</span>&lt;String&gt; &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br>...<br>    CompletableFuture.supplyAsync(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MySupplier</span>&lt;String&gt;());<br></code></pre></td></tr></table></figure>or<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture.supplyAsync(SupplierWrapper.of(()-&gt;&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;SupplierWrapper&quot;</span>;<br>&#125;)).thenAccept(System.out::println);<br></code></pre></td></tr></table></figure></li><li>Case 4.<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture.supplyAsync(SupplierWrapper.of(() -&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;SupplierWrapper&quot;</span>;<br>&#125;)).thenAcceptAsync(ConsumerWrapper.of(c -&gt; &#123;<br>    <span class="hljs-comment">// your code visit(url)</span><br>    System.out.println(<span class="hljs-string">&quot;ConsumerWrapper&quot;</span>);<br>&#125;));<br></code></pre></td></tr></table></figure>or<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">CompletableFuture.supplyAsync(SupplierWrapper.of(() -&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;SupplierWrapper&quot;</span>;<br>&#125;)).thenApplyAsync(FunctionWrapper.of(f -&gt; &#123;<br>    <span class="hljs-comment">// your code visit(url)</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;FunctionWrapper&quot;</span>;<br>&#125;));<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¹¶å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>äº¤æ˜“ä¸‹å•æ—¶é‡‘é¢å˜åŒ–</title>
    <link href="/%E4%BA%A4%E6%98%93/%E4%BA%A4%E6%98%93%E4%B8%8B%E5%8D%95%E6%97%B6%E9%87%91%E9%A2%9D%E5%8F%98%E5%8C%96/"/>
    <url>/%E4%BA%A4%E6%98%93/%E4%BA%A4%E6%98%93%E4%B8%8B%E5%8D%95%E6%97%B6%E9%87%91%E9%A2%9D%E5%8F%98%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<p>è´¦æˆ·ä¿¡æ¯:</p><p>â€‹ä½™é¢ : 100000 ä¿¡ç”¨ : 0 å‡€å€¼ : 100000 å¯ç”¨ä¿è¯é‡‘ : 100000 å·²ç”¨ä¿è¯é‡‘ : 0 é¢„ä»˜æ¬¾æ¯”ä¾‹ : 0 ä»“æ¯ : æ‰‹ç»­è´¹ : ç›ˆäº : 0</p><p>â€‹å‡€å€¼ &#x3D; ä½™é¢+ä¿¡ç”¨+æµ®åŠ¨ç›ˆäºï¼ˆå¹³ä»“åï¼Œæµ®åŠ¨ç›ˆäºè½¬ä¸ºä½™é¢ï¼‰</p><p>â€‹å‡€å€¼ &#x3D; å¯ç”¨ä¿è¯é‡‘+å·²ç”¨ä¿è¯é‡‘</p><p>â€‹æµ®åŠ¨ç›ˆäº&#x3D;è®¢å•ç›ˆäº+æ‰‹ç»­è´¹+éš”å¤œä»“æ¯</p><p>ä¸‹å•æ—¶ï¼š</p><p>â€‹ä½™é¢ : 100000 ä¿¡ç”¨ : 0 å‡€å€¼ï¼ˆé€šè¿‡å…¬å¼è®¡ç®—ï¼‰ : 100000 å¯ç”¨ä¿è¯é‡‘ : 100000 å·²ç”¨ä¿è¯é‡‘ : 0 é¢„ä»˜æ¬¾æ¯”ä¾‹ : 0 ä»“æ¯ : æ‰‹ç»­è´¹ : ç›ˆäº : 0</p><p>â€‹</p><p>å ç”¨10å…ƒçš„ä¿è¯é‡‘ï¼š   æµ®åŠ¨ç›ˆäºï¼š+1  ï¼Œå¼€ä»“æ‰‹ç»­è´¹ï¼š-50</p><p>â€‹ä½™é¢ : 100000 ä¿¡ç”¨ : 0 å‡€å€¼ï¼ˆé€šè¿‡å…¬å¼è®¡ç®—ï¼‰ : 100000+1 -50 å¯ç”¨ä¿è¯é‡‘ : 100000 +1 -50  -10  å·²ç”¨ä¿è¯é‡‘ : 10 é¢„ä»˜æ¬¾æ¯”ä¾‹ : 0 ä»“æ¯ : æ‰‹ç»­è´¹ :50  ï¼Œ æµ®åŠ¨ç›ˆäº : -50 +1  ï¼Œè®¢å•ç›ˆäºï¼š1</p><p>å‘ç”Ÿå¹³ä»“ï¼šé‡Šæ”¾å ç”¨çš„10å…ƒçš„ä¿è¯é‡‘ï¼š   æµ®åŠ¨ç›ˆäºï¼š+1ï¼Œå¼€ä»“æ‰‹ç»­è´¹ï¼š-50 ï¼Œ å…³ä»“æ‰‹ç»­è´¹ï¼š-40</p><p>â€‹ä½™é¢ : 100000 -50-40 +1 ä¿¡ç”¨ : 0  å‡€å€¼ï¼ˆé€šè¿‡å…¬å¼è®¡ç®—ï¼‰ : 100000+1 -50-40  å¯ç”¨ä¿è¯é‡‘ : 100000 +1 -50 -40  -10+10  å·²ç”¨ä¿è¯é‡‘ : 0  é¢„ä»˜æ¬¾æ¯”ä¾‹ : 0 ä»“æ¯ : æ‰‹ç»­è´¹ :  50+40ï¼Œ æµ®åŠ¨ç›ˆäº :0  ï¼Œè®¢å•ç›ˆäºï¼š1</p>]]></content>
    
    
    <categories>
      
      <category>äº¤æ˜“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è´¦æˆ·èµ„é‡‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>github å°†è¿œç¨‹ä»“åº“æ›´æ–°åˆ°è‡ªå·±çš„ä»“åº“ä¸­</title>
    <link href="/linux/github-%E5%B0%86%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E6%9B%B4%E6%96%B0%E5%88%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BB%93%E5%BA%93%E4%B8%AD/"/>
    <url>/linux/github-%E5%B0%86%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E6%9B%B4%E6%96%B0%E5%88%B0%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BB%93%E5%BA%93%E4%B8%AD/</url>
    
    <content type="html"><![CDATA[<p>è¦å°†è¿œç¨‹ä»“åº“çš„æ›´æ–°åŒæ­¥åˆ°ä½ æœ¬åœ°çš„Gitä»“åº“ä¸­ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š</p><ol><li><p><strong>æ·»åŠ è¿œç¨‹ä»“åº“</strong>ï¼ˆå¦‚æœè¿˜æ²¡æœ‰æ·»åŠ è¿œç¨‹ä»“åº“ï¼‰ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git remote add upstream &lt;è¿œç¨‹ä»“åº“çš„URL&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³å°†GitHubä¸ŠåŸå§‹é¡¹ç›®çš„æ›´æ–°åŒæ­¥åˆ°ä½ è‡ªå·±çš„åˆ†æ”¯ï¼Œ<code>upstream</code> å°±æ˜¯ä½ éœ€è¦æ·»åŠ çš„è¿œç¨‹ä»“åº“ã€‚</p></li><li><p><strong>è·å–è¿œç¨‹ä»“åº“çš„æ›´æ–°</strong>ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git fetch upstream<br></code></pre></td></tr></table></figure><p>è¿™å°†ä»è¿œç¨‹ä»“åº“è·å–æ‰€æœ‰æ›´æ–°å†…å®¹ï¼Œä½†ä¸ä¼šè‡ªåŠ¨åˆå¹¶åˆ°ä½ çš„åˆ†æ”¯ä¸­ã€‚</p></li><li><p><strong>å°†è¿œç¨‹ä»“åº“çš„æ›´æ–°åˆå¹¶åˆ°ä½ çš„åˆ†æ”¯</strong>ï¼š</p><ul><li>å¦‚æœä½ åœ¨ <code>main</code> åˆ†æ”¯ä¸Šï¼Œå¹¶å¸Œæœ›å°† <code>upstream/main</code> çš„æ›´æ–°åˆå¹¶åˆ°æœ¬åœ°çš„ <code>main</code> åˆ†æ”¯ï¼š  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout main<br>git merge upstream/main<br></code></pre></td></tr></table></figure>è¿™ä¼šå°†è¿œç¨‹ <code>main</code> åˆ†æ”¯çš„æ›´æ–°åˆå¹¶åˆ°ä½ æœ¬åœ°çš„ <code>main</code> åˆ†æ”¯ä¸­ã€‚</li></ul></li><li><p><strong>å¤„ç†å¯èƒ½çš„å†²çª</strong>ï¼š</p><ul><li>å¦‚æœåœ¨åˆå¹¶æ—¶å‘ç”Ÿå†²çªï¼ŒGit ä¼šæç¤ºä½ æ‰‹åŠ¨è§£å†³å†²çªã€‚ä½ éœ€è¦ç¼–è¾‘å†²çªçš„æ–‡ä»¶ï¼Œè§£å†³å†²çªåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add &lt;è§£å†³å†²çªçš„æ–‡ä»¶&gt;<br>git commit -m <span class="hljs-string">&quot;Resolved merge conflicts&quot;</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>å°†æ›´æ–°æ¨é€åˆ°ä½ è‡ªå·±çš„è¿œç¨‹ä»“åº“</strong>ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push origin main<br></code></pre></td></tr></table></figure><p>è¿™ä¼šå°†ä½ æœ¬åœ° <code>main</code> åˆ†æ”¯çš„æ›´æ–°æ¨é€åˆ°ä½ è‡ªå·±çš„GitHubä»“åº“ä¸­ã€‚</p></li></ol><p>é€šè¿‡è¿™äº›æ­¥éª¤ï¼Œä½ å°±å¯ä»¥å°†è¿œç¨‹ä»“åº“çš„æ›´æ–°åŒæ­¥åˆ°ä½ çš„æœ¬åœ°ä»“åº“ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®éœ€è¦å°†è¿™äº›æ›´æ–°æ¨é€åˆ°ä½ è‡ªå·±çš„è¿œç¨‹ä»“åº“ä¸­ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>git</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linuxä¸‹é€šè¿‡ç«¯å£æ‰¾åˆ°è¿›ç¨‹</title>
    <link href="/linux/linux%E4%B8%8B%E9%80%9A%E8%BF%87%E7%AB%AF%E5%8F%A3%E6%89%BE%E5%88%B0%E8%BF%9B%E7%A8%8B/"/>
    <url>/linux/linux%E4%B8%8B%E9%80%9A%E8%BF%87%E7%AB%AF%E5%8F%A3%E6%89%BE%E5%88%B0%E8%BF%9B%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ç§æ–¹æ³•é€šè¿‡ç«¯å£å·æŸ¥æ‰¾å ç”¨è¯¥ç«¯å£çš„è¿›ç¨‹ï¼š</p><h3 id="1-ä½¿ç”¨-lsof-å‘½ä»¤"><a href="#1-ä½¿ç”¨-lsof-å‘½ä»¤" class="headerlink" title="1. ä½¿ç”¨ lsof å‘½ä»¤"></a>1. ä½¿ç”¨ <code>lsof</code> å‘½ä»¤</h3><p><code>lsof</code> æ˜¯ä¸€ä¸ªç”¨äºåˆ—å‡ºæ‰“å¼€çš„æ–‡ä»¶çš„å‘½ä»¤ï¼Œå®ƒä¹Ÿå¯ä»¥ç”¨äºæŸ¥æ‰¾æ­£åœ¨ä½¿ç”¨æŸä¸ªç«¯å£çš„è¿›ç¨‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsof -i :&lt;ç«¯å£å·&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼ŒæŸ¥æ‰¾å ç”¨80ç«¯å£çš„è¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsof -i :80<br></code></pre></td></tr></table></figure><h3 id="2-ä½¿ç”¨-netstat-å‘½ä»¤"><a href="#2-ä½¿ç”¨-netstat-å‘½ä»¤" class="headerlink" title="2. ä½¿ç”¨ netstat å‘½ä»¤"></a>2. ä½¿ç”¨ <code>netstat</code> å‘½ä»¤</h3><p><code>netstat</code> æ˜¯ä¸€ä¸ªç½‘ç»œçŠ¶æ€ç›‘æ§å·¥å…·ï¼Œå¯ä»¥æ˜¾ç¤ºä¸ç½‘ç»œç›¸å…³çš„å†…å®¹ï¼ŒåŒ…æ‹¬å“ªäº›è¿›ç¨‹åœ¨ç›‘å¬å“ªäº›ç«¯å£ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">netstat -tuln | grep :&lt;ç«¯å£å·&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼ŒæŸ¥æ‰¾å ç”¨80ç«¯å£çš„è¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">netstat -tuln | grep :80<br></code></pre></td></tr></table></figure><p>ç»“åˆ <code>netstat</code> å’Œ <code>grep</code> å‘½ä»¤ï¼Œè¿˜å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„PIDï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">netstat -tulnp | grep :&lt;ç«¯å£å·&gt;<br></code></pre></td></tr></table></figure><h3 id="3-ä½¿ç”¨-ss-å‘½ä»¤"><a href="#3-ä½¿ç”¨-ss-å‘½ä»¤" class="headerlink" title="3. ä½¿ç”¨ ss å‘½ä»¤"></a>3. ä½¿ç”¨ <code>ss</code> å‘½ä»¤</h3><p><code>ss</code> æ˜¯ <code>netstat</code> çš„æ›¿ä»£å“ï¼Œç”¨äºæ˜¾ç¤ºsocketç»Ÿè®¡ä¿¡æ¯ï¼Œå¯ä»¥æ›´å¿«é€Ÿåœ°æ˜¾ç¤ºç½‘ç»œè¿æ¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ss -tuln | grep :&lt;ç«¯å£å·&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼ŒæŸ¥æ‰¾å ç”¨80ç«¯å£çš„è¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ss -tuln | grep :80<br></code></pre></td></tr></table></figure><h3 id="4-ä½¿ç”¨-fuser-å‘½ä»¤"><a href="#4-ä½¿ç”¨-fuser-å‘½ä»¤" class="headerlink" title="4. ä½¿ç”¨ fuser å‘½ä»¤"></a>4. ä½¿ç”¨ <code>fuser</code> å‘½ä»¤</h3><p><code>fuser</code> æ˜¯ä¸€ä¸ªæ˜¾ç¤ºå“ªä¸ªè¿›ç¨‹ä½¿ç”¨å“ªäº›æ–‡ä»¶æˆ–socketçš„å‘½ä»¤ã€‚å¯ä»¥ç›´æ¥æ˜¾ç¤ºå ç”¨æŒ‡å®šç«¯å£çš„è¿›ç¨‹PIDã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">fuser &lt;ç«¯å£å·&gt;/tcp<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼ŒæŸ¥æ‰¾å ç”¨80ç«¯å£çš„è¿›ç¨‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">fuser 80/tcp<br></code></pre></td></tr></table></figure><h3 id="5-æŸ¥çœ‹è¯¦ç»†çš„è¿›ç¨‹ä¿¡æ¯"><a href="#5-æŸ¥çœ‹è¯¦ç»†çš„è¿›ç¨‹ä¿¡æ¯" class="headerlink" title="5. æŸ¥çœ‹è¯¦ç»†çš„è¿›ç¨‹ä¿¡æ¯"></a>5. æŸ¥çœ‹è¯¦ç»†çš„è¿›ç¨‹ä¿¡æ¯</h3><p>ä¸€æ—¦è·å¾—äº†PIDï¼Œå¯ä»¥ä½¿ç”¨ <code>ps</code> å‘½ä»¤æ¥æŸ¥çœ‹è¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps -p &lt;PID&gt; -o pid,cmd<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ps -p 1234 -o pid,cmd<br></code></pre></td></tr></table></figure><p>è¿™å°†æ˜¾ç¤ºPIDä¸º1234çš„è¿›ç¨‹çš„å‘½ä»¤è¡Œã€‚</p><p>é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œæ‚¨å¯ä»¥å¾ˆå®¹æ˜“åœ°æŸ¥æ‰¾åˆ°å ç”¨ç‰¹å®šç«¯å£çš„è¿›ç¨‹å¹¶è·å–ç›¸åº”çš„PIDå’Œå…¶ä»–ä¿¡æ¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æŸ¥æ‰¾è¿›ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>openvpn-éƒ¨ç½²è„šæœ¬</title>
    <link href="/linux/openvpn-%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC/"/>
    <url>/linux/openvpn-%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<p>1.æ‰§è¡Œå®‰è£…è„šæœ¬ï¼š<br><a href="../../resource/openvpn.sh">openvpn.sh</a></p><p>2.å°†è¦†ç›–çš„dnsç­‰é…ç½®æ³¨é‡Šæ‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs server">local 192.168.2.124<br>port 5001<br>proto udp<br>dev tun<br>ca ca.crt<br>cert server.crt<br>key server.key<br>dh dh.pem<br>auth SHA256<br>tls-crypt tc.key<br>topology subnet<br>server 10.8.0.0 255.255.255.0<br>#push &quot;block-ipv6&quot;<br>#push &quot;ifconfig-ipv6 fddd:1194:1194:1194::2/64 fddd:1194:1194:1194::1&quot;<br>#push &quot;redirect-gateway def1 ipv6 bypass-dhcp&quot;<br>ifconfig-pool-persist ipp.txt<br>#push &quot;dhcp-option DNS 100.125.1.250&quot;<br>#push &quot;block-outside-dns&quot;<br>keepalive 10 120<br>cipher AES-128-GCM<br>user nobody<br>group nogroup<br>persist-key<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>openvpn</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨å›¾å½¢åŒ–å¯¹linuxç£ç›˜è¿›è¡Œæ‰©å®¹</title>
    <link href="/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/"/>
    <url>/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/</url>
    
    <content type="html"><![CDATA[<p>ç£ç›˜ç©ºé—´ä¸è¶³çš„æç¤ºã€‚<br>æˆ‘å°±åœ¨ç»ˆç«¯è¾“å…¥df -hæŸ¥çœ‹äº†ä¸€ä¸‹ç£ç›˜çš„ä½¿ç”¨æƒ…å†µã€‚<br>æ–‡ä»¶ç³»ç»Ÿ        å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹<br>udev             14G     0   14G    0% &#x2F;dev<br>tmpfs           2.7G  1.8M  2.7G    1% &#x2F;run<br>&#x2F;dev&#x2F;sda1        48G   46G   47M  100% &#x2F;<br>tmpfs            14G     0   14G    0% &#x2F;dev&#x2F;shm<br>tmpfs           5.0M     0  5.0M    0% &#x2F;run&#x2F;lock<br>tmpfs           2.7G   60K  2.7G    1% &#x2F;run&#x2F;user&#x2F;130<br>tmpfs           2.7G   52K  2.7G    1% &#x2F;run&#x2F;user&#x2F;0<br>overlay          48G   46G   47M  100% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;40d9810bdeacf6f8af191b96880582457507055ac701cddc05c90bd41a4cc8cd&#x2F;merged<br>overlay          48G   46G   47M  100% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;684b310e0e5d6cd40b0003fea2920d176d49aacacba87d1364dc0f0aa26d429d&#x2F;merged<br>overlay          48G   46G   47M  100% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;71c3fc9620d502f60d702b4a0227cb0ccfe86a05f75c0627a261ac1357a28867&#x2F;merged<br>overlay          48G   46G   47M  100% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;3491e006468ecf31bc09cfe8d4ecef08bb37d93d2678f919e0e57f02b76c7cc6&#x2F;merged</p><p>å‘ç°&#x2F;dev&#x2F;sda1è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„ä½¿ç”¨ç‡æ‰“åˆ°äº†90%ä»¥ä¸Šï¼Œæˆ‘å°±æƒ³ç€ç»™ä»–æ‰©ä¸€ä¸‹å®¹ã€‚<br>ç½‘ä¸Šå„ç§æ‰¾æ–¹æ³•â€¦.<br>ç½‘ä¸Šä¸€å †å¤åˆ¶ç²˜è´´çš„å‘é€¼æ•™ç¨‹å¯æŠŠæˆ‘ç»™å‘æƒ¨äº†ã€‚<br>æœ€åæ‰¾åˆ°äº†ä¸¤ç¯‡æ–‡ç« ç»¼åˆèµ·æ¥æ‰æˆåŠŸã€‚<br>å†™å‡ºæ¥çš„ç›®çš„ä»…ä»…ä¸ºäº†æ–¹ä¾¿è®°å¿†ï¼Œé‚£ä¹ˆå°±æ¥è¯´è¯´å§ã€‚<br>ç¬¬ä¸€æ­¥:<br>ä½¿ç”¨VMwareå›¾åƒç•Œé¢å·¥å…·ï¼Œå¯¹ç£ç›˜è¿›è¡Œæ‰©å®¹ã€‚è¿™ä¸€æ­¥è¦å…ˆå°†ä½ çš„ubantuå…³æœºåæ‰å¯ä»¥è¿›è¡Œã€‚ï¼ˆå¿…é¡»åˆ é™¤æ‰€æœ‰å¿«ç…§ï¼‰ç‚¹å‡»æ‹“å±•åå°±å¯ä»¥æŒ‡å®šç£ç›˜å¤§å°äº†ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡ŒæŒ‡å®šçš„ç£ç›˜å¤§å°å¹¶ä¸æ˜¯ç«‹é©¬åˆ†å‡ºä½ ç»™å®šçš„ç£ç›˜å¤§å°ã€‚è€Œæ˜¯ç»™äº†ä¸€ä¸ªå®¹é‡ä¸Šé™ï¼Œä½ ç”¨å¤šå°‘å°±æ¶ˆè€—æœ¬æœºå¤šå°‘ç©ºé—´ã€‚æ‰€ä»¥æŒ‡å®šå¤§ä¸€ç‚¹ä¹Ÿæ²¡å…³ç³»ã€‚</p><p>ç¬¬äºŒæ­¥:<br>ä¸‹è½½Gpartedé•œåƒæ–‡ä»¶ã€‚<br><a href="https://jaist.dl.sourceforge.net/project/gparted/gparted-live-testing/1.6.0-3/gparted-live-1.6.0-3-amd64.iso?viasf=1">https://jaist.dl.sourceforge.net/project/gparted/gparted-live-testing/1.6.0-3/gparted-live-1.6.0-3-amd64.iso?viasf=1</a></p><p>ç„¶ååœ¨è™šæ‹Ÿæœºçš„è®¾ç½®â€“CD&#x2F;DVD(SATA)é‡Œï¼Œ åœ¨â€å¯åŠ¨æ—¶è¿æ¥â€å‰æ‰“é’© å¹¶é€‰æ‹© ä¸Šé¢ä¸‹è½½å¥½çš„ Gparted é•œåƒï¼Œ å¦‚ä¸‹å›¾ï¼š</p><p>ç¬¬ä¸‰æ­¥:<br>å¯åŠ¨BIOSæ–¹æ³•:<br>ç”¨è®°äº‹æœ¬æ‰“å¼€ubantu.vmxæ–‡ä»¶ï¼Œåœ¨ç¬¬ä¸€è¡Œæ·»åŠ è¿™æ®µä»£ç <br>bios.forceSetupOnce &#x3D; â€œTRUEâ€</p><p>ä¿å­˜å†æ‰“å¼€å°±å¯ä»¥è¿›å…¥BIOSï¼Œè¿™ä¸ªè®¾ç½®æ—¶ä¸€æ¬¡æ€§çš„ï¼Œåœ¨ä½ å¼€æœºåè¿™æ®µä»£ç ä¼šè‡ªåŠ¨æ¶ˆå¤±ï¼Œæ‰€ä»¥è®¾ç½®å®Œä¹‹åå°±ä¸ç”¨ç®¡äº†ã€‚</p><p>è¿›å…¥BIOSåç”¨â†â†’é”®é€‰æ‹©è¿›å…¥BOOTï¼Œç„¶åç”¨â†‘â†“é€‰æ‹©åˆ°CD-ROM driveï¼Œå†æŒ‰â€ + â€œå·æŠŠå®ƒä¸€åˆ°ç¬¬ä¸€ä½ã€‚ç„¶åæŒ‰F10ä¿å­˜é€€å‡ºã€‚</p><p>å¼€æœºåå³å¯è¿›å…¥è¿™ä¸ªç•Œé¢ã€‚</p><p>è¾“å…¥26é€‰æ‹©ç®€ä½“ä¸­æ–‡ï¼Œæ•²å›è½¦</p><p>è¾“å…¥0ï¼Œæ•²å›è½¦</p><p>è¿›å…¥Gpartedçš„ç•Œé¢ä¼šè‡ªåŠ¨å¼¹å‡ºGpartedçš„åˆ†åŒºç•Œé¢ã€‚</p><p>ä¾æ¬¡åˆ é™¤ linux-swapé¡¹ï¼Œ extendedé¡¹ï¼Œ æœ€ååªå‰©ä¸‹sda1å’Œæœªåˆ†é…ï¼Œ ç„¶åå³é”®â€sda1â€é¡¹è¿›è¡Œè°ƒæ•´å¤§å°ï¼Œ<br>å°†ç£ç›˜å®¹é‡è°ƒæ•´åˆ°åˆé€‚çš„å¤§å°æœ€å¥½æ˜¯1024çš„æ•´æ•°å€ï¼Œå¹¶é¢„ç•™ç©ºé—´(2-4G)ä½œä¸ºäº¤æ¢åŒºï¼Œäº¤æ¢åŒºçš„å¤§å°ä¸ºä½ ç³»ç»Ÿå†…å­˜çš„å¤§å°ã€‚<br>å†å³é”®â€æœªåˆ†é…â€è¿›è¡Œæ‰©å±•åˆ†åŒºå‡ºextendedåˆ†åŒºï¼Œç„¶åæ–°å»ºé€»è¾‘åˆ†åŒºlinux-swapï¼Œæ“ä½œå®Œæˆåç‚¹å‡»APPLYæäº¤ã€‚ç„¶åé€€å‡º<br>ç„¶åæ­£å¸¸å¯åŠ¨ä½ çš„ubantuï¼Œå†æ¬¡è¾“å…¥å‘½ä»¤df -hæŸ¥çœ‹æ‰©å®¹æ˜¯å¦æˆåŠŸ</p><p>â””â”€# df -h<br>æ–‡ä»¶ç³»ç»Ÿ        å®¹é‡  å·²ç”¨  å¯ç”¨ å·²ç”¨% æŒ‚è½½ç‚¹<br>udev             14G     0   14G    0% &#x2F;dev<br>tmpfs           2.7G  1.8M  2.7G    1% &#x2F;run<br>&#x2F;dev&#x2F;sda1       144G   34G  104G   25% &#x2F;<br>tmpfs            14G     0   14G    0% &#x2F;dev&#x2F;shm<br>tmpfs           5.0M     0  5.0M    0% &#x2F;run&#x2F;lock<br>tmpfs           2.7G   60K  2.7G    1% &#x2F;run&#x2F;user&#x2F;130<br>overlay         144G   34G  104G   25% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;71c3fc9620d502f60d702b4a0227cb0ccfe86a05f75c0627a261ac1357a28867&#x2F;merged<br>overlay         144G   34G  104G   25% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;684b310e0e5d6cd40b0003fea2920d176d49aacacba87d1364dc0f0aa26d429d&#x2F;merged<br>overlay         144G   34G  104G   25% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;40d9810bdeacf6f8af191b96880582457507055ac701cddc05c90bd41a4cc8cd&#x2F;merged<br>overlay         144G   34G  104G   25% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;3491e006468ecf31bc09cfe8d4ecef08bb37d93d2678f919e0e57f02b76c7cc6&#x2F;merged<br>tmpfs           2.7G   56K  2.7G    1% &#x2F;run&#x2F;user&#x2F;0<br>overlay         144G   34G  104G   25% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;930ee5b9896adee4a28eec7579f04eda6b9fb74888d7c2fb13d4834d6164d782&#x2F;merged</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ‰©å®¹ç£ç›˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¯¹linuxç£ç›˜è¿›è¡Œæ— æŸæ‰©å®¹</title>
    <link href="/linux/%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%97%A0%E6%8D%9F%E6%89%A9%E5%AE%B9/"/>
    <url>/linux/%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%97%A0%E6%8D%9F%E6%89%A9%E5%AE%B9/</url>
    
    <content type="html"><![CDATA[<p>æ‰§è¡Œ lsblk å‘½ä»¤å¾—åˆ°çš„æ•°æ®å¦‚ä¸‹<br>   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS<br>sda      8:0    0  150G  0 disk <br>â”œâ”€sda1   8:1    0   49G  0 part /<br>â”œâ”€sda2   8:2    0    1K  0 part <br>â””â”€sda5   8:5    0  975M  0 part [SWAP]<br>sr0     11:0    1  4.6G  0 rom  <br></code></pre></td></tr></table></figure><br>æ­¤æ—¶ï¼Œæƒ³å°†sda1ä»49Gæ‰©å®¹åˆ°150Gã€‚è¿›è¡Œæ— æŸæ‰©å±• <code>/dev/sda1</code> çš„æ­¥éª¤è¾ƒä¸ºå¤æ‚ï¼Œä½†å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤æ¥å®‰å…¨åœ°æ‰©å±•åˆ†åŒºè€Œä¸ä¸¢å¤±æ•°æ®ã€‚è¿™åŒ…æ‹¬ä½¿ç”¨ <code>fdisk</code> æˆ– <code>parted</code> å·¥å…·æ¥è°ƒæ•´åˆ†åŒºå¤§å°ï¼Œç„¶åæ‰©å±•æ–‡ä»¶ç³»ç»Ÿã€‚</p><h3 id="æ— æŸæ‰©å±•åˆ†åŒºçš„æ­¥éª¤"><a href="#æ— æŸæ‰©å±•åˆ†åŒºçš„æ­¥éª¤" class="headerlink" title="æ— æŸæ‰©å±•åˆ†åŒºçš„æ­¥éª¤"></a>æ— æŸæ‰©å±•åˆ†åŒºçš„æ­¥éª¤</h3><h4 id="1-å¤‡ä»½æ•°æ®"><a href="#1-å¤‡ä»½æ•°æ®" class="headerlink" title="1. å¤‡ä»½æ•°æ®"></a>1. <strong>å¤‡ä»½æ•°æ®</strong></h4><p>åœ¨è¿›è¡Œä»»ä½•ç£ç›˜æ“ä½œä¹‹å‰ï¼ŒåŠ¡å¿…å¤‡ä»½é‡è¦æ•°æ®ä»¥é˜²ä¸‡ä¸€ã€‚</p><h4 id="2-ä½¿ç”¨-parted-è°ƒæ•´åˆ†åŒºå¤§å°"><a href="#2-ä½¿ç”¨-parted-è°ƒæ•´åˆ†åŒºå¤§å°" class="headerlink" title="2. ä½¿ç”¨ parted è°ƒæ•´åˆ†åŒºå¤§å°"></a>2. <strong>ä½¿ç”¨ <code>parted</code> è°ƒæ•´åˆ†åŒºå¤§å°</strong></h4><p>å‡è®¾ç°æœ‰çš„ <code>/dev/sda1</code> æ˜¯ <code>ext4</code> æ–‡ä»¶ç³»ç»Ÿã€‚</p><ol><li><p><strong>æŸ¥çœ‹å½“å‰ç£ç›˜å¸ƒå±€</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">lsblk<br>sudo fdisk -l /dev/sda<br></code></pre></td></tr></table></figure></li><li><p><strong>è°ƒæ•´åˆ†åŒºå¤§å°</strong></p><p>ä½¿ç”¨ <code>parted</code> è°ƒæ•´åˆ†åŒºå¤§å°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo parted /dev/sda<br></code></pre></td></tr></table></figure><p>åœ¨ <code>parted</code> äº¤äº’ç•Œé¢ä¸­æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">(parted) <span class="hljs-built_in">print</span><br></code></pre></td></tr></table></figure><p>ç¡®è®¤åˆ†åŒºè¡¨ï¼Œå¹¶è®°ä¸‹ <code>/dev/sda1</code> çš„èµ·å§‹ä½ç½®ï¼ˆä¾‹å¦‚ <code>2048s</code>ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">(parted) resizepart 1 150GB<br></code></pre></td></tr></table></figure><p>è¿™ä¼šæ‰©å±•åˆ†åŒº1åˆ°150GBã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">(parted) quit<br></code></pre></td></tr></table></figure></li></ol><h4 id="3-æ›´æ–°åˆ†åŒºè¡¨"><a href="#3-æ›´æ–°åˆ†åŒºè¡¨" class="headerlink" title="3. æ›´æ–°åˆ†åŒºè¡¨"></a>3. <strong>æ›´æ–°åˆ†åŒºè¡¨</strong></h4><p>æœ‰æ—¶ï¼Œç³»ç»Ÿéœ€è¦é‡æ–°åŠ è½½åˆ†åŒºè¡¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo partprobe /dev/sda<br></code></pre></td></tr></table></figure><h4 id="4-æ‰©å±•æ–‡ä»¶ç³»ç»Ÿ"><a href="#4-æ‰©å±•æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="4. æ‰©å±•æ–‡ä»¶ç³»ç»Ÿ"></a>4. <strong>æ‰©å±•æ–‡ä»¶ç³»ç»Ÿ</strong></h4><p>æ ¹æ®ä½ çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼Œæ‰§è¡Œä»¥ä¸‹æ­¥éª¤æ¥æ‰©å±•æ–‡ä»¶ç³»ç»Ÿã€‚</p><h5 id="å¯¹äº-ext4-æ–‡ä»¶ç³»ç»Ÿï¼š"><a href="#å¯¹äº-ext4-æ–‡ä»¶ç³»ç»Ÿï¼š" class="headerlink" title="å¯¹äº ext4 æ–‡ä»¶ç³»ç»Ÿï¼š"></a>å¯¹äº <code>ext4</code> æ–‡ä»¶ç³»ç»Ÿï¼š</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo resize2fs /dev/sda1<br></code></pre></td></tr></table></figure><h5 id="å¯¹äº-xfs-æ–‡ä»¶ç³»ç»Ÿï¼š"><a href="#å¯¹äº-xfs-æ–‡ä»¶ç³»ç»Ÿï¼š" class="headerlink" title="å¯¹äº xfs æ–‡ä»¶ç³»ç»Ÿï¼š"></a>å¯¹äº <code>xfs</code> æ–‡ä»¶ç³»ç»Ÿï¼š</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo xfs_growfs /dev/sda1<br></code></pre></td></tr></table></figure><h4 id="5-éªŒè¯æ‰©å±•æ˜¯å¦æˆåŠŸ"><a href="#5-éªŒè¯æ‰©å±•æ˜¯å¦æˆåŠŸ" class="headerlink" title="5. éªŒè¯æ‰©å±•æ˜¯å¦æˆåŠŸ"></a>5. <strong>éªŒè¯æ‰©å±•æ˜¯å¦æˆåŠŸ</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">df</span> -h<br></code></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹æ­¥éª¤"><a href="#ç¤ºä¾‹æ­¥éª¤" class="headerlink" title="ç¤ºä¾‹æ­¥éª¤"></a>ç¤ºä¾‹æ­¥éª¤</h3><p>å®Œæ•´çš„å‘½ä»¤å’Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹å½“å‰ç£ç›˜å¸ƒå±€</span><br>lsblk<br>sudo fdisk -l /dev/sda<br><br><span class="hljs-comment"># è°ƒæ•´åˆ†åŒºå¤§å°</span><br>sudo parted /dev/sda<br><br><span class="hljs-comment"># åœ¨ parted äº¤äº’ç•Œé¢ä¸­</span><br>(parted) <span class="hljs-built_in">print</span><br>(parted) resizepart 1 150GB<br>(parted) quit<br><br><span class="hljs-comment"># æ›´æ–°åˆ†åŒºè¡¨</span><br>sudo partprobe /dev/sda<br><br><span class="hljs-comment"># æ‰©å±•æ–‡ä»¶ç³»ç»Ÿï¼ˆå‡è®¾æ˜¯ ext4 æ–‡ä»¶ç³»ç»Ÿï¼‰</span><br>sudo resize2fs /dev/sda1<br><br><span class="hljs-comment"># éªŒè¯æ‰©å±•æ˜¯å¦æˆåŠŸ</span><br><span class="hljs-built_in">df</span> -h<br></code></pre></td></tr></table></figure><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ul><li>ç¡®ä¿ä½ çš„ <code>/dev/sda1</code> åˆ†åŒºåé¢æœ‰è¶³å¤Ÿçš„æœªåˆ†é…ç©ºé—´æ¥æ‰©å±•åˆ° 150GBã€‚</li><li>åœ¨æ“ä½œä¹‹å‰ï¼Œç¡®ä¿ç³»ç»Ÿåˆ†åŒºæœªè¢«ä½¿ç”¨æˆ–è€…åœ¨å•ç”¨æˆ·æ¨¡å¼ä¸‹è¿›è¡Œæ“ä½œï¼Œä»¥é˜²æ­¢æ•°æ®æŸåã€‚</li><li>å¦‚æœä½ æ— æ³•è¿›å…¥ç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡ live CD&#x2F;USB å¯åŠ¨ç³»ç»Ÿå¹¶æ‰§è¡Œè¿™äº›æ“ä½œã€‚</li></ul><p>è¿™äº›æ­¥éª¤æ—¨åœ¨æä¾›ä¸€ç§ç›¸å¯¹å®‰å…¨çš„æ–¹æ³•æ¥æ— æŸæ‰©å±•åˆ†åŒºã€‚å¦‚æœå¯¹æ“ä½œä¸ç†Ÿæ‚‰ï¼Œå»ºè®®è¯·æ•™ä¸“ä¸šäººå£«æˆ–ä½¿ç”¨ä¸“ä¸šçš„åˆ†åŒºç®¡ç†è½¯ä»¶è¿›è¡Œæ“ä½œã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ‰©å®¹ç£ç›˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è§£è¯»redisåˆ†å¸ƒå¼é”æ ¸å¿ƒé€»è¾‘</title>
    <link href="/redis/%E8%A7%A3%E8%AF%BBredis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91/"/>
    <url>/redis/%E8%A7%A3%E8%AF%BBredis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91/</url>
    
    <content type="html"><![CDATA[   <figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> insertable = <span class="hljs-literal">false</span>; <span class="hljs-keyword">local</span> value = redis.call(<span class="hljs-string">&#x27;hget&#x27;</span>, KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">5</span>]); <span class="hljs-keyword">if</span> value == <span class="hljs-literal">false</span> <span class="hljs-keyword">then</span> insertable = <span class="hljs-literal">true</span>; <span class="hljs-keyword">else</span> <span class="hljs-keyword">local</span> t, val = struct.<span class="hljs-built_in">unpack</span>(<span class="hljs-string">&#x27;dLc0&#x27;</span>, value); <span class="hljs-keyword">local</span> expireDate = <span class="hljs-number">92233720368547758</span>; <span class="hljs-keyword">local</span> expireDateScore = redis.call(<span class="hljs-string">&#x27;zscore&#x27;</span>, KEYS[<span class="hljs-number">2</span>], ARGV[<span class="hljs-number">5</span>]); <span class="hljs-keyword">if</span> expireDateScore ~= <span class="hljs-literal">false</span> <span class="hljs-keyword">then</span> expireDate = <span class="hljs-built_in">tonumber</span>(expireDateScore) <span class="hljs-keyword">end</span>; <span class="hljs-keyword">if</span> t ~= <span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">local</span> expireIdle = redis.call(<span class="hljs-string">&#x27;zscore&#x27;</span>, KEYS[<span class="hljs-number">3</span>], ARGV[<span class="hljs-number">5</span>]); <span class="hljs-keyword">if</span> expireIdle ~= <span class="hljs-literal">false</span> <span class="hljs-keyword">then</span> expireDate = <span class="hljs-built_in">math</span>.<span class="hljs-built_in">min</span>(expireDate, <span class="hljs-built_in">tonumber</span>(expireIdle)) <span class="hljs-keyword">end</span>; <span class="hljs-keyword">end</span>; <span class="hljs-keyword">if</span> expireDate &lt;= <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">1</span>]) <span class="hljs-keyword">then</span> insertable = <span class="hljs-literal">true</span>; <span class="hljs-keyword">end</span>; <span class="hljs-keyword">end</span>; <span class="hljs-keyword">if</span> insertable == <span class="hljs-literal">true</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">if</span> <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">2</span>]) &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">then</span> redis.call(<span class="hljs-string">&#x27;zadd&#x27;</span>, KEYS[<span class="hljs-number">2</span>], ARGV[<span class="hljs-number">2</span>], ARGV[<span class="hljs-number">5</span>]); <span class="hljs-keyword">else</span> redis.call(<span class="hljs-string">&#x27;zrem&#x27;</span>, KEYS[<span class="hljs-number">2</span>], ARGV[<span class="hljs-number">5</span>]); <span class="hljs-keyword">end</span>; <span class="hljs-keyword">if</span> <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">3</span>]) &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">then</span> redis.call(<span class="hljs-string">&#x27;zadd&#x27;</span>, KEYS[<span class="hljs-number">3</span>], ARGV[<span class="hljs-number">3</span>], ARGV[<span class="hljs-number">5</span>]); <span class="hljs-keyword">else</span> redis.call(<span class="hljs-string">&#x27;zrem&#x27;</span>, KEYS[<span class="hljs-number">3</span>], ARGV[<span class="hljs-number">5</span>]); <span class="hljs-keyword">end</span>; <span class="hljs-keyword">local</span> maxSize = <span class="hljs-built_in">tonumber</span>(redis.call(<span class="hljs-string">&#x27;hget&#x27;</span>, KEYS[<span class="hljs-number">7</span>], <span class="hljs-string">&#x27;max-size&#x27;</span>)); <span class="hljs-keyword">if</span> maxSize ~= <span class="hljs-literal">nil</span> <span class="hljs-keyword">and</span> maxSize ~= <span class="hljs-number">0</span> <span class="hljs-keyword">then</span>     <span class="hljs-keyword">local</span> currentTime = <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">1</span>]);     <span class="hljs-keyword">local</span> lastAccessTimeSetName = KEYS[<span class="hljs-number">5</span>]; <span class="hljs-keyword">local</span> mode = redis.call(<span class="hljs-string">&#x27;hget&#x27;</span>, KEYS[<span class="hljs-number">7</span>], <span class="hljs-string">&#x27;mode&#x27;</span>); <span class="hljs-keyword">if</span> mode == <span class="hljs-literal">false</span> <span class="hljs-keyword">or</span> mode == <span class="hljs-string">&#x27;LRU&#x27;</span> <span class="hljs-keyword">then</span> redis.call(<span class="hljs-string">&#x27;zadd&#x27;</span>, lastAccessTimeSetName, currentTime, ARGV[<span class="hljs-number">5</span>]); <span class="hljs-keyword">end</span>;     <span class="hljs-keyword">local</span> cacheSize = <span class="hljs-built_in">tonumber</span>(redis.call(<span class="hljs-string">&#x27;hlen&#x27;</span>, KEYS[<span class="hljs-number">1</span>]));     <span class="hljs-keyword">if</span> cacheSize &gt;= maxSize <span class="hljs-keyword">then</span>         <span class="hljs-keyword">local</span> lruItems = redis.call(<span class="hljs-string">&#x27;zrange&#x27;</span>, lastAccessTimeSetName, <span class="hljs-number">0</span>, cacheSize - maxSize);         <span class="hljs-keyword">for</span> index, lruItem <span class="hljs-keyword">in</span> <span class="hljs-built_in">ipairs</span>(lruItems) <span class="hljs-keyword">do</span>             <span class="hljs-keyword">if</span> lruItem <span class="hljs-keyword">and</span> lruItem ~= ARGV[<span class="hljs-number">5</span>] <span class="hljs-keyword">then</span>                 <span class="hljs-keyword">local</span> lruItemValue = redis.call(<span class="hljs-string">&#x27;hget&#x27;</span>, KEYS[<span class="hljs-number">1</span>], lruItem);                 redis.call(<span class="hljs-string">&#x27;hdel&#x27;</span>, KEYS[<span class="hljs-number">1</span>], lruItem);                 redis.call(<span class="hljs-string">&#x27;zrem&#x27;</span>, KEYS[<span class="hljs-number">2</span>], lruItem);                 redis.call(<span class="hljs-string">&#x27;zrem&#x27;</span>, KEYS[<span class="hljs-number">3</span>], lruItem);                 redis.call(<span class="hljs-string">&#x27;zrem&#x27;</span>, lastAccessTimeSetName, lruItem);                 <span class="hljs-keyword">if</span> lruItemValue ~= <span class="hljs-literal">false</span> <span class="hljs-keyword">then</span>                 <span class="hljs-keyword">local</span> removedChannelName = KEYS[<span class="hljs-number">6</span>]; <span class="hljs-keyword">local</span> ttl, obj = struct.<span class="hljs-built_in">unpack</span>(<span class="hljs-string">&#x27;dLc0&#x27;</span>, lruItemValue);                    <span class="hljs-keyword">local</span> msg = struct.pack(<span class="hljs-string">&#x27;Lc0Lc0&#x27;</span>, <span class="hljs-built_in">string</span>.<span class="hljs-built_in">len</span>(lruItem), lruItem, <span class="hljs-built_in">string</span>.<span class="hljs-built_in">len</span>(obj), obj);                redis.call(<span class="hljs-string">&#x27;publish&#x27;</span>, removedChannelName, msg); <span class="hljs-keyword">end</span>;             <span class="hljs-keyword">end</span>;         <span class="hljs-keyword">end</span>;     <span class="hljs-keyword">end</span>; <span class="hljs-keyword">if</span> mode == <span class="hljs-string">&#x27;LFU&#x27;</span> <span class="hljs-keyword">then</span> redis.call(<span class="hljs-string">&#x27;zincrby&#x27;</span>, lastAccessTimeSetName, <span class="hljs-number">1</span>, ARGV[<span class="hljs-number">5</span>]); <span class="hljs-keyword">end</span>; <span class="hljs-keyword">end</span>; <span class="hljs-keyword">local</span> val = struct.pack(<span class="hljs-string">&#x27;dLc0&#x27;</span>, <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">4</span>]), <span class="hljs-built_in">string</span>.<span class="hljs-built_in">len</span>(ARGV[<span class="hljs-number">6</span>]), ARGV[<span class="hljs-number">6</span>]); redis.call(<span class="hljs-string">&#x27;hset&#x27;</span>, KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">5</span>], val); <span class="hljs-keyword">local</span> msg = struct.pack(<span class="hljs-string">&#x27;Lc0Lc0&#x27;</span>, <span class="hljs-built_in">string</span>.<span class="hljs-built_in">len</span>(ARGV[<span class="hljs-number">5</span>]), ARGV[<span class="hljs-number">5</span>], <span class="hljs-built_in">string</span>.<span class="hljs-built_in">len</span>(ARGV[<span class="hljs-number">6</span>]), ARGV[<span class="hljs-number">6</span>]); redis.call(<span class="hljs-string">&#x27;publish&#x27;</span>, KEYS[<span class="hljs-number">4</span>], msg); <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>; <span class="hljs-keyword">else</span> <span class="hljs-keyword">local</span> t, val = struct.<span class="hljs-built_in">unpack</span>(<span class="hljs-string">&#x27;dLc0&#x27;</span>, value); redis.call(<span class="hljs-string">&#x27;zadd&#x27;</span>, KEYS[<span class="hljs-number">3</span>], t + ARGV[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">5</span>]); <span class="hljs-keyword">return</span> val; <span class="hljs-keyword">end</span>; <br></code></pre></td></tr></table></figure><p>è¿™æ®µLuaè„šæœ¬ç”¨äºRedisç¼“å­˜çš„ç®¡ç†å’Œæ’å…¥æ“ä½œï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p><ul><li>åˆ¤æ–­æ˜¯å¦éœ€è¦æ’å…¥æˆ–æ›´æ–°ç¼“å­˜ã€‚</li><li>å¤„ç†ç¼“å­˜çš„è¿‡æœŸé€»è¾‘ã€‚</li><li>å®ç°åŸºäºLRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰æˆ–LFUï¼ˆæœ€å°‘ä½¿ç”¨é¢‘ç‡ï¼‰ç­–ç•¥çš„ç¼“å­˜æ·˜æ±°ã€‚</li><li>åœ¨ç¼“å­˜é¡¹æ’å…¥æˆ–æ›´æ–°æ—¶å‘å¸ƒç›¸å…³æ¶ˆæ¯ã€‚</li></ul><p>å…·ä½“çš„è§£è¯»å¦‚ä¸‹ï¼š</p><ol><li><p><strong>åˆå§‹åŒ–å’Œè·å–å½“å‰å€¼</strong>ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">local</span> insertable = <span class="hljs-literal">false</span><br><span class="hljs-keyword">local</span> value = redis.call(<span class="hljs-string">&#x27;hget&#x27;</span>, KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">5</span>])<br></code></pre></td></tr></table></figure></li><li><p><strong>åˆ¤æ–­å½“å‰ç¼“å­˜é¡¹æ˜¯å¦å­˜åœ¨</strong>ï¼š</p><ul><li>å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è®¾ç½®<code>insertable</code>ä¸º<code>true</code>ï¼Œè¡¨ç¤ºå¯ä»¥æ’å…¥æ–°çš„ç¼“å­˜é¡¹ã€‚</li><li>å¦‚æœå­˜åœ¨ï¼Œç»§ç»­åˆ¤æ–­å…¶è¿‡æœŸæ—¶é—´ã€‚<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">if</span> value == <span class="hljs-literal">false</span> <span class="hljs-keyword">then</span> <br>    insertable = <span class="hljs-literal">true</span> <br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">local</span> t, val = struct.<span class="hljs-built_in">unpack</span>(<span class="hljs-string">&#x27;dLc0&#x27;</span>, value)<br>    <span class="hljs-keyword">local</span> expireDate = <span class="hljs-number">92233720368547758</span><br>    <span class="hljs-keyword">local</span> expireDateScore = redis.call(<span class="hljs-string">&#x27;zscore&#x27;</span>, KEYS[<span class="hljs-number">2</span>], ARGV[<span class="hljs-number">5</span>])<br>    <span class="hljs-keyword">if</span> expireDateScore ~= <span class="hljs-literal">false</span> <span class="hljs-keyword">then</span> expireDate = <span class="hljs-built_in">tonumber</span>(expireDateScore) <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">if</span> t ~= <span class="hljs-number">0</span> <span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">local</span> expireIdle = redis.call(<span class="hljs-string">&#x27;zscore&#x27;</span>, KEYS[<span class="hljs-number">3</span>], ARGV[<span class="hljs-number">5</span>])<br>        <span class="hljs-keyword">if</span> expireIdle ~= <span class="hljs-literal">false</span> <span class="hljs-keyword">then</span> expireDate = <span class="hljs-built_in">math</span>.<span class="hljs-built_in">min</span>(expireDate, <span class="hljs-built_in">tonumber</span>(expireIdle)) <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">if</span> expireDate &lt;= <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">1</span>]) <span class="hljs-keyword">then</span> insertable = <span class="hljs-literal">true</span> <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>å¤„ç†å¯æ’å…¥çš„æƒ…å†µ</strong>ï¼š</p><ul><li>æ›´æ–°æˆ–åˆ é™¤è¿‡æœŸæ—¶é—´ã€‚</li><li>æ£€æŸ¥ç¼“å­˜å¤§å°ï¼Œå¹¶æ ¹æ®LRUæˆ–LFUç­–ç•¥è¿›è¡Œæ·˜æ±°ã€‚<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">if</span> insertable == <span class="hljs-literal">true</span> <span class="hljs-keyword">then</span> <br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">2</span>]) &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <br>        redis.call(<span class="hljs-string">&#x27;zadd&#x27;</span>, KEYS[<span class="hljs-number">2</span>], ARGV[<span class="hljs-number">2</span>], ARGV[<span class="hljs-number">5</span>])<br>    <span class="hljs-keyword">else</span> <br>        redis.call(<span class="hljs-string">&#x27;zrem&#x27;</span>, KEYS[<span class="hljs-number">2</span>], ARGV[<span class="hljs-number">5</span>]) <br>    <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">3</span>]) &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">then</span> <br>        redis.call(<span class="hljs-string">&#x27;zadd&#x27;</span>, KEYS[<span class="hljs-number">3</span>], ARGV[<span class="hljs-number">3</span>], ARGV[<span class="hljs-number">5</span>])<br>    <span class="hljs-keyword">else</span> <br>        redis.call(<span class="hljs-string">&#x27;zrem&#x27;</span>, KEYS[<span class="hljs-number">3</span>], ARGV[<span class="hljs-number">5</span>]) <br>    <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">local</span> maxSize = <span class="hljs-built_in">tonumber</span>(redis.call(<span class="hljs-string">&#x27;hget&#x27;</span>, KEYS[<span class="hljs-number">7</span>], <span class="hljs-string">&#x27;max-size&#x27;</span>))<br>    <span class="hljs-keyword">if</span> maxSize ~= <span class="hljs-literal">nil</span> <span class="hljs-keyword">and</span> maxSize ~= <span class="hljs-number">0</span> <span class="hljs-keyword">then</span><br>        <span class="hljs-keyword">local</span> currentTime = <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">1</span>])<br>        <span class="hljs-keyword">local</span> lastAccessTimeSetName = KEYS[<span class="hljs-number">5</span>]<br>        <span class="hljs-keyword">local</span> mode = redis.call(<span class="hljs-string">&#x27;hget&#x27;</span>, KEYS[<span class="hljs-number">7</span>], <span class="hljs-string">&#x27;mode&#x27;</span>)<br>        <span class="hljs-keyword">if</span> mode == <span class="hljs-literal">false</span> <span class="hljs-keyword">or</span> mode == <span class="hljs-string">&#x27;LRU&#x27;</span> <span class="hljs-keyword">then</span> <br>            redis.call(<span class="hljs-string">&#x27;zadd&#x27;</span>, lastAccessTimeSetName, currentTime, ARGV[<span class="hljs-number">5</span>])<br>        <span class="hljs-keyword">end</span><br>        <span class="hljs-keyword">local</span> cacheSize = <span class="hljs-built_in">tonumber</span>(redis.call(<span class="hljs-string">&#x27;hlen&#x27;</span>, KEYS[<span class="hljs-number">1</span>]))<br>        <span class="hljs-keyword">if</span> cacheSize &gt;= maxSize <span class="hljs-keyword">then</span><br>            <span class="hljs-keyword">local</span> lruItems = redis.call(<span class="hljs-string">&#x27;zrange&#x27;</span>, lastAccessTimeSetName, <span class="hljs-number">0</span>, cacheSize - maxSize)<br>            <span class="hljs-keyword">for</span> index, lruItem <span class="hljs-keyword">in</span> <span class="hljs-built_in">ipairs</span>(lruItems) <span class="hljs-keyword">do</span><br>                <span class="hljs-keyword">if</span> lruItem <span class="hljs-keyword">and</span> lruItem ~= ARGV[<span class="hljs-number">5</span>] <span class="hljs-keyword">then</span><br>                    <span class="hljs-keyword">local</span> lruItemValue = redis.call(<span class="hljs-string">&#x27;hget&#x27;</span>, KEYS[<span class="hljs-number">1</span>], lruItem)<br>                    redis.call(<span class="hljs-string">&#x27;hdel&#x27;</span>, KEYS[<span class="hljs-number">1</span>], lruItem)<br>                    redis.call(<span class="hljs-string">&#x27;zrem&#x27;</span>, KEYS[<span class="hljs-number">2</span>], lruItem)<br>                    redis.call(<span class="hljs-string">&#x27;zrem&#x27;</span>, KEYS[<span class="hljs-number">3</span>], lruItem)<br>                    redis.call(<span class="hljs-string">&#x27;zrem&#x27;</span>, lastAccessTimeSetName, lruItem)<br>                    <span class="hljs-keyword">if</span> lruItemValue ~= <span class="hljs-literal">false</span> <span class="hljs-keyword">then</span><br>                        <span class="hljs-keyword">local</span> removedChannelName = KEYS[<span class="hljs-number">6</span>]<br>                        <span class="hljs-keyword">local</span> ttl, obj = struct.<span class="hljs-built_in">unpack</span>(<span class="hljs-string">&#x27;dLc0&#x27;</span>, lruItemValue)<br>                        <span class="hljs-keyword">local</span> msg = struct.pack(<span class="hljs-string">&#x27;Lc0Lc0&#x27;</span>, <span class="hljs-built_in">string</span>.<span class="hljs-built_in">len</span>(lruItem), lruItem, <span class="hljs-built_in">string</span>.<span class="hljs-built_in">len</span>(obj), obj)<br>                        redis.call(<span class="hljs-string">&#x27;publish&#x27;</span>, removedChannelName, msg)<br>                    <span class="hljs-keyword">end</span><br>                <span class="hljs-keyword">end</span><br>            <span class="hljs-keyword">end</span><br>        <span class="hljs-keyword">end</span><br>        <span class="hljs-keyword">if</span> mode == <span class="hljs-string">&#x27;LFU&#x27;</span> <span class="hljs-keyword">then</span> <br>            redis.call(<span class="hljs-string">&#x27;zincrby&#x27;</span>, lastAccessTimeSetName, <span class="hljs-number">1</span>, ARGV[<span class="hljs-number">5</span>]) <br>        <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">local</span> val = struct.pack(<span class="hljs-string">&#x27;dLc0&#x27;</span>, <span class="hljs-built_in">tonumber</span>(ARGV[<span class="hljs-number">4</span>]), <span class="hljs-built_in">string</span>.<span class="hljs-built_in">len</span>(ARGV[<span class="hljs-number">6</span>]), ARGV[<span class="hljs-number">6</span>])<br>    redis.call(<span class="hljs-string">&#x27;hset&#x27;</span>, KEYS[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">5</span>], val)<br>    <span class="hljs-keyword">local</span> msg = struct.pack(<span class="hljs-string">&#x27;Lc0Lc0&#x27;</span>, <span class="hljs-built_in">string</span>.<span class="hljs-built_in">len</span>(ARGV[<span class="hljs-number">5</span>]), ARGV[<span class="hljs-number">5</span>], <span class="hljs-built_in">string</span>.<span class="hljs-built_in">len</span>(ARGV[<span class="hljs-number">6</span>]), ARGV[<span class="hljs-number">6</span>])<br>    redis.call(<span class="hljs-string">&#x27;publish&#x27;</span>, KEYS[<span class="hljs-number">4</span>], msg)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>å¤„ç†ä¸å¯æ’å…¥çš„æƒ…å†µ</strong>ï¼š</p><ul><li>æ›´æ–°è¿‡æœŸæ—¶é—´ï¼Œå¹¶è¿”å›ç°æœ‰å€¼ã€‚<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-keyword">else</span> <br>    <span class="hljs-keyword">local</span> t, val = struct.<span class="hljs-built_in">unpack</span>(<span class="hljs-string">&#x27;dLc0&#x27;</span>, value)<br>    redis.call(<span class="hljs-string">&#x27;zadd&#x27;</span>, KEYS[<span class="hljs-number">3</span>], t + ARGV[<span class="hljs-number">1</span>], ARGV[<span class="hljs-number">5</span>])<br>    <span class="hljs-keyword">return</span> val<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure></li></ul></li></ol><h3 id="å‚æ•°å’Œé”®å€¼è§£é‡Š"><a href="#å‚æ•°å’Œé”®å€¼è§£é‡Š" class="headerlink" title="å‚æ•°å’Œé”®å€¼è§£é‡Š"></a>å‚æ•°å’Œé”®å€¼è§£é‡Š</h3><ul><li><p><code>KEYS[1]</code>: å“ˆå¸Œè¡¨å­˜å‚¨ç¼“å­˜é¡¹ã€‚</p></li><li><p><code>KEYS[2]</code>: æœ‰åºé›†åˆå­˜å‚¨è¿‡æœŸæ—¶é—´ã€‚</p></li><li><p><code>KEYS[3]</code>: æœ‰åºé›†åˆå­˜å‚¨ç©ºé—²æ—¶é—´ã€‚</p></li><li><p><code>KEYS[4]</code>: é¢‘é“åç§°ï¼Œç”¨äºå‘å¸ƒç¼“å­˜é¡¹å˜æ›´æ¶ˆæ¯ã€‚</p></li><li><p><code>KEYS[5]</code>: æœ‰åºé›†åˆå­˜å‚¨æœ€è¿‘è®¿é—®æ—¶é—´ï¼ˆLRUæ¨¡å¼ï¼‰ã€‚</p></li><li><p><code>KEYS[6]</code>: é¢‘é“åç§°ï¼Œç”¨äºå‘å¸ƒè¢«æ·˜æ±°çš„ç¼“å­˜é¡¹ã€‚</p></li><li><p><code>KEYS[7]</code>: å­˜å‚¨ç¼“å­˜é…ç½®ï¼ˆå¦‚æœ€å¤§å°ºå¯¸ã€æ¨¡å¼ç­‰ï¼‰ã€‚</p></li><li><p><code>ARGV[1]</code>: å½“å‰æ—¶é—´æˆ³ã€‚</p></li><li><p><code>ARGV[2]</code>: æ–°çš„è¿‡æœŸæ—¶é—´ã€‚</p></li><li><p><code>ARGV[3]</code>: æ–°çš„ç©ºé—²æ—¶é—´ã€‚</p></li><li><p><code>ARGV[4]</code>: æ–°ç¼“å­˜é¡¹çš„TTLã€‚</p></li><li><p><code>ARGV[5]</code>: ç¼“å­˜é¡¹çš„é”®åã€‚</p></li><li><p><code>ARGV[6]</code>: ç¼“å­˜é¡¹çš„å€¼ã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>luaè¡¨è¾¾å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨åˆ‡é¢æˆ–æ‹¦æˆªå™¨æ‰“å°å¼‚å¸¸æ—¥å¿—</title>
    <link href="/spring-boot/%E4%BD%BF%E7%94%A8%E5%88%87%E9%9D%A2%E6%88%96%E6%8B%A6%E6%88%AA%E5%99%A8%E6%89%93%E5%8D%B0%E5%BC%82%E5%B8%B8%E6%97%A5%E5%BF%97/"/>
    <url>/spring-boot/%E4%BD%BF%E7%94%A8%E5%88%87%E9%9D%A2%E6%88%96%E6%8B%A6%E6%88%AA%E5%99%A8%E6%89%93%E5%8D%B0%E5%BC%82%E5%B8%B8%E6%97%A5%E5%BF%97/</url>
    
    <content type="html"><![CDATA[<p>åœ¨Spring Bootä¸­ï¼Œä½¿ç”¨åˆ‡é¢ï¼ˆAspectï¼‰æˆ–æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰æ¥æ•è·å¼‚å¸¸å¹¶è®°å½•æ—¥å¿—æ˜¯ä¸€ç§å¸¸è§çš„åšæ³•ã€‚ä¸‹é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼æ¥å®ç°ã€‚</p><h3 id="1-ä½¿ç”¨åˆ‡é¢ï¼ˆAspectï¼‰è®°å½•å¼‚å¸¸æ—¥å¿—"><a href="#1-ä½¿ç”¨åˆ‡é¢ï¼ˆAspectï¼‰è®°å½•å¼‚å¸¸æ—¥å¿—" class="headerlink" title="1. ä½¿ç”¨åˆ‡é¢ï¼ˆAspectï¼‰è®°å½•å¼‚å¸¸æ—¥å¿—"></a>1. ä½¿ç”¨åˆ‡é¢ï¼ˆAspectï¼‰è®°å½•å¼‚å¸¸æ—¥å¿—</h3><p>Spring AOPï¼ˆAspect-Oriented Programmingï¼‰å…è®¸ä½ å®šä¹‰æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œæ¯”å¦‚æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ç­‰ã€‚å¯ä»¥é€šè¿‡ç¼–å†™ä¸€ä¸ªåˆ‡é¢æ¥æ•è·æ‰€æœ‰æ–¹æ³•ä¸­çš„å¼‚å¸¸å¹¶è®°å½•æ—¥å¿—ã€‚</p><h4 id="æ­¥éª¤ï¼š"><a href="#æ­¥éª¤ï¼š" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol><li><p><strong>æ·»åŠ ä¾èµ–</strong>ï¼š<br>ç¡®ä¿ä½ çš„é¡¹ç›®ä¸­åŒ…å«Spring AOPç›¸å…³ä¾èµ–ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Mavenï¼Œç¡®ä¿<code>spring-boot-starter-aop</code>å·²ç»åœ¨ä½ çš„<code>pom.xml</code>ä¸­ã€‚</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>åˆ›å»ºåˆ‡é¢ç±»</strong>ï¼š</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExceptionLoggingAspect</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ExceptionLoggingAspect.class);<br><br>    <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªåˆ‡å…¥ç‚¹ï¼Œæ‹¦æˆªæ‰€æœ‰æ–¹æ³•</span><br>    <span class="hljs-meta">@AfterThrowing(pointcut = &quot;execution(* com.yourpackage..*(..))&quot;, throwing = &quot;exception&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logException</span><span class="hljs-params">(Exception exception)</span> &#123;<br>        logger.error(<span class="hljs-string">&quot;Exception caught: &quot;</span>, exception);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>@AfterThrowing</code>æ³¨è§£ç”¨äºå®šä¹‰åœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œçš„é€šçŸ¥ã€‚<code>execution(* com.yourpackage..*(..))</code>è¡¨ç¤ºæ‹¦æˆª<code>com.yourpackage</code>åŒ…åŠå…¶å­åŒ…ä¸­æ‰€æœ‰ç±»çš„æ‰€æœ‰æ–¹æ³•ã€‚</p></li></ol><h3 id="2-ä½¿ç”¨æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰è®°å½•å¼‚å¸¸æ—¥å¿—"><a href="#2-ä½¿ç”¨æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰è®°å½•å¼‚å¸¸æ—¥å¿—" class="headerlink" title="2. ä½¿ç”¨æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰è®°å½•å¼‚å¸¸æ—¥å¿—"></a>2. ä½¿ç”¨æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰è®°å½•å¼‚å¸¸æ—¥å¿—</h3><p>Springä¸­çš„æ‹¦æˆªå™¨å…è®¸ä½ åœ¨HTTPè¯·æ±‚å¤„ç†çš„å„ä¸ªé˜¶æ®µæ‰§è¡Œä¸€äº›æ“ä½œï¼Œå¯ä»¥ç”¨æ¥è®°å½•å¼‚å¸¸æ—¥å¿—ã€‚</p><h4 id="æ­¥éª¤ï¼š-1"><a href="#æ­¥éª¤ï¼š-1" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol><li><p><strong>åˆ›å»ºæ‹¦æˆªå™¨ç±»</strong>ï¼š</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.ModelAndView;<br><br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;<br><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExceptionLoggingInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (ex != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// è®°å½•å¼‚å¸¸æ—¥å¿—</span><br>            <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(handler.getClass());<br>            logger.error(<span class="hljs-string">&quot;Exception caught during request processing: &quot;</span>, ex);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>æ³¨å†Œæ‹¦æˆªå™¨</strong>ï¼š</p><p>åœ¨Spring Bootåº”ç”¨ä¸­ï¼Œé€šè¿‡é…ç½®ç±»æ³¨å†Œæ‹¦æˆªå™¨ã€‚</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> ExceptionLoggingInterceptor exceptionLoggingInterceptor;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>        registry.addInterceptor(exceptionLoggingInterceptor);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™ä¸¤ç§æ–¹å¼å„æœ‰ä¼˜åŠ£ï¼š</p><ul><li><strong>åˆ‡é¢ï¼ˆAspectï¼‰</strong>é€‚ç”¨äºéœ€è¦åœ¨æ–¹æ³•çº§åˆ«æ•è·å¼‚å¸¸çš„æƒ…å†µï¼Œå¯ä»¥è½»æ¾åº”ç”¨äºæ‰€æœ‰æ–¹æ³•ã€‚</li><li><strong>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</strong>é€‚ç”¨äºéœ€è¦åœ¨è¯·æ±‚çº§åˆ«æ•è·å¼‚å¸¸çš„æƒ…å†µï¼Œæ›´é€‚åˆWebåº”ç”¨ç¨‹åºä¸­çš„HTTPè¯·æ±‚å¤„ç†ã€‚</li></ul><p>é€‰æ‹©å“ªç§æ–¹å¼å–å†³äºä½ çš„å…·ä½“éœ€æ±‚ã€‚å¦‚æœä½ å¸Œæœ›å¯¹æ‰€æœ‰æ–¹æ³•çš„å¼‚å¸¸è¿›è¡Œç»Ÿä¸€å¤„ç†ï¼Œåˆ‡é¢å¯èƒ½æ›´åˆé€‚ï¼›å¦‚æœä½ éœ€è¦å¯¹HTTPè¯·æ±‚å¤„ç†çš„å¼‚å¸¸è¿›è¡Œç»Ÿä¸€å¤„ç†ï¼Œæ‹¦æˆªå™¨åˆ™æ›´ä¸ºåˆé€‚ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>spring-boot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ‰“å°å¼‚å¸¸æ—¥å¿—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨linuxä¸Šä½¿ç”¨ä»£ç†</title>
    <link href="/linux/%E5%9C%A8linux%E4%B8%8A%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86/"/>
    <url>/linux/%E5%9C%A8linux%E4%B8%8A%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<p>è¦åœ¨ Linux å‘½ä»¤è¡Œä¸‹ä½¿ç”¨ Clash Vergeï¼Œéœ€è¦æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š</p><h3 id="1-å®‰è£…-Clash-Verge"><a href="#1-å®‰è£…-Clash-Verge" class="headerlink" title="1. å®‰è£… Clash Verge"></a>1. å®‰è£… Clash Verge</h3><p>é¦–å…ˆï¼Œç¡®ä¿ä½ çš„ç³»ç»Ÿå·²ç»å®‰è£…äº† Clash Coreã€‚Clash Verge æ˜¯ä¸€ä¸ªå›¾å½¢ç•Œé¢ç®¡ç†å·¥å…·ï¼Œè€Œ Clash æœ¬èº«æ˜¯éœ€è¦è¿è¡Œåœ¨åå°çš„ä»£ç†å·¥å…·ã€‚</p><h4 id="ä¸‹è½½-Clash"><a href="#ä¸‹è½½-Clash" class="headerlink" title="ä¸‹è½½ Clash"></a>ä¸‹è½½ Clash</h4><p><a href="../../resource/mihomo-linux-amd64-v1.18.6.deb">mihomo-linux-amd64-v1.18.6.deb</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">dpkg -i mihomo-linux-amd64-v1.18.6.deb     <br><span class="hljs-built_in">chmod</span> 777 mihomo-linux-amd64-v1.18.6.deb <br>sudo <span class="hljs-built_in">mv</span> mihomo-linux-amd64-v1.18.6 clash<br></code></pre></td></tr></table></figure><h3 id="2-é…ç½®-Clash"><a href="#2-é…ç½®-Clash" class="headerlink" title="2. é…ç½® Clash"></a>2. é…ç½® Clash</h3><p>åœ¨ä½¿ç”¨ Clash Verge ä¹‹å‰ï¼Œéœ€è¦å…ˆé…ç½® Clash çš„ <code>config.yaml</code> æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">æ‹·è´windowsä¸Šçš„é…ç½®ï¼šD:\soft\clash-verge-1.6.2\.config\io.github.clash-verge-rev.clash-verge-rev/clash-verge.yaml<br>wget -O /root/.config/mihomo/config.yaml ä½ é…ç½®å¥½çš„clash-verge.yaml<br></code></pre></td></tr></table></figure><h3 id="3-å¯åŠ¨-Clash"><a href="#3-å¯åŠ¨-Clash" class="headerlink" title="3. å¯åŠ¨ Clash"></a>3. å¯åŠ¨ Clash</h3><p>åœ¨å‘½ä»¤è¡Œä¸­å¯åŠ¨ Clashï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">nohup</span> ./clash &amp;<br></code></pre></td></tr></table></figure><p>Clash Verge å¯åŠ¨åï¼Œå°†æ‰“å¼€ä¸€ä¸ªæœ¬åœ°çš„å›¾å½¢ç•Œé¢ï¼Œä½ å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®è¯¥ç•Œé¢ï¼Œé€šå¸¸æ˜¯ <code>http://localhost:7899</code> æˆ–è€…å…¶ä»–é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„ç«¯å£ã€‚</p><ol><li><strong>åˆ›å»ºä»£ç†é…ç½®æ–‡ä»¶</strong>ï¼šåœ¨Kaliç³»ç»Ÿçš„Dockeré…ç½®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code>/etc/systemd/system/docker.service.d/http-proxy.conf</code>çš„æ–‡ä»¶ã€‚å¦‚æœè¯¥ç›®å½•ä¸å­˜åœ¨ï¼Œè¯·å…ˆåˆ›å»ºå®ƒã€‚</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo <span class="hljs-built_in">mkdir</span> -p /etc/systemd/system/docker.service.d<br>sudo nano /etc/systemd/system/docker.service.d/http-proxy.conf<br></code></pre></td></tr></table></figure><ol start="2"><li><strong>é…ç½®ä»£ç†</strong>ï¼šåœ¨<code>http-proxy.conf</code>æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œå°†<code>http://127.0.0.1:7899</code>æ›¿æ¢ä¸ºä½ çš„ä»£ç†æœåŠ¡å™¨åœ°å€å’Œç«¯å£ã€‚</li></ol><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Service]</span><br><span class="hljs-attr">Environment</span>=<span class="hljs-string">&quot;HTTP_PROXY=http://127.0.0.1:7899&quot;</span><br><span class="hljs-attr">Environment</span>=<span class="hljs-string">&quot;HTTPS_PROXY=http://127.0.0.1:7899&quot;</span><br><span class="hljs-attr">Environment</span>=<span class="hljs-string">&quot;NO_PROXY=localhost,127.0.0.1&quot;</span><br></code></pre></td></tr></table></figure><ol start="3"><li><strong>é‡æ–°åŠ è½½å®ˆæŠ¤è¿›ç¨‹å¹¶é‡å¯DockeræœåŠ¡</strong>ï¼š</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo systemctl daemon-reload<br>sudo systemctl restart docker<br></code></pre></td></tr></table></figure><ol start="4"><li><strong>éªŒè¯ä»£ç†é…ç½®</strong>ï¼šä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯Dockeræ˜¯å¦é€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œè¿æ¥ï¼š</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">docker info<br></code></pre></td></tr></table></figure><p>åœ¨è¾“å‡ºä¿¡æ¯ä¸­æ‰¾åˆ°<code>HTTP Proxy</code>å’Œ<code>HTTPS Proxy</code>æ¡ç›®ï¼Œæ£€æŸ¥å®ƒä»¬æ˜¯å¦æ˜¾ç¤ºäº†ä½ é…ç½®çš„ä»£ç†æœåŠ¡å™¨åœ°å€ã€‚</p><p>å¦‚æœä½ éœ€è¦ä¸ºDockerå®¢æˆ·ç«¯é…ç½®ä»£ç†ï¼ˆå¦‚<code>docker build</code>å‘½ä»¤ï¼‰ï¼Œå¯ä»¥åœ¨ä½ çš„shellé…ç½®æ–‡ä»¶ï¼ˆå¦‚<code>~/.bashrc</code>æˆ–<code>~/.zshrc</code>ï¼‰ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">export</span> HTTP_PROXY=<span class="hljs-string">&quot;http://your-proxy.example.com:8080&quot;</span><br><span class="hljs-built_in">export</span> HTTPS_PROXY=<span class="hljs-string">&quot;http://your-proxy.example.com:8080&quot;</span><br><span class="hljs-built_in">export</span> NO_PROXY=<span class="hljs-string">&quot;localhost,127.0.0.1&quot;</span><br></code></pre></td></tr></table></figure><p>ä¿å­˜æ–‡ä»¶å¹¶åŠ è½½æ–°çš„é…ç½®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">source</span> ~/.bashrc  <span class="hljs-comment"># æˆ–è€… source ~/.zshrc</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼ŒDockerå®¢æˆ·ç«¯åœ¨è¿è¡Œæ—¶ä¹Ÿä¼šé€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œè¿æ¥ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>clash</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¿»å¢™</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>select for updateç”¨æ³•çš„å¥½å¤„</title>
    <link href="/mysql/select-for-update%E7%94%A8%E6%B3%95%E7%9A%84%E5%A5%BD%E5%A4%84/"/>
    <url>/mysql/select-for-update%E7%94%A8%E6%B3%95%E7%9A%84%E5%A5%BD%E5%A4%84/</url>
    
    <content type="html"><![CDATA[<p><code>SELECT FOR UPDATE</code> æ˜¯ä¸€ç§ç”¨äºæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰çš„ SQL è¯­å¥ï¼Œä¸»è¦ç”¨äºåœ¨äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­é”å®šé€‰å®šçš„è¡Œï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡ä¿®æ”¹è¿™äº›è¡Œï¼Œç›´åˆ°å½“å‰äº‹åŠ¡å®Œæˆã€‚è¿™ç§æœºåˆ¶åœ¨å¤„ç†å¹¶å‘è®¿é—®æ—¶å°¤å…¶æœ‰ç”¨ï¼Œä»¥ä¸‹æ˜¯å…¶å…·ä½“å¥½å¤„ï¼š</p><h3 id="1-é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»"><a href="#1-é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»" class="headerlink" title="1. é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»"></a>1. <strong>é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»è¯»</strong></h3><p>é€šè¿‡ä½¿ç”¨ <code>SELECT FOR UPDATE</code>ï¼Œå¯ä»¥é”å®šé€‰å®šçš„è¡Œï¼Œç¡®ä¿å…¶ä»–äº‹åŠ¡æ— æ³•å¯¹è¿™äº›è¡Œè¿›è¡Œä¿®æ”¹ï¼Œä»è€Œé˜²æ­¢ä»¥ä¸‹ç±»å‹çš„å¹¶å‘é—®é¢˜ï¼š</p><ul><li><strong>è„è¯»</strong>ï¼šä¸€ä¸ªäº‹åŠ¡å¯ä»¥è¯»å–åˆ°å¦ä¸€ä¸ªæœªæäº¤äº‹åŠ¡çš„ä¿®æ”¹ã€‚</li><li><strong>ä¸å¯é‡å¤è¯»</strong>ï¼šä¸€ä¸ªäº‹åŠ¡åœ¨ä¸¤æ¬¡è¯»å–ä¹‹é—´ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹äº†æ•°æ®ï¼Œå¯¼è‡´ä¸¤æ¬¡è¯»å–ç»“æœä¸åŒã€‚</li><li><strong>å¹»è¯»</strong>ï¼šä¸€ä¸ªäº‹åŠ¡åœ¨ä¸¤æ¬¡è¯»å–ä¹‹é—´ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡æ’å…¥äº†æ–°è¡Œï¼Œå¯¼è‡´ç¬¬äºŒæ¬¡è¯»å–è¿”å›æ›´å¤šè¡Œã€‚</li></ul><h3 id="2-ç¡®ä¿ä¸€è‡´æ€§å’Œå®Œæ•´æ€§"><a href="#2-ç¡®ä¿ä¸€è‡´æ€§å’Œå®Œæ•´æ€§" class="headerlink" title="2. ç¡®ä¿ä¸€è‡´æ€§å’Œå®Œæ•´æ€§"></a>2. <strong>ç¡®ä¿ä¸€è‡´æ€§å’Œå®Œæ•´æ€§</strong></h3><p>åœ¨æ‰§è¡Œå¤æ‚çš„ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œä¾‹å¦‚è´¦æˆ·è½¬è´¦ã€åº“å­˜æ›´æ–°ç­‰ï¼Œä½¿ç”¨ <code>SELECT FOR UPDATE</code> å¯ä»¥ç¡®ä¿åœ¨æ•´ä¸ªäº‹åŠ¡è¿‡ç¨‹ä¸­æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨äº‹åŠ¡ä¸­é—´å…¶ä»–äº‹åŠ¡å¯¹æ•°æ®çš„ä¿®æ”¹ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</p><h3 id="3-é˜²æ­¢ä¸¢å¤±æ›´æ–°"><a href="#3-é˜²æ­¢ä¸¢å¤±æ›´æ–°" class="headerlink" title="3. é˜²æ­¢ä¸¢å¤±æ›´æ–°"></a>3. <strong>é˜²æ­¢ä¸¢å¤±æ›´æ–°</strong></h3><p>å½“å¤šä¸ªäº‹åŠ¡è¯•å›¾åŒæ—¶æ›´æ–°åŒä¸€è¡Œæ—¶ï¼Œ<code>SELECT FOR UPDATE</code> å¯ä»¥é˜²æ­¢ä¸¢å¤±æ›´æ–°é—®é¢˜ã€‚å®ƒç¡®ä¿ä¸€ä¸ªäº‹åŠ¡å®Œæˆåï¼Œå…¶ä»–äº‹åŠ¡æ‰èƒ½ç»§ç»­æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œé¿å…äº†ä¸¤ä¸ªäº‹åŠ¡çš„æ›´æ–°äº’ç›¸è¦†ç›–ã€‚</p><h3 id="4-ä¼˜åŒ–å¹¶å‘æ§åˆ¶"><a href="#4-ä¼˜åŒ–å¹¶å‘æ§åˆ¶" class="headerlink" title="4. ä¼˜åŒ–å¹¶å‘æ§åˆ¶"></a>4. <strong>ä¼˜åŒ–å¹¶å‘æ§åˆ¶</strong></h3><p>ä½¿ç”¨ <code>SELECT FOR UPDATE</code> å¯ä»¥æä¾›ç»†ç²’åº¦çš„å¹¶å‘æ§åˆ¶ï¼Œé€šè¿‡åªé”å®šå¿…è¦çš„è¡Œï¼Œè€Œä¸æ˜¯æ•´ä¸ªè¡¨ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½å’Œèµ„æºåˆ©ç”¨ç‡ã€‚</p><h3 id="5-ç®€åŒ–ç¼–ç¨‹æ¨¡å‹"><a href="#5-ç®€åŒ–ç¼–ç¨‹æ¨¡å‹" class="headerlink" title="5. ç®€åŒ–ç¼–ç¨‹æ¨¡å‹"></a>5. <strong>ç®€åŒ–ç¼–ç¨‹æ¨¡å‹</strong></h3><p><code>SELECT FOR UPDATE</code> å¯ä»¥ç®€åŒ–å¼€å‘äººå‘˜çš„ç¼–ç¨‹æ¨¡å‹ï¼Œä¸éœ€è¦æ‰‹åŠ¨å¤„ç†å¤æ‚çš„é”æœºåˆ¶ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨å¤„ç†è¡Œé”å®šå’Œé‡Šæ”¾ï¼Œä»è€Œå‡å°‘ç¼–ç¨‹é”™è¯¯çš„æœºä¼šã€‚</p><h3 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span>;<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> accounts <span class="hljs-keyword">WHERE</span> account_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;<br><span class="hljs-comment">-- æ‰§è¡Œä¸€äº›éœ€è¦é”å®šè¿™è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚æ›´æ–°è´¦æˆ·ä½™é¢</span><br><span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">100</span> <span class="hljs-keyword">WHERE</span> account_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">COMMIT</span>;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œé€šè¿‡ <code>SELECT FOR UPDATE</code> é”å®š <code>account_id = 1</code> çš„è¡Œï¼Œç¡®ä¿åœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œæ²¡æœ‰å…¶ä»–äº‹åŠ¡å¯ä»¥ä¿®æ”¹è¯¥è¡Œã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œ<code>SELECT FOR UPDATE</code> æä¾›äº†ä¸€ç§å¼ºå¤§çš„å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œå¸®åŠ©ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ã€ä¸€è‡´æ€§ï¼Œå¹¶é˜²æ­¢å¹¶å‘ä¿®æ”¹å¯¼è‡´çš„é—®é¢˜ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>mysql</category>
      
    </categories>
    
    
    <tags>
      
      <tag>äº‹åŠ¡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>tcp6 å¦‚ä½• æ”¹æˆtcp4</title>
    <link href="/linux/tcp6-%E5%A6%82%E4%BD%95-%E6%94%B9%E6%88%90tcp4/"/>
    <url>/linux/tcp6-%E5%A6%82%E4%BD%95-%E6%94%B9%E6%88%90tcp4/</url>
    
    <content type="html"><![CDATA[<p>è¦å°† TCP6ï¼ˆIPv6ï¼‰è½¬æ¢ä¸º TCP4ï¼ˆIPv4ï¼‰ï¼Œå…·ä½“æ­¥éª¤å–å†³äºä½ æƒ³è¦è½¬æ¢çš„ä¸Šä¸‹æ–‡ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³è¦åœ¨æœåŠ¡å™¨é…ç½®ã€ç½‘ç»œæœåŠ¡é…ç½®æˆ–è€…åº”ç”¨ç¨‹åºä¸­è¿›è¡Œè¿™ç§è½¬æ¢ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„æ–¹æ³•ï¼š</p><h3 id="1-ä¿®æ”¹ç³»ç»Ÿé…ç½®"><a href="#1-ä¿®æ”¹ç³»ç»Ÿé…ç½®" class="headerlink" title="1. ä¿®æ”¹ç³»ç»Ÿé…ç½®"></a>1. ä¿®æ”¹ç³»ç»Ÿé…ç½®</h3><p>å¦‚æœä½ çš„ç³»ç»Ÿé»˜è®¤ä½¿ç”¨ IPv6ï¼Œä½ å¯ä»¥é€šè¿‡ä¿®æ”¹ç³»ç»Ÿé…ç½®æ¥ä¼˜å…ˆä½¿ç”¨ IPv4ã€‚</p><h4 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h4><p>ç¼–è¾‘ <code>/etc/gai.conf</code> æ–‡ä»¶ï¼Œå–æ¶ˆ <code>precedence ::ffff:0:0/96  100</code> çš„æ³¨é‡Šã€‚è¿™ä¼šè®©ç³»ç»Ÿä¼˜å…ˆä½¿ç”¨ IPv4ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nano /etc/gai.conf<br></code></pre></td></tr></table></figure><p>å–æ¶ˆä¸‹é¢è¿™è¡Œçš„æ³¨é‡Šï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">precedence ::ffff:0:0/96  100<br></code></pre></td></tr></table></figure><h4 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h4><p>å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œç¦ç”¨IPv6ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">netsh interface ipv6 <span class="hljs-built_in">set</span> prefixpolicy ::ffff:0:0/96  40 1<br></code></pre></td></tr></table></figure><h3 id="2-é…ç½®ç½‘ç»œæœåŠ¡"><a href="#2-é…ç½®ç½‘ç»œæœåŠ¡" class="headerlink" title="2. é…ç½®ç½‘ç»œæœåŠ¡"></a>2. é…ç½®ç½‘ç»œæœåŠ¡</h3><p>å¯¹äºå…·ä½“çš„ç½‘ç»œæœåŠ¡ï¼Œä½ å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šä½¿ç”¨ IPv4ã€‚</p><h4 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h4><p>åœ¨ Nginx é…ç½®æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥æŒ‡å®šæœåŠ¡å™¨ç›‘å¬çš„ IP åœ°å€ä¸º IPv4 åœ°å€ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">80</span> ipv6only=<span class="hljs-literal">off</span>;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>å°†ä¸Šé¢çš„é…ç½®æ”¹ä¸ºä»…ç›‘å¬ IPv4 åœ°å€ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h4><p>åœ¨ Apache çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥æŒ‡å®šç›‘å¬çš„ IP åœ°å€ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Listen</span> <span class="hljs-number">80</span><br><span class="hljs-attribute">Listen</span><span class="hljs-meta"> [::]:80</span><br></code></pre></td></tr></table></figure><p>å°†ä¸Šé¢çš„é…ç½®æ”¹ä¸ºä»…ç›‘å¬ IPv4 åœ°å€ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Listen</span> <span class="hljs-number">80</span><br></code></pre></td></tr></table></figure><h3 id="3-ä¿®æ”¹åº”ç”¨ç¨‹åºé…ç½®"><a href="#3-ä¿®æ”¹åº”ç”¨ç¨‹åºé…ç½®" class="headerlink" title="3. ä¿®æ”¹åº”ç”¨ç¨‹åºé…ç½®"></a>3. ä¿®æ”¹åº”ç”¨ç¨‹åºé…ç½®</h3><p>å¯¹äºæŸäº›åº”ç”¨ç¨‹åºï¼Œä½ å¯èƒ½éœ€è¦ä¿®æ”¹ä»£ç æˆ–é…ç½®æ–‡ä»¶ä»¥ç¡®ä¿å®ƒä»¬ä»…ä½¿ç”¨ IPv4ã€‚</p><h4 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h4><p>åœ¨ Python åº”ç”¨ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ <code>socket</code> æ¨¡å—æŒ‡å®šä»…ä½¿ç”¨ IPv4ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket<br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªIPv4çš„TCP socket</span><br>sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>sock.bind((<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, <span class="hljs-number">8080</span>))<br>sock.listen(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><p>åœ¨ Java åº”ç”¨ä¸­ï¼Œä½ å¯ä»¥è®¾ç½® <code>java.net.preferIPv4Stack</code> ç³»ç»Ÿå±æ€§ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        System.setProperty(<span class="hljs-string">&quot;java.net.preferIPv4Stack&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>);<br>        <span class="hljs-comment">// å…¶ä»–ä»£ç </span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å…·ä½“çš„æ–¹æ³•å–å†³äºä½ çš„å…·ä½“éœ€æ±‚å’Œç¯å¢ƒã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé…ç½®æ–‡ä»¶å’Œç³»ç»Ÿè®¾ç½®é€šå¸¸å¯ä»¥è§£å†³å¤§å¤šæ•°é—®é¢˜ã€‚å¦‚æœä½ æœ‰æ›´å…·ä½“çš„åº”ç”¨æˆ–ç¯å¢ƒï¼Œè¯·æä¾›æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œæˆ‘å¯ä»¥æä¾›æ›´å…·ä½“çš„æŒ‡å¯¼ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nginxé…ç½®ä¸Šä¼ æ–‡ä»¶å¤§å°</title>
    <link href="/linux/nginx%E9%85%8D%E7%BD%AE%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%A4%A7%E5%B0%8F/"/>
    <url>/linux/nginx%E9%85%8D%E7%BD%AE%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%A4%A7%E5%B0%8F/</url>
    
    <content type="html"><![CDATA[<p>è¦åœ¨Nginxä¸­é…ç½®ä¸Šä¼ æ–‡ä»¶ï¼Œæ‚¨éœ€è¦å¯¹Nginxçš„é…ç½®æ–‡ä»¶è¿›è¡Œä¸€äº›ä¿®æ”¹ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹é…ç½®ï¼Œè¯´æ˜å¦‚ä½•é…ç½®Nginxä»¥æ”¯æŒæ–‡ä»¶ä¸Šä¼ ï¼š</p><ol><li><p><strong>é…ç½®Nginxå¤„ç†ä¸Šä¼ æ–‡ä»¶çš„å¤§å°é™åˆ¶ï¼š</strong></p><p>æ‰“å¼€æ‚¨çš„Nginxé…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸ä½äº <code>/etc/nginx/nginx.conf</code> æˆ– <code>/etc/nginx/conf.d/default.conf</code>ï¼‰å¹¶æ‰¾åˆ° <code>http</code> å—æˆ– <code>server</code> å—ã€‚</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">http</span> &#123;<br>    <span class="hljs-comment"># å…¶ä»–é…ç½®...</span><br>    <br>    <span class="hljs-comment"># è®¾ç½®å®¢æˆ·ç«¯ä¸Šä¼ æ–‡ä»¶çš„æœ€å¤§é™åˆ¶ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰</span><br>    <span class="hljs-attribute">client_max_body_size</span> <span class="hljs-number">50M</span>;<br><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">server_name</span> example.com;<br><br>        <span class="hljs-comment"># å…¶ä»–é…ç½®...</span><br><br>        <span class="hljs-section">location</span> /upload &#123;<br>            <span class="hljs-comment"># å°†æ–‡ä»¶ä¸Šä¼ åˆ°æŒ‡å®šçš„ç›®å½•</span><br>            <span class="hljs-attribute">root</span> /var/www/uploads;<br><br>            <span class="hljs-comment"># å…¶ä»–é…ç½®...</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>client_max_body_size</code> è¢«è®¾ç½®ä¸º <code>50M</code>ï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯å¯ä»¥ä¸Šä¼ æœ€å¤§ä¸º50MBçš„æ–‡ä»¶ã€‚</p></li><li><p><strong>é…ç½®ä¸Šä¼ æ–‡ä»¶çš„ä¿å­˜è·¯å¾„ï¼š</strong></p><p>æ‚¨å¯ä»¥åœ¨ <code>location</code> å—ä¸­æŒ‡å®šæ–‡ä»¶ä¸Šä¼ çš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œä¸Šä¼ çš„æ–‡ä»¶å°†è¢«ä¿å­˜åˆ° <code>/var/www/uploads</code> ç›®å½•ã€‚</p></li><li><p><strong>é‡å¯Nginxä»¥ä½¿é…ç½®ç”Ÿæ•ˆï¼š</strong></p><p>ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åï¼Œéœ€è¦é‡å¯NginxæœåŠ¡ä»¥ä½¿é…ç½®ç”Ÿæ•ˆã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo systemctl restart nginx<br></code></pre></td></tr></table></figure></li><li><p><strong>å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶ï¼š</strong></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒNginxæœ¬èº«ä¸ä¼šå¤„ç†ä¸Šä¼ çš„æ–‡ä»¶ï¼Œæ‚¨éœ€è¦åœ¨åç«¯åº”ç”¨ä¸­å¤„ç†è¿™äº›æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨PHPã€Pythonã€Node.jsç­‰è¯­è¨€åœ¨åç«¯å¤„ç†æ–‡ä»¶ä¸Šä¼ ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨PHPå¤„ç†æ–‡ä»¶ä¸Šä¼ çš„ç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="hljs-string">&#x27;POST&#x27;</span> &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$uploadDir</span> = <span class="hljs-string">&#x27;/var/www/uploads/&#x27;</span>;<br>    <span class="hljs-variable">$uploadFile</span> = <span class="hljs-variable">$uploadDir</span> . <span class="hljs-title function_ invoke__">basename</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-variable">$uploadFile</span>)) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸã€‚&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ã€‚&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨Nginxçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œæ‚¨å¯ä»¥é…ç½®ä¸€ä¸ª <code>location</code> å—æ¥å¤„ç†æ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> /upload &#123;<br>    <span class="hljs-attribute">root</span> /var/www/uploads;<br><br>    <span class="hljs-comment"># ä»£ç†åˆ°åç«¯PHPè„šæœ¬</span><br>    <span class="hljs-attribute">fastcgi_pass</span> <span class="hljs-number">127.0.0.1:9000</span>;<br>    <span class="hljs-attribute">include</span> fastcgi_params;<br>    <span class="hljs-attribute">fastcgi_param</span> SCRIPT_FILENAME /var/www/html/upload.php;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>nginx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>dockerä¿®æ”¹åº”ç”¨ä¸ºè‡ªåŠ¨å¯åŠ¨</title>
    <link href="/linux/docker%E4%BF%AE%E6%94%B9%E5%BA%94%E7%94%A8%E4%B8%BA%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8/"/>
    <url>/linux/docker%E4%BF%AE%E6%94%B9%E5%BA%94%E7%94%A8%E4%B8%BA%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8/</url>
    
    <content type="html"><![CDATA[<p>æ˜¯çš„ï¼ŒDocker æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥é…ç½®å®¹å™¨åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ï¼Œè¿™å°±æ˜¯ä½¿ç”¨ <code>docker update</code> å‘½ä»¤é…ç½®å®¹å™¨çš„é‡å¯ç­–ç•¥ã€‚</p><p>ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ <code>docker update</code> å‘½ä»¤æ¥é…ç½®ç°æœ‰çš„å®¹å™¨åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker update --restart unless-stopped &lt;container_name_or_id&gt;<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„å®¹å™¨åä¸º <code>mysql-container</code>ï¼Œä½ å¯ä»¥è¿™æ ·é…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker update --restart unless-stopped mysql-container<br></code></pre></td></tr></table></figure><p>è¿™æ ·é…ç½®åï¼Œå½“ç³»ç»Ÿé‡å¯æ—¶ï¼ŒDocker ä¼šæ ¹æ® <code>unless-stopped</code> ç­–ç•¥è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„é‡å¯ç­–ç•¥ï¼š</p><ul><li><code>no</code>: å®¹å™¨ä¸ä¼šè‡ªåŠ¨é‡å¯ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚</li><li><code>on-failure</code>: ä»…å½“å®¹å™¨é€€å‡ºçŠ¶æ€éé›¶æ—¶æ‰é‡å¯ã€‚</li><li><code>always</code>: æ— è®ºé€€å‡ºçŠ¶æ€å¦‚ä½•ï¼Œæ€»æ˜¯é‡å¯å®¹å™¨ã€‚</li><li><code>unless-stopped</code>: å®¹å™¨é™¤éè¢«æ‰‹åŠ¨åœæ­¢ï¼Œå¦åˆ™æ€»æ˜¯é‡å¯ã€‚</li></ul><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•å¯åŠ¨ä¸€ä¸ªæ–°çš„ MySQL å®¹å™¨å¹¶é…ç½®å…¶åœ¨ç³»ç»Ÿé‡å¯æ—¶è‡ªåŠ¨å¯åŠ¨ï¼š</p><ol><li><p>å¯åŠ¨ä¸€ä¸ª MySQL å®¹å™¨ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>    --name mysql-container \<br>    -e MYSQL_ROOT_PASSWORD=my-secret-pw \<br>    -v /my/own/datadir:/var/lib/mysql \<br>    mysql:latest<br></code></pre></td></tr></table></figure></li><li><p>é…ç½®å®¹å™¨çš„é‡å¯ç­–ç•¥ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker update --restart unless-stopped mysql-container<br></code></pre></td></tr></table></figure></li></ol><h3 id="æ£€æŸ¥å®¹å™¨é‡å¯ç­–ç•¥"><a href="#æ£€æŸ¥å®¹å™¨é‡å¯ç­–ç•¥" class="headerlink" title="æ£€æŸ¥å®¹å™¨é‡å¯ç­–ç•¥"></a>æ£€æŸ¥å®¹å™¨é‡å¯ç­–ç•¥</h3><p>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥å®¹å™¨çš„é‡å¯ç­–ç•¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker inspect -f <span class="hljs-string">&#x27;&#123;&#123; .HostConfig.RestartPolicy.Name &#125;&#125;&#x27;</span> mysql-container<br></code></pre></td></tr></table></figure><p>è¿™å°†è¾“å‡ºå®¹å™¨çš„å½“å‰é‡å¯ç­–ç•¥ã€‚</p><h3 id="ä½¿ç”¨-Docker-Compose"><a href="#ä½¿ç”¨-Docker-Compose" class="headerlink" title="ä½¿ç”¨ Docker Compose"></a>ä½¿ç”¨ Docker Compose</h3><p>å¦‚æœä½ ä½¿ç”¨ Docker Composeï¼Œå¯ä»¥åœ¨ <code>docker-compose.yml</code> æ–‡ä»¶ä¸­é…ç½®é‡å¯ç­–ç•¥ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.8&#x27;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">mysql:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:latest</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mysql-container</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">my-secret-pw</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/my/own/datadir:/var/lib/mysql</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨å®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose up -d<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œä½ å¯ä»¥è½»æ¾åœ°é…ç½® Docker å®¹å™¨åœ¨ç³»ç»Ÿé‡å¯æ—¶è‡ªåŠ¨å¯åŠ¨ï¼Œæ— è®ºæ˜¯é€šè¿‡ <code>docker run</code>ã€<code>docker update</code> è¿˜æ˜¯ <code>docker-compose</code>ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linuxä¸‹å®ç°é’‰é’‰å‘Šè­¦</title>
    <link href="/linux/linux%E4%B8%8B%E5%AE%9E%E7%8E%B0%E9%92%89%E9%92%89%E5%91%8A%E8%AD%A6/"/>
    <url>/linux/linux%E4%B8%8B%E5%AE%9E%E7%8E%B0%E9%92%89%E9%92%89%E5%91%8A%E8%AD%A6/</url>
    
    <content type="html"><![CDATA[<p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨Shellè„šæœ¬å’Œå®šæ—¶ä»»åŠ¡ï¼ˆcronï¼‰æ¥ç›‘æ§CPUã€å†…å­˜å’Œç¡¬ç›˜ä½¿ç”¨æƒ…å†µï¼Œå½“è¶…è¿‡æŒ‡å®šé˜ˆå€¼æ—¶å‘é€å‘Šè­¦ã€‚ä¸ºäº†å‘é€é’‰é’‰å‘Šè­¦ï¼Œéœ€è¦ç”¨åˆ°é’‰é’‰çš„è‡ªå®šä¹‰æœºå™¨äººæ¥å£ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬æ•™ç¨‹çš„æœºå™¨æ˜¯12æ ¸å¿ƒã€‚å› æ­¤éœ€è¦å¾—åˆ°12æ ¸å¿ƒçš„æœ€é«˜cpuä½¿ç”¨ç‡åå–æœ€å¤§å€¼ã€‚</p><p>ä»¥ä¸‹æ˜¯å®ç°æ­¤åŠŸèƒ½çš„æ­¥éª¤ï¼š</p><ol><li><p><strong>åˆ›å»ºé’‰é’‰æœºå™¨äººå¹¶è·å–Webhook URLï¼š</strong></p><ul><li>ç™»å½•é’‰é’‰ï¼Œåˆ›å»ºè‡ªå®šä¹‰æœºå™¨äººå¹¶è·å–Webhook URLï¼Œç”¨äºå‘é€å‘Šè­¦ä¿¡æ¯ã€‚</li></ul></li><li><p><strong>ç¼–å†™Shellè„šæœ¬ï¼š</strong></p><ul><li>ç¼–å†™ä¸€ä¸ªShellè„šæœ¬æ¥æ£€æŸ¥ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œå¹¶åœ¨è¶…è¿‡é˜ˆå€¼æ—¶å‘é€é’‰é’‰å‘Šè­¦ã€‚</li></ul></li><li><p><strong>é…ç½®å®šæ—¶ä»»åŠ¡ï¼ˆcronï¼‰ï¼š</strong></p><ul><li>å°†è„šæœ¬é…ç½®ä¸ºå®šæ—¶ä»»åŠ¡ï¼Œå®šæœŸæ£€æŸ¥ç³»ç»Ÿèµ„æºçš„ä½¿ç”¨æƒ…å†µã€‚</li></ul></li></ol><h3 id="1-åˆ›å»ºé’‰é’‰æœºå™¨äººå¹¶è·å–Webhook-URL"><a href="#1-åˆ›å»ºé’‰é’‰æœºå™¨äººå¹¶è·å–Webhook-URL" class="headerlink" title="1. åˆ›å»ºé’‰é’‰æœºå™¨äººå¹¶è·å–Webhook URL"></a>1. åˆ›å»ºé’‰é’‰æœºå™¨äººå¹¶è·å–Webhook URL</h3><p>åœ¨é’‰é’‰ä¸­åˆ›å»ºè‡ªå®šä¹‰æœºå™¨äººï¼Œè®°å½•ä¸‹Webhook URLï¼Œè¿™å°†åœ¨è„šæœ¬ä¸­ç”¨äºå‘é€å‘Šè­¦ã€‚</p><ul><li>ä¾‹å¦‚ï¼š<a href="https://oapi.dingtalk.com/robot/send?access_token=073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5">https://oapi.dingtalk.com/robot/send?access_token=073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5</a></li></ul><h3 id="2-ç¼–å†™Shellè„šæœ¬"><a href="#2-ç¼–å†™Shellè„šæœ¬" class="headerlink" title="2. ç¼–å†™Shellè„šæœ¬"></a>2. ç¼–å†™Shellè„šæœ¬</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹Shellè„šæœ¬<code>monitor.sh</code>ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br><span class="hljs-comment"># è·å–cpuä½¿ç”¨ç‡</span><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">get_cpu_usage</span></span>()&#123;<br>    <span class="hljs-built_in">echo</span> $(top -bn1 | grep <span class="hljs-string">&quot;Cpu(s)&quot;</span> | awk <span class="hljs-string">&#x27;&#123;print 100 - $8&#125;&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;printf &quot;%.2f&quot;, $1&#125;&#x27;</span>)<br>&#125;<br><br><span class="hljs-comment"># è·å–ç£ç›˜ä½¿ç”¨ç‡</span><br>data_name=<span class="hljs-string">&quot;/&quot;</span> <br>diskUsage=$(<span class="hljs-built_in">df</span> -h | grep -w <span class="hljs-variable">$data_name</span> | awk <span class="hljs-string">&#x27;&#123;print $5&#125;&#x27;</span> | sed <span class="hljs-string">&#x27;s/%//&#x27;</span>)<br><br><span class="hljs-comment"># è·å–å†…å­˜æƒ…å†µ</span><br>mem_total=$(free -m | awk <span class="hljs-string">&#x27;NR==2 &#123;print $2&#125;&#x27;</span>)<br>mem_used=$(free -m | awk <span class="hljs-string">&#x27;NR==2 &#123;print $3&#125;&#x27;</span>)<br><br><span class="hljs-comment"># ç»Ÿè®¡å†…å­˜ä½¿ç”¨ç‡</span><br>mem_used_percent=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;scale=2; (<span class="hljs-variable">$mem_used</span> / <span class="hljs-variable">$mem_total</span>) * 100&quot;</span> | bc)<br><br><span class="hljs-comment"># è·å–æŠ¥è­¦æ—¶é—´</span><br>now_time=$(<span class="hljs-built_in">date</span> <span class="hljs-string">&#x27;+%F %T&#x27;</span>)<br><br>user=<span class="hljs-string">&quot;18857415467&quot;</span><br><br><span class="hljs-comment"># ä¸»æœºä¿¡æ¯</span><br>Date_time=$(<span class="hljs-built_in">date</span> <span class="hljs-string">&quot;+%Y-%m-%d--%H:%M:%S&quot;</span>)<br>IP_addr=$(hostname -I | awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span>)<br><br><span class="hljs-comment"># webhook url</span><br>Dingding_Url=<span class="hljs-string">&quot;https://oapi.dingtalk.com/robot/send?access_token=073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5&quot;</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">SendDownMessageToDingding</span></span>()&#123;<br>    <span class="hljs-comment"># å‘é€é’‰é’‰æ¶ˆæ¯</span><br>    curl -s <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;Dingding_Url&#125;</span>&quot;</span> -H <span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span> -d <span class="hljs-string">&quot;</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">     &#x27;msgtype&#x27;: &#x27;text&#x27;,</span><br><span class="hljs-string">     &#x27;text&#x27;: &#123;&#x27;content&#x27;: &#x27;èµ„æºè€—å°½è­¦å‘Šï¼\nå·¡æŸ¥æ—¶é—´ï¼š<span class="hljs-variable">$&#123;Date_time&#125;</span>\nIPåœ°å€ï¼š<span class="hljs-variable">$&#123;IP_addr&#125;</span>\nèµ„æºçŠ¶å†µå¦‚ä¸‹:\nã€CPUä½¿ç”¨ç‡ï¼š<span class="hljs-variable">$&#123;cpuUsage&#125;</span>%ã€‘\nã€ç£ç›˜ä½¿ç”¨ç‡ï¼š<span class="hljs-variable">$&#123;diskUsage&#125;</span>%ã€‘\nã€å†…å­˜ä½¿ç”¨ç‡ï¼š<span class="hljs-variable">$&#123;mem_used_percent&#125;</span>%ã€‘&#x27;&#125;,</span><br><span class="hljs-string">     &#x27;at&#x27;: &#123;&#x27;atMobiles&#x27;: [&#x27;<span class="hljs-variable">$&#123;user&#125;</span>&#x27;], &#x27;isAtAll&#x27;: true&#125;</span><br><span class="hljs-string">      &#125;&quot;</span><br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">check</span></span>()&#123;<br>    cpuUsage=$(get_cpu_usage)<br>    <span class="hljs-keyword">if</span> (( $(echo &quot;<span class="hljs-variable">$cpuUsage</span> &gt; <span class="hljs-number">90</span>&quot; | bc -l) )); <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ£€æµ‹åˆ°CPUä½¿ç”¨ç‡é«˜äº90%ï¼Œå¼€å§‹1åˆ†é’Ÿç›‘æ§...&quot;</span><br>        high_cpu_duration=0<br>        <span class="hljs-keyword">for</span> ((i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-number">60</span>; i++)); <span class="hljs-keyword">do</span><br>            <span class="hljs-built_in">sleep</span> 1<br>            cpuUsage=$(get_cpu_usage)<br>            <span class="hljs-keyword">if</span> (( $(echo &quot;<span class="hljs-variable">$cpuUsage</span> &gt; <span class="hljs-number">90</span>&quot; | bc -l) )); <span class="hljs-keyword">then</span><br>                ((high_cpu_duration++))<br>            <span class="hljs-keyword">else</span><br>                high_cpu_duration=0<br>            <span class="hljs-keyword">fi</span><br><br>            <span class="hljs-keyword">if</span> (( high_cpu_duration &gt;= <span class="hljs-number">60</span> )); <span class="hljs-keyword">then</span><br>                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;CPUä½¿ç”¨ç‡æŒç»­é«˜äº90%è¶…è¿‡1åˆ†é’Ÿï¼Œå‘é€è­¦æŠ¥...&quot;</span><br>                SendDownMessageToDingding<br>                <span class="hljs-built_in">break</span><br>            <span class="hljs-keyword">fi</span><br>        <span class="hljs-keyword">done</span><br>    <span class="hljs-keyword">fi</span><br><br>    <span class="hljs-keyword">if</span> (( $(echo &quot;<span class="hljs-variable">$diskUsage</span> &gt; <span class="hljs-number">80</span>&quot; | bc -l) )) || (( $(echo &quot;<span class="hljs-variable">$mem_used_percent</span> &gt; <span class="hljs-number">80</span>&quot; | bc -l) )); <span class="hljs-keyword">then</span><br>        SendDownMessageToDingding<br>    <span class="hljs-keyword">fi</span><br>&#125;<br><br>check<br><br></code></pre></td></tr></table></figure><p>å°†<code>073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5</code>æ›¿æ¢ä¸ºä½ ä»é’‰é’‰è·å–çš„Webhook URLçš„tokenã€‚</p><h3 id="3-é…ç½®å®šæ—¶ä»»åŠ¡ï¼ˆcronï¼‰"><a href="#3-é…ç½®å®šæ—¶ä»»åŠ¡ï¼ˆcronï¼‰" class="headerlink" title="3. é…ç½®å®šæ—¶ä»»åŠ¡ï¼ˆcronï¼‰"></a>3. é…ç½®å®šæ—¶ä»»åŠ¡ï¼ˆcronï¼‰</h3><p>é€šè¿‡cronå®šæœŸè¿è¡Œè¿™ä¸ªè„šæœ¬ã€‚é¦–å…ˆï¼Œç¼–è¾‘croné…ç½®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">crontab -e<br></code></pre></td></tr></table></figure><p>ç„¶åæ·»åŠ ä»¥ä¸‹å†…å®¹ä»¥æ¯åˆ†é’Ÿè¿è¡Œä¸€æ¬¡è„šæœ¬ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">* * * * * /path/to/monitor.sh<br></code></pre></td></tr></table></figure><p>ç¡®ä¿è„šæœ¬<code>monitor.sh</code>æœ‰æ‰§è¡Œæƒé™ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">chmod</span> +x /path/to/monitor.sh<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸Šè¿°è„šæœ¬å’Œcroné…ç½®å°†ç›‘æ§CPUã€å†…å­˜å’Œç¡¬ç›˜ä½¿ç”¨æƒ…å†µï¼Œå¹¶åœ¨è¶…è¿‡è®¾å®šçš„é˜ˆå€¼æ—¶é€šè¿‡é’‰é’‰å‘é€å‘Šè­¦æ¶ˆæ¯ã€‚ä½ å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´è„šæœ¬çš„æ‰§è¡Œé¢‘ç‡å’Œå‘Šè­¦é˜ˆå€¼ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æŠ¥è­¦</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­¦ä¹ itç½‘ç«™æ¨è</title>
    <link href="/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/"/>
    <url>/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/</url>
    
    <content type="html"><![CDATA[<p>åˆ†äº«ä¸€äº›å¥½çš„ç½‘ç«™ï¼Œä¸ªäººå­¦ä¹ å¸¸ç”¨çš„ç½‘ç«™ï¼Œä½œä¸ºåˆ†äº«åç»­æŒç»­æ›´æ–°.</p><h2 id="ç½‘ç«™èµ„æº"><a href="#ç½‘ç«™èµ„æº" class="headerlink" title="ç½‘ç«™èµ„æº"></a>ç½‘ç«™èµ„æº</h2><h3 id="æŠ€æœ¯å­¦ä¹ ç½‘ç«™"><a href="#æŠ€æœ¯å­¦ä¹ ç½‘ç«™" class="headerlink" title="æŠ€æœ¯å­¦ä¹ ç½‘ç«™"></a>æŠ€æœ¯å­¦ä¹ ç½‘ç«™</h3><ul><li>ç›—ç‰ˆä¹¦ç½‘ç«™ï¼š<a href="https://zh.singlelogin.re/">https://zh.singlelogin.re/</a></li><li>æ¶æ„å¸ˆå­¦ä¹  <a href="https://bugstack.cn/md/other/guide-to-reading.html#%E4%B8%80%E3%80%81%E6%9C%AC%E7%AB%99%E7%9F%A5%E8%AF%86%E9%98%85%E8%A7%88" title="https://bugstack.cn/md/other/guide-to-reading.html#ä¸€ã€æœ¬ç«™çŸ¥è¯†é˜…è§ˆ">https://bugstack.cn/md/other/guide-to-reading.html#ä¸€ã€æœ¬ç«™çŸ¥è¯†é˜…è§ˆ</a></li><li>æºç å­¦ä¹ ï¼š<a href="https://doocs.github.io/source-code-hunter/#/" title="https://doocs.github.io/source-code-hunter/#/">https://doocs.github.io/source-code-hunter/#/</a></li><li>äº’è”ç½‘ Java å·¥ç¨‹å¸ˆè¿›é˜¶çŸ¥è¯†å®Œå…¨æ‰«ç›²:  <a href="https://doocs.github.io/advanced-java/#/?id=%E4%BA%92%E8%81%94%E7%BD%91-java-%E5%B7%A5%E7%A8%8B%E5%B8%88%E8%BF%9B%E9%98%B6%E7%9F%A5%E8%AF%86%E5%AE%8C%E5%85%A8%E6%89%AB%E7%9B%B2" title="https://doocs.github.io/advanced-java/#/?id=äº’è”ç½‘-java-å·¥ç¨‹å¸ˆè¿›é˜¶çŸ¥è¯†å®Œå…¨æ‰«ç›²">https://doocs.github.io/advanced-java/#/?id=äº’è”ç½‘-java-å·¥ç¨‹å¸ˆè¿›é˜¶çŸ¥è¯†å®Œå…¨æ‰«ç›²</a></li><li>å¶è‰¯è¾°ã®å­¦ä¹ ç¬”è®° <a href="https://yangzhiwen911.github.io/zh/guide/" title="https://yangzhiwen911.github.io/zh/guide/">https://yangzhiwen911.github.io/zh/guide/</a></li><li>å›¾çµJavaæ¶æ„å¸ˆå­¦ä¹ è·¯çº¿(ç‚¹å‡»é“¾æ¥çœ‹æ–°ç‰ˆæœ¬) <a href="https://www.processon.com/view/link/5eccea8fe0b34d5f263038f0#map" title="https://www.processon.com/view/link/5eccea8fe0b34d5f263038f0#map">https://www.processon.com/view/link/5eccea8fe0b34d5f263038f0#map</a></li><li><a href="https://www.thebyte.com.cn/" title="æ·±å…¥æ¶æ„åŸç†ä¸å®è·µ">æ·±å…¥æ¶æ„åŸç†ä¸å®è·µ</a> <a href="https://www.thebyte.com.cn/" title="https://www.thebyte.com.cn/">https://www.thebyte.com.cn/</a>;</li><li>Kubernetes å®è·µæŒ‡å— <a href="https://imroc.cc/kubernetes/" title="https://imroc.cc/kubernetes/">https://imroc.cc/kubernetes/</a>;<br>vipç ´è§£è§†é¢‘  <a href="https://share.xiaole88.com/%E5%85%B6%E4%BB%96%E4%B8%9C%E8%A5%BF/%E8%80%81%E9%BD%90%E7%9A%84IT%E5%8A%A0%E6%B2%B9%E7%AB%99" title="https://share.xiaole88.com/å…¶ä»–ä¸œè¥¿/è€é½çš„ITåŠ æ²¹ç«™">https://share.xiaole88.com/å…¶ä»–ä¸œè¥¿/è€é½çš„ITåŠ æ²¹ç«™</a><br><a href="https://share.xiaole88.com/K8%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E7%AE%B1" title="https://share.xiaole88.com/K8æ¸—é€å·¥å…·ç®±">https://share.xiaole88.com/K8æ¸—é€å·¥å…·ç®±</a></li></ul><h3 id="å·¥å…·ç½‘ç«™ï¼š"><a href="#å·¥å…·ç½‘ç«™ï¼š" class="headerlink" title="å·¥å…·ç½‘ç«™ï¼š"></a>å·¥å…·ç½‘ç«™ï¼š</h3><ul><li><p><a href="https://www.flickr.com/" title="https://www.flickr.com/">https://www.flickr.com/</a>   å¥½çš„ç…§ç‰‡ä¸èƒ½æˆ‘ä¸€ä¸ªäººåˆ†äº«</p></li><li><p><a href="https://markmap.js.org/repl" title="https://markmap.js.org/repl">https://markmap.js.org/repl</a>  å°†markmap ç”Ÿæˆå›¾ä¾‹</p></li><li><p>è‹¹æœidç›¸å…³ï¼š</p><p><a href="https://appleid.stryun.top/" title="https://appleid.stryun.top/">https://appleid.stryun.top/</a></p><p><a href="https://apple.hutaosubconverter.com/hutao" title="https://apple.hutaosubconverter.com/hutao">https://apple.hutaosubconverter.com/hutao</a></p></li></ul><h3 id="è¥é”€æ–¹å‘å­¦ä¹ ï¼š"><a href="#è¥é”€æ–¹å‘å­¦ä¹ ï¼š" class="headerlink" title="è¥é”€æ–¹å‘å­¦ä¹ ï¼š"></a>è¥é”€æ–¹å‘å­¦ä¹ ï¼š</h3><ul><li><p>å®£ä¼ å›¾ç”Ÿæˆ <a href="https://design.palxp.cn/home?tempid=1188" title="https://design.palxp.cn/home?tempid=1188">https://design.palxp.cn/home?tempid=1188</a></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>åˆ†äº«</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç½‘ç«™èµ„æº</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
